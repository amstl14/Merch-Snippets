<!doctype html>
{% load staticfiles %}
{% load ludega_art_filters %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Ludega</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="96x96" href="{% static "ludega_art/img/favicon.png" %}">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="{% static "ludega_art/css/material-kit.css" %}" rel="stylesheet"/>-->
    <link href="{% static "ludega_art/css/bootstrap.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/gsdk.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/examples.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.css" %}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <!-- link to the SqPaymentForm library -->
    <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- link to the local SqPaymentForm initialization -->
    <script src="{% static 'ludega_art/js/sqpaymentform.js' %}" type="text/javascript"></script>

    <!-- link to the custom styles for SqPaymentForm -->
    <link href="{% static "ludega_art/css/sqpaymentform.css" %}" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="{% static "ludega_art/css/pe-icon-7-stroke.css" %}" rel="stylesheet" />-->
    <style>
        .input-group-addon.primary {
            color: rgb(255, 255, 255);
            background-color: rgb(50, 118, 177);
            border-color: rgb(40, 94, 142);
        }

        .input-group-addon.success {
            color: rgb(255, 255, 255);
            background-color: rgb(92, 184, 92);
            border-color: rgb(76, 174, 76);
        }

        .input-group-addon.info {
            color: rgb(255, 255, 255);
            background-color: rgb(57, 179, 215);
            border-color: rgb(38, 154, 188);
        }

        .input-group-addon.warning {
            color: rgb(255, 255, 255);
            background-color: rgb(240, 173, 78);
            border-color: rgb(238, 162, 54);
        }

        .input-group-addon.danger {
            color: rgb(255, 255, 255);
            background-color: rgb(217, 83, 79);
            border-color: rgb(212, 63, 58);
        }
    </style>
</head>
<body class="ecommerce">
<nav id="navBar1337" class="navbar navbar-transparent navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button id="menu-toggle" type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar bar1"></span>
                <span class="icon-bar bar2"></span>
                <span class="icon-bar bar3"></span>
            </button>
            <!--<a class="navbar-brand" href="http://ludega.com"><i class="fa fa-chevron-left"></i> Back to Kit</a>-->
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                {#                <li>#}
                {#                    <a href="#">#}
                {#                        About LudegaArt#}
                {#                        <!--<b class="caret"></b>-->#}
                {#                    </a>#}
                {#                </li>#}
                <li>
                    <a href="" data-toggle="modal" data-target="#contactModal">
                        Contact Us
                        <!--<b class="caret"></b>-->
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        More
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-with-icons">
                        <!--<li>
                                    <a href="contact-us.html">
                                    <i class="pe-7s-mail-open-file"></i> Contact Us
                                    </a>
                                </li>
                                <li>
                                    <a href="about-us.html">
                                    <i class="pe-7s-info"></i> Blog Page
                                    </a>
                                </li>
                                <li>
                                    <a href="pricing.html">
                                    <i class="pe-7s-cash"></i> Pricing Page
                                    </a>
                                </li>-->
                        <li>
                            <a href="http://ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega
                            </a>
                        </li>
                        <li>
                            <a href="http://brokerage.ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Brokerage
                            </a>
                        </li>
                        <li>
                            <a href="http://104.131.86.135/" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Window Cleaning
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a id="cartBtn" href="#" class="btn btn-round btn-default cartBtn">Cart ({{ cart_count }} Items)</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<div class="wrapper">
    <div class="img-wrapper">
        <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/banner2.png' %}">
    </div>

    <!--<div class="parallax filter-black">
        <div class="parallax-image">
            <div class="col-sm-12 col-md-12 col-lg-12" style="padding-left: 0px; padding-right: 0px;">
                <img id="titleImage" src="{% static 'ludega_art/img/header.jpg' %}" alt="..." style="height: 100%; width:100%;"/>
            </div>
        </div>
        <br><br><br><br>
        <div class="small-info">
            {#            <h1 style="font-family:longtime">Ludega</h1>#}
            {#            <h3 style="font-family:longtime">Ludega Merch</h3>#}
        </div>
    </div>-->
    <!--<div class="section">
                <div class="container">
                    <h2 class="section-title">Special Offers</h2>
                    {% if top_products_list %}
                    <div id="mainContentRow" class="row">
                        {% for product in top_products_list %}
                        <div class="col-md-4">
                            <div class="card card-product card-plain">
                                <div class="image">
                                    <a>
                                    <img src="/{{product.image_file}}"  alt="..."/>
                                    </a>
                                </div>
                                <div class="content">
                                    <a href="#">
                                        <h4 class="title">{{product.name}}</h4>
                                    </a>
                                    <div class="footer">
                                        <span class="price price-old"> &dollar;1,930</span>
                                        <span class="price price-new">&dollar;1,330</span>
                                        <button class="btn btn-danger btn-simple pull-right" rel="tooltip" title="Remove from wishlist" data-placement="left">
                                        <i class="fa fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>-->
    <!-- section -->
    <div id="cartSection" class="section" style="display:none;">
        <div id="cartContainer" class="container my-card-dark">
            <button type="button" style="margin-top:15px;" id="closeCartBtn" class="close" aria-hidden="true">×</button>
            <h2 id="shoppingCartTitle" class="section-title">Your Shopping Cart</h2>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <!-- nesting -->
                        <div id="cartMainProdRow" class="row">
                            <!-- Cart Items will go here...-->
                        </div>
                        <div class="row" style="height:15px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <button id="cartContinueShoppingBtn" class="btn btn btn-success btn-block"
                                            style="margin-bottom:10px;">Continue Shopping
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button id="checkOut1" class="btn btn-info btn-block" style="margin-bottom:10px;"
                                            data-toggle="modal"
                                            onclick="initialize_checkout_modal()">Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="height:15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mainProductSection" class="section">
        <div id="productSectionContainer" class="container" style="max-width:100%;">
            <h2 class="section-title">Find what you need</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="filterDiv" class="card card-refine">
                        <!-- card-plain for no border -->
                        <div class="header">
                            <h4 class="title">Refine
                                <!--<button class="btn btn-default btn-xs btn pull-right btn-simple" rel="tooltip" title="Reset Filter">
                                    <i id="refreshFilterBtn" class="fa fa-refresh"></i>
                                </button>-->
                            </h4>
                        </div>
                        <div class="content">
                            <div class="panel-group" id="accordion">
                                <!-- Commenting out this dollar range section for now -->
                                <!--
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                <h6 class="panel-title">
                                                  <a data-toggle="collapse" href="#refinePrice">
                                                    Price Range
                                                    <i class="fa fa-caret-up pull-right"></i>
                                                  </a>
                                                </h6>
                                              </div>
                                              <div id="refinePrice" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                   <span class="price price-left">&dollar; 100</span>
                                                   <span class="price price-right">&dollar; 850</span>
                                                   <div class="clearfix"></div>
                                                   <div id="refine-price-range" class="slider slider-info"></div>
                                                </div>
                                              </div>
                                            </div>
                                            -->
                                {#                                <div class="panel panel-default">#}
                                {#                                    <div class="panel-heading">#}
                                {#                                        <h6 class="panel-title">#}
                                {#                                            <a data-toggle="collapse" href="#refineImage" class="collapsed">#}
                                {#                                                Images#}
                                {#                                                <i class="fa fa-caret-up pull-right"></i>#}
                                {#                                            </a>#}
                                {#                                        </h6>#}
                                {#                                    </div>#}
                                {#                                    <div id="refineImage" class="panel-collapse collapse">#}
                                {#                                        <div class="panel-body">#}
                                {#                                            <label class="checkbox">#}
                                {#                                                <input type="checkbox" id="AllImagesCheckBox" value=""#}
                                {#                                                       data-toggle="checkbox" checked="">#}
                                {#                                                All#}
                                {#                                            </label>#}
                                {#                                            {% if images %}#}
                                {#                                                {% for image in images %}#}
                                {#                                                    <label class="checkbox">#}
                                {#                                                        <input type="checkbox"#}
                                {#                                                               id="{{ image.name|str_replace:' ,' }}CheckBox" value=""#}
                                {#                                                               data-toggle="checkbox">#}
                                {#                                                        {{ image.name }}#}
                                {#                                                    </label>#}
                                {#                                                {% endfor %}#}
                                {#                                            {% endif %}#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineClothing" class="collapsed">
                                                  Clothing
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineClothing" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                <label class="checkbox">
                                                  <input type="checkbox" id="AllClothingCheckBox" value="" data-toggle="checkbox" checked="">
                                                  All
                                                </label>
                                                {% if types %}
                                                    {% for type in types %}
                                                        {% if type.is_clothing %}
                                                          <label class="checkbox">
                                                            <input type="checkbox" id="
                                    {{type.display_name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                            {{type.display_name}}
                                                          </label>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                              </div>
                                            </div>
                                            </div> -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            <a data-toggle="collapse" href="#refineProduct" class="collapsed">
                                                Products
                                                <i class="fa fa-caret-up pull-right"></i>
                                            </a>
                                        </h6>
                                    </div>
                                    <div id="refineProduct" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label class="checkbox">
                                                <input type="checkbox" id="AllProductsCheckBox" value=""
                                                       data-toggle="checkbox" checked="">
                                                All
                                            </label>
                                            {% if types %}
                                                {% for type in types %}
                                                    {% if not type.sub_type_only %}
                                                        <label class="checkbox">
                                                            <input type="checkbox"
                                                                   id="{{ type.display_name|str_replace:' ,' }}CheckBox"
                                                                   value="" data-toggle="checkbox">
                                                            {{ type.display_name }}
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineColor" class="collapsed">
                                                  Colors
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineColor" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                 <label class="checkbox">
                                                    <input type="checkbox" id="AllColorsCheckBox" value="" data-toggle="checkbox" checked="">
                                                    All
                                                  </label>
                                                  {% if colors %}
                                                      {% for color in colors %}
                                                        <label class="checkbox">
                                                          <input type="checkbox" id="{{color.name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                          {{color.name}}
                                                        </label>
                                                      {% endfor %}
                                                  {% endif %}
                                              </div>
                                            </div>
                                            </div> <!-- end panel -->
                            </div>
                        </div>
                    </div>
                    <!-- end card -->
                </div>
                <div class="col-md-9" id="productColumn">
                    <div class="row" id="row0">
                        {% if products %}
                            {% for product in products %}
                                {% if product.display %}
                                    <div class="col-sm-4"
                                         data-id="{{ product.id }}"
                                         data-image="{{ product.image_file }}"
                                            {% with colors_=product.colors.all %}
                                         data-colors="
                                    {% for color in colors_ %}
                                    {{ color }},
                                    {% endfor %}"
                                         data-product_type="{{ product.product_type.display_name }}"
                                         data-is_clothing="{{ product.product_type.is_clothing }}"
                                                >
                                            {% endwith %}
                                    <div data-toggle="modal" onmouseover="prodHover({{ product.id }})"
                                         data-id="{{ product.id }}" data-target="#prodModal"
                                         class="fake-link card card-product card-plain my-card-light"
                                         id="prod{{ product.id }}">
                                        <div style="overflow:visible;padding-top:10px;" class="image text-center">
                                            <div id="topImgSpacerProdId{{ product.id }}"
                                                 style="overflow:visible;height:0px"
                                                 ;></div>
                                            <a>
                                                <img id="imgProdId{{ product.id }}" class="my-img-dark"
                                                     style="max-width:90%;max-height:300px;height:auto;width:auto;"
                                                     src="/{{ product.image_file }}" alt="..."/>
                                            </a>
                                            <div id="bottomImgSpacerProdId{{ product.id }}" style="height:0px" ;></div>
                                        </div>
                                        <div class="content text-center">
                                            <span>
                                                <a>
                                                    <h4 class="title">{{ product.name }}</h4>
                                                </a>
                                            </span>
                                            <!--<p class="description">
                                                {{product.description}}
                                                </p>-->
                                            <div class="footer">
                                                <span class="price"> {{ product.id|get_price_str }}</span>
                                                <button onclick="filterBtnOnClick('{{ product.product_type }}')"
                                                        class="btn btn-danger btn-tooltip btn-simple pull-right"
                                                        rel="tooltip" title="Filter to {{ product.product_type }}"
                                                        data-placement="top">
                                                    <!--<i style="align-self:right;" class="fa fa-filter"></i>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end card -->
                                    </div>
                                    <!-- Each row should only contain 3 products -->
                                    {% if forloop.counter|divisibleby:3 == True %}
                                        <!-- End the previous <div class="row">  -->
                                        </div>
                                        <!-- Determine the row id (which is "row" + rowNum)                -->
                                        {% with rowCount=forloop.counter|divnum:3 %}
                                            {% with rowid="row"|addstr:rowCount %}
                                                <div class="row" id="{{ rowid }}">
                                            {% endwith %} <!-- Ending "with rowCount=forloop.counter|divnum:3" -->
                                        {% endwith %} <!-- Ending "with rowid="row"|addstr:rowCount"       -->
                                    {% endif %}
                                {% endif %}
                            {% endfor %} <!-- Ending "for product in products" -->
                        {% endif %}  <!-- Ending "if products"             -->
                        </div>
                    <div class="space-50"></div>
                    <div class="col-md-3 col-md-offset-4" id="loadMoreCol">
                        <button rel="tooltip" title="" style="margin-bottom:1px;" class="btn btn-info btn-round"
                                id="loadMore" data-toggle="morphing" data-rotation-color="blue">Load more...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- section -->
<div id="footerSpacer" class="space-50"></div>
<div class="subscribe-line subscribe-line-transparent"
     style="background-image: url('{% static 'ludega_art/img/merch7.png' %}')">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <form class="">
                    <div class="form-group">
                        <input type="text" value="" class="form-control" placeholder="Enter your email here...">
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-info btn-fill btn-block">Subscribe Now!</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer footer-big footer-default">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="id">Bahasa Indonesia</option>
                        <option value="ms">Bahasa Melayu</option>
                        <option value="ca">Català</option>
                        <option value="da">Dansk</option>
                        <option value="de">Deutsch</option>
                        <option value="en" selected="">English</option>
                        <option value="es">Español</option>
                        <option value="el">Eλληνικά</option>
                        <option value="fr">Français</option>
                        <option value="it">Italiano</option>
                        <option value="hu">Magyar</option>
                        <option value="nl">Nederlands</option>
                        <option value="no">Norsk</option>
                        <option value="pl">Polski</option>
                        <option value="pt">Português</option>
                        <option value="fi">Suomi</option>
                        <option value="sv">Svenska</option>
                        <option value="tr">Türkçe</option>
                        <option value="is">Íslenska</option>
                        <option value="cs">Čeština</option>
                        <option value="ru">Русский</option>
                        <option value="th">ภาษาไทย</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="ARS">ARS</option>
                        <option value="AUD">AUD</option>
                        <option value="BRL">BRL</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="CZK">CZK</option>
                        <option value="DKK">DKK</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="HKD">HKD</option>
                        <option value="HUF">HUF</option>
                        <option value="IDR">IDR</option>
                        <option value="ILS">ILS</option>
                        <option value="INR">INR</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                        <option value="MYR">MYR</option>
                        <option value="MXN">MXN</option>
                        <option value="NOK">NOK</option>
                        <option value="NZD">NZD</option>
                        <option value="PHP">PHP</option>
                        <option value="PLN">PLN</option>
                        <option value="RUB">RUB</option>
                        <option value="SEK">SEK</option>
                        <option value="SGD">SGD</option>
                        <option value="TWD">TWD</option>
                        <option value="USD" selected="">USD</option>
                        <option value="VND">VND</option>
                        <option value="ZAR">ZAR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-1">
                <h5 class="title">Company</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Our Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                About Us
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3 col-md-offset-1">
                <h5 class="title"> Help and Support</h5>
                <nav>
                    <ul>
                        <li>
                            <a data-toggle="modal" data-target="#contactModal">
                                Contact Us
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Terms & Conditions
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Money Back
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3">
                <h5 class="title">Latest News</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i> <b>We're Live!</b>
                                Ludega Merch is now live, feel free to place an order.
                                <hr class="hr-small">
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i>
                                <b>New merchandise!</b> New merch has been added, check out some of the new inventory.
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr/>
        <div class="social-area text-center">
            <h5>Join us on</h5>
            <a href="https://www.facebook.com/ludega.merch.3" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-facebook"></i>
            </a>
            <a href="https://mobile.twitter.com/LudegaMerch" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-twitter"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-google-plus"></i>#}
{#            </a>#}
            <a href="https://www.instagram.com/ludegamerch/" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-instagram"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-linkedin"></i>#}
{#            </a>#}
        </div>
        <div class="copyright">
            &copy; 2017 <a href="http://www.ludega.com">Ludega</a> - It Will Be.
        </div>
    </div>
</footer>
</div> <!-- wrapper -->

<div id="largeImgModal" class="img-modal">
    <!-- The Close Button -->
    <span class="my-close" onclick="document.getElementById('largeImgModal').style.display='none'">&times;</span>
    <!-- Modal Content (The Image) -->
    <img class="img-modal-content" id="largeImg" src="">
    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<!--<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true" style="display: none;">-->
<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <div class="modal-body">
                <!--<div class="container">-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="tab-content">
                            <div class="tab-pane active" id="product-page6">
                                <img class="my-prod-modal-img" onclick="increaseImgWithModal('123')" id="prodModalImage"
                                     style="-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-width:100%;max-height:500px;margin:auto;display:block;"
                                     src="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <a>
                                <h3 id="prodModalTitle" class="title"></h3>
                            </a>
                            <!--<p class="description">
                                        </p>-->
                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="descriptionHeading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleDescriptionHeader" class="collapsed">
                                            Product Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleDescriptionHeader" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="descriptionHeading" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdDescription">
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="typeDescriptionHeading">
                                    <h4 class="panel-title">
                                        <a id="collapsibleTypeDescriptionClickable" class="collapsed"
                                           data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleTypeDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleTypeDescriptionHeader">
                                            Type Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleTypeDescriptionHeader" class="panel-collapse collapse"
                                     role="tabpanel" aria-labelledby="typeDescriptionHeading" aria-expanded="false"
                                     style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdTypeDescription">
                                        <p>You haven't selected a Product Type yet.</p>
                                        <!--<ul style="padding-left: 20px;">
                                                    <li style="list-style-position: outside;"> Fits small to size</li>
                                                    <li style="list-style-position: outside;"> Model wears a UK 40R</li>
                                                    <li style="list-style-position: outside;"> Model measures: chest 39"/ 99cm, height 6'1"/ 185cm</li>
                                                </ul>-->
                                    </div>
                                </div>
                            </div>
                            <!--<div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                          <h4 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                              Details
                                            </a>
                                          </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false" style="height: 0px;">
                                          <div class="panel-body">
                                            85% wool, 15% linen. Dry-clean only
                                          </div>
                                        </div>
                                        </div>-->
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="headingFour">
                                    <h4 class="panel-title">
                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Returns
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="headingFour" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body">
                                        Here at Ludega Merch, we pride ourselves in having a friendly return policy.
                                        It's simple; if you're not 100% satisfied with your product, simply return it to
                                        us in the condition it was received and we'll refund or replace your order
                                        (shipping not included) and give you a 5% discount on your next purchase
                                        regardless of purchase amount.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Acordeon  -->
                        <div class="row align-items-center">
                            <div class="prod-options pull-down">
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodTypeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Type</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodSizeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Size</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12" id="priceDivCol" style="height:0px;opacity:0;">
                                    <a align="right">
                                        <h3 id="prodModalPrice" class="title">Select a Product Type and Size for
                                            Pricing!</h3>
                                    </a>
                                </div>
                                <div class="col-md-12" style="height:60px;">
                                    <div class="pull-right" style="margin-top:10px;">
                                        <button type="button" id="prodModalAddToCart" class="btn btn-fill">Add to Cart
                                        </button>
                                        <button type="button" id="prodModalBuyNow" class="btn btn-fill">Buy Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                       <div class="col-md-4"></div>
                       <div class="col-md-4 text-center"><a><h3 class="title">Similar Products</h3></a></div>
                       <div class="col-md-4"></div>
                   </div>
                  <div class="row">
                  <div class="col-md-12">
                   <div class="nbs-flexisel-container">
                           <div class="nbs-flexisel-inner">
                              <ul class="nav nav-text nbs-flexisel-ul" role="tablist" id="relatedProdsScroller" style="left: -113.75px;">
                              </ul>
                           </div>
                           <div class="nbs-flexisel-nav-left" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-left"></i></div>
                           <div class="nbs-flexisel-nav-right" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-right"></i></div>
                        </div>
                      </div>
                    </div>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
        <!--</div>-->
    </div>
</div>
</div>
<form id="hiddenForm"></form>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <!--<button type="button" id="contactModalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            <div class="modal-body">
                <div id="contactContainer" class="col-md-offset-1">
                    <h2 class="section-title">Send us a message</h2>
                </div>
                <div class="row">
                    <!--<div class="separator line-separator">♦</div>-->
                    <div id="contactContainer" class="col-md-6 col-md-offset-1">
                        </p>
                        <form role="form" id="contact-form" method="post" data-color="blue">
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your name (optional)</label>
                                <input id="contactorName" placeholder="First & Last Name" type="text" name="name"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Email address (optional)</label>
                                <input id="contactorEmail" placeholder="Your personal email" type="email" name="email"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Phone (optional)</label>
                                <input id="contactorPhone" placeholder="Phone Nmber" type="text" name="phone"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your message</label>
                                <textarea name="message" class="form-control" id="contactorMessage" rows="6"
                                          required></textarea>
                                <span class="material-input"></span></div>
                            <div id="contactButtonContainer" class="submit">
                                <input id="sendEmail" type="submit" class="btn btn-info btn-fill" value="Send Message">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4 col-md-offset-1">
                        <div class="contact-info">
                            <!--<h5><i class="fa fa-map-marker text-muted"></i> Address</h5>
                            <p class="text-muted"> Bld Mihail Kogalniceanu, nr. 8,<br>
                                7652 Bucharest,<br>
                                Romania
                            </p><br>-->
                            <h5><i class="fa fa-phone text-muted"></i> 24/7 Live Support</h5>
                            <p class="text-muted"> Customer Support<br>
                                (720) 288-0674<br>
                                Mon - Sun, 12:00AM -11:59PM
                            </p><br>
                            <h5><i class="fa fa-envelope text-muted"></i> Email Us</h5>
                            <p class="text-muted"> Ludega Merch LLC<br>
                                customer.support@ludega.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ageVerifictaionModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" )>
            <div class="img-wrapper">
                <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/merch7.png' %}">
            </div>
            <div class="modal-header" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Age Verification</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <h5 class="text-center">Are you old enough to purchase these products?</h5>
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title text-center">
                                <i class="fa fa-info-circle"></i>
                                <a data-toggle="collapse" href="#collapse1">Why are we asking?</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse">
                            <div class="panel-body">THIS WEBSITE CONTAINS ADULT MATERIAL AND IS ONLY SUITABLE FOR THOSE 18
                OR OLDER. ALL CUSTOMERS FROM ARIZONA, CALIFORNIA, ILLINOIS, KANSAS, MASSACHUSETTS,
                MISSISSIPPI, MISSOURI, NEW JERSEY, NEW YORK, & OHIO MUST BE 21 YEARS OR OLDER. BY ENTERING
                THIS SITE, YOU CONFIRM THAT YOU ARE OF LEGAL AGE TO PURCHASE THESE PRODUCTS IN YOUR STATE.
                WARNING: TOBACCO PRODUCTS CONTAIN NICOTINE, AND NICOTINE IS AN ADDICTIVE CHEMICAL.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class=" btn btn-primary btn-block" onclick="$('#ageVerifictaionModal').modal('hide');">
                                Yes
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="btn btn-danger btn-block" onclick="ageVerificationNoClicked()">
                                No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="checkoutModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Checkout As Guest</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <div class="row">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <ul id="checkoutNavPills" class="nav nav-pills" role="tablist"
                            style="justify-content:center;display:flex;">
                            <li id="checkoutEmailli" class="active">
                                <a id="checkoutEmailHref" href="#email" role="tab" data-toggle="tab"
                                   aria-expanded="true">
                                    Email
                                </a>
                            </li>
                            <li id="checkoutShippingli" class="">
                                <a id="checkoutShippingHref" href="#shipping" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Shipping Info
                                </a>
                            </li>
                            <li id="checkoutPaymentli" class="">
                                <a id="checkoutPaymentHref" href="#payment" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="email">
                        <div class="row" style="padding-top: 15px;">
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                            <div class="col-sm-10 col-md-10 col-lg-10">
                                <div class="form-group">
                                    <label for="validate-email">Email</label>
                                    <input type="email" class="form-control" id="email_input" placeholder="Email"
                                           required=""><br>
                                    <label for="validate-email">Additional Notes [optional]</label>
                                    <textarea class="form-control" rows="5" id="notes" placeholder="Color, size, flavor, or any other additional comments."></textarea>
                                </div>
                            </div>
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="shipping">
                        <div id="" class="" style="padding:15px;">
                            <div class="form-group">
                                <select class="form-control" id="shippingOptions">
                                    <option value="0" selected="">USPS Priority - $9.00</option>
                                    {#                                    <option value="1">Free Shipping [All orders over $100, abuse of this will void your order.]</option>#}
                                </select>
                            </div>
                            <div class="">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left">
                                    <label for="exampleInputEmail1">First Name</label>
                                    <input type="text" class="form-control" id="firstName_input"
                                           aria-describedby="emailHelp" placeholder="First Name" required="">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right">
                                    <label for="exampleInputEmail1">Last Name</label>
                                    <input type="text" class="form-control" id="lastName_input"
                                           aria-describedby="emailHelp" placeholder="Last Name" required="">
                                </div>
                                <br>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Address</label>
                                <input type="text" class="form-control" id="address_input" aria-describedby="emailHelp"
                                       placeholder="Address Line 1">
                            </div>
                            <div class="form-group shove-bot">
                                <input type="text" class="form-control" id="address_input2" aria-describedby="emailHelp"
                                       placeholder="Address Line 2 [Optional]">
                            </div>
                            <div class="form-group shove-left">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="city_input" aria-describedby="emailHelp"
                                           placeholder="City">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="state_input"
                                           aria-describedby="emailHelp" placeholder="State/Province/Region">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-left">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="number" class="form-control" id="zip_input_shipping"
                                           aria-describedby="emailHelp" onchange="checkDenverZipCode()"
                                           placeholder="Zip/Postal Code">
                                </div>
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-right">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="country_input"
                                           aria-describedby="emailHelp" placeholder="Country">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div id="shippingAlert" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="payment">
                        <div id="sq-ccbox">
                            <!--
                                You should replace the action attribute of the form with the path of
                                the URL you want to POST the nonce to (for example, "/process-card")
                            -->
                            <div class="row">
                                <div id="cc-form" class="col-sm-12 col-md-12 col-lg-12 pad-cc-info">

                                    <table>
                                        <tbody>
                                        <tr>
                                            <th class="pad-left">Card Number</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-card-number"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">CVV</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-cvv"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Expiration Date</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-expiration-date"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Postal Code</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-postal-code"></div>
                                            </td>
                                        </tr>

                                        </tbody>
                                    </table>
                                    <!--After a nonce is generated it will be assigned to this hidden input field.-->
                                    <input type="hidden" id="card-nonce" name="nonce">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                            <div id="totalCreditCardForm"
                                 class="totalCC col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"></div>
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalBackBtn" type="button" class="btn btn-info"
                                    style="justify-content:left;display:flex;">
                                <i class="fa fa-arrow-left" style="padding-top: 2px;"></i>
                                Back
                            </button>
                        </div>
                        <div id="" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>

                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalNextBtn" type="button" class="btn btn-info">
                                Next
                                <i class="fa fa-arrow-right"></i>
                            </button>
                            <button id="checkoutModalPayBtn" type="button" onclick="attemptCheckout(event)"
                                    class="btn btn-info">Confirm & Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header"></div>
            <div class="">

                <div class="row marketing">

                    <div class="col-lg-12">

                        <h4><b>Product Name</b></h4>
                        <hr/>

                        <div>
                            <h4>Success - your order is confirmed!</h4>
                            <h5>Order number:
                                <div id="orderNumber"> orderNumber</div>
                            </h5>
                            <hr/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">Shipping Address
                                    <ul class="list-group">
                                        <li class="list-group-item" id="orderName">firstName lastName</li>
                                        <li class="list-group-item" id="orderEmail">email</li>
                                        <li class="list-group-item" id="orderAddress">address</li>
                                        <li class="list-group-item" id="orderZip">state city zip</li>
                                        <li class="list-group-item" id="orderCountry">country</li>
                                    </ul>

                                </div>
                                <div class="col-xs-6 text-right">
                                    <h1><span class="glyphicon glyphicon glyphicon-cloud-download"
                                              aria-hidden="true"></span></h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <p><span class="glyphicon glyphicon glyphicon-question-sign"
                                             aria-hidden="true"></span>
                                        All Monthly and Quarterly subscription plans renew automatically on the 15th of
                                        the month.</p>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed">
                                            <thead>
                                            <tr>
                                                <td><strong>Product Name</strong></td>
                                                <td class="text-right"><strong>Product Options</strong></td>
                                                <td class="text-right"><strong>Subscription Type</strong></td>
                                                <td class="text-right"><strong>Price</strong></td>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                            <tr>
                                                <td>Veganboxen</td>
                                                <td class="text-right">Variable #1</td>
                                                <td class="text-right">Monthly</td>
                                                <td class="text-right">189 SEK</td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-right"><strong>VAT - 12%</strong></td>
                                                <td class="thick-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Shipping</strong></td>
                                                <td class="no-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Total</strong></td>
                                                <td class="no-line text-right">189 SEK</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div> <!-- /container -->
        </div>
    </div>
</div>

</body>

<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>
<!--  jQuery and Bootstrap core files    -->
<script src="{% static 'ludega_art/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/jquery-ui.custom.min.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/bootstrap.min.js' %}" type="text/javascript"></script>
<!--  Plugins -->
<script src="{% static 'ludega_art/js/gsdk-checkbox.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-morphing.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-radio.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-bootstrapswitch.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-select.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'ludega_art/js/chartist.min.js' %}"></script>
<script src="{% static 'ludega_art/js/jquery.tagsinput.js' %}"></script>
<script src="{% static 'ludega_glass/js/toastr.min.js' %}"></script>
<script src="{% static 'ludega_art/js/visible.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
<!--  Get Shit Done Kit PRO Core javascript 	 -->
<script src="{% static 'ludega_art/js/get-shit-done.js' %}"></script>


<script type="text/javascript">

    var debug = true;
    var big_image;
    var transparent = true;
    var loadMoreColOrigHtml = "";


    // This function initializes listeners and calls initialization functions
    // TODO: Get all listeners to be called here.
    $().ready(function () {
        responsive = $(window).width();

        var show_age_verification_json_str = '{{ show_age_verification }}';
        var show_age_verification_json = JSON.parse(show_age_verification_json_str.replace(/&quot;/g,"\""));
        if(show_age_verification_json["show_age_verification"] == "true") {
            $("#ageVerifictaionModal").modal({backdrop: 'static', keyboard: false});
        }
        else{
            // No need to display the age verification
        }


        $(window).on('scroll', checkScroll);

        if (responsive >= 768) {
            big_image = $('.parallax-image').find('img');

            $(window).on('scroll', function () {
                parallax();
                checkScroll();
            });
        }

        //This ensures that if the user tries to scroll while we're doing some fancy scrolling of our own, it will get canceled
        $('html, body').on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
            $('html, body').stop();
        });


        initializeProductRows();
        loadMoreColOrigHtml = $("#loadMoreCol").html();
        setLoadMoreClickFunc();
        //applyFilterOptions();
        refreshCartBtn();
        initializeCheckBoxListeners();
        // There are two cart btns due to sizing of screen. We don't want to apply
        // the listener until document is ready. Otherwise we may not get the
        // listener to be applied to the "second" version of the btn.
        apply_cart_btn_listeners();
        // If the user refreshes the page while they're half way down,
        // then calling this will ensure we display the header bar correctly.
        checkScroll();
        setTimeout(function () {
            addAndAnimateImgSpacers();
        }, 500);
        setProductSectionContainerSize();

    });

    function ageVerificationNoClicked(){
        $.ajax({
            url: '/art/no_selected_on_age_verification/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                console.log("User indicated that they are not of age to purchases our products.")
            },
            error: function (response) {
                console.log("Error - Response was" + response);
            }
        });

        window.location.href='http://www.google.com';
    }

    function checkDenverZipCode() {

        var total = parseFloat((document.getElementById("cartTotal").innerHTML).replace('Total: $', ''))


        var shippingAlert = document.getElementById("shippingAlert");
        var myInput = parseInt(document.getElementById("zip_input_shipping").value);

        var denver_zip_codes = [80002, 80003, 80004, 80005, 80007, 80010, 80011, 80012, 80013, 80014, 80015, 80016, 80017,
            80018, 80019, 80020, 80021, 80022, 80023, 80024, 80030, 80031, 80033, 80045, 80101, 80102,
            80103, 80104, 80105, 80107, 80108, 80109, 80110, 80111, 80112, 80113, 80116, 80117, 80118,
            80120, 80121, 80122, 80123, 80124, 80125, 80126, 80127, 80128, 80129, 80130, 80131, 80134,
            80135, 80136, 80137, 80138, 80202, 80203, 80204, 80205, 80206, 80207, 80209, 80210, 80211,
            80212, 80214, 80215, 80216, 80218, 80219, 80220, 80221, 80222, 80223, 80224, 80226, 80227,
            80228, 80229, 80230, 80231, 80232, 80233, 80234, 80235, 80236, 80237, 80238, 80239, 80241,
            80246, 80247, 80249, 80260, 80264, 80290, 80293, 80294, 80401, 80403, 80419, 80420, 80421,
            80422, 80425, 80427, 80432, 80433, 80436, 80438, 80439, 80440, 80444, 80448, 80449, 80452,
            80453, 80454, 80456, 80457, 80465, 80470, 80475, 80476, 80601, 80602, 80640, 80820, 80827,
            80830, 80835];

        var check_for_denver_zip = denver_zip_codes.includes(myInput);

        if (check_for_denver_zip == true) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["success"]('You are eligible for free shipping!');
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + (total - 9.00).toFixed(2) + " [Free Shipping]";
        }
        else {
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + parseFloat(total).toFixed(2);
            document.getElementById("shippingAlert").innerHTML = "";
        }

    }

    function setProductSectionContainerSize() {
        //alert($(window).width());
        if ($(window).width() > 1400) {
            var pixels = $("#mainProductSection").width() * .75;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "80%");
            }, 500);
        }
        else {
            var pixels = $("#mainProductSection").width() * .9;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "90%");
            }, 500);
        }
    }

    function increaseImgWithModal(id) {
        // Get the modal
        var modal = document.getElementById('largeImgModal');

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("prodModalImage");
        var modalImg = document.getElementById("largeImg");
        var captionText = document.getElementById("caption");
        modal.style.display = "block";
        modalImg.src = img.src;
        captionText.innerHTML = img.alt;

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("my-close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };
    }

    function scaleAndShadowById(id, time) {
        $("#" + id).removeClass("remove-shadow-size");
        $("#" + id).addClass("add-shadow-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-shadow-size");
            $("#" + id).removeClass("add-shadow-size");
        }, time);
    }

    function scaleById(id, time) {
        $("#" + id).removeClass("remove-size");
        $("#" + id).addClass("add-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-size");
            $("#" + id).removeClass("add-size");
        }, time);
    }

    function refreshCartBtn() {
        $.ajax({
            url: '/art/get_cart_count/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                $(".cartBtn").each(function () {
                    $(this).text("Cart (" + response + " Items)");
                });
                //$("#cartBtn").text("Cart (" + response + " Items)");
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function clearCart() {
        $.ajax({
            url: '/art/clear_cart/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                if (!response === "{\"error\":\"\",\"message\":\"success\"}") {
                    console.log("ERROR - Failed to Clear Cart");
                    // TODO: Attempt to email support.ludega.com
                }
            },
            error: function () {
                console.log("ERROR - Failed to Clear Cart");
                // TODO: Attempt to email support.ludega.com
            }
        });
    }

    // This function is called via a "handler" in static/ludega_art/js/sqpaymentform.js
    function chargeCard(nonce) {

        // TODO: Send this json over the network and parse server side.
        var cart_json = $("#cart_info_json").val();
        var obj = JSON.parse(cart_json);

        number_of_keys = (Object.keys(obj).length) - 1;
        var i = 0;
        var prod_id_arr = [];
        var quantity_arr = [];
        var prod_type_arr = [];
        var prod_size_arr = [];

        for (i; i < number_of_keys; i++) {
            prod_id_arr[i] = obj[i]["prod_id"];
            quantity_arr[i] = obj[i]["quantity"];
            prod_type_arr[i] = obj[i]["type"];
            prod_size_arr[i] = obj[i]["size"];
        }

        console.log("DEBUG ON");
        console.log('Nonce: ' + nonce);
        console.log('prod_id_arr: ' + prod_id_arr);
        console.log('quantity_arr: ' + quantity_arr);
        console.log('prod_type_arr: ' + prod_type_arr);
        console.log('prod_size_arr: ' + prod_size_arr);
        console.log('Number of keys: ' + number_of_keys);
        console.log(document.getElementById("firstName_input").value);
        console.log(document.getElementById("lastName_input").value);
        console.log(document.getElementById("address_input").value);
        console.log(document.getElementById("city_input").value);
        console.log(document.getElementById("state_input").value);
        console.log(document.getElementById("zip_input_shipping").value);
        console.log(document.getElementById("notes").value);

        var e = document.getElementById("shippingOptions");
        var shipping_method = e.options[e.selectedIndex].value;
        console.log(shipping_method);

        $.ajax({
            url: '/art/submit_order_charge_card/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                nonce: nonce,
                prod_id_arr: prod_id_arr,
                quantity_arr: quantity_arr,
                prod_size_arr: prod_size_arr,
                prod_type_arr: prod_type_arr,
                number_of_keys: number_of_keys,
                email: document.getElementById("email_input").value,
                note: document.getElementById("notes").value,
                first_name: document.getElementById("firstName_input").value,
                last_name: document.getElementById("lastName_input").value,
                address1: document.getElementById("address_input").value,
                address2: document.getElementById("address_input2").value,
                city: document.getElementById("city_input").value,
                state: document.getElementById("state_input").value,
                zip: document.getElementById("zip_input_shipping").value,
                country: document.getElementById("country_input").value,
                shipping_method: shipping_method,
            },
            success: function (response) {

                var fName = document.getElementById("firstName_input").value
                var lName = document.getElementById("firstName_input").value


                if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date');
                    var element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV');
                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date / CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Expiration');

                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_CARD\', u\'detail\': u\'Invalid card number.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Credit Card Number');
                    var element = document.getElementById("sq-card-number");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'CARD_DECLINED\', u\'detail\': u\'Card declined.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Sorry, your card was declined.');
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'INVALID_REQUEST_ERROR\', u\'code\': u\'CARD_TOKEN_USED\', u\'detail\': u\'Card nonce already used; please request new nonce.\'}]}') {
                    // Somehow this nonce was already used. We need to re-request a nonce and try this whole process again.
                    console.log("Card nonce already used; please request new nonce and try to charge card again.")
                    //$("#checkoutModalPayBtn").trigger("click");
                }
                // THIS, hopefully, is where we get most of the time!
                else if (response.indexOf("order_confirmation_number") >= 0) {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]('Payment Recieved!');

                    // Clear cart since we just successfully bought everything in the cart
                    if (!clearCart()) {
                        console.log("CRITICAL ERROR - Failed to clear cart.");
                    }

                    console.log(response);
                    response_json = JSON.parse(response);
                    var confirmation_num = response_json["order_confirmation_number"];

                    // Now redirect page to confirmation page.
                    url = '/order_confirmation?order_id_hash=' + confirmation_num;
                    window.location.replace(url);

                }
                else {
                    console.log("CRITICAL ERROR - Got unexpected response from server.\nResponse was: " + response);
                    // TODO: Email software.support@ludega.com
                }
            },
            error: function (response) {
                alert("Failed: " + response.toString());
            }
        });
    }

    // This get's called upon "showing" of the checkout modal
    // Think of it as the "before showing, run this stuff" function
    function initialize_checkout_modal() {

        $('#checkoutEmailHref').trigger("click");

        $('#checkoutForm').trigger("reset");
        $("#email_input").removeClass("sq-input--focus");
        $("#email_valid_color").removeClass("success");
        $("#email_valid_color").addClass("danger");
        $("#email_valid_symbol").removeClass("fa-check-circle");
        $("#email_valid_symbol").addClass("fa-times-circle");

        $("#firstName_input").removeClass("sq-input--focus");
        $("#lastName_input").removeClass("sq-input--focus");
        $("#address_input").removeClass("sq-input--focus");
        $("#city_input").removeClass("sq-input--focus");
        $("#state_input").removeClass("sq-input--focus");
        $("#zip_input_shipping").removeClass("sq-input--focus");
        $("#country_input").removeClass("sq-input--focus");


        $('#cc-form').find('input:text').val('');
        $('#checkoutModal').modal('hide');
        $("#collapse2").removeClass("in");
        $("#collapse3").removeClass("in");
        try {
            var cart_empty = document.getElementById("noProdsInformDiv").innerHTML;

            if (cart_empty == "No Items In Cart") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-left",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "500",
                    "hideDuration": "1000",
                    "timeOut": "2000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["error"]('Your cart is empty. Please add an item to checkout.');
                return;
            }
            else {
                $("#checkoutModal").modal()
            }
        }
        catch (err) {
            $("#checkoutModal").modal()
        }


        {#document.getElementsByTagName('iframe')[0].src=document.getElementsByTagName('iframe')[0].src#}
        {#document.getElementsByTagName('iframe')[1].src=document.getElementsByTagName('iframe')[1].src#}
        {#document.getElementsByTagName('iframe')[2].src=document.getElementsByTagName('iframe')[2].src#}
        {#document.getElementsByTagName('iframe')[3].src=document.getElementsByTagName('iframe')[3].src#}


        {#document.getElementById('sq-card-number').src += '';#}


        {#var iframe = document.getElementById('sq-cvv');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#iframe.src = iframe.src;#}

        {#var iframe = document.getElementById('sq-card-number');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-cvv');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src#}
    }


    function scaleAndShadowByDataId(id, time) {
        //alert("here too...");
        $('*[data-id=' + id + ']').removeClass("remove-shadow-size");
        $('*[data-id=' + id + ']').addClass("add-shadow-size");
        setTimeout(function () {
            $('*[data-id=' + id + ']').addClass("remove-shadow-size");
            $('*[data-id=' + id + ']').removeClass("add-shadow-size");
        }, time);
    }

    // This function handles user clicks on "Continue Shopping" in the
    // cart section of the site
    $("#cartContinueShoppingBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        $("#cartContainer").hover(function (event) {
            event.preventDefault();
        });
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    $("#closeCartBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    // This function handles clicks on the "Checkout" button.
    // We build a link to the "Shopify Pay Page" and redirect the user there
    $("#checkOut").on("click", function () {
        console.log($("#cart_info_json").val());
        var cart_info = JSON.parse($("#cart_info_json").val());

        var checkout_page_url = "https://enspirus-arts.myshopify.com/cart/";
        var i = 0;
        var key_count = Object.keys(cart_info).length;
        if (key_count == 1) {
            scaleById("emptyCartMessage", 350);
            setTimeout(function () {
                scaleById("emptyCartMessage", 350);
            }, 650);
        }
        else {
            for (var key in cart_info) {
                if (key != "total_price") {
                    checkout_page_url += cart_info[key]["variant_id"] + ":" + cart_info[key]["quantity"];
                    if (i < key_count - 2) {
                        checkout_page_url += ",";
                    }
                }
                i++;
            }
            // Direct user to checkout page
            window.location.href = checkout_page_url;
        }
    });

    // This is a niche situation listener. Essentially, if the user
    // wants to see the "Type Description" and clicks/taps on it, but
    // they haven't selected a type in the drop down, then we want to
    // pulse the type selector and only temporarily display a message
    // stating that they haven't chooses a type yet.
    $("#collapsibleTypeDescriptionClickable").on("click", function () {
        if ($('#collapsibleTypeDescriptionHeader').attr('aria-expanded') == "false" && $("#prodTypeSelector").find("option:selected").val() == "default") {
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);

            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("hide");
            }, 2000);
        }
    });

    // This function resets the filters to default which, currently is just
    // "All". Meaning completely open, no filter subset criteria
    $("#refreshFilterBtn").on("click", function () {
        addHiddenInputElement("resetFilterBtnStatus", "clicked");
        $("#AllProductsCheckBox").parent().addClass("checked");
        $("#AllProductsCheckBox").trigger("click");
        //$("#AllImagesCheckBox").parent().addClass("checked");
        addHiddenInputElement("resetFilterBtnStatus", "notClicked");
        //$("#AllImagesCheckBox").trigger("change");
    });

    // Once a size is selected, we should be able to display a price.
    $('#prodSizeSelector').on('change', function () {
        // Get/save product size selection
        var sizeSelection = $(this).find("option:selected").val();
        if (sizeSelection != "default") {
            // Get/save the price for the given selection
            var prod_modal_json_info = JSON.parse($("#prod_modal_content_json_hidden").val());
            // Get/save product type selected
            var typeSelection = $("#prodTypeSelector").find("option:selected").val();
            // Get/save product price (for selected size/type)
            var price = prod_modal_json_info["purchase_options"][typeSelection]["size_price"][sizeSelection];

            // If the price is already showing, collapse it and then open it to show
            // new price
            if ($("#priceDivCol").height() != 0 && $("#priceDivCol").height() != 1) {
                // Collapse it so it can be changed and then re-opened.
                $("#priceDivCol").animate({
                    height: "0px",
                    opacity: 0
                }, 600);
                setTimeout(function () {
                    $("#prodModalPrice").text("$" + price);
                }, 600);
            }
            // It was already collapsed. Just fill price. Then we'll show it (below)
            else {
                $("#prodModalPrice").text("$" + price);
            }
            // Show price (with fade in and expand in)
            $("#priceDivCol").animate({
                height: "60px",
                opacity: 1
            }, 600);
            //$("#priceDivCol").slideDown("slow");
            //$("#priceDivCol").fadeIn("slow");
        }
        else {
            $("#priceDivCol").animate({
                height: "0px",
                opacity: 0
            }, 600);
            setTimeout(function () {
                $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
            }, 600);
        }
    });

    // This accomplishes a cascading drop down list.
    // When Type is selected, then the Size selector
    // can be populated. This function populates the
    // size selector with options based on what type
    // the user selected.
    $('#prodTypeSelector').on('change', function () {
        // Start by removing existing options from size selector
        $("#prodSizeSelector")
            .find('option')
            .remove()
            .end()
            .append('<option value="default">Select Size</option>')
            .val('default')
        ;
        $("#prodSizeSelector").selectpicker('refresh');

        var selected = $(this).find("option:selected").val();
        var modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
        var one_size = "";
        if (selected != "default") {
            // Fill the size dropdown with options
            for (var size in modal_info_json["purchase_options"][selected]["size_price"]) {
                $("#prodSizeSelector").append("<option value='" + size + "'>" + size + "</option>");
                $("#prodSizeSelector").attr('disabled', false);
                $("#prodSizeSelector").selectpicker('refresh');
                one_size = size;
            }

            // Fill the Type Description Header and expand it
            $("#prodModalProdTypeDescription").html(selected + "<br>" + modal_info_json["purchase_options"][selected]["description"]);
            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("show");
            }, 500);
        }
        else {
            // Then they selected the "Default" value which isn't a valid type
            // Disable size as there is no size for "Default"
            $("#prodSizeSelector").attr('disabled', true);
            $("#prodSizeSelector").selectpicker('refresh');
            // Collapse and change the Type Description
            $("#collapsibleTypeDescriptionHeader").collapse("hide");
            setTimeout(function () {
                $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
            }, 500);
        }

        // If there's only one Prod Size for the Prod Type selected,
        // then auto-select that size for the user.
        if ($("#prodSizeSelector option").size() == 2) {
            $("#prodSizeSelector").val(one_size);
            $("#prodSizeSelector").selectpicker('refresh')
        }
        // Size selector may have changed. As a check, trigger the on change function/listener
        $("#prodSizeSelector").trigger("change");
    });

    // This function/listener removes options from type and size selector
    // whenever the modal is closed (modal close). It also collapses the description and
    // type headers/info boxes.
    $("#prodModal").on('hidden.bs.modal', function () {
        // Remove options from type selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodTypeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Remove optiosn from size selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodSizeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Collaps price section and reset pricing text
        $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
        $("#priceDivCol").animate({
            height: "0px",
            opacity: 0
        }, 600);

        // Refresh the selectors since we changed them.
        // Bootstrap requires this step.
        $("#prodTypeSelector").selectpicker('refresh');
        $("#prodSizeSelector").selectpicker('refresh');

        // Reset Type Description and Product Description
        $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
        $("#collapsibleTypeDescriptionHeader").collapse("hide");
        $("#collapsibleDescriptionHeader").collapse("hide");

        // Remove Product Image
        $("#prodModalImage").attr("src", "");
    });

    // When the user clicks the "Cart" button at the top, this is what happens.
    function apply_cart_btn_listeners() {
        $(".cartBtn").each(function () {
            $(this).on("click", function () {
                if ($("#cartSection").css("display") == "none") {
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            // Save the JSON returned in a hidden form
                            addHiddenInputElement("cart_info_json", response);

                            // Parse response (json formatted string) into a json object for iterating through it
                            var cart_info_json = JSON.parse(response);

                            // for each item in the cart
                            var i = 0;
                            for (var key in cart_info_json) {
                                var item_row = "";
                                if (i == 0 && Object.keys(cart_info_json).length != 3 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;">';
                                }
                                else if (i == Object.keys(cart_info_json).length - 2 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">';
                                }
                                else {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;border-bottom:0.5px solid lightgray;">';
                                }
                                if (key != "total_price") {
                                    $("#cartMainProdRow").append('' +
                                        item_row +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row">' +
                                        '</div>' +
                                        '<div class="row"  style="padding-bottom:10px;">' +
                                        '<div class="col-xs-4"><img src="/' + cart_info_json[key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                                        '<div class="col-xs-8">' +
                                        '<a><h3 class="title">' + cart_info_json[key]["name"] + '</h3></a>' +
                                        '<p>' + ' ' + cart_info_json[key]["type"] + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row" style="padding-bottom:15px;">' +
                                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Quantity</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                                        '</div>' +
                                        '<div class="row">' +
                                        '<div id="unitPriceProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + cart_info_json[key]["price"] + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<input onchange="quantityChange(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="quantityProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_info_json[key]["quantity"]) + '">' +
                                        '</div>' +
                                        '<div id="subtotalProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_info_json[key]["price"] * cart_info_json[key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<button onclick="cartRemoveItem(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="cartRemoveProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-id="' + cart_info_json[key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                    );

                                }
                                i++;
                            }

                            // If we added at least 1 item
                            // There will always be one key (total_amount). So if there are 2, then we had
                            // at least one item. Thus if i > 1, not i > 0


                            if (i > 1) {
                                var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                                var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                                var shipping = 9.00.toFixed(2);

                                /*if (subTotal >= 100){
                                    shipping = 0.00.toFixed(2);
                                }*/

                                var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);

                                $("#cartMainProdRow").append('' +
                                    '<div id="cartTotalRow" class="row" style="padding-top:15px;">' +
                                    '<div class="col-sm-6 col-xs-12"></div>' +
                                    '<div class="col-sm-6 col-xs-12">' +
                                    //'<div class="col-xs-3"></div>' +
                                    '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                                    //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                            // Else no items were added. So display something saying so.
                            else {
                                $("#cartMainProdRow").append('<div id="emptyCartMessage" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                            }

                            $("#cartContainer").removeClass("remove-shadow-size-quick");
                            if ($("#closeCartBtn").css("display") == "none") {
                                $("#closeCartBtn").css("display", "block");
                            }
                            $("#cartSection").slideToggle();
                            $('html, body').animate({
                                scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                            }, 1000);
                            if ($("html").hasClass("nav-open")) {
                                $("#menu-toggle").trigger("click");
                            }
                            //console.log(response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                }
                else {
                    $('html, body').animate({
                        scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                    }, 1000);
                    if ($("html").hasClass("nav-open")) {
                        $("#menu-toggle").trigger("click");
                    }
                }

                // Seems we get weird flickering effects (involved in the animate scrollTop action) if this isn't here
                return false;
            });
        });
    }

    function quantityChange(id, size, type) {
        // Special Note: Size may have instances of periods to represent decimal sizes. When
        // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
        // below, you'll see that I'm escaping the period using our replaceAll string function.
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        if ($("[id='quantityProdId" + concatIdSizeType + "']").val() <= 0) {
            // Display notification informing of success
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]('Select the red trash can to remove an item from your cart.');

            $("[id='quantityProdId" + concatIdSizeType + "']").val(1);
            scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 650);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 1300);
        }
        else {
            // Firstly, inform the server that the user would like to add to their cart. And attempt to do so...
            var _size = size;
            var _type = type;
            $.ajax({
                url: '/art/update_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: $("[id='quantityProdId" + concatIdSizeType + "']").val(),
                    price: $("[id='unitPriceProdId" + concatIdSizeType + "']").text(),
                    size: _size,
                    type: _type,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    scaleAndShadowById("cartBtn", 500);
                    refreshCartBtn();
                    // Updating hidden json
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            addHiddenInputElement("cart_info_json", response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                },
                error: function () {
                    alert("Error...");
                }
            });

            // This behemoth of a statement simply sets the text of the subtotal for a give item in the cart
            // The length of the statement is due to rounding, multiplication, and ridiculous id naming convention I've
            // used for naming/id'ing items in the cart
            $("[id='subtotalProdId" + concatIdSizeType + "']").text("$" + (Math.round((parseFloat($("[id='unitPriceProdId" + concatIdSizeType + "']").text().replace("$", "")) * $("[id='quantityProdId" + concatIdSizeType + "']").val()) * 100) / 100).toFixed(2));

            //We also want to refresh the cart total.
            refreshCartTotal();
        }
    }

    function prodHover(id) {
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
        if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
            $("#imgProdId" + id).css("transform", "scale(.90, .90)");
        }
        $("#prod" + id).hover(function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(.90, .90)");
            }
        }, function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(1,1)");
            }
        });
    }

    // This function loops through each item in the cart and applies a border on top or bottom as needed
    function redrawCartItemBorders() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                if (i == 0) {
                    $(this).css("border-top", "0.5px solid lightgray");
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
                else {
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
            }
            i++;
        });
    }

    // This function adds up all items in the cart and renders the total at the bottom
    function refreshCartTotal() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        var total = 0;
        var subTotal = 0;
        var taxes = 0;
        var shipping = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                var subtotalId = ($(this).attr("id")).replace("cartItemProdId", "subtotalProdId");
                subtotalId = subtotalId.replaceAll(".", "\\.");
                if (subtotalId != "emptyCartMessage") {
                    total += parseFloat(($("[id='" + subtotalId + "']").text()).replace("$", ""));
                }
            }
            i++;
        });


        taxes = ((Math.round(total * 100) / 100) * 0.029).toFixed(2);
        subTotal = (Math.round(total * 100) / 100).toFixed(2);
        shipping = 9.00.toFixed(2);
        /*if (subTotal >= 100){
            shipping = 0.00.toFixed(2);
        }*/
        total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);
        $("#cartTotal").text("Total: $" + total);
        $("#tax").text("Tax: $" + taxes);
        $("#subTotal").text("Sub Total: $" + subTotal);
        $("#shippingCost").text("Shipping: $" + shipping);


    }

    // This function handles user clicks on the Trash icon next to items
    // in the cart
    function cartRemoveItem(id, _size, _type) {
        var concatIdSizeType = id + _size + _type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        $("[id='cartItemProdId" + concatIdSizeType + "']").slideUp(500);
        setTimeout(function () {
            $("[id='cartItemProdId" + concatIdSizeType + "']").remove();
        }, 500);

        // make a call to the server to remove the item(s) from the cart
        $.ajax({
            url: '/art/remove_from_cart/',
            type: "POST",
            data: {product_id: id, size: _size, type: _type, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                refreshCartBtn();

                //Need to ensure other one is removed at this point. So waiting half a second to assess
                setTimeout(function () {
                    // If there's no more items, we want to show Empty Cart Message
                    var itemCount = $("#cartMainProdRow").children().length - 1;
                    if (itemCount == 0) {
                        $("#cartMainProdRow").append('<div id="emptyCartMessage" style="display:none;text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                        $("#emptyCartMessage").slideDown("slow");
                        $("#cartTotalRow").slideUp(500);
                        setTimeout(function () {
                            $("#cartTotalRow").remove();
                        }, 500);
                    }
                    else {
                        setTimeout(function () {
                            redrawCartItemBorders();
                            refreshCartTotal();
                        }, 500);
                    }
                }, 500);

                // Updating hidden json
                $.ajax({
                    url: '/art/get_cart/',
                    type: "POST",
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (response) {
                        addHiddenInputElement("cart_info_json", response);
                    },
                    error: function () {
                        alert("Error...");
                    }
                });
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function drawNewItemInCart(id, size, type) {
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        // Start by checking if this particular item already exists in our cart
        // If so, then we just need to increment the quantity by 1
        var item_already_in_cart = false;
        $("#cartMainProdRow").children().each(function () {
            if ($(this).attr("id") == "cartItemProdId" + id + size + type) {
                item_already_in_cart = true;
            }
        });
        // Then all we need to do is increment the quantity for the given item and triger the quantity change event
        if (item_already_in_cart) {
            var new_quant_val = parseInt($("[id='quantityProdId" + concatIdSizeType + "']").val()) + 1;
            $("[id='quantityProdId" + concatIdSizeType + "']").val(new_quant_val);
            $("[id='quantityProdId" + concatIdSizeType + "']").trigger("change");
        }
        // Else, we've got an entire item row to add to the cart (without closing and reopening it)
        else {
            // Start by updating the cart information (that we store in a hidden json)
            $.ajax({
                url: '/art/get_cart/',
                type: "POST",
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (response) {
                    addHiddenInputElement("cart_info_json", response);
                    // Debugging Purposes Only
                    //console.log(response);
                    // Now locate the item we're adding to the cart in the JSON obj
                    var cart_json_obj = JSON.parse(response);
                    var da_key = "";
                    for (var key in cart_json_obj) {
                        if (cart_json_obj[key].hasOwnProperty("prod_id")) {
                            if (cart_json_obj[key]["prod_id"] == id) {
                                da_key = key;
                            }
                        }
                    }
                    // Now that we have da key to it (lol...) we can generate the html to add our item
                    // to our cart. We're going to start it out as display:none and then expand
                    // it once it's added fully.
                    var total_row = $("#cartMainProdRow").children().last();
                    total_row.before('' +
                        '<div id="cartItemProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="row table-hover" style="display:none;margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row">' +
                        '</div>' +
                        '<div class="row"  style="padding-bottom:10px;">' +
                        '<div class="col-xs-4"><img src="/' + cart_json_obj[da_key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                        '<div class="col-xs-8">' +
                        '<a><h3 class="title">' + cart_json_obj[da_key]["name"] + '</h3></a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row" style="padding-bottom:15px;">' +
                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Quality</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                        '</div>' +
                        '<div class="row">' +
                        '<div id="unitPriceProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + cart_json_obj[da_key]["price"] + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<input onchange="quantityChange(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="quantityProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_json_obj[da_key]["quantity"]) + '">' +
                        '</div>' +
                        '<div id="subtotalProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_json_obj[da_key]["price"] * cart_json_obj[da_key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<button onclick="cartRemoveItem(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="cartRemoveProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" data-id="' + cart_json_obj[da_key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                    );

                    if (!!document.getElementById("emptyCartMessage")) {
                        // Fade out the message
                        $("#emptyCartMessage").animate({
                            opacity: 0,
                            height: "0px"
                        }, 500);
                        setTimeout(function () {
                            $("#emptyCartMessage").remove();
                        }, 500);

                        var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                        var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                        var shipping = 9.00.toFixed(2);
                        if (subTotal >= 100) {
                            shipping = 0.00.toFixed(2);
                        }

                        var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);


                        $("#cartMainProdRow").append('' +
                            '<div style="display:none;" id="cartTotalRow" class="row" style="padding-top:15px;">' +
                            '<div class="col-sm-6 col-xs-12"></div>' +
                            '<div class="col-sm-6 col-xs-12">' +
                            //'<div class="col-xs-3"></div>' +
                            '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping[USPS Priority]: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                            //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                            '</div>' +
                            '</div>'
                        );

                        $("#cartTotalRow").slideDown("slow");
                    }

                    // Show it (via sliding it down)
                    // Special Note: Size may have instances of periods to represent decimal sizes. When
                    // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
                    // below, you'll see that I'm escaping the period using our replaceAll string function.
                    var cartItemId = "cartItemProdId" + id + size + type;
                    cartItemId = cartItemId.replaceAll(".", "\\.");
                    $("[id='" + cartItemId + "']").slideDown("slow");
                    // Re-draw border lines as needed
                    redrawCartItemBorders();
                    refreshCartTotal();
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
    }

    // Handles the "Add to Cart" clicks.
    $("#prodModalAddToCart").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Type.");

            // Pulse the type selector
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Size.");

            // pulse the size selector
            scaleAndShadowByDataId("prodSizeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodSizeSelector", 500);
            }, 1000);
        }
        else {
            var prod_modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
            var id = prod_modal_info_json["requested_prod"]["id"];
            var size_selected = $("#prodSizeSelector").find("option:selected").val();
            var type_selected = $("#prodTypeSelector").find("option:selected").val();
            $.ajax({
                url: '/art/add_to_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: 1,
                    price: $("#prodModalPrice").text(),
                    size: size_selected,
                    type: type_selected,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    // Close Modal
                    $("#modalCloseBtn").trigger("click");

                    // Display notification informing of success
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]("Added to Cart!");

                    scaleAndShadowById("cartBtn", 350);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 700);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 1400);
                    refreshCartBtn();

                    // If the cart is currently showing, then we want to add to it on the fly (as apposed to
                    // building the entire thing from scratch like the apply_cart_btn_listeners() function(s)
                    // do.
                    if ($("#cartSection").css("display") == "block") {
                        drawNewItemInCart(id, size_selected, type_selected);
                    }

                    // This flashes helps draw attention to the menu button (when user is on phone)
                    $("#menu-toggle").addClass("toggled");
                    setTimeout(function () {
                        $("#menu-toggle").removeClass("toggled");
                    }, 200);
                    setTimeout(function () {
                        $("#menu-toggle").addClass("toggled");
                        setTimeout(function () {
                            $("#menu-toggle").removeClass("toggled");
                        }, 100);
                    }, 500);
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // Handles the "Buy Now" clicks.
    $("#prodModalBuyNow").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Type!");

            $('*[data-id="prodTypeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodTypeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodTypeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodTypeSelector"]').removeClass("add-shadow-size");
            }, 500);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Size!");

            $('*[data-id="prodSizeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodSizeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodSizeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodSizeSelector"]').removeClass("add-shadow-size");
            }, 500);

        }
        else {
            $("#prodModalAddToCart").trigger("click");
            $("#cartBtn").trigger("click");
            setTimeout(function () {
                scaleAndShadowById("checkOut", 500);
                setTimeout(function () {
                    scaleAndShadowById("checkOut", 500);
                }, 1000);
            }, 2000);
            setTimeout(function () {
                if ($("#checkOut").visible() == false) {
                    $('html, body').animate({
                        scrollTop: $("#checkOut").offset().top - $(window).height() + $("#navBar1337").height() + 20
                    }, 1000);
                }
            }, 2000);
        }

        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // When the screen is scrolled down a certain amount, this function
    // changes the color of the menu bar at the top. This is done for
    // style/readability
    function checkScroll() {
        if ($(document).scrollTop() > 180) {
            if (transparent) {
                transparent = false;
                $('nav[role="navigation"]').removeClass('navbar-transparent').addClass('navbar-default');
            }
        } else {
            if (!transparent) {
                transparent = true;
                $('nav[role="navigation"]').addClass('navbar-transparent').removeClass('navbar-default');
            }
        }
    }

    // This beautiful function/filter will return boolean of whether a given element is or is not within the
    // view port.
    // Currently not working as intended. Using visible.js instead.
    // Example use: $('div').is(':offscreen');
    jQuery.expr.filters.offscreen = function (el) {
        var rect = el.getBoundingClientRect();
        return (
            (rect.x + rect.width) < 0
            || (rect.y + rect.height) < 0
            || (rect.x > window.innerWidth || rect.y > window.innerHeight)
        );
    };

    // When card-product is clicked, we need to reach out to server and fill modal with
    // appropriate information.
    $(document).on("click", ".card-product", function () {

        // Call out to server to get needed information (for product modal)
        // Response should be json formatted data. alert(response) to see it.
        $.ajax({
            url: '/art/get_product_modal_info/',
            type: "POST",
            data: {id: $(this).data('id'), csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                // Debugging purposes. Uncomment to see JSON data.
                //console.log(response);

                // Save the response in hidden form element
                if (!!document.getElementById("prod_modal_content_json_hidden")) {
                    $("#prod_modal_content_json_hidden").val(response);
                }
                else {
                    addHiddenInputElement("prod_modal_content_json_hidden", response);
                }

                // Parse the json into object/var
                var modal_info_json = JSON.parse(response);

                // Fill modal
                $("#prodModalImage").attr('src', '/' + modal_info_json["requested_prod"]["image_file"]);
                $("#prodModalTitle").text(modal_info_json["requested_prod"]["product_name"]);
                $("#prodModalProdDescription").text(modal_info_json["requested_prod"]["description"]);
                // Expand description header
                setTimeout(function () {
                    $("#collapsibleDescriptionHeader").collapse("show");
                }, 500);

                //alert(Object.keys(modal_info_json["purchase_options"])[0]);
                //alert(JSON.stringify(modal_info_json["purchase_options"]));

                // Loop through type options and fill selector
                for (var key in modal_info_json["purchase_options"]) {
                    $("#prodTypeSelector").append("<option value='" + key + "'>" + key + "</option>").selectpicker('refresh');
                }
                // Refresh selectors to update with new options and disable size
                $("#prodSizeSelector").attr('disabled', true);
                $("#prodSizeSelector").selectpicker('refresh');
                $("#prodTypeSelector").selectpicker('refresh');
                // If there's only one "Type" option, then select it for the user
                if (Object.keys(modal_info_json["purchase_options"]).length == 1) {
                    // Set Type selector to the one option that exists...
                    $("#prodTypeSelector").val(Object.keys(modal_info_json["purchase_options"])[0]);
                    $("#prodTypeSelector").selectpicker('refresh'); // Refresh selector so change shows in browser
                    // Trigger the change event so that the size type get's populated and activated
                }
                // Trigger the change in case we ended up setting it to something (so that other listener actions trigger)
                $("#prodTypeSelector").trigger("change");

                // Adding in related/similar products scroller content
                for (var key in modal_info_json["related_prods"]) {
                    $("#relatedProdsScroller").append('<li class="nbs-flexisel-item" style="width: 113.75px;">' +
                        '     <a href="#product-page2" role="tab" data-toggle="tab" aria-expanded="false">' +
                        '        <img src="/' + modal_info_json["related_prods"][key]["image_file"] + '" alt="...">' +
                        '    </a>' +
                        '</li>');
                }

            },
            error: function () {
                alert("Error...");
            }
        });

        // Build Modal using #prod_modal_content_json_hidden

        //var products = JSON.parse("{{products|escapejs}}");

        //alert(JSON.string(products));

        var prodID = $(this).data('id');

        //$(".modal-body #modal-body").text( prodID );
    });

    var parallax = function () {
        var current_scroll = $(this).scrollTop();

        oVal = ($(window).scrollTop() / 3);
        big_image.css('top', oVal);
    };

    // Handles little clickable filter button on each product box
    function filterBtnOnClick(prodType) {
        event.stopPropagation();
        alert("Filter button clicked. Still need to implement filter. Would have filtered to " + prodType);
    }

    // Function to hide all product rows past the 1th indicy (aka show only 2 prod rows)
    function initializeProductRows() {
        var rowNum = 2;
        var id = 'row' + rowNum;
        var hasNextRow = !!document.getElementById(id);
        // while there exists another row (past the 1th row or the last row we hid)
        while (hasNextRow) {
            // Setting selector for jquery hide function
            selector = '#' + id;
            // Hiding rows (past 0th and 1th)
            $(selector).slideUp("fast");
            // If the row's child elements have a height of 0, display of none, or opacity of 0,
            // Then we will undo that since their parent element/container is what we'll be
            // expanding. When we expand the parent element, we want the children to be visible.
            $(selector).children().each(function (i) {
                if ($(this).css("height") == "0px") {
                    $(this).css("height", "100%");
                }
                if ($(this).css("opacity") == "0") {
                    $(this).css("opacity", "1");
                }
                if ($(this).css("display") == "none") {
                    $(this).css("display", "block");
                }
            });
            // Increment row num (to check for)
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Loads/Shows/Un-hides/Displays 2 more product rows
    // if they exist. It does this with a fade and an expand.
    function loadMoreProductRows(option, time) {
        // Start by removing the noProdsInformDiv
        $("#noProdsInformDiv").remove();
        // start searching for hidden rows
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a next row
        var hasNextRow = !!document.getElementById(id);
        // Start a counter. We only want to show 2 new rows (per "Load More..." click)
        var count = 0;
        while (hasNextRow && count < 2) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);

            // if it's hidden, then display it (with some animation to it)
            if (option == "fadeAndExpand") {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.css("overflow", "visible");
                    //row.css("height","0px");
                    row.css("opacity", 0);
                    //row.css("display","block");
                    row.slideToggle('slow');
                    row.animate({
                        //height:"100%",
                        opacity: 1
                    }, time);

                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }
            else if (option == "expandThenFade") {
                if ($("#productsStatus").val() == "some") {
                    if (row.css("display") == "none" || row.css("opacity") == 0) {
                        row.animate({
                            height: "auto"
                        }, 1);
                        setTimeout(function () {
                            row.animate({
                                opacity: 1
                            }, 1);
                        }, 1);
                    }
                    row.children().each(function () {
                        if ($(this).css("display") == "none" || $(this).css("opacity") == 0) {

                            $(this).height("100%");
                            $(this).css({opacity: 1});
                            // No Animation needed here. If we're here, the parent class should have
                            // opacity of 0
                        }
                    });
                    if ($("#productColumn").css("display") == "none" || $("#productColumn").css("opacity") == 0) {

                        $("#productColumn").slideDown(time);
                        /*$("#productColumn").animate({
                                height: "toggle"
                            }, 1000);*/

                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }
                else {
                    // There aren't any products to show
                    // Due to the Filter settings.
                    // Inform the user.
                    if (!!document.getElementById("noProdsInformDiv") == false) {
                        $("#productColumn").append('<div id="wrapper" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items Met Your Chosen Filter Options</h3></div>');
                        $("#productColumn").slideDown(time);
                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }

                // Scroll the screen so that the newly displayed products are some % from the
                // top of the screen
                if (option == "fadeAndExpand") {
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                }
                // This was a hidden row and now it isn't. Increment counter.
                // Only want to do this to two (per "Load More..." click)
                count++;
            }
            else {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.animate({
                        opacity: 1
                    }, time);
                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }

            // Increment row num (to check for) and count
            rowNum++;

            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
            setTimeout(function () {
                addImgSpacers();
            }, time / 2)
        }
    }

    // This function returns true if there exist hidden product rows on the page
    // This function returns false if there exist no hidden product rows on the page
    function existsHiddenProdRows() {
        // We know we've got the 1th and 0th row showing, so start searching
        // for hidden rows at the 2nd indexed (aka 3rd) row.
        var rowNum = 2;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a 3rd row (aka 2nd indexed row)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);
            // If this row is hidden, then there exist some hidden row(s)
            if (row.css("display") == "none" && row.children().length > 0) {
                return true;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;                    // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
        return false;
    }

    // The "Load More..." button gets removed and re-added throughout its life.
    // Each time the button element is removed and added, this function needs
    // to be called in order to reapply the click listener (and function that
    // goes with it).
    function setLoadMoreClickFunc() {
        $('#loadMore').click(function () {
            loadMoreProductRows("fadeAndExpand", 1000);
            setTimeout(function () {
                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>Load more...</button>" +
                    "</div>";
                var options = {
                    action: "setState",
                    state: "info"
                };
                $('#loadMore').morphingButton(options);
                setTimeout(function () {
                    // Fade out existing button
                    if (existsHiddenProdRows()) {
                        $('#loadMoreCol').fadeOut(400); // Match this with id=LBFOD line
                    }
                    setTimeout(function () {
                        if (existsHiddenProdRows()) {
                            $('#loadMoreCol').replaceWith(loadMoreHtml);
                            // Fade in new instance of button
                            $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                            $('#loadMore').morphingButton();
                        } else {
                            $('#loadMoreCol').animate({
                                height: "toggle",
                                opacity: "toggle"
                            }, 1000);
                        }
                    }, 400); // Duration given for "Fade Out" of Light Blue (Success) Circle (id: LBFOD)
                }, 300); // Duration of Light Blue (Success) Circle (prior to Fade Out)
            }, 700); // Duration of Spinning Circle
        });
    }

    // If All is checked and user checks another filter box, then all should become
    // unchecked
    function initializeCheckBoxListeners() {
        {% for type in types %}
            $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllProductsCheckBox was checked, un-check it.
                if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
                    $("#AllProductsCheckBox").parent().removeClass("checked");
                }

                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // Color Filtering Removed For Now
        /*
            {% for color in colors %}
                $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                    // If AllColorsCheckBox was checked, un-check it.
                    if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
                        $("#AllColorsCheckBox").parent().removeClass("checked");
                    }

                    // Apply the filter change that just happened.
                    applyFilterOptions();
                });
            {% endfor %}
            */

        {% for image in images %}
            $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllImagesCheckBox was checked, un-check it.
                if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
                    $("#AllImagesCheckBox").parent().removeClass("checked");
                }
                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // When All is checked (in colors subsection) then other boxes should be unchecked
        // NOTE: Colors Filtering Disabled For Now
        /*$("#AllColorsCheckBox").change(function(){
                {% for color in colors %}
                    $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in Product subsection) then other boxes should be unchecked
        $("#AllProductsCheckBox").change(function () {
            {% for type in types %}
                $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            if ($("#resetFilterBtnStatus").val() != "clicked") {
                // Apply the filter change that just happened.
                applyFilterOptions();
            }
        });

        // When All is checked (in Clothing subsection) then other boxes should be unchecked
        // Merging Clothing and Products Check Box Filters Sections
        // Thus commenting out below section
        /*$("#AllClothingCheckBox").change(function(){
                {% for type in types %}
                    {% if type.is_clothing == True %}
                        $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                    {% endif %}
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in image subsection) then other boxes should be unchecked
        $("#AllImagesCheckBox").change(function () {
            {% for image in images %}
                $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            // Apply the filter change that just happened.
            applyFilterOptions();
        });

    }

    // This function returns the filter state as an object containing arrays.
    // Each array contains a list of valid types to be filtered to
    function getFilterState() {
        var filters = {
            images: [],
            clothing: [],
            products: [],
            colors: []
        };

        // Iterate over each check box and fill appropriate filter array
        if ($("#AllClothingCheckBox").parent().hasClass("checked")) {
            filters.clothing[0] = "All";
        }
        if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
            filters.products[0] = "All";
        }
        if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
            filters.colors[0] = "All";
        }
        if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
            filters.images[0] = "All";
        }
        // If the products filter don't have "all" checked
        if (!($("#AllProductsCheckBox").parent().hasClass("checked"))) {
            var productFilterCount = 0;
            {% for type in types %}
                if ($("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.products[productFilterCount] = "{{type.display_name}}";
                    productFilterCount++;
                }
            {% endfor %}
        }

        if (!($("#AllImagesCheckBox").parent().hasClass("checked"))) {
            var imageFilterCount = 0;
            {% for image in images %}
                if ($("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.images[imageFilterCount] = "{{image.name}}";
                    imageFilterCount++;
                }
            {% endfor %}
        }

        /*if(!($("#AllColorsCheckBox").parent().hasClass("checked"))) {
                var colorFilterCount = 0;
                {% for color in colors %}
                    if($("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")){
                        filters.colors[colorFilterCount] = "{{color.name}}";
                        colorFilterCount++;
                    }
                {% endfor %}
            }*/

        return filters;
    }

    // Replaces all instances of a given string in another string
    String.prototype.replaceAll = function (str1, str2, ignore) {
        return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof(str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
    };

    // This function adds "text" to the value() field of the element
    // with id of "elementId"
    function addHiddenInputElement(elementId, text) {
        text = text.replaceAll("'", "&#39;");
        //text = text.replace("\"","&#34;");
        if (!!document.getElementById(elementId)) {
            $("#" + elementId).val(text);
        }
        else {
            $('#hiddenForm').append("<input type='hidden' name='" + elementId + "' id='" + elementId + "' value='" + text + "'/>");
        }
    }

    // As the name suggests, this will animated an object fading away
    // and then remvoe the element
    function fadeOutRemoveElement(elementId, time) {
        $("#" + elementId).animate({
            opacity: "toggle"
        }, time);
        setTimeout(function () {
            $("[data-id=" + elementId + "]").remove();
        }, time);
    }

    // As the name suggests, this function collapses all product rows.
    // Not currently used. Used to be. Then implemented same effect
    // except utilized parent element/container.
    function collapseAllProductRows() {
        // Start by fading out the "Load More..." button as we don't want the user to click this while
        // we're refreshing the product tables/rows
        $("#loadMoreCol").animate({
            opacity: 0
        }, 1000);

        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results)
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            $(selector).animate({
                opacity: 0//,
                //height:"toggle"
            }, 1000);

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Removes products starting at a row/column and
    // continuing until there are no prods left to remove
    function removeRemainingProducts(startRow, startCol) {
        //alert(startRow + " , " + startCol);
        var rowNum = startRow;
        var colNum = startCol;
        // Set initial element id to begin at
        var id = 'row' + rowNum;

        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            var i = 0;
            $(selector).children().each(function () {
                if ((rowNum == startRow && i >= colNum) || (rowNum != startRow)) {
                    /*$(this).animate({
                            height:0
                        },2000);
                        var prod_element = $(this);
                        setTimeout(function(){
                            prod_element.remove();
                        }, 2000);*/
                    $(this).remove();
                }
                i++;
            });

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // This functions gets the 0th product described in the
    // hidden products_json_hidden form element (value() field)
    function getZerothJSONProductHTML() {
        var products_json = JSON.parse($("#products_json_hidden").val());
        var date = Date.now();

        var new_prod_element = "" +
            "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
            " data-image='" + products_json[0][4] + "' data-colors='' style='opacity:0; height:100%; dispay:none;'" +
            " data-product_type='" + products_json[0][3] + "'>" +
            "   <div data-toggle='modal' onmouseover='prodHover(" + products_json[0][0] + ")'  data-target='#prodModal' data-id='" + products_json[0][0] + "' class='fake-link card card-product card-plain my-card-light' id='prod" + products_json[0][0] + "'>" +
            "       <div style='overflow:visible;padding-top:10px;' class='image text-center'>" +
            "           <div id='topImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "           <a>" +
            "               <img id='imgProdId" + products_json[0][0] + "' class='my-img-dark' style='max-width:90%;max-height:300px;height:auto;width:auto;' src='/" + products_json[0][4] + "' alt='Couldnt Find Image'/>" +
            "           </a>" +
            "           <div id='bottomImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "       </div>" +
            "       <div class='content text-center'>" +
            "           <a>" +
            "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
            "           </a>" +
            //"           <p class='description'>" +
            //products_json[0][2] +
            //"           </p>" +
            "           <div class='footer'>" +
            "               <span class='price'>" + products_json[0][6] + "</span>" +
            "               <button onclick='filterBtnOnClick(\"" + products_json[0][3] + "\")' class='btn btn-danger btn-tooltip btn-simple pull-right' data-toggle='tooltip' title='Filter to " + products_json[0][3] + "' data-placement='left'>" +
            //"                   <i style='align-self:right;' class='fa fa-filter'></i>" +
            "               </button>" +
            "           </div>" +
            "       </div>" +
            "   </div> <!-- end card -->" +
            "</div>";

        jQuery.ready();

        return new_prod_element;
    }

    function addAndAnimateImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 added due to some padding at top of img
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300 && prodImgHeight > 0) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                            $("#bottomImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                        }
                        // Sometimes an image might still be loading due to slow network or something.
                        // In these cases, I believe height returned will be 0 or less than 0.
                        // When this is the case, we want to pause (to allow it to finish loading)
                        // and call the function again. Then return from the function (to end
                        // the initial instance of the function. This may happen multiple times.
                        else if (prodImgHeight <= 0) {
                            setTimeout(function () {
                                addAndAnimateImgSpacers();
                            }, 500);

                        }
                    });
                }
            });
        }
    }

    function addImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 is added due to some padding at the top
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).height(spaceDivHeight);
                            $("#bottomImgSpacerProdId" + prodId).height(spaceDivHeight);
                        }
                    });
                }
            });
        }
    }

    // This function builds the product rows
    // as they're described in the hidden products_json_hidden
    // form element (value() field).
    function buildAllProductRows() {
        // Parse the JSON (to add a new prod (which matches filter options))
        var products_json = JSON.parse($("#products_json_hidden").val());

        // Replace existing products and keep track of our position
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // This will be used for tracking position
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            $(selector).children().each(function (i) {
                var product_element = $(this);

                if ($("#products_json_hidden").val() != "[]") {
                    // Parse the JSON (to add a new prod (which matches filter options))
                    var products_json = JSON.parse($("#products_json_hidden").val());

                    // Generate/Save html to replace what we just faded/removed
                    var new_prod_element = getZerothJSONProductHTML();

                    // Replace the element we're on with
                    product_element.replaceWith(new_prod_element);

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);

                    rowCol[1]++;
                }
            });

            // Check if we need to adjust/increment column/row
            if (rowCol[1] > 2) {
                //reset rowCol (since there's only to be three products per row)
                rowCol[1] = 0;
                rowCol[0]++;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }

        // If the filter the user chose returns more than was previously there, then we need to continue adding
        if ($("#products_json_hidden").val() != "[]") {
            // Parse the JSON (to add a new prod (which matches filter options))
            var products_json = JSON.parse($("#products_json_hidden").val());

            while ($("#products_json_hidden").val() != "[]") {
                // First ensure a row exists for the item to be put into
                // And that we're not trying to add a 4th column
                if (!!$("#row" + rowCol[0]) && rowCol[1] <= 2) {
                    // Append the product
                    $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement below

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);
                }
                else if (rowCol[1] > 2) {
                    //reset rowCol (since there's only to be three products per row)
                    rowCol[1] = 0;
                    rowCol[0]++;
                }
                // Need to create the row to put the product into
                else {
                    //alert("getting here...");
                    //Check if there are any previous rows to append to
                    var rowOneBack = rowCol[0]--;
                    if (!!$("#row" + rowOneBack)) {
                        $("#row" + rowOneBack).append("</div> <div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());
                    }
                    // There are no rows. Need to create from scratch. None to append to
                    else {
                        // Need to create new row
                        // Appending </div><[new row stuffs]> to end of existing existing row
                        $("#productColumn").append("<div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'></div>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                        // Drop 0th element from json text
                        products_json.splice(0, 1);
                        var products_json_str = JSON.stringify(products_json);
                        // push the json string to the hidden element for latter use
                        addHiddenInputElement("products_json_hidden", products_json_str);
                    }
                    // Increment rowCol
                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement above
                }
            }
        }
        else {
            removeRemainingProducts(rowCol[0], rowCol[1]);
        }
    }

    /*$(window).on("resize",function(){
            waitForFinalEvent(function() {
                setProductSectionContainerSize();
                alert("here....");
            },1000);
        });*/

    var waitForFinalEvent = (function () {
        var timers = {};
        return function (callback, ms, uniqueId) {
            if (!uniqueId) {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId]) {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    function enableFilters() {
        $(window).trigger('resize');
        // This will enable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', 1);
        $('#disableFilterDiv').remove();
        scaleAndShadowById("filterDiv", 400);
        setTimeout(function () {
            $('#filterDiv').removeClass("remove-shadow-size");
        }, 800);
    }

    // This is the main function for applying filter options
    // after the user modifies them. This function calls
    // the other needed function with the correct timing
    // between each one.
    function applyFilterOptions() {
        // Start by stopping any existing animation on the product column
        $("#productColumn").stop(true);
        // Add spacer to bottom. This gives the circle space to exist on the phone view
        $("#footerSpacer").addClass("space-150");
        // Apply the "Loading" circle to the screen
        var pos = $("#productColumn").position();
        var w = $("#productColumn").width();
        //alert(pos.top + "," + pos.left);
        $('<div id="loadingCircle" class="loader" style="display:none;position:absolute;top:' + (pos.top.toString()) + 'px;left:' + ((pos.left) + (w / 2) - 60).toString() + 'px;z-index:2;"></div>').insertAfter("#productColumn");
        $("#loadingCircle").fadeIn(1000);

        var productColHtml = "";

        // Get filters as list of arrays
        var filters = getFilterState();
        // Convert to string (for server side python/django function)
        filters_str = "";
        filters_str += "" + filters.images.toString();
        //filters_str+= ":-!" + filters.clothing.toString();
        filters_str += ":-!" + filters.products.toString();
        //filters_str+= ":-!" + filters.colors.toString();

        //alert(filters_str);

        // Debug Purposes
        //alert(filters.images + " - " + filters.clothing + " - " + filters.products + " - " + filters.colors);

        // This will disable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', .6);
        $('#filterDiv').append('<div id="disableFilterDiv" style="position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>');

        $.ajax({
            url: '/art/filter_request/',
            type: "POST",
            data: {filters: filters_str, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                //alert(response);
                console.log(response);
                // Save the response
                addHiddenInputElement("products_json_hidden", response);

                // Method TWO START
                ////////////////////////////////////////////////////////////////////////////////////////////////
                // Goal here is to collaps all rows and then expand all rows with new products showing
                ////////////////////////////////////////////////////////////////////////////////////////////////
                //collapseAllProductRows();

                // Set hidden element that dictates whether or not we got products back to show
                if ($("#products_json_hidden").val() == "[]") {
                    addHiddenInputElement("productsStatus", "none");
                }
                else {
                    addHiddenInputElement("productsStatus", "some");
                }

                // Start by just fading away the entire product column/rows element
                // This way we can do whatever with the rows/product elements on the inside and then fade it back in
                $("#productColumn").animate({
                    opacity: 0
                }, 500);

                setTimeout(function () {
                    $("#productColumn").slideUp(500);
                    // Build product rows (while the column is opacity 0)
                    setTimeout(function () {
                        buildAllProductRows();
                        initializeProductRows();
                        // If after filtering we're not showing all rows,
                        // then get the "Load More" button there and ready.
                        if (existsHiddenProdRows()) {
                            if (existsHiddenProdRows()) {
                                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info" +
                                    " btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>" +
                                    "Load more...</button></div>";
                                $('#loadMoreCol').replaceWith(loadMoreHtml);
                                // Fade in new instance of button
                                $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                                $('#loadMore').morphingButton();
                            } else {
                                $('#loadMoreCol').animate({
                                    height: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                            }
                        }
                        else {
                            $("#loadMoreCol").slideUp("slow");
                        }
                        setTimeout(function () {
                            loadMoreProductRows("expandThenFade", 500);
                            $("#loadingCircle").fadeOut(500);
                            // Remove spacer to bottom. This gives the circle space to exist on the phone view
                            setTimeout(function () {
                                enableFilters();
                                $("#footerSpacer").removeClass("space-150");
                            }, 500)
                        }, 100);
                    }, 1000);
                }, 1000);

                // Set needed rows to be "display:none;"

                /* ---------- Method ONE START ----------
                    //////////////////////////////////////////////////////////////
                    //(this got complicated fast so I'm trying a different method
                    //////////////////////////////////////////////////////////////
                    // Loop through rows/products and remove if not found in
                    // the list that we just got from the server
                    var rowNum = 0;
                    // Set initial element id to begin at
                    var id     = 'row' + rowNum;
                    var rowCol = [0,0];
                    // Check if there even is a row (there should/will be unless the user
                    // previously filtered to something with zero results
                    // TODO: Handle this event... (see statement above)
                    var hasNextRow = !!document.getElementById(id);
                    while(hasNextRow){
                        rowCol[1] = 0;
                        // jquery selector
                        var selector = '#' + id;
                        // get row element
                        var row = $(selector);

                        var prodIdCounter = 0;
                        // Loop over each product element and check if it should be there
                        $(selector).children().each(function(i) {
                            //alert("On Row " + selector + " Child " + $(this).attr("data-id"));
                            var products_json = JSON.parse($("#products_json_hidden").val());
                            //Debug purposes
                            //alert($(this).attr("name") + $(this).attr("data-product_type"));

                            // Determine if this particular product should be shown
                            // (based on new filter settings)
                            var i = 0;
                            var existsInFilteredProdList = false;
                            for(i = 0; i < products_json.length; i++){
                                // Debug - Output ID we're checking against
                                //alert(products_json[i][0]);
                                if(products_json[i][0] == $(this).attr("data-id")){
                                    existsInFilteredProdList = true;
                                    break;
                                }
                            }
                            // DEBUG OUTPUT...
                            //alert(existsInFilteredProdList);

                            var product_element = $(this);
                            // If it's not in the filters product list, then fade it away and fade
                            // something else in
                            if(!existsInFilteredProdList){
                                product_element.animate({
                                    width: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                                setTimeout(function(){
                                    // If there exists some in the list to show
                                    if($("#products_json_hidden").val() != "[]") {
                                        // Parse the JSON (to add a new prod (which matches filter options))
                                        var products_json =  JSON.parse($("#products_json_hidden").val());
                                        // If this product isn't already listed
                                        if(!!$("[data-id=" + products_json[0][0] + "]")) {
                                            // Generate/Save html to replace what we just faded/removed
                                            var date = Date.now();
                                            var new_prod_element = "" +
                                                "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
                                                " data-image='" + products_json[0][4] + "' data-colors='' style='display:none'" +
                                                "data-product_type='" + products_json[0][3] + "'>" +
                                                "   <div class='card card-product card-plain'>" +
                                                "       <div class='image'>" +
                                                "           <a href='#'>" +
                                                "               <img src='/" + products_json[0][4] + "' alt='...'/>" +
                                                "           </a>" +
                                                "       </div>" +
                                                "       <div class='content'>" +
                                                "           <a href='#'>" +
                                                "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
                                                "           </a>" +
                                                "           <p class='description'>" +
                                                products_json[0][2] +
                                                "           </p>" +
                                                "           <div class='footer'>" +
                                                "               <span class='price'> TODO </span>" +
                                                "               <button class='btn btn-danger btn-simple pull-right' rel='tooltip' title='Remove from wishlist' data-placement='left'>" +
                                                "                   <i class='fa fa-heart'></i>" +
                                                "               </button>" +
                                                "           </div>" +
                                                "       </div>" +
                                                "   </div> <!-- end card -->" +
                                                "</div>";
                                            // Replace the element we're on with
                                            product_element.replaceWith(new_prod_element);

                                            // Fade/Expand it in.
                                            $("#prod" + products_json[0][0] + "-" + date).animate({
                                                width: "toggle",
                                                opacity: "toggle"
                                            }, 1000);
                                        }

                                        // We should have just taken the 0th item in the json list/array and
                                        // put it on the web page (if it wasn't already there)

                                        // Get json string (hidden element vlaue) as json object
                                        var products_json = JSON.parse($("#products_json_hidden").val());

                                        // Drop 0th element from json text
                                        products_json.splice(0,1);
                                        var products_json_str = JSON.stringify(products_json);
                                        // push the json string to the hidden element for latter use
                                        addHiddenInputElement("products_json_hidden", products_json_str);
                                    }
                                },1000);
                            }
                            else{
                                // There's nothing to do here because it should stay right where it is.
                            }

                            rowCol[1]++;
                        });

                        // Increment row num (to check for) and count
                        rowNum++;
                        // Set new id (to row after one we just hid)
                        id = 'row' + rowNum;
                        // Check if new/next row exists
                        hasNextRow = !!document.getElementById(id);

                        // Increment rowCol
                        rowCol[0]++;
                    }
                    -------- End Method ONE -------*/

                //alert(rowCol[0] + "," + rowCol[1]);
                // Anything remaining in the products_json (results of filter) needs to be added

            },
            error: function () {
                alert("Error...");
            }
        });
    }

    $('#checkoutEmailHref').on("click", function () {
        $('#checkoutModalBackBtn').hide();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutShippingHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutPaymentHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').hide();
        $('#checkoutModalPayBtn').show();
    });

    // When "Next" button is clicked on the checkout modal
    $("#checkoutModalNextBtn").on("click", function () {
        // For each child li of the nav pills (in the checkout modal)
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutPaymentHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
        });
    });

    $("#checkoutModalBackBtn").on("click", function () {
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutEmailHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
        });
    });

    $(document).ready(function () {
        {#$icon = $addon.find('span'),#}
        {#$addon = $group.find('.input-group-addon'),#}
        {#$addon.removeClass('success');#}
        {#$addon.addClass('danger');#}
        {#$icon.attr('class', 'fas fa-times-circle');#}

        var email = document.getElementById("email_input");

        $('.form-control').keyup(function () {
            if ($.trim($('.form-control').val()).length) {
                $(this).addClass('sq-input--focus');
                $(this).removeClass('sq-input--error');
                {#$(this).removeClass('sq-input--focus');#}
            } else {
                $(this).removeClass('active-text');
            }
        });

        /*
        $('.input-group input[required]').on('keyup change', function () {
            var $form = $(this).closest('form'),
                $group = $(this).closest('.input-group'),
                $addon = $group.find('.input-group-addon'),
                $icon = $addon.find('span'),
                state = false;

            if (!$group.data('validate')) {
                state = $(this).val() ? true : false;
            } else if ($group.data('validate') == "email") {
                state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
            }


            if (state) {
                document.getElementById("disabledButtonWrapper").title = "";
                $addon.removeClass('danger');
                $addon.addClass('success');
                $icon.attr('class', 'fas fa-check-circle');
            } else {
                document.getElementById("disabledButtonWrapper").title = "Email is Invalid";
                $addon.removeClass('success');
                $addon.addClass('danger');
                $icon.attr('class', 'fas fa-times-circle');
            }

            if ($form.find('.input-group-addon.danger').length == 0) {
                $form.find('[type="submit"]').prop('disabled', false);
            } else {
                $form.find('[type="submit"]').prop('disabled', true);
            }
        });

        $('.input-group input[required], .input-group textarea[required], .input-group select[required]').trigger('change');
        */

    });

    var sendEmailBtn = document.getElementById("sendEmail");
    var contactModal = document.getElementById('contactModal');

    sendEmailBtn.onclick = function () {
        var _name = document.getElementById("contactorName").value;
        var _email = document.getElementById("contactorEmail").value;
        var _phone = document.getElementById("contactorPhone").value;
        var _message = document.getElementById("contactorMessage").value;

        // Close and clear the contact modal
        $('#contactModal').modal('hide');
        $('#contactorName').val('');
        $('#contactorEmail').val('');
        $('#contactorPhone').val('');
        $('#contactorMessage').val('');

        $.ajax({
            url: '/art/contact_us_email/',
            type: "POST",
            data: {
                name: _name,
                email: _email,
                phone_number: _phone,
                message: _message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // TODO: It's possible that we get a successful response even though we didn't send the email.
                // TODO-cont: In view should put specific thing in there. If not found (here) then consider it
                // TODO-cont: failed. Otherwise if we find specific string, success.
                //console.log(response);
                // Configure Notification
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["success"]("Your message to the Ludega Team was sent successfully. Thanks!", "Success");
            },
            error: function () {
                // Configure Notification
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "0",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut",
                    "tapToDismiss": false
                };
                toastr["error"]("Woh, we're sorry but we seem to have hit a snag on our end. Please reach out to us directly at ludega.team@ludega.com or call us 24/7 at (720) 288-0674.", "Error");
            }
        });
    };

    function attemptCheckout(event) {
        // Email Field (checkout "form")validation
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!emailReg.test($('#email_input').val())) {
            $('#email_input').addClass('sq-input--error');
            $('#checkoutEmailHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]("Invalid Email");

            return;
        }

        // Shipping Info Validation
        var fname = document.getElementById("firstName_input");
        var lname = document.getElementById("lastName_input");
        var add1 = document.getElementById("address_input");
        var city = document.getElementById("city_input");
        var state = document.getElementById("state_input");
        var zip = document.getElementById("zip_input_shipping");
        var country = document.getElementById("country_input");

        var shipping_info_errors_found = false;
        var errorMsg = "";

        if (fname.value == "") {
            // fname.addClass("sq-input--error");
            fname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "First name required<br>";
        }
        if (lname.value == "") {
            // fname.addClass("sq-input--error");
            lname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Last name required<br>";
        }
        if (add1.value == "") {
            // fname.addClass("sq-input--error");
            add1.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Address required<br>";
        }
        if (city.value == "") {
            // fname.addClass("sq-input--error");
            city.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "City required<br>";
        }
        if (state.value == "") {
            // fname.addClass("sq-input--error");
            state.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "State required<br>";
        }
        if (zip.value == "") {
            // fname.addClass("sq-input--error");
            zip.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Zip Code required<br>";
        }
        if (country.value == "") {
            // fname.addClass("sq-input--error");
            country.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Country required<br>";
        }

        if (shipping_info_errors_found) {
            // Take user to shipping section of form
            $('#checkoutShippingHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"](errorMsg);
            return;
        }

        // If we're here, all our validation passed.
        // Note: Square takes care of validating card info, so it's still possible that errors come back (during card
        // nonce request / after.
        if (!requestCardNonce(event)) {
            // TODO: Error. What should we do here and when will/should false be returned?
        }
    }
</script>
<!-- If you are using TypeKit.com uncomment this code -->
<!--
        <script src="https://use.typekit.net/[your kit code here].js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        -->
<!-- If you have retina @2x images on your server which can be sent to iPhone/iPad/MacRetina, please uncomment the next line -->
<!-- <script src="assets/js/retina.min.js"></script> -->
<!-- This ensures that when the modal opens, it won't scroll the background of up -->
</html>
<!doctype html>
{% load staticfiles %}
{% load ludega_art_filters %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Ludega</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="96x96" href="{% static "ludega_art/img/favicon.png" %}">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="{% static "ludega_art/css/material-kit.css" %}" rel="stylesheet"/>-->
    <link href="{% static "ludega_art/css/bootstrap.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/gsdk.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/examples.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.css" %}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <!-- link to the SqPaymentForm library -->
    <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- link to the local SqPaymentForm initialization -->
    <script src="{% static 'ludega_art/js/sqpaymentform.js' %}" type="text/javascript"></script>

    <!-- link to the custom styles for SqPaymentForm -->
    <link href="{% static "ludega_art/css/sqpaymentform.css" %}" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="{% static "ludega_art/css/pe-icon-7-stroke.css" %}" rel="stylesheet" />-->
    <style>
        .input-group-addon.primary {
            color: rgb(255, 255, 255);
            background-color: rgb(50, 118, 177);
            border-color: rgb(40, 94, 142);
        }

        .input-group-addon.success {
            color: rgb(255, 255, 255);
            background-color: rgb(92, 184, 92);
            border-color: rgb(76, 174, 76);
        }

        .input-group-addon.info {
            color: rgb(255, 255, 255);
            background-color: rgb(57, 179, 215);
            border-color: rgb(38, 154, 188);
        }

        .input-group-addon.warning {
            color: rgb(255, 255, 255);
            background-color: rgb(240, 173, 78);
            border-color: rgb(238, 162, 54);
        }

        .input-group-addon.danger {
            color: rgb(255, 255, 255);
            background-color: rgb(217, 83, 79);
            border-color: rgb(212, 63, 58);
        }
    </style>
</head>
<body class="ecommerce">
<nav id="navBar1337" class="navbar navbar-transparent navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button id="menu-toggle" type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar bar1"></span>
                <span class="icon-bar bar2"></span>
                <span class="icon-bar bar3"></span>
            </button>
            <!--<a class="navbar-brand" href="http://ludega.com"><i class="fa fa-chevron-left"></i> Back to Kit</a>-->
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                {#                <li>#}
                {#                    <a href="#">#}
                {#                        About LudegaArt#}
                {#                        <!--<b class="caret"></b>-->#}
                {#                    </a>#}
                {#                </li>#}
                <li>
                    <a href="" data-toggle="modal" data-target="#contactModal">
                        Contact Us
                        <!--<b class="caret"></b>-->
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        More
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-with-icons">
                        <!--<li>
                                    <a href="contact-us.html">
                                    <i class="pe-7s-mail-open-file"></i> Contact Us
                                    </a>
                                </li>
                                <li>
                                    <a href="about-us.html">
                                    <i class="pe-7s-info"></i> Blog Page
                                    </a>
                                </li>
                                <li>
                                    <a href="pricing.html">
                                    <i class="pe-7s-cash"></i> Pricing Page
                                    </a>
                                </li>-->
                        <li>
                            <a href="http://ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega
                            </a>
                        </li>
                        <li>
                            <a href="http://brokerage.ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Brokerage
                            </a>
                        </li>
                        <li>
                            <a href="http://104.131.86.135/" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Window Cleaning
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a id="cartBtn" href="#" class="btn btn-round btn-default cartBtn">Cart ({{ cart_count }} Items)</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<div class="wrapper">
    <div class="img-wrapper">
        <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/banner2.png' %}">
    </div>

    <!--<div class="parallax filter-black">
        <div class="parallax-image">
            <div class="col-sm-12 col-md-12 col-lg-12" style="padding-left: 0px; padding-right: 0px;">
                <img id="titleImage" src="{% static 'ludega_art/img/header.jpg' %}" alt="..." style="height: 100%; width:100%;"/>
            </div>
        </div>
        <br><br><br><br>
        <div class="small-info">
            {#            <h1 style="font-family:longtime">Ludega</h1>#}
            {#            <h3 style="font-family:longtime">Ludega Merch</h3>#}
        </div>
    </div>-->
    <!--<div class="section">
                <div class="container">
                    <h2 class="section-title">Special Offers</h2>
                    {% if top_products_list %}
                    <div id="mainContentRow" class="row">
                        {% for product in top_products_list %}
                        <div class="col-md-4">
                            <div class="card card-product card-plain">
                                <div class="image">
                                    <a>
                                    <img src="/{{product.image_file}}"  alt="..."/>
                                    </a>
                                </div>
                                <div class="content">
                                    <a href="#">
                                        <h4 class="title">{{product.name}}</h4>
                                    </a>
                                    <div class="footer">
                                        <span class="price price-old"> &dollar;1,930</span>
                                        <span class="price price-new">&dollar;1,330</span>
                                        <button class="btn btn-danger btn-simple pull-right" rel="tooltip" title="Remove from wishlist" data-placement="left">
                                        <i class="fa fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>-->
    <!-- section -->
    <div id="cartSection" class="section" style="display:none;">
        <div id="cartContainer" class="container my-card-dark">
            <button type="button" style="margin-top:15px;" id="closeCartBtn" class="close" aria-hidden="true">×</button>
            <h2 id="shoppingCartTitle" class="section-title">Your Shopping Cart</h2>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <!-- nesting -->
                        <div id="cartMainProdRow" class="row">
                            <!-- Cart Items will go here...-->
                        </div>
                        <div class="row" style="height:15px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <button id="cartContinueShoppingBtn" class="btn btn btn-success btn-block"
                                            style="margin-bottom:10px;">Continue Shopping
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button id="checkOut1" class="btn btn-info btn-block" style="margin-bottom:10px;"
                                            data-toggle="modal"
                                            onclick="initialize_checkout_modal()">Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="height:15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mainProductSection" class="section">
        <div id="productSectionContainer" class="container" style="max-width:100%;">
            <h2 class="section-title">Find what you need</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="filterDiv" class="card card-refine">
                        <!-- card-plain for no border -->
                        <div class="header">
                            <h4 class="title">Refine
                                <!--<button class="btn btn-default btn-xs btn pull-right btn-simple" rel="tooltip" title="Reset Filter">
                                    <i id="refreshFilterBtn" class="fa fa-refresh"></i>
                                </button>-->
                            </h4>
                        </div>
                        <div class="content">
                            <div class="panel-group" id="accordion">
                                <!-- Commenting out this dollar range section for now -->
                                <!--
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                <h6 class="panel-title">
                                                  <a data-toggle="collapse" href="#refinePrice">
                                                    Price Range
                                                    <i class="fa fa-caret-up pull-right"></i>
                                                  </a>
                                                </h6>
                                              </div>
                                              <div id="refinePrice" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                   <span class="price price-left">&dollar; 100</span>
                                                   <span class="price price-right">&dollar; 850</span>
                                                   <div class="clearfix"></div>
                                                   <div id="refine-price-range" class="slider slider-info"></div>
                                                </div>
                                              </div>
                                            </div>
                                            -->
                                {#                                <div class="panel panel-default">#}
                                {#                                    <div class="panel-heading">#}
                                {#                                        <h6 class="panel-title">#}
                                {#                                            <a data-toggle="collapse" href="#refineImage" class="collapsed">#}
                                {#                                                Images#}
                                {#                                                <i class="fa fa-caret-up pull-right"></i>#}
                                {#                                            </a>#}
                                {#                                        </h6>#}
                                {#                                    </div>#}
                                {#                                    <div id="refineImage" class="panel-collapse collapse">#}
                                {#                                        <div class="panel-body">#}
                                {#                                            <label class="checkbox">#}
                                {#                                                <input type="checkbox" id="AllImagesCheckBox" value=""#}
                                {#                                                       data-toggle="checkbox" checked="">#}
                                {#                                                All#}
                                {#                                            </label>#}
                                {#                                            {% if images %}#}
                                {#                                                {% for image in images %}#}
                                {#                                                    <label class="checkbox">#}
                                {#                                                        <input type="checkbox"#}
                                {#                                                               id="{{ image.name|str_replace:' ,' }}CheckBox" value=""#}
                                {#                                                               data-toggle="checkbox">#}
                                {#                                                        {{ image.name }}#}
                                {#                                                    </label>#}
                                {#                                                {% endfor %}#}
                                {#                                            {% endif %}#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineClothing" class="collapsed">
                                                  Clothing
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineClothing" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                <label class="checkbox">
                                                  <input type="checkbox" id="AllClothingCheckBox" value="" data-toggle="checkbox" checked="">
                                                  All
                                                </label>
                                                {% if types %}
                                                    {% for type in types %}
                                                        {% if type.is_clothing %}
                                                          <label class="checkbox">
                                                            <input type="checkbox" id="
                                    {{type.display_name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                            {{type.display_name}}
                                                          </label>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                              </div>
                                            </div>
                                            </div> -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            <a data-toggle="collapse" href="#refineProduct" class="collapsed">
                                                Products
                                                <i class="fa fa-caret-up pull-right"></i>
                                            </a>
                                        </h6>
                                    </div>
                                    <div id="refineProduct" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label class="checkbox">
                                                <input type="checkbox" id="AllProductsCheckBox" value=""
                                                       data-toggle="checkbox" checked="">
                                                All
                                            </label>
                                            {% if types %}
                                                {% for type in types %}
                                                    {% if not type.sub_type_only %}
                                                        <label class="checkbox">
                                                            <input type="checkbox"
                                                                   id="{{ type.display_name|str_replace:' ,' }}CheckBox"
                                                                   value="" data-toggle="checkbox">
                                                            {{ type.display_name }}
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineColor" class="collapsed">
                                                  Colors
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineColor" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                 <label class="checkbox">
                                                    <input type="checkbox" id="AllColorsCheckBox" value="" data-toggle="checkbox" checked="">
                                                    All
                                                  </label>
                                                  {% if colors %}
                                                      {% for color in colors %}
                                                        <label class="checkbox">
                                                          <input type="checkbox" id="{{color.name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                          {{color.name}}
                                                        </label>
                                                      {% endfor %}
                                                  {% endif %}
                                              </div>
                                            </div>
                                            </div> <!-- end panel -->
                            </div>
                        </div>
                    </div>
                    <!-- end card -->
                </div>
                <div class="col-md-9" id="productColumn">
                    <div class="row" id="row0">
                        {% if products %}
                            {% for product in products %}
                                {% if product.display %}
                                    <div class="col-sm-4"
                                         data-id="{{ product.id }}"
                                         data-image="{{ product.image_file }}"
                                            {% with colors_=product.colors.all %}
                                         data-colors="
                                    {% for color in colors_ %}
                                    {{ color }},
                                    {% endfor %}"
                                         data-product_type="{{ product.product_type.display_name }}"
                                         data-is_clothing="{{ product.product_type.is_clothing }}"
                                                >
                                            {% endwith %}
                                    <div data-toggle="modal" onmouseover="prodHover({{ product.id }})"
                                         data-id="{{ product.id }}" data-target="#prodModal"
                                         class="fake-link card card-product card-plain my-card-light"
                                         id="prod{{ product.id }}">
                                        <div style="overflow:visible;padding-top:10px;" class="image text-center">
                                            <div id="topImgSpacerProdId{{ product.id }}"
                                                 style="overflow:visible;height:0px"
                                                 ;></div>
                                            <a>
                                                <img id="imgProdId{{ product.id }}" class="my-img-dark"
                                                     style="max-width:90%;max-height:300px;height:auto;width:auto;"
                                                     src="/{{ product.image_file }}" alt="..."/>
                                            </a>
                                            <div id="bottomImgSpacerProdId{{ product.id }}" style="height:0px" ;></div>
                                        </div>
                                        <div class="content text-center">
                                            <span>
                                                <a>
                                                    <h4 class="title">{{ product.name }}</h4>
                                                </a>
                                            </span>
                                            <!--<p class="description">
                                                {{product.description}}
                                                </p>-->
                                            <div class="footer">
                                                <span class="price"> {{ product.id|get_price_str }}</span>
                                                <button onclick="filterBtnOnClick('{{ product.product_type }}')"
                                                        class="btn btn-danger btn-tooltip btn-simple pull-right"
                                                        rel="tooltip" title="Filter to {{ product.product_type }}"
                                                        data-placement="top">
                                                    <!--<i style="align-self:right;" class="fa fa-filter"></i>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end card -->
                                    </div>
                                    <!-- Each row should only contain 3 products -->
                                    {% if forloop.counter|divisibleby:3 == True %}
                                        <!-- End the previous <div class="row">  -->
                                        </div>
                                        <!-- Determine the row id (which is "row" + rowNum)                -->
                                        {% with rowCount=forloop.counter|divnum:3 %}
                                            {% with rowid="row"|addstr:rowCount %}
                                                <div class="row" id="{{ rowid }}">
                                            {% endwith %} <!-- Ending "with rowCount=forloop.counter|divnum:3" -->
                                        {% endwith %} <!-- Ending "with rowid="row"|addstr:rowCount"       -->
                                    {% endif %}
                                {% endif %}
                            {% endfor %} <!-- Ending "for product in products" -->
                        {% endif %}  <!-- Ending "if products"             -->
                        </div>
                    <div class="space-50"></div>
                    <div class="col-md-3 col-md-offset-4" id="loadMoreCol">
                        <button rel="tooltip" title="" style="margin-bottom:1px;" class="btn btn-info btn-round"
                                id="loadMore" data-toggle="morphing" data-rotation-color="blue">Load more...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- section -->
<div id="footerSpacer" class="space-50"></div>
<div class="subscribe-line subscribe-line-transparent"
     style="background-image: url('{% static 'ludega_art/img/merch7.png' %}')">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <form class="">
                    <div class="form-group">
                        <input type="text" value="" class="form-control" placeholder="Enter your email here...">
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-info btn-fill btn-block">Subscribe Now!</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer footer-big footer-default">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="id">Bahasa Indonesia</option>
                        <option value="ms">Bahasa Melayu</option>
                        <option value="ca">Català</option>
                        <option value="da">Dansk</option>
                        <option value="de">Deutsch</option>
                        <option value="en" selected="">English</option>
                        <option value="es">Español</option>
                        <option value="el">Eλληνικά</option>
                        <option value="fr">Français</option>
                        <option value="it">Italiano</option>
                        <option value="hu">Magyar</option>
                        <option value="nl">Nederlands</option>
                        <option value="no">Norsk</option>
                        <option value="pl">Polski</option>
                        <option value="pt">Português</option>
                        <option value="fi">Suomi</option>
                        <option value="sv">Svenska</option>
                        <option value="tr">Türkçe</option>
                        <option value="is">Íslenska</option>
                        <option value="cs">Čeština</option>
                        <option value="ru">Русский</option>
                        <option value="th">ภาษาไทย</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="ARS">ARS</option>
                        <option value="AUD">AUD</option>
                        <option value="BRL">BRL</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="CZK">CZK</option>
                        <option value="DKK">DKK</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="HKD">HKD</option>
                        <option value="HUF">HUF</option>
                        <option value="IDR">IDR</option>
                        <option value="ILS">ILS</option>
                        <option value="INR">INR</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                        <option value="MYR">MYR</option>
                        <option value="MXN">MXN</option>
                        <option value="NOK">NOK</option>
                        <option value="NZD">NZD</option>
                        <option value="PHP">PHP</option>
                        <option value="PLN">PLN</option>
                        <option value="RUB">RUB</option>
                        <option value="SEK">SEK</option>
                        <option value="SGD">SGD</option>
                        <option value="TWD">TWD</option>
                        <option value="USD" selected="">USD</option>
                        <option value="VND">VND</option>
                        <option value="ZAR">ZAR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-1">
                <h5 class="title">Company</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Our Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                About Us
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3 col-md-offset-1">
                <h5 class="title"> Help and Support</h5>
                <nav>
                    <ul>
                        <li>
                            <a data-toggle="modal" data-target="#contactModal">
                                Contact Us
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Terms & Conditions
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Money Back
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3">
                <h5 class="title">Latest News</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i> <b>We're Live!</b>
                                Ludega Merch is now live, feel free to place an order.
                                <hr class="hr-small">
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i>
                                <b>New merchandise!</b> New merch has been added, check out some of the new inventory.
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr/>
        <div class="social-area text-center">
            <h5>Join us on</h5>
            <a href="https://www.facebook.com/ludega.merch.3" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-facebook"></i>
            </a>
            <a href="https://mobile.twitter.com/LudegaMerch" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-twitter"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-google-plus"></i>#}
{#            </a>#}
            <a href="https://www.instagram.com/ludegamerch/" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-instagram"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-linkedin"></i>#}
{#            </a>#}
        </div>
        <div class="copyright">
            &copy; 2017 <a href="http://www.ludega.com">Ludega</a> - It Will Be.
        </div>
    </div>
</footer>
</div> <!-- wrapper -->

<div id="largeImgModal" class="img-modal">
    <!-- The Close Button -->
    <span class="my-close" onclick="document.getElementById('largeImgModal').style.display='none'">&times;</span>
    <!-- Modal Content (The Image) -->
    <img class="img-modal-content" id="largeImg" src="">
    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<!--<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true" style="display: none;">-->
<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <div class="modal-body">
                <!--<div class="container">-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="tab-content">
                            <div class="tab-pane active" id="product-page6">
                                <img class="my-prod-modal-img" onclick="increaseImgWithModal('123')" id="prodModalImage"
                                     style="-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-width:100%;max-height:500px;margin:auto;display:block;"
                                     src="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <a>
                                <h3 id="prodModalTitle" class="title"></h3>
                            </a>
                            <!--<p class="description">
                                        </p>-->
                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="descriptionHeading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleDescriptionHeader" class="collapsed">
                                            Product Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleDescriptionHeader" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="descriptionHeading" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdDescription">
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="typeDescriptionHeading">
                                    <h4 class="panel-title">
                                        <a id="collapsibleTypeDescriptionClickable" class="collapsed"
                                           data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleTypeDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleTypeDescriptionHeader">
                                            Type Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleTypeDescriptionHeader" class="panel-collapse collapse"
                                     role="tabpanel" aria-labelledby="typeDescriptionHeading" aria-expanded="false"
                                     style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdTypeDescription">
                                        <p>You haven't selected a Product Type yet.</p>
                                        <!--<ul style="padding-left: 20px;">
                                                    <li style="list-style-position: outside;"> Fits small to size</li>
                                                    <li style="list-style-position: outside;"> Model wears a UK 40R</li>
                                                    <li style="list-style-position: outside;"> Model measures: chest 39"/ 99cm, height 6'1"/ 185cm</li>
                                                </ul>-->
                                    </div>
                                </div>
                            </div>
                            <!--<div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                          <h4 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                              Details
                                            </a>
                                          </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false" style="height: 0px;">
                                          <div class="panel-body">
                                            85% wool, 15% linen. Dry-clean only
                                          </div>
                                        </div>
                                        </div>-->
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="headingFour">
                                    <h4 class="panel-title">
                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Returns
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="headingFour" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body">
                                        Here at Ludega Merch, we pride ourselves in having a friendly return policy.
                                        It's simple; if you're not 100% satisfied with your product, simply return it to
                                        us in the condition it was received and we'll refund or replace your order
                                        (shipping not included) and give you a 5% discount on your next purchase
                                        regardless of purchase amount.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Acordeon  -->
                        <div class="row align-items-center">
                            <div class="prod-options pull-down">
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodTypeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Type</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodSizeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Size</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12" id="priceDivCol" style="height:0px;opacity:0;">
                                    <a align="right">
                                        <h3 id="prodModalPrice" class="title">Select a Product Type and Size for
                                            Pricing!</h3>
                                    </a>
                                </div>
                                <div class="col-md-12" style="height:60px;">
                                    <div class="pull-right" style="margin-top:10px;">
                                        <button type="button" id="prodModalAddToCart" class="btn btn-fill">Add to Cart
                                        </button>
                                        <button type="button" id="prodModalBuyNow" class="btn btn-fill">Buy Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                       <div class="col-md-4"></div>
                       <div class="col-md-4 text-center"><a><h3 class="title">Similar Products</h3></a></div>
                       <div class="col-md-4"></div>
                   </div>
                  <div class="row">
                  <div class="col-md-12">
                   <div class="nbs-flexisel-container">
                           <div class="nbs-flexisel-inner">
                              <ul class="nav nav-text nbs-flexisel-ul" role="tablist" id="relatedProdsScroller" style="left: -113.75px;">
                              </ul>
                           </div>
                           <div class="nbs-flexisel-nav-left" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-left"></i></div>
                           <div class="nbs-flexisel-nav-right" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-right"></i></div>
                        </div>
                      </div>
                    </div>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
        <!--</div>-->
    </div>
</div>
</div>
<form id="hiddenForm"></form>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <!--<button type="button" id="contactModalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            <div class="modal-body">
                <div id="contactContainer" class="col-md-offset-1">
                    <h2 class="section-title">Send us a message</h2>
                </div>
                <div class="row">
                    <!--<div class="separator line-separator">♦</div>-->
                    <div id="contactContainer" class="col-md-6 col-md-offset-1">
                        </p>
                        <form role="form" id="contact-form" method="post" data-color="blue">
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your name (optional)</label>
                                <input id="contactorName" placeholder="First & Last Name" type="text" name="name"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Email address (optional)</label>
                                <input id="contactorEmail" placeholder="Your personal email" type="email" name="email"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Phone (optional)</label>
                                <input id="contactorPhone" placeholder="Phone Nmber" type="text" name="phone"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your message</label>
                                <textarea name="message" class="form-control" id="contactorMessage" rows="6"
                                          required></textarea>
                                <span class="material-input"></span></div>
                            <div id="contactButtonContainer" class="submit">
                                <input id="sendEmail" type="submit" class="btn btn-info btn-fill" value="Send Message">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4 col-md-offset-1">
                        <div class="contact-info">
                            <!--<h5><i class="fa fa-map-marker text-muted"></i> Address</h5>
                            <p class="text-muted"> Bld Mihail Kogalniceanu, nr. 8,<br>
                                7652 Bucharest,<br>
                                Romania
                            </p><br>-->
                            <h5><i class="fa fa-phone text-muted"></i> 24/7 Live Support</h5>
                            <p class="text-muted"> Customer Support<br>
                                (720) 288-0674<br>
                                Mon - Sun, 12:00AM -11:59PM
                            </p><br>
                            <h5><i class="fa fa-envelope text-muted"></i> Email Us</h5>
                            <p class="text-muted"> Ludega Merch LLC<br>
                                customer.support@ludega.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ageVerifictaionModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" )>
            <div class="img-wrapper">
                <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/merch7.png' %}">
            </div>
            <div class="modal-header" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Age Verification</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <h5 class="text-center">Are you old enough to purchase these products?</h5>
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title text-center">
                                <i class="fa fa-info-circle"></i>
                                <a data-toggle="collapse" href="#collapse1">Why are we asking?</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse">
                            <div class="panel-body">THIS WEBSITE CONTAINS ADULT MATERIAL AND IS ONLY SUITABLE FOR THOSE 18
                OR OLDER. ALL CUSTOMERS FROM ARIZONA, CALIFORNIA, ILLINOIS, KANSAS, MASSACHUSETTS,
                MISSISSIPPI, MISSOURI, NEW JERSEY, NEW YORK, & OHIO MUST BE 21 YEARS OR OLDER. BY ENTERING
                THIS SITE, YOU CONFIRM THAT YOU ARE OF LEGAL AGE TO PURCHASE THESE PRODUCTS IN YOUR STATE.
                WARNING: TOBACCO PRODUCTS CONTAIN NICOTINE, AND NICOTINE IS AN ADDICTIVE CHEMICAL.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class=" btn btn-primary btn-block" onclick="$('#ageVerifictaionModal').modal('hide');">
                                Yes
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="btn btn-danger btn-block" onclick="ageVerificationNoClicked()">
                                No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="checkoutModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Checkout As Guest</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <div class="row">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <ul id="checkoutNavPills" class="nav nav-pills" role="tablist"
                            style="justify-content:center;display:flex;">
                            <li id="checkoutEmailli" class="active">
                                <a id="checkoutEmailHref" href="#email" role="tab" data-toggle="tab"
                                   aria-expanded="true">
                                    Email
                                </a>
                            </li>
                            <li id="checkoutShippingli" class="">
                                <a id="checkoutShippingHref" href="#shipping" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Shipping Info
                                </a>
                            </li>
                            <li id="checkoutPaymentli" class="">
                                <a id="checkoutPaymentHref" href="#payment" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="email">
                        <div class="row" style="padding-top: 15px;">
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                            <div class="col-sm-10 col-md-10 col-lg-10">
                                <div class="form-group">
                                    <label for="validate-email">Email</label>
                                    <input type="email" class="form-control" id="email_input" placeholder="Email"
                                           required=""><br>
                                    <label for="validate-email">Additional Notes [optional]</label>
                                    <textarea class="form-control" rows="5" id="notes" placeholder="Color, size, flavor, or any other additional comments."></textarea>
                                </div>
                            </div>
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="shipping">
                        <div id="" class="" style="padding:15px;">
                            <div class="form-group">
                                <select class="form-control" id="shippingOptions">
                                    <option value="0" selected="">USPS Priority - $9.00</option>
                                    {#                                    <option value="1">Free Shipping [All orders over $100, abuse of this will void your order.]</option>#}
                                </select>
                            </div>
                            <div class="">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left">
                                    <label for="exampleInputEmail1">First Name</label>
                                    <input type="text" class="form-control" id="firstName_input"
                                           aria-describedby="emailHelp" placeholder="First Name" required="">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right">
                                    <label for="exampleInputEmail1">Last Name</label>
                                    <input type="text" class="form-control" id="lastName_input"
                                           aria-describedby="emailHelp" placeholder="Last Name" required="">
                                </div>
                                <br>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Address</label>
                                <input type="text" class="form-control" id="address_input" aria-describedby="emailHelp"
                                       placeholder="Address Line 1">
                            </div>
                            <div class="form-group shove-bot">
                                <input type="text" class="form-control" id="address_input2" aria-describedby="emailHelp"
                                       placeholder="Address Line 2 [Optional]">
                            </div>
                            <div class="form-group shove-left">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="city_input" aria-describedby="emailHelp"
                                           placeholder="City">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="state_input"
                                           aria-describedby="emailHelp" placeholder="State/Province/Region">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-left">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="number" class="form-control" id="zip_input_shipping"
                                           aria-describedby="emailHelp" onchange="checkDenverZipCode()"
                                           placeholder="Zip/Postal Code">
                                </div>
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-right">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="country_input"
                                           aria-describedby="emailHelp" placeholder="Country">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div id="shippingAlert" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="payment">
                        <div id="sq-ccbox">
                            <!--
                                You should replace the action attribute of the form with the path of
                                the URL you want to POST the nonce to (for example, "/process-card")
                            -->
                            <div class="row">
                                <div id="cc-form" class="col-sm-12 col-md-12 col-lg-12 pad-cc-info">

                                    <table>
                                        <tbody>
                                        <tr>
                                            <th class="pad-left">Card Number</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-card-number"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">CVV</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-cvv"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Expiration Date</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-expiration-date"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Postal Code</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-postal-code"></div>
                                            </td>
                                        </tr>

                                        </tbody>
                                    </table>
                                    <!--After a nonce is generated it will be assigned to this hidden input field.-->
                                    <input type="hidden" id="card-nonce" name="nonce">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                            <div id="totalCreditCardForm"
                                 class="totalCC col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"></div>
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalBackBtn" type="button" class="btn btn-info"
                                    style="justify-content:left;display:flex;">
                                <i class="fa fa-arrow-left" style="padding-top: 2px;"></i>
                                Back
                            </button>
                        </div>
                        <div id="" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>

                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalNextBtn" type="button" class="btn btn-info">
                                Next
                                <i class="fa fa-arrow-right"></i>
                            </button>
                            <button id="checkoutModalPayBtn" type="button" onclick="attemptCheckout(event)"
                                    class="btn btn-info">Confirm & Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header"></div>
            <div class="">

                <div class="row marketing">

                    <div class="col-lg-12">

                        <h4><b>Product Name</b></h4>
                        <hr/>

                        <div>
                            <h4>Success - your order is confirmed!</h4>
                            <h5>Order number:
                                <div id="orderNumber"> orderNumber</div>
                            </h5>
                            <hr/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">Shipping Address
                                    <ul class="list-group">
                                        <li class="list-group-item" id="orderName">firstName lastName</li>
                                        <li class="list-group-item" id="orderEmail">email</li>
                                        <li class="list-group-item" id="orderAddress">address</li>
                                        <li class="list-group-item" id="orderZip">state city zip</li>
                                        <li class="list-group-item" id="orderCountry">country</li>
                                    </ul>

                                </div>
                                <div class="col-xs-6 text-right">
                                    <h1><span class="glyphicon glyphicon glyphicon-cloud-download"
                                              aria-hidden="true"></span></h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <p><span class="glyphicon glyphicon glyphicon-question-sign"
                                             aria-hidden="true"></span>
                                        All Monthly and Quarterly subscription plans renew automatically on the 15th of
                                        the month.</p>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed">
                                            <thead>
                                            <tr>
                                                <td><strong>Product Name</strong></td>
                                                <td class="text-right"><strong>Product Options</strong></td>
                                                <td class="text-right"><strong>Subscription Type</strong></td>
                                                <td class="text-right"><strong>Price</strong></td>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                            <tr>
                                                <td>Veganboxen</td>
                                                <td class="text-right">Variable #1</td>
                                                <td class="text-right">Monthly</td>
                                                <td class="text-right">189 SEK</td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-right"><strong>VAT - 12%</strong></td>
                                                <td class="thick-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Shipping</strong></td>
                                                <td class="no-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Total</strong></td>
                                                <td class="no-line text-right">189 SEK</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div> <!-- /container -->
        </div>
    </div>
</div>

</body>

<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>
<!--  jQuery and Bootstrap core files    -->
<script src="{% static 'ludega_art/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/jquery-ui.custom.min.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/bootstrap.min.js' %}" type="text/javascript"></script>
<!--  Plugins -->
<script src="{% static 'ludega_art/js/gsdk-checkbox.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-morphing.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-radio.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-bootstrapswitch.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-select.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'ludega_art/js/chartist.min.js' %}"></script>
<script src="{% static 'ludega_art/js/jquery.tagsinput.js' %}"></script>
<script src="{% static 'ludega_glass/js/toastr.min.js' %}"></script>
<script src="{% static 'ludega_art/js/visible.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
<!--  Get Shit Done Kit PRO Core javascript 	 -->
<script src="{% static 'ludega_art/js/get-shit-done.js' %}"></script>


<script type="text/javascript">

    var debug = true;
    var big_image;
    var transparent = true;
    var loadMoreColOrigHtml = "";


    // This function initializes listeners and calls initialization functions
    // TODO: Get all listeners to be called here.
    $().ready(function () {
        responsive = $(window).width();

        var show_age_verification_json_str = '{{ show_age_verification }}';
        var show_age_verification_json = JSON.parse(show_age_verification_json_str.replace(/&quot;/g,"\""));
        if(show_age_verification_json["show_age_verification"] == "true") {
            $("#ageVerifictaionModal").modal({backdrop: 'static', keyboard: false});
        }
        else{
            // No need to display the age verification
        }


        $(window).on('scroll', checkScroll);

        if (responsive >= 768) {
            big_image = $('.parallax-image').find('img');

            $(window).on('scroll', function () {
                parallax();
                checkScroll();
            });
        }

        //This ensures that if the user tries to scroll while we're doing some fancy scrolling of our own, it will get canceled
        $('html, body').on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
            $('html, body').stop();
        });


        initializeProductRows();
        loadMoreColOrigHtml = $("#loadMoreCol").html();
        setLoadMoreClickFunc();
        //applyFilterOptions();
        refreshCartBtn();
        initializeCheckBoxListeners();
        // There are two cart btns due to sizing of screen. We don't want to apply
        // the listener until document is ready. Otherwise we may not get the
        // listener to be applied to the "second" version of the btn.
        apply_cart_btn_listeners();
        // If the user refreshes the page while they're half way down,
        // then calling this will ensure we display the header bar correctly.
        checkScroll();
        setTimeout(function () {
            addAndAnimateImgSpacers();
        }, 500);
        setProductSectionContainerSize();

    });

    function ageVerificationNoClicked(){
        $.ajax({
            url: '/art/no_selected_on_age_verification/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                console.log("User indicated that they are not of age to purchases our products.")
            },
            error: function (response) {
                console.log("Error - Response was" + response);
            }
        });

        window.location.href='http://www.google.com';
    }

    function checkDenverZipCode() {

        var total = parseFloat((document.getElementById("cartTotal").innerHTML).replace('Total: $', ''))


        var shippingAlert = document.getElementById("shippingAlert");
        var myInput = parseInt(document.getElementById("zip_input_shipping").value);

        var denver_zip_codes = [80002, 80003, 80004, 80005, 80007, 80010, 80011, 80012, 80013, 80014, 80015, 80016, 80017,
            80018, 80019, 80020, 80021, 80022, 80023, 80024, 80030, 80031, 80033, 80045, 80101, 80102,
            80103, 80104, 80105, 80107, 80108, 80109, 80110, 80111, 80112, 80113, 80116, 80117, 80118,
            80120, 80121, 80122, 80123, 80124, 80125, 80126, 80127, 80128, 80129, 80130, 80131, 80134,
            80135, 80136, 80137, 80138, 80202, 80203, 80204, 80205, 80206, 80207, 80209, 80210, 80211,
            80212, 80214, 80215, 80216, 80218, 80219, 80220, 80221, 80222, 80223, 80224, 80226, 80227,
            80228, 80229, 80230, 80231, 80232, 80233, 80234, 80235, 80236, 80237, 80238, 80239, 80241,
            80246, 80247, 80249, 80260, 80264, 80290, 80293, 80294, 80401, 80403, 80419, 80420, 80421,
            80422, 80425, 80427, 80432, 80433, 80436, 80438, 80439, 80440, 80444, 80448, 80449, 80452,
            80453, 80454, 80456, 80457, 80465, 80470, 80475, 80476, 80601, 80602, 80640, 80820, 80827,
            80830, 80835];

        var check_for_denver_zip = denver_zip_codes.includes(myInput);

        if (check_for_denver_zip == true) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["success"]('You are eligible for free shipping!');
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + (total - 9.00).toFixed(2) + " [Free Shipping]";
        }
        else {
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + parseFloat(total).toFixed(2);
            document.getElementById("shippingAlert").innerHTML = "";
        }

    }

    function setProductSectionContainerSize() {
        //alert($(window).width());
        if ($(window).width() > 1400) {
            var pixels = $("#mainProductSection").width() * .75;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "80%");
            }, 500);
        }
        else {
            var pixels = $("#mainProductSection").width() * .9;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "90%");
            }, 500);
        }
    }

    function increaseImgWithModal(id) {
        // Get the modal
        var modal = document.getElementById('largeImgModal');

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("prodModalImage");
        var modalImg = document.getElementById("largeImg");
        var captionText = document.getElementById("caption");
        modal.style.display = "block";
        modalImg.src = img.src;
        captionText.innerHTML = img.alt;

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("my-close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };
    }

    function scaleAndShadowById(id, time) {
        $("#" + id).removeClass("remove-shadow-size");
        $("#" + id).addClass("add-shadow-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-shadow-size");
            $("#" + id).removeClass("add-shadow-size");
        }, time);
    }

    function scaleById(id, time) {
        $("#" + id).removeClass("remove-size");
        $("#" + id).addClass("add-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-size");
            $("#" + id).removeClass("add-size");
        }, time);
    }

    function refreshCartBtn() {
        $.ajax({
            url: '/art/get_cart_count/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                $(".cartBtn").each(function () {
                    $(this).text("Cart (" + response + " Items)");
                });
                //$("#cartBtn").text("Cart (" + response + " Items)");
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function clearCart() {
        $.ajax({
            url: '/art/clear_cart/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                if (!response === "{\"error\":\"\",\"message\":\"success\"}") {
                    console.log("ERROR - Failed to Clear Cart");
                    // TODO: Attempt to email support.ludega.com
                }
            },
            error: function () {
                console.log("ERROR - Failed to Clear Cart");
                // TODO: Attempt to email support.ludega.com
            }
        });
    }

    // This function is called via a "handler" in static/ludega_art/js/sqpaymentform.js
    function chargeCard(nonce) {

        // TODO: Send this json over the network and parse server side.
        var cart_json = $("#cart_info_json").val();
        var obj = JSON.parse(cart_json);

        number_of_keys = (Object.keys(obj).length) - 1;
        var i = 0;
        var prod_id_arr = [];
        var quantity_arr = [];
        var prod_type_arr = [];
        var prod_size_arr = [];

        for (i; i < number_of_keys; i++) {
            prod_id_arr[i] = obj[i]["prod_id"];
            quantity_arr[i] = obj[i]["quantity"];
            prod_type_arr[i] = obj[i]["type"];
            prod_size_arr[i] = obj[i]["size"];
        }

        console.log("DEBUG ON");
        console.log('Nonce: ' + nonce);
        console.log('prod_id_arr: ' + prod_id_arr);
        console.log('quantity_arr: ' + quantity_arr);
        console.log('prod_type_arr: ' + prod_type_arr);
        console.log('prod_size_arr: ' + prod_size_arr);
        console.log('Number of keys: ' + number_of_keys);
        console.log(document.getElementById("firstName_input").value);
        console.log(document.getElementById("lastName_input").value);
        console.log(document.getElementById("address_input").value);
        console.log(document.getElementById("city_input").value);
        console.log(document.getElementById("state_input").value);
        console.log(document.getElementById("zip_input_shipping").value);
        console.log(document.getElementById("notes").value);

        var e = document.getElementById("shippingOptions");
        var shipping_method = e.options[e.selectedIndex].value;
        console.log(shipping_method);

        $.ajax({
            url: '/art/submit_order_charge_card/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                nonce: nonce,
                prod_id_arr: prod_id_arr,
                quantity_arr: quantity_arr,
                prod_size_arr: prod_size_arr,
                prod_type_arr: prod_type_arr,
                number_of_keys: number_of_keys,
                email: document.getElementById("email_input").value,
                note: document.getElementById("notes").value,
                first_name: document.getElementById("firstName_input").value,
                last_name: document.getElementById("lastName_input").value,
                address1: document.getElementById("address_input").value,
                address2: document.getElementById("address_input2").value,
                city: document.getElementById("city_input").value,
                state: document.getElementById("state_input").value,
                zip: document.getElementById("zip_input_shipping").value,
                country: document.getElementById("country_input").value,
                shipping_method: shipping_method,
            },
            success: function (response) {

                var fName = document.getElementById("firstName_input").value
                var lName = document.getElementById("firstName_input").value


                if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date');
                    var element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV');
                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date / CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Expiration');

                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_CARD\', u\'detail\': u\'Invalid card number.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Credit Card Number');
                    var element = document.getElementById("sq-card-number");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'CARD_DECLINED\', u\'detail\': u\'Card declined.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Sorry, your card was declined.');
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'INVALID_REQUEST_ERROR\', u\'code\': u\'CARD_TOKEN_USED\', u\'detail\': u\'Card nonce already used; please request new nonce.\'}]}') {
                    // Somehow this nonce was already used. We need to re-request a nonce and try this whole process again.
                    console.log("Card nonce already used; please request new nonce and try to charge card again.")
                    //$("#checkoutModalPayBtn").trigger("click");
                }
                // THIS, hopefully, is where we get most of the time!
                else if (response.indexOf("order_confirmation_number") >= 0) {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]('Payment Recieved!');

                    // Clear cart since we just successfully bought everything in the cart
                    if (!clearCart()) {
                        console.log("CRITICAL ERROR - Failed to clear cart.");
                    }

                    console.log(response);
                    response_json = JSON.parse(response);
                    var confirmation_num = response_json["order_confirmation_number"];

                    // Now redirect page to confirmation page.
                    url = '/order_confirmation?order_id_hash=' + confirmation_num;
                    window.location.replace(url);

                }
                else {
                    console.log("CRITICAL ERROR - Got unexpected response from server.\nResponse was: " + response);
                    // TODO: Email software.support@ludega.com
                }
            },
            error: function (response) {
                alert("Failed: " + response.toString());
            }
        });
    }

    // This get's called upon "showing" of the checkout modal
    // Think of it as the "before showing, run this stuff" function
    function initialize_checkout_modal() {

        $('#checkoutEmailHref').trigger("click");

        $('#checkoutForm').trigger("reset");
        $("#email_input").removeClass("sq-input--focus");
        $("#email_valid_color").removeClass("success");
        $("#email_valid_color").addClass("danger");
        $("#email_valid_symbol").removeClass("fa-check-circle");
        $("#email_valid_symbol").addClass("fa-times-circle");

        $("#firstName_input").removeClass("sq-input--focus");
        $("#lastName_input").removeClass("sq-input--focus");
        $("#address_input").removeClass("sq-input--focus");
        $("#city_input").removeClass("sq-input--focus");
        $("#state_input").removeClass("sq-input--focus");
        $("#zip_input_shipping").removeClass("sq-input--focus");
        $("#country_input").removeClass("sq-input--focus");


        $('#cc-form').find('input:text').val('');
        $('#checkoutModal').modal('hide');
        $("#collapse2").removeClass("in");
        $("#collapse3").removeClass("in");
        try {
            var cart_empty = document.getElementById("noProdsInformDiv").innerHTML;

            if (cart_empty == "No Items In Cart") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-left",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "500",
                    "hideDuration": "1000",
                    "timeOut": "2000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["error"]('Your cart is empty. Please add an item to checkout.');
                return;
            }
            else {
                $("#checkoutModal").modal()
            }
        }
        catch (err) {
            $("#checkoutModal").modal()
        }


        {#document.getElementsByTagName('iframe')[0].src=document.getElementsByTagName('iframe')[0].src#}
        {#document.getElementsByTagName('iframe')[1].src=document.getElementsByTagName('iframe')[1].src#}
        {#document.getElementsByTagName('iframe')[2].src=document.getElementsByTagName('iframe')[2].src#}
        {#document.getElementsByTagName('iframe')[3].src=document.getElementsByTagName('iframe')[3].src#}


        {#document.getElementById('sq-card-number').src += '';#}


        {#var iframe = document.getElementById('sq-cvv');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#iframe.src = iframe.src;#}

        {#var iframe = document.getElementById('sq-card-number');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-cvv');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src#}
    }


    function scaleAndShadowByDataId(id, time) {
        //alert("here too...");
        $('*[data-id=' + id + ']').removeClass("remove-shadow-size");
        $('*[data-id=' + id + ']').addClass("add-shadow-size");
        setTimeout(function () {
            $('*[data-id=' + id + ']').addClass("remove-shadow-size");
            $('*[data-id=' + id + ']').removeClass("add-shadow-size");
        }, time);
    }

    // This function handles user clicks on "Continue Shopping" in the
    // cart section of the site
    $("#cartContinueShoppingBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        $("#cartContainer").hover(function (event) {
            event.preventDefault();
        });
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    $("#closeCartBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    // This function handles clicks on the "Checkout" button.
    // We build a link to the "Shopify Pay Page" and redirect the user there
    $("#checkOut").on("click", function () {
        console.log($("#cart_info_json").val());
        var cart_info = JSON.parse($("#cart_info_json").val());

        var checkout_page_url = "https://enspirus-arts.myshopify.com/cart/";
        var i = 0;
        var key_count = Object.keys(cart_info).length;
        if (key_count == 1) {
            scaleById("emptyCartMessage", 350);
            setTimeout(function () {
                scaleById("emptyCartMessage", 350);
            }, 650);
        }
        else {
            for (var key in cart_info) {
                if (key != "total_price") {
                    checkout_page_url += cart_info[key]["variant_id"] + ":" + cart_info[key]["quantity"];
                    if (i < key_count - 2) {
                        checkout_page_url += ",";
                    }
                }
                i++;
            }
            // Direct user to checkout page
            window.location.href = checkout_page_url;
        }
    });

    // This is a niche situation listener. Essentially, if the user
    // wants to see the "Type Description" and clicks/taps on it, but
    // they haven't selected a type in the drop down, then we want to
    // pulse the type selector and only temporarily display a message
    // stating that they haven't chooses a type yet.
    $("#collapsibleTypeDescriptionClickable").on("click", function () {
        if ($('#collapsibleTypeDescriptionHeader').attr('aria-expanded') == "false" && $("#prodTypeSelector").find("option:selected").val() == "default") {
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);

            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("hide");
            }, 2000);
        }
    });

    // This function resets the filters to default which, currently is just
    // "All". Meaning completely open, no filter subset criteria
    $("#refreshFilterBtn").on("click", function () {
        addHiddenInputElement("resetFilterBtnStatus", "clicked");
        $("#AllProductsCheckBox").parent().addClass("checked");
        $("#AllProductsCheckBox").trigger("click");
        //$("#AllImagesCheckBox").parent().addClass("checked");
        addHiddenInputElement("resetFilterBtnStatus", "notClicked");
        //$("#AllImagesCheckBox").trigger("change");
    });

    // Once a size is selected, we should be able to display a price.
    $('#prodSizeSelector').on('change', function () {
        // Get/save product size selection
        var sizeSelection = $(this).find("option:selected").val();
        if (sizeSelection != "default") {
            // Get/save the price for the given selection
            var prod_modal_json_info = JSON.parse($("#prod_modal_content_json_hidden").val());
            // Get/save product type selected
            var typeSelection = $("#prodTypeSelector").find("option:selected").val();
            // Get/save product price (for selected size/type)
            var price = prod_modal_json_info["purchase_options"][typeSelection]["size_price"][sizeSelection];

            // If the price is already showing, collapse it and then open it to show
            // new price
            if ($("#priceDivCol").height() != 0 && $("#priceDivCol").height() != 1) {
                // Collapse it so it can be changed and then re-opened.
                $("#priceDivCol").animate({
                    height: "0px",
                    opacity: 0
                }, 600);
                setTimeout(function () {
                    $("#prodModalPrice").text("$" + price);
                }, 600);
            }
            // It was already collapsed. Just fill price. Then we'll show it (below)
            else {
                $("#prodModalPrice").text("$" + price);
            }
            // Show price (with fade in and expand in)
            $("#priceDivCol").animate({
                height: "60px",
                opacity: 1
            }, 600);
            //$("#priceDivCol").slideDown("slow");
            //$("#priceDivCol").fadeIn("slow");
        }
        else {
            $("#priceDivCol").animate({
                height: "0px",
                opacity: 0
            }, 600);
            setTimeout(function () {
                $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
            }, 600);
        }
    });

    // This accomplishes a cascading drop down list.
    // When Type is selected, then the Size selector
    // can be populated. This function populates the
    // size selector with options based on what type
    // the user selected.
    $('#prodTypeSelector').on('change', function () {
        // Start by removing existing options from size selector
        $("#prodSizeSelector")
            .find('option')
            .remove()
            .end()
            .append('<option value="default">Select Size</option>')
            .val('default')
        ;
        $("#prodSizeSelector").selectpicker('refresh');

        var selected = $(this).find("option:selected").val();
        var modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
        var one_size = "";
        if (selected != "default") {
            // Fill the size dropdown with options
            for (var size in modal_info_json["purchase_options"][selected]["size_price"]) {
                $("#prodSizeSelector").append("<option value='" + size + "'>" + size + "</option>");
                $("#prodSizeSelector").attr('disabled', false);
                $("#prodSizeSelector").selectpicker('refresh');
                one_size = size;
            }

            // Fill the Type Description Header and expand it
            $("#prodModalProdTypeDescription").html(selected + "<br>" + modal_info_json["purchase_options"][selected]["description"]);
            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("show");
            }, 500);
        }
        else {
            // Then they selected the "Default" value which isn't a valid type
            // Disable size as there is no size for "Default"
            $("#prodSizeSelector").attr('disabled', true);
            $("#prodSizeSelector").selectpicker('refresh');
            // Collapse and change the Type Description
            $("#collapsibleTypeDescriptionHeader").collapse("hide");
            setTimeout(function () {
                $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
            }, 500);
        }

        // If there's only one Prod Size for the Prod Type selected,
        // then auto-select that size for the user.
        if ($("#prodSizeSelector option").size() == 2) {
            $("#prodSizeSelector").val(one_size);
            $("#prodSizeSelector").selectpicker('refresh')
        }
        // Size selector may have changed. As a check, trigger the on change function/listener
        $("#prodSizeSelector").trigger("change");
    });

    // This function/listener removes options from type and size selector
    // whenever the modal is closed (modal close). It also collapses the description and
    // type headers/info boxes.
    $("#prodModal").on('hidden.bs.modal', function () {
        // Remove options from type selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodTypeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Remove optiosn from size selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodSizeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Collaps price section and reset pricing text
        $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
        $("#priceDivCol").animate({
            height: "0px",
            opacity: 0
        }, 600);

        // Refresh the selectors since we changed them.
        // Bootstrap requires this step.
        $("#prodTypeSelector").selectpicker('refresh');
        $("#prodSizeSelector").selectpicker('refresh');

        // Reset Type Description and Product Description
        $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
        $("#collapsibleTypeDescriptionHeader").collapse("hide");
        $("#collapsibleDescriptionHeader").collapse("hide");

        // Remove Product Image
        $("#prodModalImage").attr("src", "");
    });

    // When the user clicks the "Cart" button at the top, this is what happens.
    function apply_cart_btn_listeners() {
        $(".cartBtn").each(function () {
            $(this).on("click", function () {
                if ($("#cartSection").css("display") == "none") {
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            // Save the JSON returned in a hidden form
                            addHiddenInputElement("cart_info_json", response);

                            // Parse response (json formatted string) into a json object for iterating through it
                            var cart_info_json = JSON.parse(response);

                            // for each item in the cart
                            var i = 0;
                            for (var key in cart_info_json) {
                                var item_row = "";
                                if (i == 0 && Object.keys(cart_info_json).length != 3 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;">';
                                }
                                else if (i == Object.keys(cart_info_json).length - 2 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">';
                                }
                                else {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;border-bottom:0.5px solid lightgray;">';
                                }
                                if (key != "total_price") {
                                    $("#cartMainProdRow").append('' +
                                        item_row +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row">' +
                                        '</div>' +
                                        '<div class="row"  style="padding-bottom:10px;">' +
                                        '<div class="col-xs-4"><img src="/' + cart_info_json[key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                                        '<div class="col-xs-8">' +
                                        '<a><h3 class="title">' + cart_info_json[key]["name"] + '</h3></a>' +
                                        '<p>' + ' ' + cart_info_json[key]["type"] + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row" style="padding-bottom:15px;">' +
                                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Quantity</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                                        '</div>' +
                                        '<div class="row">' +
                                        '<div id="unitPriceProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + cart_info_json[key]["price"] + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<input onchange="quantityChange(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="quantityProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_info_json[key]["quantity"]) + '">' +
                                        '</div>' +
                                        '<div id="subtotalProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_info_json[key]["price"] * cart_info_json[key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<button onclick="cartRemoveItem(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="cartRemoveProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-id="' + cart_info_json[key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                    );

                                }
                                i++;
                            }

                            // If we added at least 1 item
                            // There will always be one key (total_amount). So if there are 2, then we had
                            // at least one item. Thus if i > 1, not i > 0


                            if (i > 1) {
                                var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                                var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                                var shipping = 9.00.toFixed(2);

                                /*if (subTotal >= 100){
                                    shipping = 0.00.toFixed(2);
                                }*/

                                var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);

                                $("#cartMainProdRow").append('' +
                                    '<div id="cartTotalRow" class="row" style="padding-top:15px;">' +
                                    '<div class="col-sm-6 col-xs-12"></div>' +
                                    '<div class="col-sm-6 col-xs-12">' +
                                    //'<div class="col-xs-3"></div>' +
                                    '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                                    //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                            // Else no items were added. So display something saying so.
                            else {
                                $("#cartMainProdRow").append('<div id="emptyCartMessage" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                            }

                            $("#cartContainer").removeClass("remove-shadow-size-quick");
                            if ($("#closeCartBtn").css("display") == "none") {
                                $("#closeCartBtn").css("display", "block");
                            }
                            $("#cartSection").slideToggle();
                            $('html, body').animate({
                                scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                            }, 1000);
                            if ($("html").hasClass("nav-open")) {
                                $("#menu-toggle").trigger("click");
                            }
                            //console.log(response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                }
                else {
                    $('html, body').animate({
                        scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                    }, 1000);
                    if ($("html").hasClass("nav-open")) {
                        $("#menu-toggle").trigger("click");
                    }
                }

                // Seems we get weird flickering effects (involved in the animate scrollTop action) if this isn't here
                return false;
            });
        });
    }

    function quantityChange(id, size, type) {
        // Special Note: Size may have instances of periods to represent decimal sizes. When
        // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
        // below, you'll see that I'm escaping the period using our replaceAll string function.
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        if ($("[id='quantityProdId" + concatIdSizeType + "']").val() <= 0) {
            // Display notification informing of success
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]('Select the red trash can to remove an item from your cart.');

            $("[id='quantityProdId" + concatIdSizeType + "']").val(1);
            scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 650);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 1300);
        }
        else {
            // Firstly, inform the server that the user would like to add to their cart. And attempt to do so...
            var _size = size;
            var _type = type;
            $.ajax({
                url: '/art/update_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: $("[id='quantityProdId" + concatIdSizeType + "']").val(),
                    price: $("[id='unitPriceProdId" + concatIdSizeType + "']").text(),
                    size: _size,
                    type: _type,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    scaleAndShadowById("cartBtn", 500);
                    refreshCartBtn();
                    // Updating hidden json
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            addHiddenInputElement("cart_info_json", response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                },
                error: function () {
                    alert("Error...");
                }
            });

            // This behemoth of a statement simply sets the text of the subtotal for a give item in the cart
            // The length of the statement is due to rounding, multiplication, and ridiculous id naming convention I've
            // used for naming/id'ing items in the cart
            $("[id='subtotalProdId" + concatIdSizeType + "']").text("$" + (Math.round((parseFloat($("[id='unitPriceProdId" + concatIdSizeType + "']").text().replace("$", "")) * $("[id='quantityProdId" + concatIdSizeType + "']").val()) * 100) / 100).toFixed(2));

            //We also want to refresh the cart total.
            refreshCartTotal();
        }
    }

    function prodHover(id) {
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
        if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
            $("#imgProdId" + id).css("transform", "scale(.90, .90)");
        }
        $("#prod" + id).hover(function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(.90, .90)");
            }
        }, function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(1,1)");
            }
        });
    }

    // This function loops through each item in the cart and applies a border on top or bottom as needed
    function redrawCartItemBorders() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                if (i == 0) {
                    $(this).css("border-top", "0.5px solid lightgray");
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
                else {
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
            }
            i++;
        });
    }

    // This function adds up all items in the cart and renders the total at the bottom
    function refreshCartTotal() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        var total = 0;
        var subTotal = 0;
        var taxes = 0;
        var shipping = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                var subtotalId = ($(this).attr("id")).replace("cartItemProdId", "subtotalProdId");
                subtotalId = subtotalId.replaceAll(".", "\\.");
                if (subtotalId != "emptyCartMessage") {
                    total += parseFloat(($("[id='" + subtotalId + "']").text()).replace("$", ""));
                }
            }
            i++;
        });


        taxes = ((Math.round(total * 100) / 100) * 0.029).toFixed(2);
        subTotal = (Math.round(total * 100) / 100).toFixed(2);
        shipping = 9.00.toFixed(2);
        /*if (subTotal >= 100){
            shipping = 0.00.toFixed(2);
        }*/
        total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);
        $("#cartTotal").text("Total: $" + total);
        $("#tax").text("Tax: $" + taxes);
        $("#subTotal").text("Sub Total: $" + subTotal);
        $("#shippingCost").text("Shipping: $" + shipping);


    }

    // This function handles user clicks on the Trash icon next to items
    // in the cart
    function cartRemoveItem(id, _size, _type) {
        var concatIdSizeType = id + _size + _type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        $("[id='cartItemProdId" + concatIdSizeType + "']").slideUp(500);
        setTimeout(function () {
            $("[id='cartItemProdId" + concatIdSizeType + "']").remove();
        }, 500);

        // make a call to the server to remove the item(s) from the cart
        $.ajax({
            url: '/art/remove_from_cart/',
            type: "POST",
            data: {product_id: id, size: _size, type: _type, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                refreshCartBtn();

                //Need to ensure other one is removed at this point. So waiting half a second to assess
                setTimeout(function () {
                    // If there's no more items, we want to show Empty Cart Message
                    var itemCount = $("#cartMainProdRow").children().length - 1;
                    if (itemCount == 0) {
                        $("#cartMainProdRow").append('<div id="emptyCartMessage" style="display:none;text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                        $("#emptyCartMessage").slideDown("slow");
                        $("#cartTotalRow").slideUp(500);
                        setTimeout(function () {
                            $("#cartTotalRow").remove();
                        }, 500);
                    }
                    else {
                        setTimeout(function () {
                            redrawCartItemBorders();
                            refreshCartTotal();
                        }, 500);
                    }
                }, 500);

                // Updating hidden json
                $.ajax({
                    url: '/art/get_cart/',
                    type: "POST",
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (response) {
                        addHiddenInputElement("cart_info_json", response);
                    },
                    error: function () {
                        alert("Error...");
                    }
                });
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function drawNewItemInCart(id, size, type) {
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        // Start by checking if this particular item already exists in our cart
        // If so, then we just need to increment the quantity by 1
        var item_already_in_cart = false;
        $("#cartMainProdRow").children().each(function () {
            if ($(this).attr("id") == "cartItemProdId" + id + size + type) {
                item_already_in_cart = true;
            }
        });
        // Then all we need to do is increment the quantity for the given item and triger the quantity change event
        if (item_already_in_cart) {
            var new_quant_val = parseInt($("[id='quantityProdId" + concatIdSizeType + "']").val()) + 1;
            $("[id='quantityProdId" + concatIdSizeType + "']").val(new_quant_val);
            $("[id='quantityProdId" + concatIdSizeType + "']").trigger("change");
        }
        // Else, we've got an entire item row to add to the cart (without closing and reopening it)
        else {
            // Start by updating the cart information (that we store in a hidden json)
            $.ajax({
                url: '/art/get_cart/',
                type: "POST",
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (response) {
                    addHiddenInputElement("cart_info_json", response);
                    // Debugging Purposes Only
                    //console.log(response);
                    // Now locate the item we're adding to the cart in the JSON obj
                    var cart_json_obj = JSON.parse(response);
                    var da_key = "";
                    for (var key in cart_json_obj) {
                        if (cart_json_obj[key].hasOwnProperty("prod_id")) {
                            if (cart_json_obj[key]["prod_id"] == id) {
                                da_key = key;
                            }
                        }
                    }
                    // Now that we have da key to it (lol...) we can generate the html to add our item
                    // to our cart. We're going to start it out as display:none and then expand
                    // it once it's added fully.
                    var total_row = $("#cartMainProdRow").children().last();
                    total_row.before('' +
                        '<div id="cartItemProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="row table-hover" style="display:none;margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row">' +
                        '</div>' +
                        '<div class="row"  style="padding-bottom:10px;">' +
                        '<div class="col-xs-4"><img src="/' + cart_json_obj[da_key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                        '<div class="col-xs-8">' +
                        '<a><h3 class="title">' + cart_json_obj[da_key]["name"] + '</h3></a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row" style="padding-bottom:15px;">' +
                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Quality</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                        '</div>' +
                        '<div class="row">' +
                        '<div id="unitPriceProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + cart_json_obj[da_key]["price"] + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<input onchange="quantityChange(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="quantityProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_json_obj[da_key]["quantity"]) + '">' +
                        '</div>' +
                        '<div id="subtotalProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_json_obj[da_key]["price"] * cart_json_obj[da_key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<button onclick="cartRemoveItem(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="cartRemoveProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" data-id="' + cart_json_obj[da_key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                    );

                    if (!!document.getElementById("emptyCartMessage")) {
                        // Fade out the message
                        $("#emptyCartMessage").animate({
                            opacity: 0,
                            height: "0px"
                        }, 500);
                        setTimeout(function () {
                            $("#emptyCartMessage").remove();
                        }, 500);

                        var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                        var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                        var shipping = 9.00.toFixed(2);
                        if (subTotal >= 100) {
                            shipping = 0.00.toFixed(2);
                        }

                        var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);


                        $("#cartMainProdRow").append('' +
                            '<div style="display:none;" id="cartTotalRow" class="row" style="padding-top:15px;">' +
                            '<div class="col-sm-6 col-xs-12"></div>' +
                            '<div class="col-sm-6 col-xs-12">' +
                            //'<div class="col-xs-3"></div>' +
                            '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping[USPS Priority]: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                            //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                            '</div>' +
                            '</div>'
                        );

                        $("#cartTotalRow").slideDown("slow");
                    }

                    // Show it (via sliding it down)
                    // Special Note: Size may have instances of periods to represent decimal sizes. When
                    // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
                    // below, you'll see that I'm escaping the period using our replaceAll string function.
                    var cartItemId = "cartItemProdId" + id + size + type;
                    cartItemId = cartItemId.replaceAll(".", "\\.");
                    $("[id='" + cartItemId + "']").slideDown("slow");
                    // Re-draw border lines as needed
                    redrawCartItemBorders();
                    refreshCartTotal();
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
    }

    // Handles the "Add to Cart" clicks.
    $("#prodModalAddToCart").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Type.");

            // Pulse the type selector
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Size.");

            // pulse the size selector
            scaleAndShadowByDataId("prodSizeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodSizeSelector", 500);
            }, 1000);
        }
        else {
            var prod_modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
            var id = prod_modal_info_json["requested_prod"]["id"];
            var size_selected = $("#prodSizeSelector").find("option:selected").val();
            var type_selected = $("#prodTypeSelector").find("option:selected").val();
            $.ajax({
                url: '/art/add_to_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: 1,
                    price: $("#prodModalPrice").text(),
                    size: size_selected,
                    type: type_selected,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    // Close Modal
                    $("#modalCloseBtn").trigger("click");

                    // Display notification informing of success
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]("Added to Cart!");

                    scaleAndShadowById("cartBtn", 350);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 700);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 1400);
                    refreshCartBtn();

                    // If the cart is currently showing, then we want to add to it on the fly (as apposed to
                    // building the entire thing from scratch like the apply_cart_btn_listeners() function(s)
                    // do.
                    if ($("#cartSection").css("display") == "block") {
                        drawNewItemInCart(id, size_selected, type_selected);
                    }

                    // This flashes helps draw attention to the menu button (when user is on phone)
                    $("#menu-toggle").addClass("toggled");
                    setTimeout(function () {
                        $("#menu-toggle").removeClass("toggled");
                    }, 200);
                    setTimeout(function () {
                        $("#menu-toggle").addClass("toggled");
                        setTimeout(function () {
                            $("#menu-toggle").removeClass("toggled");
                        }, 100);
                    }, 500);
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // Handles the "Buy Now" clicks.
    $("#prodModalBuyNow").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Type!");

            $('*[data-id="prodTypeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodTypeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodTypeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodTypeSelector"]').removeClass("add-shadow-size");
            }, 500);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Size!");

            $('*[data-id="prodSizeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodSizeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodSizeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodSizeSelector"]').removeClass("add-shadow-size");
            }, 500);

        }
        else {
            $("#prodModalAddToCart").trigger("click");
            $("#cartBtn").trigger("click");
            setTimeout(function () {
                scaleAndShadowById("checkOut", 500);
                setTimeout(function () {
                    scaleAndShadowById("checkOut", 500);
                }, 1000);
            }, 2000);
            setTimeout(function () {
                if ($("#checkOut").visible() == false) {
                    $('html, body').animate({
                        scrollTop: $("#checkOut").offset().top - $(window).height() + $("#navBar1337").height() + 20
                    }, 1000);
                }
            }, 2000);
        }

        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // When the screen is scrolled down a certain amount, this function
    // changes the color of the menu bar at the top. This is done for
    // style/readability
    function checkScroll() {
        if ($(document).scrollTop() > 180) {
            if (transparent) {
                transparent = false;
                $('nav[role="navigation"]').removeClass('navbar-transparent').addClass('navbar-default');
            }
        } else {
            if (!transparent) {
                transparent = true;
                $('nav[role="navigation"]').addClass('navbar-transparent').removeClass('navbar-default');
            }
        }
    }

    // This beautiful function/filter will return boolean of whether a given element is or is not within the
    // view port.
    // Currently not working as intended. Using visible.js instead.
    // Example use: $('div').is(':offscreen');
    jQuery.expr.filters.offscreen = function (el) {
        var rect = el.getBoundingClientRect();
        return (
            (rect.x + rect.width) < 0
            || (rect.y + rect.height) < 0
            || (rect.x > window.innerWidth || rect.y > window.innerHeight)
        );
    };

    // When card-product is clicked, we need to reach out to server and fill modal with
    // appropriate information.
    $(document).on("click", ".card-product", function () {

        // Call out to server to get needed information (for product modal)
        // Response should be json formatted data. alert(response) to see it.
        $.ajax({
            url: '/art/get_product_modal_info/',
            type: "POST",
            data: {id: $(this).data('id'), csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                // Debugging purposes. Uncomment to see JSON data.
                //console.log(response);

                // Save the response in hidden form element
                if (!!document.getElementById("prod_modal_content_json_hidden")) {
                    $("#prod_modal_content_json_hidden").val(response);
                }
                else {
                    addHiddenInputElement("prod_modal_content_json_hidden", response);
                }

                // Parse the json into object/var
                var modal_info_json = JSON.parse(response);

                // Fill modal
                $("#prodModalImage").attr('src', '/' + modal_info_json["requested_prod"]["image_file"]);
                $("#prodModalTitle").text(modal_info_json["requested_prod"]["product_name"]);
                $("#prodModalProdDescription").text(modal_info_json["requested_prod"]["description"]);
                // Expand description header
                setTimeout(function () {
                    $("#collapsibleDescriptionHeader").collapse("show");
                }, 500);

                //alert(Object.keys(modal_info_json["purchase_options"])[0]);
                //alert(JSON.stringify(modal_info_json["purchase_options"]));

                // Loop through type options and fill selector
                for (var key in modal_info_json["purchase_options"]) {
                    $("#prodTypeSelector").append("<option value='" + key + "'>" + key + "</option>").selectpicker('refresh');
                }
                // Refresh selectors to update with new options and disable size
                $("#prodSizeSelector").attr('disabled', true);
                $("#prodSizeSelector").selectpicker('refresh');
                $("#prodTypeSelector").selectpicker('refresh');
                // If there's only one "Type" option, then select it for the user
                if (Object.keys(modal_info_json["purchase_options"]).length == 1) {
                    // Set Type selector to the one option that exists...
                    $("#prodTypeSelector").val(Object.keys(modal_info_json["purchase_options"])[0]);
                    $("#prodTypeSelector").selectpicker('refresh'); // Refresh selector so change shows in browser
                    // Trigger the change event so that the size type get's populated and activated
                }
                // Trigger the change in case we ended up setting it to something (so that other listener actions trigger)
                $("#prodTypeSelector").trigger("change");

                // Adding in related/similar products scroller content
                for (var key in modal_info_json["related_prods"]) {
                    $("#relatedProdsScroller").append('<li class="nbs-flexisel-item" style="width: 113.75px;">' +
                        '     <a href="#product-page2" role="tab" data-toggle="tab" aria-expanded="false">' +
                        '        <img src="/' + modal_info_json["related_prods"][key]["image_file"] + '" alt="...">' +
                        '    </a>' +
                        '</li>');
                }

            },
            error: function () {
                alert("Error...");
            }
        });

        // Build Modal using #prod_modal_content_json_hidden

        //var products = JSON.parse("{{products|escapejs}}");

        //alert(JSON.string(products));

        var prodID = $(this).data('id');

        //$(".modal-body #modal-body").text( prodID );
    });

    var parallax = function () {
        var current_scroll = $(this).scrollTop();

        oVal = ($(window).scrollTop() / 3);
        big_image.css('top', oVal);
    };

    // Handles little clickable filter button on each product box
    function filterBtnOnClick(prodType) {
        event.stopPropagation();
        alert("Filter button clicked. Still need to implement filter. Would have filtered to " + prodType);
    }

    // Function to hide all product rows past the 1th indicy (aka show only 2 prod rows)
    function initializeProductRows() {
        var rowNum = 2;
        var id = 'row' + rowNum;
        var hasNextRow = !!document.getElementById(id);
        // while there exists another row (past the 1th row or the last row we hid)
        while (hasNextRow) {
            // Setting selector for jquery hide function
            selector = '#' + id;
            // Hiding rows (past 0th and 1th)
            $(selector).slideUp("fast");
            // If the row's child elements have a height of 0, display of none, or opacity of 0,
            // Then we will undo that since their parent element/container is what we'll be
            // expanding. When we expand the parent element, we want the children to be visible.
            $(selector).children().each(function (i) {
                if ($(this).css("height") == "0px") {
                    $(this).css("height", "100%");
                }
                if ($(this).css("opacity") == "0") {
                    $(this).css("opacity", "1");
                }
                if ($(this).css("display") == "none") {
                    $(this).css("display", "block");
                }
            });
            // Increment row num (to check for)
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Loads/Shows/Un-hides/Displays 2 more product rows
    // if they exist. It does this with a fade and an expand.
    function loadMoreProductRows(option, time) {
        // Start by removing the noProdsInformDiv
        $("#noProdsInformDiv").remove();
        // start searching for hidden rows
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a next row
        var hasNextRow = !!document.getElementById(id);
        // Start a counter. We only want to show 2 new rows (per "Load More..." click)
        var count = 0;
        while (hasNextRow && count < 2) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);

            // if it's hidden, then display it (with some animation to it)
            if (option == "fadeAndExpand") {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.css("overflow", "visible");
                    //row.css("height","0px");
                    row.css("opacity", 0);
                    //row.css("display","block");
                    row.slideToggle('slow');
                    row.animate({
                        //height:"100%",
                        opacity: 1
                    }, time);

                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }
            else if (option == "expandThenFade") {
                if ($("#productsStatus").val() == "some") {
                    if (row.css("display") == "none" || row.css("opacity") == 0) {
                        row.animate({
                            height: "auto"
                        }, 1);
                        setTimeout(function () {
                            row.animate({
                                opacity: 1
                            }, 1);
                        }, 1);
                    }
                    row.children().each(function () {
                        if ($(this).css("display") == "none" || $(this).css("opacity") == 0) {

                            $(this).height("100%");
                            $(this).css({opacity: 1});
                            // No Animation needed here. If we're here, the parent class should have
                            // opacity of 0
                        }
                    });
                    if ($("#productColumn").css("display") == "none" || $("#productColumn").css("opacity") == 0) {

                        $("#productColumn").slideDown(time);
                        /*$("#productColumn").animate({
                                height: "toggle"
                            }, 1000);*/

                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }
                else {
                    // There aren't any products to show
                    // Due to the Filter settings.
                    // Inform the user.
                    if (!!document.getElementById("noProdsInformDiv") == false) {
                        $("#productColumn").append('<div id="wrapper" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items Met Your Chosen Filter Options</h3></div>');
                        $("#productColumn").slideDown(time);
                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }

                // Scroll the screen so that the newly displayed products are some % from the
                // top of the screen
                if (option == "fadeAndExpand") {
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                }
                // This was a hidden row and now it isn't. Increment counter.
                // Only want to do this to two (per "Load More..." click)
                count++;
            }
            else {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.animate({
                        opacity: 1
                    }, time);
                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }

            // Increment row num (to check for) and count
            rowNum++;

            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
            setTimeout(function () {
                addImgSpacers();
            }, time / 2)
        }
    }

    // This function returns true if there exist hidden product rows on the page
    // This function returns false if there exist no hidden product rows on the page
    function existsHiddenProdRows() {
        // We know we've got the 1th and 0th row showing, so start searching
        // for hidden rows at the 2nd indexed (aka 3rd) row.
        var rowNum = 2;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a 3rd row (aka 2nd indexed row)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);
            // If this row is hidden, then there exist some hidden row(s)
            if (row.css("display") == "none" && row.children().length > 0) {
                return true;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;                    // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
        return false;
    }

    // The "Load More..." button gets removed and re-added throughout its life.
    // Each time the button element is removed and added, this function needs
    // to be called in order to reapply the click listener (and function that
    // goes with it).
    function setLoadMoreClickFunc() {
        $('#loadMore').click(function () {
            loadMoreProductRows("fadeAndExpand", 1000);
            setTimeout(function () {
                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>Load more...</button>" +
                    "</div>";
                var options = {
                    action: "setState",
                    state: "info"
                };
                $('#loadMore').morphingButton(options);
                setTimeout(function () {
                    // Fade out existing button
                    if (existsHiddenProdRows()) {
                        $('#loadMoreCol').fadeOut(400); // Match this with id=LBFOD line
                    }
                    setTimeout(function () {
                        if (existsHiddenProdRows()) {
                            $('#loadMoreCol').replaceWith(loadMoreHtml);
                            // Fade in new instance of button
                            $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                            $('#loadMore').morphingButton();
                        } else {
                            $('#loadMoreCol').animate({
                                height: "toggle",
                                opacity: "toggle"
                            }, 1000);
                        }
                    }, 400); // Duration given for "Fade Out" of Light Blue (Success) Circle (id: LBFOD)
                }, 300); // Duration of Light Blue (Success) Circle (prior to Fade Out)
            }, 700); // Duration of Spinning Circle
        });
    }

    // If All is checked and user checks another filter box, then all should become
    // unchecked
    function initializeCheckBoxListeners() {
        {% for type in types %}
            $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllProductsCheckBox was checked, un-check it.
                if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
                    $("#AllProductsCheckBox").parent().removeClass("checked");
                }

                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // Color Filtering Removed For Now
        /*
            {% for color in colors %}
                $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                    // If AllColorsCheckBox was checked, un-check it.
                    if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
                        $("#AllColorsCheckBox").parent().removeClass("checked");
                    }

                    // Apply the filter change that just happened.
                    applyFilterOptions();
                });
            {% endfor %}
            */

        {% for image in images %}
            $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllImagesCheckBox was checked, un-check it.
                if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
                    $("#AllImagesCheckBox").parent().removeClass("checked");
                }
                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // When All is checked (in colors subsection) then other boxes should be unchecked
        // NOTE: Colors Filtering Disabled For Now
        /*$("#AllColorsCheckBox").change(function(){
                {% for color in colors %}
                    $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in Product subsection) then other boxes should be unchecked
        $("#AllProductsCheckBox").change(function () {
            {% for type in types %}
                $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            if ($("#resetFilterBtnStatus").val() != "clicked") {
                // Apply the filter change that just happened.
                applyFilterOptions();
            }
        });

        // When All is checked (in Clothing subsection) then other boxes should be unchecked
        // Merging Clothing and Products Check Box Filters Sections
        // Thus commenting out below section
        /*$("#AllClothingCheckBox").change(function(){
                {% for type in types %}
                    {% if type.is_clothing == True %}
                        $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                    {% endif %}
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in image subsection) then other boxes should be unchecked
        $("#AllImagesCheckBox").change(function () {
            {% for image in images %}
                $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            // Apply the filter change that just happened.
            applyFilterOptions();
        });

    }

    // This function returns the filter state as an object containing arrays.
    // Each array contains a list of valid types to be filtered to
    function getFilterState() {
        var filters = {
            images: [],
            clothing: [],
            products: [],
            colors: []
        };

        // Iterate over each check box and fill appropriate filter array
        if ($("#AllClothingCheckBox").parent().hasClass("checked")) {
            filters.clothing[0] = "All";
        }
        if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
            filters.products[0] = "All";
        }
        if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
            filters.colors[0] = "All";
        }
        if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
            filters.images[0] = "All";
        }
        // If the products filter don't have "all" checked
        if (!($("#AllProductsCheckBox").parent().hasClass("checked"))) {
            var productFilterCount = 0;
            {% for type in types %}
                if ($("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.products[productFilterCount] = "{{type.display_name}}";
                    productFilterCount++;
                }
            {% endfor %}
        }

        if (!($("#AllImagesCheckBox").parent().hasClass("checked"))) {
            var imageFilterCount = 0;
            {% for image in images %}
                if ($("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.images[imageFilterCount] = "{{image.name}}";
                    imageFilterCount++;
                }
            {% endfor %}
        }

        /*if(!($("#AllColorsCheckBox").parent().hasClass("checked"))) {
                var colorFilterCount = 0;
                {% for color in colors %}
                    if($("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")){
                        filters.colors[colorFilterCount] = "{{color.name}}";
                        colorFilterCount++;
                    }
                {% endfor %}
            }*/

        return filters;
    }

    // Replaces all instances of a given string in another string
    String.prototype.replaceAll = function (str1, str2, ignore) {
        return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof(str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
    };

    // This function adds "text" to the value() field of the element
    // with id of "elementId"
    function addHiddenInputElement(elementId, text) {
        text = text.replaceAll("'", "&#39;");
        //text = text.replace("\"","&#34;");
        if (!!document.getElementById(elementId)) {
            $("#" + elementId).val(text);
        }
        else {
            $('#hiddenForm').append("<input type='hidden' name='" + elementId + "' id='" + elementId + "' value='" + text + "'/>");
        }
    }

    // As the name suggests, this will animated an object fading away
    // and then remvoe the element
    function fadeOutRemoveElement(elementId, time) {
        $("#" + elementId).animate({
            opacity: "toggle"
        }, time);
        setTimeout(function () {
            $("[data-id=" + elementId + "]").remove();
        }, time);
    }

    // As the name suggests, this function collapses all product rows.
    // Not currently used. Used to be. Then implemented same effect
    // except utilized parent element/container.
    function collapseAllProductRows() {
        // Start by fading out the "Load More..." button as we don't want the user to click this while
        // we're refreshing the product tables/rows
        $("#loadMoreCol").animate({
            opacity: 0
        }, 1000);

        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results)
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            $(selector).animate({
                opacity: 0//,
                //height:"toggle"
            }, 1000);

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Removes products starting at a row/column and
    // continuing until there are no prods left to remove
    function removeRemainingProducts(startRow, startCol) {
        //alert(startRow + " , " + startCol);
        var rowNum = startRow;
        var colNum = startCol;
        // Set initial element id to begin at
        var id = 'row' + rowNum;

        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            var i = 0;
            $(selector).children().each(function () {
                if ((rowNum == startRow && i >= colNum) || (rowNum != startRow)) {
                    /*$(this).animate({
                            height:0
                        },2000);
                        var prod_element = $(this);
                        setTimeout(function(){
                            prod_element.remove();
                        }, 2000);*/
                    $(this).remove();
                }
                i++;
            });

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // This functions gets the 0th product described in the
    // hidden products_json_hidden form element (value() field)
    function getZerothJSONProductHTML() {
        var products_json = JSON.parse($("#products_json_hidden").val());
        var date = Date.now();

        var new_prod_element = "" +
            "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
            " data-image='" + products_json[0][4] + "' data-colors='' style='opacity:0; height:100%; dispay:none;'" +
            " data-product_type='" + products_json[0][3] + "'>" +
            "   <div data-toggle='modal' onmouseover='prodHover(" + products_json[0][0] + ")'  data-target='#prodModal' data-id='" + products_json[0][0] + "' class='fake-link card card-product card-plain my-card-light' id='prod" + products_json[0][0] + "'>" +
            "       <div style='overflow:visible;padding-top:10px;' class='image text-center'>" +
            "           <div id='topImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "           <a>" +
            "               <img id='imgProdId" + products_json[0][0] + "' class='my-img-dark' style='max-width:90%;max-height:300px;height:auto;width:auto;' src='/" + products_json[0][4] + "' alt='Couldnt Find Image'/>" +
            "           </a>" +
            "           <div id='bottomImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "       </div>" +
            "       <div class='content text-center'>" +
            "           <a>" +
            "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
            "           </a>" +
            //"           <p class='description'>" +
            //products_json[0][2] +
            //"           </p>" +
            "           <div class='footer'>" +
            "               <span class='price'>" + products_json[0][6] + "</span>" +
            "               <button onclick='filterBtnOnClick(\"" + products_json[0][3] + "\")' class='btn btn-danger btn-tooltip btn-simple pull-right' data-toggle='tooltip' title='Filter to " + products_json[0][3] + "' data-placement='left'>" +
            //"                   <i style='align-self:right;' class='fa fa-filter'></i>" +
            "               </button>" +
            "           </div>" +
            "       </div>" +
            "   </div> <!-- end card -->" +
            "</div>";

        jQuery.ready();

        return new_prod_element;
    }

    function addAndAnimateImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 added due to some padding at top of img
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300 && prodImgHeight > 0) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                            $("#bottomImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                        }
                        // Sometimes an image might still be loading due to slow network or something.
                        // In these cases, I believe height returned will be 0 or less than 0.
                        // When this is the case, we want to pause (to allow it to finish loading)
                        // and call the function again. Then return from the function (to end
                        // the initial instance of the function. This may happen multiple times.
                        else if (prodImgHeight <= 0) {
                            setTimeout(function () {
                                addAndAnimateImgSpacers();
                            }, 500);

                        }
                    });
                }
            });
        }
    }

    function addImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 is added due to some padding at the top
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).height(spaceDivHeight);
                            $("#bottomImgSpacerProdId" + prodId).height(spaceDivHeight);
                        }
                    });
                }
            });
        }
    }

    // This function builds the product rows
    // as they're described in the hidden products_json_hidden
    // form element (value() field).
    function buildAllProductRows() {
        // Parse the JSON (to add a new prod (which matches filter options))
        var products_json = JSON.parse($("#products_json_hidden").val());

        // Replace existing products and keep track of our position
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // This will be used for tracking position
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            $(selector).children().each(function (i) {
                var product_element = $(this);

                if ($("#products_json_hidden").val() != "[]") {
                    // Parse the JSON (to add a new prod (which matches filter options))
                    var products_json = JSON.parse($("#products_json_hidden").val());

                    // Generate/Save html to replace what we just faded/removed
                    var new_prod_element = getZerothJSONProductHTML();

                    // Replace the element we're on with
                    product_element.replaceWith(new_prod_element);

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);

                    rowCol[1]++;
                }
            });

            // Check if we need to adjust/increment column/row
            if (rowCol[1] > 2) {
                //reset rowCol (since there's only to be three products per row)
                rowCol[1] = 0;
                rowCol[0]++;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }

        // If the filter the user chose returns more than was previously there, then we need to continue adding
        if ($("#products_json_hidden").val() != "[]") {
            // Parse the JSON (to add a new prod (which matches filter options))
            var products_json = JSON.parse($("#products_json_hidden").val());

            while ($("#products_json_hidden").val() != "[]") {
                // First ensure a row exists for the item to be put into
                // And that we're not trying to add a 4th column
                if (!!$("#row" + rowCol[0]) && rowCol[1] <= 2) {
                    // Append the product
                    $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement below

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);
                }
                else if (rowCol[1] > 2) {
                    //reset rowCol (since there's only to be three products per row)
                    rowCol[1] = 0;
                    rowCol[0]++;
                }
                // Need to create the row to put the product into
                else {
                    //alert("getting here...");
                    //Check if there are any previous rows to append to
                    var rowOneBack = rowCol[0]--;
                    if (!!$("#row" + rowOneBack)) {
                        $("#row" + rowOneBack).append("</div> <div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());
                    }
                    // There are no rows. Need to create from scratch. None to append to
                    else {
                        // Need to create new row
                        // Appending </div><[new row stuffs]> to end of existing existing row
                        $("#productColumn").append("<div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'></div>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                        // Drop 0th element from json text
                        products_json.splice(0, 1);
                        var products_json_str = JSON.stringify(products_json);
                        // push the json string to the hidden element for latter use
                        addHiddenInputElement("products_json_hidden", products_json_str);
                    }
                    // Increment rowCol
                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement above
                }
            }
        }
        else {
            removeRemainingProducts(rowCol[0], rowCol[1]);
        }
    }

    /*$(window).on("resize",function(){
            waitForFinalEvent(function() {
                setProductSectionContainerSize();
                alert("here....");
            },1000);
        });*/

    var waitForFinalEvent = (function () {
        var timers = {};
        return function (callback, ms, uniqueId) {
            if (!uniqueId) {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId]) {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    function enableFilters() {
        $(window).trigger('resize');
        // This will enable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', 1);
        $('#disableFilterDiv').remove();
        scaleAndShadowById("filterDiv", 400);
        setTimeout(function () {
            $('#filterDiv').removeClass("remove-shadow-size");
        }, 800);
    }

    // This is the main function for applying filter options
    // after the user modifies them. This function calls
    // the other needed function with the correct timing
    // between each one.
    function applyFilterOptions() {
        // Start by stopping any existing animation on the product column
        $("#productColumn").stop(true);
        // Add spacer to bottom. This gives the circle space to exist on the phone view
        $("#footerSpacer").addClass("space-150");
        // Apply the "Loading" circle to the screen
        var pos = $("#productColumn").position();
        var w = $("#productColumn").width();
        //alert(pos.top + "," + pos.left);
        $('<div id="loadingCircle" class="loader" style="display:none;position:absolute;top:' + (pos.top.toString()) + 'px;left:' + ((pos.left) + (w / 2) - 60).toString() + 'px;z-index:2;"></div>').insertAfter("#productColumn");
        $("#loadingCircle").fadeIn(1000);

        var productColHtml = "";

        // Get filters as list of arrays
        var filters = getFilterState();
        // Convert to string (for server side python/django function)
        filters_str = "";
        filters_str += "" + filters.images.toString();
        //filters_str+= ":-!" + filters.clothing.toString();
        filters_str += ":-!" + filters.products.toString();
        //filters_str+= ":-!" + filters.colors.toString();

        //alert(filters_str);

        // Debug Purposes
        //alert(filters.images + " - " + filters.clothing + " - " + filters.products + " - " + filters.colors);

        // This will disable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', .6);
        $('#filterDiv').append('<div id="disableFilterDiv" style="position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>');

        $.ajax({
            url: '/art/filter_request/',
            type: "POST",
            data: {filters: filters_str, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                //alert(response);
                console.log(response);
                // Save the response
                addHiddenInputElement("products_json_hidden", response);

                // Method TWO START
                ////////////////////////////////////////////////////////////////////////////////////////////////
                // Goal here is to collaps all rows and then expand all rows with new products showing
                ////////////////////////////////////////////////////////////////////////////////////////////////
                //collapseAllProductRows();

                // Set hidden element that dictates whether or not we got products back to show
                if ($("#products_json_hidden").val() == "[]") {
                    addHiddenInputElement("productsStatus", "none");
                }
                else {
                    addHiddenInputElement("productsStatus", "some");
                }

                // Start by just fading away the entire product column/rows element
                // This way we can do whatever with the rows/product elements on the inside and then fade it back in
                $("#productColumn").animate({
                    opacity: 0
                }, 500);

                setTimeout(function () {
                    $("#productColumn").slideUp(500);
                    // Build product rows (while the column is opacity 0)
                    setTimeout(function () {
                        buildAllProductRows();
                        initializeProductRows();
                        // If after filtering we're not showing all rows,
                        // then get the "Load More" button there and ready.
                        if (existsHiddenProdRows()) {
                            if (existsHiddenProdRows()) {
                                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info" +
                                    " btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>" +
                                    "Load more...</button></div>";
                                $('#loadMoreCol').replaceWith(loadMoreHtml);
                                // Fade in new instance of button
                                $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                                $('#loadMore').morphingButton();
                            } else {
                                $('#loadMoreCol').animate({
                                    height: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                            }
                        }
                        else {
                            $("#loadMoreCol").slideUp("slow");
                        }
                        setTimeout(function () {
                            loadMoreProductRows("expandThenFade", 500);
                            $("#loadingCircle").fadeOut(500);
                            // Remove spacer to bottom. This gives the circle space to exist on the phone view
                            setTimeout(function () {
                                enableFilters();
                                $("#footerSpacer").removeClass("space-150");
                            }, 500)
                        }, 100);
                    }, 1000);
                }, 1000);

                // Set needed rows to be "display:none;"

                /* ---------- Method ONE START ----------
                    //////////////////////////////////////////////////////////////
                    //(this got complicated fast so I'm trying a different method
                    //////////////////////////////////////////////////////////////
                    // Loop through rows/products and remove if not found in
                    // the list that we just got from the server
                    var rowNum = 0;
                    // Set initial element id to begin at
                    var id     = 'row' + rowNum;
                    var rowCol = [0,0];
                    // Check if there even is a row (there should/will be unless the user
                    // previously filtered to something with zero results
                    // TODO: Handle this event... (see statement above)
                    var hasNextRow = !!document.getElementById(id);
                    while(hasNextRow){
                        rowCol[1] = 0;
                        // jquery selector
                        var selector = '#' + id;
                        // get row element
                        var row = $(selector);

                        var prodIdCounter = 0;
                        // Loop over each product element and check if it should be there
                        $(selector).children().each(function(i) {
                            //alert("On Row " + selector + " Child " + $(this).attr("data-id"));
                            var products_json = JSON.parse($("#products_json_hidden").val());
                            //Debug purposes
                            //alert($(this).attr("name") + $(this).attr("data-product_type"));

                            // Determine if this particular product should be shown
                            // (based on new filter settings)
                            var i = 0;
                            var existsInFilteredProdList = false;
                            for(i = 0; i < products_json.length; i++){
                                // Debug - Output ID we're checking against
                                //alert(products_json[i][0]);
                                if(products_json[i][0] == $(this).attr("data-id")){
                                    existsInFilteredProdList = true;
                                    break;
                                }
                            }
                            // DEBUG OUTPUT...
                            //alert(existsInFilteredProdList);

                            var product_element = $(this);
                            // If it's not in the filters product list, then fade it away and fade
                            // something else in
                            if(!existsInFilteredProdList){
                                product_element.animate({
                                    width: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                                setTimeout(function(){
                                    // If there exists some in the list to show
                                    if($("#products_json_hidden").val() != "[]") {
                                        // Parse the JSON (to add a new prod (which matches filter options))
                                        var products_json =  JSON.parse($("#products_json_hidden").val());
                                        // If this product isn't already listed
                                        if(!!$("[data-id=" + products_json[0][0] + "]")) {
                                            // Generate/Save html to replace what we just faded/removed
                                            var date = Date.now();
                                            var new_prod_element = "" +
                                                "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
                                                " data-image='" + products_json[0][4] + "' data-colors='' style='display:none'" +
                                                "data-product_type='" + products_json[0][3] + "'>" +
                                                "   <div class='card card-product card-plain'>" +
                                                "       <div class='image'>" +
                                                "           <a href='#'>" +
                                                "               <img src='/" + products_json[0][4] + "' alt='...'/>" +
                                                "           </a>" +
                                                "       </div>" +
                                                "       <div class='content'>" +
                                                "           <a href='#'>" +
                                                "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
                                                "           </a>" +
                                                "           <p class='description'>" +
                                                products_json[0][2] +
                                                "           </p>" +
                                                "           <div class='footer'>" +
                                                "               <span class='price'> TODO </span>" +
                                                "               <button class='btn btn-danger btn-simple pull-right' rel='tooltip' title='Remove from wishlist' data-placement='left'>" +
                                                "                   <i class='fa fa-heart'></i>" +
                                                "               </button>" +
                                                "           </div>" +
                                                "       </div>" +
                                                "   </div> <!-- end card -->" +
                                                "</div>";
                                            // Replace the element we're on with
                                            product_element.replaceWith(new_prod_element);

                                            // Fade/Expand it in.
                                            $("#prod" + products_json[0][0] + "-" + date).animate({
                                                width: "toggle",
                                                opacity: "toggle"
                                            }, 1000);
                                        }

                                        // We should have just taken the 0th item in the json list/array and
                                        // put it on the web page (if it wasn't already there)

                                        // Get json string (hidden element vlaue) as json object
                                        var products_json = JSON.parse($("#products_json_hidden").val());

                                        // Drop 0th element from json text
                                        products_json.splice(0,1);
                                        var products_json_str = JSON.stringify(products_json);
                                        // push the json string to the hidden element for latter use
                                        addHiddenInputElement("products_json_hidden", products_json_str);
                                    }
                                },1000);
                            }
                            else{
                                // There's nothing to do here because it should stay right where it is.
                            }

                            rowCol[1]++;
                        });

                        // Increment row num (to check for) and count
                        rowNum++;
                        // Set new id (to row after one we just hid)
                        id = 'row' + rowNum;
                        // Check if new/next row exists
                        hasNextRow = !!document.getElementById(id);

                        // Increment rowCol
                        rowCol[0]++;
                    }
                    -------- End Method ONE -------*/

                //alert(rowCol[0] + "," + rowCol[1]);
                // Anything remaining in the products_json (results of filter) needs to be added

            },
            error: function () {
                alert("Error...");
            }
        });
    }

    $('#checkoutEmailHref').on("click", function () {
        $('#checkoutModalBackBtn').hide();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutShippingHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutPaymentHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').hide();
        $('#checkoutModalPayBtn').show();
    });

    // When "Next" button is clicked on the checkout modal
    $("#checkoutModalNextBtn").on("click", function () {
        // For each child li of the nav pills (in the checkout modal)
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutPaymentHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
        });
    });

    $("#checkoutModalBackBtn").on("click", function () {
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutEmailHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
        });
    });

    $(document).ready(function () {
        {#$icon = $addon.find('span'),#}
        {#$addon = $group.find('.input-group-addon'),#}
        {#$addon.removeClass('success');#}
        {#$addon.addClass('danger');#}
        {#$icon.attr('class', 'fas fa-times-circle');#}

        var email = document.getElementById("email_input");

        $('.form-control').keyup(function () {
            if ($.trim($('.form-control').val()).length) {
                $(this).addClass('sq-input--focus');
                $(this).removeClass('sq-input--error');
                {#$(this).removeClass('sq-input--focus');#}
            } else {
                $(this).removeClass('active-text');
            }
        });

        /*
        $('.input-group input[required]').on('keyup change', function () {
            var $form = $(this).closest('form'),
                $group = $(this).closest('.input-group'),
                $addon = $group.find('.input-group-addon'),
                $icon = $addon.find('span'),
                state = false;

            if (!$group.data('validate')) {
                state = $(this).val() ? true : false;
            } else if ($group.data('validate') == "email") {
                state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
            }


            if (state) {
                document.getElementById("disabledButtonWrapper").title = "";
                $addon.removeClass('danger');
                $addon.addClass('success');
                $icon.attr('class', 'fas fa-check-circle');
            } else {
                document.getElementById("disabledButtonWrapper").title = "Email is Invalid";
                $addon.removeClass('success');
                $addon.addClass('danger');
                $icon.attr('class', 'fas fa-times-circle');
            }

            if ($form.find('.input-group-addon.danger').length == 0) {
                $form.find('[type="submit"]').prop('disabled', false);
            } else {
                $form.find('[type="submit"]').prop('disabled', true);
            }
        });

        $('.input-group input[required], .input-group textarea[required], .input-group select[required]').trigger('change');
        */

    });

    var sendEmailBtn = document.getElementById("sendEmail");
    var contactModal = document.getElementById('contactModal');

    sendEmailBtn.onclick = function () {
        var _name = document.getElementById("contactorName").value;
        var _email = document.getElementById("contactorEmail").value;
        var _phone = document.getElementById("contactorPhone").value;
        var _message = document.getElementById("contactorMessage").value;

        // Close and clear the contact modal
        $('#contactModal').modal('hide');
        $('#contactorName').val('');
        $('#contactorEmail').val('');
        $('#contactorPhone').val('');
        $('#contactorMessage').val('');

        $.ajax({
            url: '/art/contact_us_email/',
            type: "POST",
            data: {
                name: _name,
                email: _email,
                phone_number: _phone,
                message: _message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // TODO: It's possible that we get a successful response even though we didn't send the email.
                // TODO-cont: In view should put specific thing in there. If not found (here) then consider it
                // TODO-cont: failed. Otherwise if we find specific string, success.
                //console.log(response);
                // Configure Notification
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["success"]("Your message to the Ludega Team was sent successfully. Thanks!", "Success");
            },
            error: function () {
                // Configure Notification
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "0",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut",
                    "tapToDismiss": false
                };
                toastr["error"]("Woh, we're sorry but we seem to have hit a snag on our end. Please reach out to us directly at ludega.team@ludega.com or call us 24/7 at (720) 288-0674.", "Error");
            }
        });
    };

    function attemptCheckout(event) {
        // Email Field (checkout "form")validation
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!emailReg.test($('#email_input').val())) {
            $('#email_input').addClass('sq-input--error');
            $('#checkoutEmailHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]("Invalid Email");

            return;
        }

        // Shipping Info Validation
        var fname = document.getElementById("firstName_input");
        var lname = document.getElementById("lastName_input");
        var add1 = document.getElementById("address_input");
        var city = document.getElementById("city_input");
        var state = document.getElementById("state_input");
        var zip = document.getElementById("zip_input_shipping");
        var country = document.getElementById("country_input");

        var shipping_info_errors_found = false;
        var errorMsg = "";

        if (fname.value == "") {
            // fname.addClass("sq-input--error");
            fname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "First name required<br>";
        }
        if (lname.value == "") {
            // fname.addClass("sq-input--error");
            lname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Last name required<br>";
        }
        if (add1.value == "") {
            // fname.addClass("sq-input--error");
            add1.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Address required<br>";
        }
        if (city.value == "") {
            // fname.addClass("sq-input--error");
            city.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "City required<br>";
        }
        if (state.value == "") {
            // fname.addClass("sq-input--error");
            state.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "State required<br>";
        }
        if (zip.value == "") {
            // fname.addClass("sq-input--error");
            zip.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Zip Code required<br>";
        }
        if (country.value == "") {
            // fname.addClass("sq-input--error");
            country.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Country required<br>";
        }

        if (shipping_info_errors_found) {
            // Take user to shipping section of form
            $('#checkoutShippingHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"](errorMsg);
            return;
        }

        // If we're here, all our validation passed.
        // Note: Square takes care of validating card info, so it's still possible that errors come back (during card
        // nonce request / after.
        if (!requestCardNonce(event)) {
            // TODO: Error. What should we do here and when will/should false be returned?
        }
    }
</script>
<!-- If you are using TypeKit.com uncomment this code -->
<!--
        <script src="https://use.typekit.net/[your kit code here].js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        -->
<!-- If you have retina @2x images on your server which can be sent to iPhone/iPad/MacRetina, please uncomment the next line -->
<!-- <script src="assets/js/retina.min.js"></script> -->
<!-- This ensures that when the modal opens, it won't scroll the background of up -->
</html>
<!doctype html>
{% load staticfiles %}
{% load ludega_art_filters %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Ludega</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="96x96" href="{% static "ludega_art/img/favicon.png" %}">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="{% static "ludega_art/css/material-kit.css" %}" rel="stylesheet"/>-->
    <link href="{% static "ludega_art/css/bootstrap.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/gsdk.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/examples.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.css" %}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <!-- link to the SqPaymentForm library -->
    <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- link to the local SqPaymentForm initialization -->
    <script src="{% static 'ludega_art/js/sqpaymentform.js' %}" type="text/javascript"></script>

    <!-- link to the custom styles for SqPaymentForm -->
    <link href="{% static "ludega_art/css/sqpaymentform.css" %}" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="{% static "ludega_art/css/pe-icon-7-stroke.css" %}" rel="stylesheet" />-->
    <style>
        .input-group-addon.primary {
            color: rgb(255, 255, 255);
            background-color: rgb(50, 118, 177);
            border-color: rgb(40, 94, 142);
        }

        .input-group-addon.success {
            color: rgb(255, 255, 255);
            background-color: rgb(92, 184, 92);
            border-color: rgb(76, 174, 76);
        }

        .input-group-addon.info {
            color: rgb(255, 255, 255);
            background-color: rgb(57, 179, 215);
            border-color: rgb(38, 154, 188);
        }

        .input-group-addon.warning {
            color: rgb(255, 255, 255);
            background-color: rgb(240, 173, 78);
            border-color: rgb(238, 162, 54);
        }

        .input-group-addon.danger {
            color: rgb(255, 255, 255);
            background-color: rgb(217, 83, 79);
            border-color: rgb(212, 63, 58);
        }
    </style>
</head>
<body class="ecommerce">
<nav id="navBar1337" class="navbar navbar-transparent navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button id="menu-toggle" type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar bar1"></span>
                <span class="icon-bar bar2"></span>
                <span class="icon-bar bar3"></span>
            </button>
            <!--<a class="navbar-brand" href="http://ludega.com"><i class="fa fa-chevron-left"></i> Back to Kit</a>-->
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                {#                <li>#}
                {#                    <a href="#">#}
                {#                        About LudegaArt#}
                {#                        <!--<b class="caret"></b>-->#}
                {#                    </a>#}
                {#                </li>#}
                <li>
                    <a href="" data-toggle="modal" data-target="#contactModal">
                        Contact Us
                        <!--<b class="caret"></b>-->
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        More
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-with-icons">
                        <!--<li>
                                    <a href="contact-us.html">
                                    <i class="pe-7s-mail-open-file"></i> Contact Us
                                    </a>
                                </li>
                                <li>
                                    <a href="about-us.html">
                                    <i class="pe-7s-info"></i> Blog Page
                                    </a>
                                </li>
                                <li>
                                    <a href="pricing.html">
                                    <i class="pe-7s-cash"></i> Pricing Page
                                    </a>
                                </li>-->
                        <li>
                            <a href="http://ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega
                            </a>
                        </li>
                        <li>
                            <a href="http://brokerage.ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Brokerage
                            </a>
                        </li>
                        <li>
                            <a href="http://104.131.86.135/" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Window Cleaning
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a id="cartBtn" href="#" class="btn btn-round btn-default cartBtn">Cart ({{ cart_count }} Items)</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<div class="wrapper">
    <div class="img-wrapper">
        <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/banner2.png' %}">
    </div>

    <!--<div class="parallax filter-black">
        <div class="parallax-image">
            <div class="col-sm-12 col-md-12 col-lg-12" style="padding-left: 0px; padding-right: 0px;">
                <img id="titleImage" src="{% static 'ludega_art/img/header.jpg' %}" alt="..." style="height: 100%; width:100%;"/>
            </div>
        </div>
        <br><br><br><br>
        <div class="small-info">
            {#            <h1 style="font-family:longtime">Ludega</h1>#}
            {#            <h3 style="font-family:longtime">Ludega Merch</h3>#}
        </div>
    </div>-->
    <!--<div class="section">
                <div class="container">
                    <h2 class="section-title">Special Offers</h2>
                    {% if top_products_list %}
                    <div id="mainContentRow" class="row">
                        {% for product in top_products_list %}
                        <div class="col-md-4">
                            <div class="card card-product card-plain">
                                <div class="image">
                                    <a>
                                    <img src="/{{product.image_file}}"  alt="..."/>
                                    </a>
                                </div>
                                <div class="content">
                                    <a href="#">
                                        <h4 class="title">{{product.name}}</h4>
                                    </a>
                                    <div class="footer">
                                        <span class="price price-old"> &dollar;1,930</span>
                                        <span class="price price-new">&dollar;1,330</span>
                                        <button class="btn btn-danger btn-simple pull-right" rel="tooltip" title="Remove from wishlist" data-placement="left">
                                        <i class="fa fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>-->
    <!-- section -->
    <div id="cartSection" class="section" style="display:none;">
        <div id="cartContainer" class="container my-card-dark">
            <button type="button" style="margin-top:15px;" id="closeCartBtn" class="close" aria-hidden="true">×</button>
            <h2 id="shoppingCartTitle" class="section-title">Your Shopping Cart</h2>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <!-- nesting -->
                        <div id="cartMainProdRow" class="row">
                            <!-- Cart Items will go here...-->
                        </div>
                        <div class="row" style="height:15px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <button id="cartContinueShoppingBtn" class="btn btn btn-success btn-block"
                                            style="margin-bottom:10px;">Continue Shopping
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button id="checkOut1" class="btn btn-info btn-block" style="margin-bottom:10px;"
                                            data-toggle="modal"
                                            onclick="initialize_checkout_modal()">Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="height:15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mainProductSection" class="section">
        <div id="productSectionContainer" class="container" style="max-width:100%;">
            <h2 class="section-title">Find what you need</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="filterDiv" class="card card-refine">
                        <!-- card-plain for no border -->
                        <div class="header">
                            <h4 class="title">Refine
                                <!--<button class="btn btn-default btn-xs btn pull-right btn-simple" rel="tooltip" title="Reset Filter">
                                    <i id="refreshFilterBtn" class="fa fa-refresh"></i>
                                </button>-->
                            </h4>
                        </div>
                        <div class="content">
                            <div class="panel-group" id="accordion">
                                <!-- Commenting out this dollar range section for now -->
                                <!--
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                <h6 class="panel-title">
                                                  <a data-toggle="collapse" href="#refinePrice">
                                                    Price Range
                                                    <i class="fa fa-caret-up pull-right"></i>
                                                  </a>
                                                </h6>
                                              </div>
                                              <div id="refinePrice" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                   <span class="price price-left">&dollar; 100</span>
                                                   <span class="price price-right">&dollar; 850</span>
                                                   <div class="clearfix"></div>
                                                   <div id="refine-price-range" class="slider slider-info"></div>
                                                </div>
                                              </div>
                                            </div>
                                            -->
                                {#                                <div class="panel panel-default">#}
                                {#                                    <div class="panel-heading">#}
                                {#                                        <h6 class="panel-title">#}
                                {#                                            <a data-toggle="collapse" href="#refineImage" class="collapsed">#}
                                {#                                                Images#}
                                {#                                                <i class="fa fa-caret-up pull-right"></i>#}
                                {#                                            </a>#}
                                {#                                        </h6>#}
                                {#                                    </div>#}
                                {#                                    <div id="refineImage" class="panel-collapse collapse">#}
                                {#                                        <div class="panel-body">#}
                                {#                                            <label class="checkbox">#}
                                {#                                                <input type="checkbox" id="AllImagesCheckBox" value=""#}
                                {#                                                       data-toggle="checkbox" checked="">#}
                                {#                                                All#}
                                {#                                            </label>#}
                                {#                                            {% if images %}#}
                                {#                                                {% for image in images %}#}
                                {#                                                    <label class="checkbox">#}
                                {#                                                        <input type="checkbox"#}
                                {#                                                               id="{{ image.name|str_replace:' ,' }}CheckBox" value=""#}
                                {#                                                               data-toggle="checkbox">#}
                                {#                                                        {{ image.name }}#}
                                {#                                                    </label>#}
                                {#                                                {% endfor %}#}
                                {#                                            {% endif %}#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineClothing" class="collapsed">
                                                  Clothing
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineClothing" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                <label class="checkbox">
                                                  <input type="checkbox" id="AllClothingCheckBox" value="" data-toggle="checkbox" checked="">
                                                  All
                                                </label>
                                                {% if types %}
                                                    {% for type in types %}
                                                        {% if type.is_clothing %}
                                                          <label class="checkbox">
                                                            <input type="checkbox" id="
                                    {{type.display_name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                            {{type.display_name}}
                                                          </label>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                              </div>
                                            </div>
                                            </div> -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            <a data-toggle="collapse" href="#refineProduct" class="collapsed">
                                                Products
                                                <i class="fa fa-caret-up pull-right"></i>
                                            </a>
                                        </h6>
                                    </div>
                                    <div id="refineProduct" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label class="checkbox">
                                                <input type="checkbox" id="AllProductsCheckBox" value=""
                                                       data-toggle="checkbox" checked="">
                                                All
                                            </label>
                                            {% if types %}
                                                {% for type in types %}
                                                    {% if not type.sub_type_only %}
                                                        <label class="checkbox">
                                                            <input type="checkbox"
                                                                   id="{{ type.display_name|str_replace:' ,' }}CheckBox"
                                                                   value="" data-toggle="checkbox">
                                                            {{ type.display_name }}
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineColor" class="collapsed">
                                                  Colors
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineColor" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                 <label class="checkbox">
                                                    <input type="checkbox" id="AllColorsCheckBox" value="" data-toggle="checkbox" checked="">
                                                    All
                                                  </label>
                                                  {% if colors %}
                                                      {% for color in colors %}
                                                        <label class="checkbox">
                                                          <input type="checkbox" id="{{color.name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                          {{color.name}}
                                                        </label>
                                                      {% endfor %}
                                                  {% endif %}
                                              </div>
                                            </div>
                                            </div> <!-- end panel -->
                            </div>
                        </div>
                    </div>
                    <!-- end card -->
                </div>
                <div class="col-md-9" id="productColumn">
                    <div class="row" id="row0">
                        {% if products %}
                            {% for product in products %}
                                {% if product.display %}
                                    <div class="col-sm-4"
                                         data-id="{{ product.id }}"
                                         data-image="{{ product.image_file }}"
                                            {% with colors_=product.colors.all %}
                                         data-colors="
                                    {% for color in colors_ %}
                                    {{ color }},
                                    {% endfor %}"
                                         data-product_type="{{ product.product_type.display_name }}"
                                         data-is_clothing="{{ product.product_type.is_clothing }}"
                                                >
                                            {% endwith %}
                                    <div data-toggle="modal" onmouseover="prodHover({{ product.id }})"
                                         data-id="{{ product.id }}" data-target="#prodModal"
                                         class="fake-link card card-product card-plain my-card-light"
                                         id="prod{{ product.id }}">
                                        <div style="overflow:visible;padding-top:10px;" class="image text-center">
                                            <div id="topImgSpacerProdId{{ product.id }}"
                                                 style="overflow:visible;height:0px"
                                                 ;></div>
                                            <a>
                                                <img id="imgProdId{{ product.id }}" class="my-img-dark"
                                                     style="max-width:90%;max-height:300px;height:auto;width:auto;"
                                                     src="/{{ product.image_file }}" alt="..."/>
                                            </a>
                                            <div id="bottomImgSpacerProdId{{ product.id }}" style="height:0px" ;></div>
                                        </div>
                                        <div class="content text-center">
                                            <span>
                                                <a>
                                                    <h4 class="title">{{ product.name }}</h4>
                                                </a>
                                            </span>
                                            <!--<p class="description">
                                                {{product.description}}
                                                </p>-->
                                            <div class="footer">
                                                <span class="price"> {{ product.id|get_price_str }}</span>
                                                <button onclick="filterBtnOnClick('{{ product.product_type }}')"
                                                        class="btn btn-danger btn-tooltip btn-simple pull-right"
                                                        rel="tooltip" title="Filter to {{ product.product_type }}"
                                                        data-placement="top">
                                                    <!--<i style="align-self:right;" class="fa fa-filter"></i>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end card -->
                                    </div>
                                    <!-- Each row should only contain 3 products -->
                                    {% if forloop.counter|divisibleby:3 == True %}
                                        <!-- End the previous <div class="row">  -->
                                        </div>
                                        <!-- Determine the row id (which is "row" + rowNum)                -->
                                        {% with rowCount=forloop.counter|divnum:3 %}
                                            {% with rowid="row"|addstr:rowCount %}
                                                <div class="row" id="{{ rowid }}">
                                            {% endwith %} <!-- Ending "with rowCount=forloop.counter|divnum:3" -->
                                        {% endwith %} <!-- Ending "with rowid="row"|addstr:rowCount"       -->
                                    {% endif %}
                                {% endif %}
                            {% endfor %} <!-- Ending "for product in products" -->
                        {% endif %}  <!-- Ending "if products"             -->
                        </div>
                    <div class="space-50"></div>
                    <div class="col-md-3 col-md-offset-4" id="loadMoreCol">
                        <button rel="tooltip" title="" style="margin-bottom:1px;" class="btn btn-info btn-round"
                                id="loadMore" data-toggle="morphing" data-rotation-color="blue">Load more...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- section -->
<div id="footerSpacer" class="space-50"></div>
<div class="subscribe-line subscribe-line-transparent"
     style="background-image: url('{% static 'ludega_art/img/merch7.png' %}')">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <form class="">
                    <div class="form-group">
                        <input type="text" value="" class="form-control" placeholder="Enter your email here...">
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-info btn-fill btn-block">Subscribe Now!</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer footer-big footer-default">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="id">Bahasa Indonesia</option>
                        <option value="ms">Bahasa Melayu</option>
                        <option value="ca">Català</option>
                        <option value="da">Dansk</option>
                        <option value="de">Deutsch</option>
                        <option value="en" selected="">English</option>
                        <option value="es">Español</option>
                        <option value="el">Eλληνικά</option>
                        <option value="fr">Français</option>
                        <option value="it">Italiano</option>
                        <option value="hu">Magyar</option>
                        <option value="nl">Nederlands</option>
                        <option value="no">Norsk</option>
                        <option value="pl">Polski</option>
                        <option value="pt">Português</option>
                        <option value="fi">Suomi</option>
                        <option value="sv">Svenska</option>
                        <option value="tr">Türkçe</option>
                        <option value="is">Íslenska</option>
                        <option value="cs">Čeština</option>
                        <option value="ru">Русский</option>
                        <option value="th">ภาษาไทย</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="ARS">ARS</option>
                        <option value="AUD">AUD</option>
                        <option value="BRL">BRL</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="CZK">CZK</option>
                        <option value="DKK">DKK</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="HKD">HKD</option>
                        <option value="HUF">HUF</option>
                        <option value="IDR">IDR</option>
                        <option value="ILS">ILS</option>
                        <option value="INR">INR</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                        <option value="MYR">MYR</option>
                        <option value="MXN">MXN</option>
                        <option value="NOK">NOK</option>
                        <option value="NZD">NZD</option>
                        <option value="PHP">PHP</option>
                        <option value="PLN">PLN</option>
                        <option value="RUB">RUB</option>
                        <option value="SEK">SEK</option>
                        <option value="SGD">SGD</option>
                        <option value="TWD">TWD</option>
                        <option value="USD" selected="">USD</option>
                        <option value="VND">VND</option>
                        <option value="ZAR">ZAR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-1">
                <h5 class="title">Company</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Our Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                About Us
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3 col-md-offset-1">
                <h5 class="title"> Help and Support</h5>
                <nav>
                    <ul>
                        <li>
                            <a data-toggle="modal" data-target="#contactModal">
                                Contact Us
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Terms & Conditions
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Money Back
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3">
                <h5 class="title">Latest News</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i> <b>We're Live!</b>
                                Ludega Merch is now live, feel free to place an order.
                                <hr class="hr-small">
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i>
                                <b>New merchandise!</b> New merch has been added, check out some of the new inventory.
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr/>
        <div class="social-area text-center">
            <h5>Join us on</h5>
            <a href="https://www.facebook.com/ludega.merch.3" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-facebook"></i>
            </a>
            <a href="https://mobile.twitter.com/LudegaMerch" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-twitter"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-google-plus"></i>#}
{#            </a>#}
            <a href="https://www.instagram.com/ludegamerch/" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-instagram"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-linkedin"></i>#}
{#            </a>#}
        </div>
        <div class="copyright">
            &copy; 2017 <a href="http://www.ludega.com">Ludega</a> - It Will Be.
        </div>
    </div>
</footer>
</div> <!-- wrapper -->

<div id="largeImgModal" class="img-modal">
    <!-- The Close Button -->
    <span class="my-close" onclick="document.getElementById('largeImgModal').style.display='none'">&times;</span>
    <!-- Modal Content (The Image) -->
    <img class="img-modal-content" id="largeImg" src="">
    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<!--<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true" style="display: none;">-->
<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <div class="modal-body">
                <!--<div class="container">-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="tab-content">
                            <div class="tab-pane active" id="product-page6">
                                <img class="my-prod-modal-img" onclick="increaseImgWithModal('123')" id="prodModalImage"
                                     style="-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-width:100%;max-height:500px;margin:auto;display:block;"
                                     src="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <a>
                                <h3 id="prodModalTitle" class="title"></h3>
                            </a>
                            <!--<p class="description">
                                        </p>-->
                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="descriptionHeading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleDescriptionHeader" class="collapsed">
                                            Product Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleDescriptionHeader" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="descriptionHeading" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdDescription">
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="typeDescriptionHeading">
                                    <h4 class="panel-title">
                                        <a id="collapsibleTypeDescriptionClickable" class="collapsed"
                                           data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleTypeDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleTypeDescriptionHeader">
                                            Type Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleTypeDescriptionHeader" class="panel-collapse collapse"
                                     role="tabpanel" aria-labelledby="typeDescriptionHeading" aria-expanded="false"
                                     style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdTypeDescription">
                                        <p>You haven't selected a Product Type yet.</p>
                                        <!--<ul style="padding-left: 20px;">
                                                    <li style="list-style-position: outside;"> Fits small to size</li>
                                                    <li style="list-style-position: outside;"> Model wears a UK 40R</li>
                                                    <li style="list-style-position: outside;"> Model measures: chest 39"/ 99cm, height 6'1"/ 185cm</li>
                                                </ul>-->
                                    </div>
                                </div>
                            </div>
                            <!--<div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                          <h4 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                              Details
                                            </a>
                                          </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false" style="height: 0px;">
                                          <div class="panel-body">
                                            85% wool, 15% linen. Dry-clean only
                                          </div>
                                        </div>
                                        </div>-->
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="headingFour">
                                    <h4 class="panel-title">
                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Returns
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="headingFour" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body">
                                        Here at Ludega Merch, we pride ourselves in having a friendly return policy.
                                        It's simple; if you're not 100% satisfied with your product, simply return it to
                                        us in the condition it was received and we'll refund or replace your order
                                        (shipping not included) and give you a 5% discount on your next purchase
                                        regardless of purchase amount.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Acordeon  -->
                        <div class="row align-items-center">
                            <div class="prod-options pull-down">
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodTypeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Type</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodSizeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Size</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12" id="priceDivCol" style="height:0px;opacity:0;">
                                    <a align="right">
                                        <h3 id="prodModalPrice" class="title">Select a Product Type and Size for
                                            Pricing!</h3>
                                    </a>
                                </div>
                                <div class="col-md-12" style="height:60px;">
                                    <div class="pull-right" style="margin-top:10px;">
                                        <button type="button" id="prodModalAddToCart" class="btn btn-fill">Add to Cart
                                        </button>
                                        <button type="button" id="prodModalBuyNow" class="btn btn-fill">Buy Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                       <div class="col-md-4"></div>
                       <div class="col-md-4 text-center"><a><h3 class="title">Similar Products</h3></a></div>
                       <div class="col-md-4"></div>
                   </div>
                  <div class="row">
                  <div class="col-md-12">
                   <div class="nbs-flexisel-container">
                           <div class="nbs-flexisel-inner">
                              <ul class="nav nav-text nbs-flexisel-ul" role="tablist" id="relatedProdsScroller" style="left: -113.75px;">
                              </ul>
                           </div>
                           <div class="nbs-flexisel-nav-left" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-left"></i></div>
                           <div class="nbs-flexisel-nav-right" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-right"></i></div>
                        </div>
                      </div>
                    </div>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
        <!--</div>-->
    </div>
</div>
</div>
<form id="hiddenForm"></form>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <!--<button type="button" id="contactModalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            <div class="modal-body">
                <div id="contactContainer" class="col-md-offset-1">
                    <h2 class="section-title">Send us a message</h2>
                </div>
                <div class="row">
                    <!--<div class="separator line-separator">♦</div>-->
                    <div id="contactContainer" class="col-md-6 col-md-offset-1">
                        </p>
                        <form role="form" id="contact-form" method="post" data-color="blue">
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your name (optional)</label>
                                <input id="contactorName" placeholder="First & Last Name" type="text" name="name"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Email address (optional)</label>
                                <input id="contactorEmail" placeholder="Your personal email" type="email" name="email"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Phone (optional)</label>
                                <input id="contactorPhone" placeholder="Phone Nmber" type="text" name="phone"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your message</label>
                                <textarea name="message" class="form-control" id="contactorMessage" rows="6"
                                          required></textarea>
                                <span class="material-input"></span></div>
                            <div id="contactButtonContainer" class="submit">
                                <input id="sendEmail" type="submit" class="btn btn-info btn-fill" value="Send Message">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4 col-md-offset-1">
                        <div class="contact-info">
                            <!--<h5><i class="fa fa-map-marker text-muted"></i> Address</h5>
                            <p class="text-muted"> Bld Mihail Kogalniceanu, nr. 8,<br>
                                7652 Bucharest,<br>
                                Romania
                            </p><br>-->
                            <h5><i class="fa fa-phone text-muted"></i> 24/7 Live Support</h5>
                            <p class="text-muted"> Customer Support<br>
                                (720) 288-0674<br>
                                Mon - Sun, 12:00AM -11:59PM
                            </p><br>
                            <h5><i class="fa fa-envelope text-muted"></i> Email Us</h5>
                            <p class="text-muted"> Ludega Merch LLC<br>
                                customer.support@ludega.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ageVerifictaionModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" )>
            <div class="img-wrapper">
                <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/merch7.png' %}">
            </div>
            <div class="modal-header" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Age Verification</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <h5 class="text-center">Are you old enough to purchase these products?</h5>
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title text-center">
                                <i class="fa fa-info-circle"></i>
                                <a data-toggle="collapse" href="#collapse1">Why are we asking?</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse">
                            <div class="panel-body">THIS WEBSITE CONTAINS ADULT MATERIAL AND IS ONLY SUITABLE FOR THOSE 18
                OR OLDER. ALL CUSTOMERS FROM ARIZONA, CALIFORNIA, ILLINOIS, KANSAS, MASSACHUSETTS,
                MISSISSIPPI, MISSOURI, NEW JERSEY, NEW YORK, & OHIO MUST BE 21 YEARS OR OLDER. BY ENTERING
                THIS SITE, YOU CONFIRM THAT YOU ARE OF LEGAL AGE TO PURCHASE THESE PRODUCTS IN YOUR STATE.
                WARNING: TOBACCO PRODUCTS CONTAIN NICOTINE, AND NICOTINE IS AN ADDICTIVE CHEMICAL.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class=" btn btn-primary btn-block" onclick="$('#ageVerifictaionModal').modal('hide');">
                                Yes
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="btn btn-danger btn-block" onclick="ageVerificationNoClicked()">
                                No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="checkoutModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Checkout As Guest</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <div class="row">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <ul id="checkoutNavPills" class="nav nav-pills" role="tablist"
                            style="justify-content:center;display:flex;">
                            <li id="checkoutEmailli" class="active">
                                <a id="checkoutEmailHref" href="#email" role="tab" data-toggle="tab"
                                   aria-expanded="true">
                                    Email
                                </a>
                            </li>
                            <li id="checkoutShippingli" class="">
                                <a id="checkoutShippingHref" href="#shipping" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Shipping Info
                                </a>
                            </li>
                            <li id="checkoutPaymentli" class="">
                                <a id="checkoutPaymentHref" href="#payment" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="email">
                        <div class="row" style="padding-top: 15px;">
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                            <div class="col-sm-10 col-md-10 col-lg-10">
                                <div class="form-group">
                                    <label for="validate-email">Email</label>
                                    <input type="email" class="form-control" id="email_input" placeholder="Email"
                                           required=""><br>
                                    <label for="validate-email">Additional Notes [optional]</label>
                                    <textarea class="form-control" rows="5" id="notes" placeholder="Color, size, flavor, or any other additional comments."></textarea>
                                </div>
                            </div>
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="shipping">
                        <div id="" class="" style="padding:15px;">
                            <div class="form-group">
                                <select class="form-control" id="shippingOptions">
                                    <option value="0" selected="">USPS Priority - $9.00</option>
                                    {#                                    <option value="1">Free Shipping [All orders over $100, abuse of this will void your order.]</option>#}
                                </select>
                            </div>
                            <div class="">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left">
                                    <label for="exampleInputEmail1">First Name</label>
                                    <input type="text" class="form-control" id="firstName_input"
                                           aria-describedby="emailHelp" placeholder="First Name" required="">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right">
                                    <label for="exampleInputEmail1">Last Name</label>
                                    <input type="text" class="form-control" id="lastName_input"
                                           aria-describedby="emailHelp" placeholder="Last Name" required="">
                                </div>
                                <br>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Address</label>
                                <input type="text" class="form-control" id="address_input" aria-describedby="emailHelp"
                                       placeholder="Address Line 1">
                            </div>
                            <div class="form-group shove-bot">
                                <input type="text" class="form-control" id="address_input2" aria-describedby="emailHelp"
                                       placeholder="Address Line 2 [Optional]">
                            </div>
                            <div class="form-group shove-left">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="city_input" aria-describedby="emailHelp"
                                           placeholder="City">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="state_input"
                                           aria-describedby="emailHelp" placeholder="State/Province/Region">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-left">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="number" class="form-control" id="zip_input_shipping"
                                           aria-describedby="emailHelp" onchange="checkDenverZipCode()"
                                           placeholder="Zip/Postal Code">
                                </div>
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-right">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="country_input"
                                           aria-describedby="emailHelp" placeholder="Country">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div id="shippingAlert" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="payment">
                        <div id="sq-ccbox">
                            <!--
                                You should replace the action attribute of the form with the path of
                                the URL you want to POST the nonce to (for example, "/process-card")
                            -->
                            <div class="row">
                                <div id="cc-form" class="col-sm-12 col-md-12 col-lg-12 pad-cc-info">

                                    <table>
                                        <tbody>
                                        <tr>
                                            <th class="pad-left">Card Number</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-card-number"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">CVV</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-cvv"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Expiration Date</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-expiration-date"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Postal Code</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-postal-code"></div>
                                            </td>
                                        </tr>

                                        </tbody>
                                    </table>
                                    <!--After a nonce is generated it will be assigned to this hidden input field.-->
                                    <input type="hidden" id="card-nonce" name="nonce">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                            <div id="totalCreditCardForm"
                                 class="totalCC col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"></div>
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalBackBtn" type="button" class="btn btn-info"
                                    style="justify-content:left;display:flex;">
                                <i class="fa fa-arrow-left" style="padding-top: 2px;"></i>
                                Back
                            </button>
                        </div>
                        <div id="" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>

                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalNextBtn" type="button" class="btn btn-info">
                                Next
                                <i class="fa fa-arrow-right"></i>
                            </button>
                            <button id="checkoutModalPayBtn" type="button" onclick="attemptCheckout(event)"
                                    class="btn btn-info">Confirm & Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header"></div>
            <div class="">

                <div class="row marketing">

                    <div class="col-lg-12">

                        <h4><b>Product Name</b></h4>
                        <hr/>

                        <div>
                            <h4>Success - your order is confirmed!</h4>
                            <h5>Order number:
                                <div id="orderNumber"> orderNumber</div>
                            </h5>
                            <hr/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">Shipping Address
                                    <ul class="list-group">
                                        <li class="list-group-item" id="orderName">firstName lastName</li>
                                        <li class="list-group-item" id="orderEmail">email</li>
                                        <li class="list-group-item" id="orderAddress">address</li>
                                        <li class="list-group-item" id="orderZip">state city zip</li>
                                        <li class="list-group-item" id="orderCountry">country</li>
                                    </ul>

                                </div>
                                <div class="col-xs-6 text-right">
                                    <h1><span class="glyphicon glyphicon glyphicon-cloud-download"
                                              aria-hidden="true"></span></h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <p><span class="glyphicon glyphicon glyphicon-question-sign"
                                             aria-hidden="true"></span>
                                        All Monthly and Quarterly subscription plans renew automatically on the 15th of
                                        the month.</p>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed">
                                            <thead>
                                            <tr>
                                                <td><strong>Product Name</strong></td>
                                                <td class="text-right"><strong>Product Options</strong></td>
                                                <td class="text-right"><strong>Subscription Type</strong></td>
                                                <td class="text-right"><strong>Price</strong></td>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                            <tr>
                                                <td>Veganboxen</td>
                                                <td class="text-right">Variable #1</td>
                                                <td class="text-right">Monthly</td>
                                                <td class="text-right">189 SEK</td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-right"><strong>VAT - 12%</strong></td>
                                                <td class="thick-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Shipping</strong></td>
                                                <td class="no-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Total</strong></td>
                                                <td class="no-line text-right">189 SEK</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div> <!-- /container -->
        </div>
    </div>
</div>

</body>

<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>
<!--  jQuery and Bootstrap core files    -->
<script src="{% static 'ludega_art/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/jquery-ui.custom.min.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/bootstrap.min.js' %}" type="text/javascript"></script>
<!--  Plugins -->
<script src="{% static 'ludega_art/js/gsdk-checkbox.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-morphing.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-radio.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-bootstrapswitch.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-select.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'ludega_art/js/chartist.min.js' %}"></script>
<script src="{% static 'ludega_art/js/jquery.tagsinput.js' %}"></script>
<script src="{% static 'ludega_glass/js/toastr.min.js' %}"></script>
<script src="{% static 'ludega_art/js/visible.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
<!--  Get Shit Done Kit PRO Core javascript 	 -->
<script src="{% static 'ludega_art/js/get-shit-done.js' %}"></script>


<script type="text/javascript">

    var debug = true;
    var big_image;
    var transparent = true;
    var loadMoreColOrigHtml = "";


    // This function initializes listeners and calls initialization functions
    // TODO: Get all listeners to be called here.
    $().ready(function () {
        responsive = $(window).width();

        var show_age_verification_json_str = '{{ show_age_verification }}';
        var show_age_verification_json = JSON.parse(show_age_verification_json_str.replace(/&quot;/g,"\""));
        if(show_age_verification_json["show_age_verification"] == "true") {
            $("#ageVerifictaionModal").modal({backdrop: 'static', keyboard: false});
        }
        else{
            // No need to display the age verification
        }


        $(window).on('scroll', checkScroll);

        if (responsive >= 768) {
            big_image = $('.parallax-image').find('img');

            $(window).on('scroll', function () {
                parallax();
                checkScroll();
            });
        }

        //This ensures that if the user tries to scroll while we're doing some fancy scrolling of our own, it will get canceled
        $('html, body').on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
            $('html, body').stop();
        });


        initializeProductRows();
        loadMoreColOrigHtml = $("#loadMoreCol").html();
        setLoadMoreClickFunc();
        //applyFilterOptions();
        refreshCartBtn();
        initializeCheckBoxListeners();
        // There are two cart btns due to sizing of screen. We don't want to apply
        // the listener until document is ready. Otherwise we may not get the
        // listener to be applied to the "second" version of the btn.
        apply_cart_btn_listeners();
        // If the user refreshes the page while they're half way down,
        // then calling this will ensure we display the header bar correctly.
        checkScroll();
        setTimeout(function () {
            addAndAnimateImgSpacers();
        }, 500);
        setProductSectionContainerSize();

    });

    function ageVerificationNoClicked(){
        $.ajax({
            url: '/art/no_selected_on_age_verification/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                console.log("User indicated that they are not of age to purchases our products.")
            },
            error: function (response) {
                console.log("Error - Response was" + response);
            }
        });

        window.location.href='http://www.google.com';
    }

    function checkDenverZipCode() {

        var total = parseFloat((document.getElementById("cartTotal").innerHTML).replace('Total: $', ''))


        var shippingAlert = document.getElementById("shippingAlert");
        var myInput = parseInt(document.getElementById("zip_input_shipping").value);

        var denver_zip_codes = [80002, 80003, 80004, 80005, 80007, 80010, 80011, 80012, 80013, 80014, 80015, 80016, 80017,
            80018, 80019, 80020, 80021, 80022, 80023, 80024, 80030, 80031, 80033, 80045, 80101, 80102,
            80103, 80104, 80105, 80107, 80108, 80109, 80110, 80111, 80112, 80113, 80116, 80117, 80118,
            80120, 80121, 80122, 80123, 80124, 80125, 80126, 80127, 80128, 80129, 80130, 80131, 80134,
            80135, 80136, 80137, 80138, 80202, 80203, 80204, 80205, 80206, 80207, 80209, 80210, 80211,
            80212, 80214, 80215, 80216, 80218, 80219, 80220, 80221, 80222, 80223, 80224, 80226, 80227,
            80228, 80229, 80230, 80231, 80232, 80233, 80234, 80235, 80236, 80237, 80238, 80239, 80241,
            80246, 80247, 80249, 80260, 80264, 80290, 80293, 80294, 80401, 80403, 80419, 80420, 80421,
            80422, 80425, 80427, 80432, 80433, 80436, 80438, 80439, 80440, 80444, 80448, 80449, 80452,
            80453, 80454, 80456, 80457, 80465, 80470, 80475, 80476, 80601, 80602, 80640, 80820, 80827,
            80830, 80835];

        var check_for_denver_zip = denver_zip_codes.includes(myInput);

        if (check_for_denver_zip == true) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["success"]('You are eligible for free shipping!');
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + (total - 9.00).toFixed(2) + " [Free Shipping]";
        }
        else {
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + parseFloat(total).toFixed(2);
            document.getElementById("shippingAlert").innerHTML = "";
        }

    }

    function setProductSectionContainerSize() {
        //alert($(window).width());
        if ($(window).width() > 1400) {
            var pixels = $("#mainProductSection").width() * .75;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "80%");
            }, 500);
        }
        else {
            var pixels = $("#mainProductSection").width() * .9;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "90%");
            }, 500);
        }
    }

    function increaseImgWithModal(id) {
        // Get the modal
        var modal = document.getElementById('largeImgModal');

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("prodModalImage");
        var modalImg = document.getElementById("largeImg");
        var captionText = document.getElementById("caption");
        modal.style.display = "block";
        modalImg.src = img.src;
        captionText.innerHTML = img.alt;

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("my-close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };
    }

    function scaleAndShadowById(id, time) {
        $("#" + id).removeClass("remove-shadow-size");
        $("#" + id).addClass("add-shadow-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-shadow-size");
            $("#" + id).removeClass("add-shadow-size");
        }, time);
    }

    function scaleById(id, time) {
        $("#" + id).removeClass("remove-size");
        $("#" + id).addClass("add-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-size");
            $("#" + id).removeClass("add-size");
        }, time);
    }

    function refreshCartBtn() {
        $.ajax({
            url: '/art/get_cart_count/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                $(".cartBtn").each(function () {
                    $(this).text("Cart (" + response + " Items)");
                });
                //$("#cartBtn").text("Cart (" + response + " Items)");
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function clearCart() {
        $.ajax({
            url: '/art/clear_cart/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                if (!response === "{\"error\":\"\",\"message\":\"success\"}") {
                    console.log("ERROR - Failed to Clear Cart");
                    // TODO: Attempt to email support.ludega.com
                }
            },
            error: function () {
                console.log("ERROR - Failed to Clear Cart");
                // TODO: Attempt to email support.ludega.com
            }
        });
    }

    // This function is called via a "handler" in static/ludega_art/js/sqpaymentform.js
    function chargeCard(nonce) {

        // TODO: Send this json over the network and parse server side.
        var cart_json = $("#cart_info_json").val();
        var obj = JSON.parse(cart_json);

        number_of_keys = (Object.keys(obj).length) - 1;
        var i = 0;
        var prod_id_arr = [];
        var quantity_arr = [];
        var prod_type_arr = [];
        var prod_size_arr = [];

        for (i; i < number_of_keys; i++) {
            prod_id_arr[i] = obj[i]["prod_id"];
            quantity_arr[i] = obj[i]["quantity"];
            prod_type_arr[i] = obj[i]["type"];
            prod_size_arr[i] = obj[i]["size"];
        }

        console.log("DEBUG ON");
        console.log('Nonce: ' + nonce);
        console.log('prod_id_arr: ' + prod_id_arr);
        console.log('quantity_arr: ' + quantity_arr);
        console.log('prod_type_arr: ' + prod_type_arr);
        console.log('prod_size_arr: ' + prod_size_arr);
        console.log('Number of keys: ' + number_of_keys);
        console.log(document.getElementById("firstName_input").value);
        console.log(document.getElementById("lastName_input").value);
        console.log(document.getElementById("address_input").value);
        console.log(document.getElementById("city_input").value);
        console.log(document.getElementById("state_input").value);
        console.log(document.getElementById("zip_input_shipping").value);
        console.log(document.getElementById("notes").value);

        var e = document.getElementById("shippingOptions");
        var shipping_method = e.options[e.selectedIndex].value;
        console.log(shipping_method);

        $.ajax({
            url: '/art/submit_order_charge_card/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                nonce: nonce,
                prod_id_arr: prod_id_arr,
                quantity_arr: quantity_arr,
                prod_size_arr: prod_size_arr,
                prod_type_arr: prod_type_arr,
                number_of_keys: number_of_keys,
                email: document.getElementById("email_input").value,
                note: document.getElementById("notes").value,
                first_name: document.getElementById("firstName_input").value,
                last_name: document.getElementById("lastName_input").value,
                address1: document.getElementById("address_input").value,
                address2: document.getElementById("address_input2").value,
                city: document.getElementById("city_input").value,
                state: document.getElementById("state_input").value,
                zip: document.getElementById("zip_input_shipping").value,
                country: document.getElementById("country_input").value,
                shipping_method: shipping_method,
            },
            success: function (response) {

                var fName = document.getElementById("firstName_input").value
                var lName = document.getElementById("firstName_input").value


                if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date');
                    var element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV');
                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date / CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Expiration');

                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_CARD\', u\'detail\': u\'Invalid card number.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Credit Card Number');
                    var element = document.getElementById("sq-card-number");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'CARD_DECLINED\', u\'detail\': u\'Card declined.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Sorry, your card was declined.');
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'INVALID_REQUEST_ERROR\', u\'code\': u\'CARD_TOKEN_USED\', u\'detail\': u\'Card nonce already used; please request new nonce.\'}]}') {
                    // Somehow this nonce was already used. We need to re-request a nonce and try this whole process again.
                    console.log("Card nonce already used; please request new nonce and try to charge card again.")
                    //$("#checkoutModalPayBtn").trigger("click");
                }
                // THIS, hopefully, is where we get most of the time!
                else if (response.indexOf("order_confirmation_number") >= 0) {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]('Payment Recieved!');

                    // Clear cart since we just successfully bought everything in the cart
                    if (!clearCart()) {
                        console.log("CRITICAL ERROR - Failed to clear cart.");
                    }

                    console.log(response);
                    response_json = JSON.parse(response);
                    var confirmation_num = response_json["order_confirmation_number"];

                    // Now redirect page to confirmation page.
                    url = '/order_confirmation?order_id_hash=' + confirmation_num;
                    window.location.replace(url);

                }
                else {
                    console.log("CRITICAL ERROR - Got unexpected response from server.\nResponse was: " + response);
                    // TODO: Email software.support@ludega.com
                }
            },
            error: function (response) {
                alert("Failed: " + response.toString());
            }
        });
    }

    // This get's called upon "showing" of the checkout modal
    // Think of it as the "before showing, run this stuff" function
    function initialize_checkout_modal() {

        $('#checkoutEmailHref').trigger("click");

        $('#checkoutForm').trigger("reset");
        $("#email_input").removeClass("sq-input--focus");
        $("#email_valid_color").removeClass("success");
        $("#email_valid_color").addClass("danger");
        $("#email_valid_symbol").removeClass("fa-check-circle");
        $("#email_valid_symbol").addClass("fa-times-circle");

        $("#firstName_input").removeClass("sq-input--focus");
        $("#lastName_input").removeClass("sq-input--focus");
        $("#address_input").removeClass("sq-input--focus");
        $("#city_input").removeClass("sq-input--focus");
        $("#state_input").removeClass("sq-input--focus");
        $("#zip_input_shipping").removeClass("sq-input--focus");
        $("#country_input").removeClass("sq-input--focus");


        $('#cc-form').find('input:text').val('');
        $('#checkoutModal').modal('hide');
        $("#collapse2").removeClass("in");
        $("#collapse3").removeClass("in");
        try {
            var cart_empty = document.getElementById("noProdsInformDiv").innerHTML;

            if (cart_empty == "No Items In Cart") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-left",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "500",
                    "hideDuration": "1000",
                    "timeOut": "2000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["error"]('Your cart is empty. Please add an item to checkout.');
                return;
            }
            else {
                $("#checkoutModal").modal()
            }
        }
        catch (err) {
            $("#checkoutModal").modal()
        }


        {#document.getElementsByTagName('iframe')[0].src=document.getElementsByTagName('iframe')[0].src#}
        {#document.getElementsByTagName('iframe')[1].src=document.getElementsByTagName('iframe')[1].src#}
        {#document.getElementsByTagName('iframe')[2].src=document.getElementsByTagName('iframe')[2].src#}
        {#document.getElementsByTagName('iframe')[3].src=document.getElementsByTagName('iframe')[3].src#}


        {#document.getElementById('sq-card-number').src += '';#}


        {#var iframe = document.getElementById('sq-cvv');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#iframe.src = iframe.src;#}

        {#var iframe = document.getElementById('sq-card-number');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-cvv');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src#}
    }


    function scaleAndShadowByDataId(id, time) {
        //alert("here too...");
        $('*[data-id=' + id + ']').removeClass("remove-shadow-size");
        $('*[data-id=' + id + ']').addClass("add-shadow-size");
        setTimeout(function () {
            $('*[data-id=' + id + ']').addClass("remove-shadow-size");
            $('*[data-id=' + id + ']').removeClass("add-shadow-size");
        }, time);
    }

    // This function handles user clicks on "Continue Shopping" in the
    // cart section of the site
    $("#cartContinueShoppingBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        $("#cartContainer").hover(function (event) {
            event.preventDefault();
        });
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    $("#closeCartBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    // This function handles clicks on the "Checkout" button.
    // We build a link to the "Shopify Pay Page" and redirect the user there
    $("#checkOut").on("click", function () {
        console.log($("#cart_info_json").val());
        var cart_info = JSON.parse($("#cart_info_json").val());

        var checkout_page_url = "https://enspirus-arts.myshopify.com/cart/";
        var i = 0;
        var key_count = Object.keys(cart_info).length;
        if (key_count == 1) {
            scaleById("emptyCartMessage", 350);
            setTimeout(function () {
                scaleById("emptyCartMessage", 350);
            }, 650);
        }
        else {
            for (var key in cart_info) {
                if (key != "total_price") {
                    checkout_page_url += cart_info[key]["variant_id"] + ":" + cart_info[key]["quantity"];
                    if (i < key_count - 2) {
                        checkout_page_url += ",";
                    }
                }
                i++;
            }
            // Direct user to checkout page
            window.location.href = checkout_page_url;
        }
    });

    // This is a niche situation listener. Essentially, if the user
    // wants to see the "Type Description" and clicks/taps on it, but
    // they haven't selected a type in the drop down, then we want to
    // pulse the type selector and only temporarily display a message
    // stating that they haven't chooses a type yet.
    $("#collapsibleTypeDescriptionClickable").on("click", function () {
        if ($('#collapsibleTypeDescriptionHeader').attr('aria-expanded') == "false" && $("#prodTypeSelector").find("option:selected").val() == "default") {
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);

            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("hide");
            }, 2000);
        }
    });

    // This function resets the filters to default which, currently is just
    // "All". Meaning completely open, no filter subset criteria
    $("#refreshFilterBtn").on("click", function () {
        addHiddenInputElement("resetFilterBtnStatus", "clicked");
        $("#AllProductsCheckBox").parent().addClass("checked");
        $("#AllProductsCheckBox").trigger("click");
        //$("#AllImagesCheckBox").parent().addClass("checked");
        addHiddenInputElement("resetFilterBtnStatus", "notClicked");
        //$("#AllImagesCheckBox").trigger("change");
    });

    // Once a size is selected, we should be able to display a price.
    $('#prodSizeSelector').on('change', function () {
        // Get/save product size selection
        var sizeSelection = $(this).find("option:selected").val();
        if (sizeSelection != "default") {
            // Get/save the price for the given selection
            var prod_modal_json_info = JSON.parse($("#prod_modal_content_json_hidden").val());
            // Get/save product type selected
            var typeSelection = $("#prodTypeSelector").find("option:selected").val();
            // Get/save product price (for selected size/type)
            var price = prod_modal_json_info["purchase_options"][typeSelection]["size_price"][sizeSelection];

            // If the price is already showing, collapse it and then open it to show
            // new price
            if ($("#priceDivCol").height() != 0 && $("#priceDivCol").height() != 1) {
                // Collapse it so it can be changed and then re-opened.
                $("#priceDivCol").animate({
                    height: "0px",
                    opacity: 0
                }, 600);
                setTimeout(function () {
                    $("#prodModalPrice").text("$" + price);
                }, 600);
            }
            // It was already collapsed. Just fill price. Then we'll show it (below)
            else {
                $("#prodModalPrice").text("$" + price);
            }
            // Show price (with fade in and expand in)
            $("#priceDivCol").animate({
                height: "60px",
                opacity: 1
            }, 600);
            //$("#priceDivCol").slideDown("slow");
            //$("#priceDivCol").fadeIn("slow");
        }
        else {
            $("#priceDivCol").animate({
                height: "0px",
                opacity: 0
            }, 600);
            setTimeout(function () {
                $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
            }, 600);
        }
    });

    // This accomplishes a cascading drop down list.
    // When Type is selected, then the Size selector
    // can be populated. This function populates the
    // size selector with options based on what type
    // the user selected.
    $('#prodTypeSelector').on('change', function () {
        // Start by removing existing options from size selector
        $("#prodSizeSelector")
            .find('option')
            .remove()
            .end()
            .append('<option value="default">Select Size</option>')
            .val('default')
        ;
        $("#prodSizeSelector").selectpicker('refresh');

        var selected = $(this).find("option:selected").val();
        var modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
        var one_size = "";
        if (selected != "default") {
            // Fill the size dropdown with options
            for (var size in modal_info_json["purchase_options"][selected]["size_price"]) {
                $("#prodSizeSelector").append("<option value='" + size + "'>" + size + "</option>");
                $("#prodSizeSelector").attr('disabled', false);
                $("#prodSizeSelector").selectpicker('refresh');
                one_size = size;
            }

            // Fill the Type Description Header and expand it
            $("#prodModalProdTypeDescription").html(selected + "<br>" + modal_info_json["purchase_options"][selected]["description"]);
            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("show");
            }, 500);
        }
        else {
            // Then they selected the "Default" value which isn't a valid type
            // Disable size as there is no size for "Default"
            $("#prodSizeSelector").attr('disabled', true);
            $("#prodSizeSelector").selectpicker('refresh');
            // Collapse and change the Type Description
            $("#collapsibleTypeDescriptionHeader").collapse("hide");
            setTimeout(function () {
                $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
            }, 500);
        }

        // If there's only one Prod Size for the Prod Type selected,
        // then auto-select that size for the user.
        if ($("#prodSizeSelector option").size() == 2) {
            $("#prodSizeSelector").val(one_size);
            $("#prodSizeSelector").selectpicker('refresh')
        }
        // Size selector may have changed. As a check, trigger the on change function/listener
        $("#prodSizeSelector").trigger("change");
    });

    // This function/listener removes options from type and size selector
    // whenever the modal is closed (modal close). It also collapses the description and
    // type headers/info boxes.
    $("#prodModal").on('hidden.bs.modal', function () {
        // Remove options from type selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodTypeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Remove optiosn from size selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodSizeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Collaps price section and reset pricing text
        $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
        $("#priceDivCol").animate({
            height: "0px",
            opacity: 0
        }, 600);

        // Refresh the selectors since we changed them.
        // Bootstrap requires this step.
        $("#prodTypeSelector").selectpicker('refresh');
        $("#prodSizeSelector").selectpicker('refresh');

        // Reset Type Description and Product Description
        $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
        $("#collapsibleTypeDescriptionHeader").collapse("hide");
        $("#collapsibleDescriptionHeader").collapse("hide");

        // Remove Product Image
        $("#prodModalImage").attr("src", "");
    });

    // When the user clicks the "Cart" button at the top, this is what happens.
    function apply_cart_btn_listeners() {
        $(".cartBtn").each(function () {
            $(this).on("click", function () {
                if ($("#cartSection").css("display") == "none") {
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            // Save the JSON returned in a hidden form
                            addHiddenInputElement("cart_info_json", response);

                            // Parse response (json formatted string) into a json object for iterating through it
                            var cart_info_json = JSON.parse(response);

                            // for each item in the cart
                            var i = 0;
                            for (var key in cart_info_json) {
                                var item_row = "";
                                if (i == 0 && Object.keys(cart_info_json).length != 3 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;">';
                                }
                                else if (i == Object.keys(cart_info_json).length - 2 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">';
                                }
                                else {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;border-bottom:0.5px solid lightgray;">';
                                }
                                if (key != "total_price") {
                                    $("#cartMainProdRow").append('' +
                                        item_row +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row">' +
                                        '</div>' +
                                        '<div class="row"  style="padding-bottom:10px;">' +
                                        '<div class="col-xs-4"><img src="/' + cart_info_json[key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                                        '<div class="col-xs-8">' +
                                        '<a><h3 class="title">' + cart_info_json[key]["name"] + '</h3></a>' +
                                        '<p>' + ' ' + cart_info_json[key]["type"] + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row" style="padding-bottom:15px;">' +
                                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Quantity</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                                        '</div>' +
                                        '<div class="row">' +
                                        '<div id="unitPriceProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + cart_info_json[key]["price"] + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<input onchange="quantityChange(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="quantityProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_info_json[key]["quantity"]) + '">' +
                                        '</div>' +
                                        '<div id="subtotalProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_info_json[key]["price"] * cart_info_json[key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<button onclick="cartRemoveItem(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="cartRemoveProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-id="' + cart_info_json[key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                    );

                                }
                                i++;
                            }

                            // If we added at least 1 item
                            // There will always be one key (total_amount). So if there are 2, then we had
                            // at least one item. Thus if i > 1, not i > 0


                            if (i > 1) {
                                var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                                var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                                var shipping = 9.00.toFixed(2);

                                /*if (subTotal >= 100){
                                    shipping = 0.00.toFixed(2);
                                }*/

                                var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);

                                $("#cartMainProdRow").append('' +
                                    '<div id="cartTotalRow" class="row" style="padding-top:15px;">' +
                                    '<div class="col-sm-6 col-xs-12"></div>' +
                                    '<div class="col-sm-6 col-xs-12">' +
                                    //'<div class="col-xs-3"></div>' +
                                    '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                                    //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                            // Else no items were added. So display something saying so.
                            else {
                                $("#cartMainProdRow").append('<div id="emptyCartMessage" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                            }

                            $("#cartContainer").removeClass("remove-shadow-size-quick");
                            if ($("#closeCartBtn").css("display") == "none") {
                                $("#closeCartBtn").css("display", "block");
                            }
                            $("#cartSection").slideToggle();
                            $('html, body').animate({
                                scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                            }, 1000);
                            if ($("html").hasClass("nav-open")) {
                                $("#menu-toggle").trigger("click");
                            }
                            //console.log(response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                }
                else {
                    $('html, body').animate({
                        scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                    }, 1000);
                    if ($("html").hasClass("nav-open")) {
                        $("#menu-toggle").trigger("click");
                    }
                }

                // Seems we get weird flickering effects (involved in the animate scrollTop action) if this isn't here
                return false;
            });
        });
    }

    function quantityChange(id, size, type) {
        // Special Note: Size may have instances of periods to represent decimal sizes. When
        // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
        // below, you'll see that I'm escaping the period using our replaceAll string function.
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        if ($("[id='quantityProdId" + concatIdSizeType + "']").val() <= 0) {
            // Display notification informing of success
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]('Select the red trash can to remove an item from your cart.');

            $("[id='quantityProdId" + concatIdSizeType + "']").val(1);
            scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 650);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 1300);
        }
        else {
            // Firstly, inform the server that the user would like to add to their cart. And attempt to do so...
            var _size = size;
            var _type = type;
            $.ajax({
                url: '/art/update_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: $("[id='quantityProdId" + concatIdSizeType + "']").val(),
                    price: $("[id='unitPriceProdId" + concatIdSizeType + "']").text(),
                    size: _size,
                    type: _type,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    scaleAndShadowById("cartBtn", 500);
                    refreshCartBtn();
                    // Updating hidden json
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            addHiddenInputElement("cart_info_json", response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                },
                error: function () {
                    alert("Error...");
                }
            });

            // This behemoth of a statement simply sets the text of the subtotal for a give item in the cart
            // The length of the statement is due to rounding, multiplication, and ridiculous id naming convention I've
            // used for naming/id'ing items in the cart
            $("[id='subtotalProdId" + concatIdSizeType + "']").text("$" + (Math.round((parseFloat($("[id='unitPriceProdId" + concatIdSizeType + "']").text().replace("$", "")) * $("[id='quantityProdId" + concatIdSizeType + "']").val()) * 100) / 100).toFixed(2));

            //We also want to refresh the cart total.
            refreshCartTotal();
        }
    }

    function prodHover(id) {
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
        if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
            $("#imgProdId" + id).css("transform", "scale(.90, .90)");
        }
        $("#prod" + id).hover(function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(.90, .90)");
            }
        }, function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(1,1)");
            }
        });
    }

    // This function loops through each item in the cart and applies a border on top or bottom as needed
    function redrawCartItemBorders() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                if (i == 0) {
                    $(this).css("border-top", "0.5px solid lightgray");
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
                else {
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
            }
            i++;
        });
    }

    // This function adds up all items in the cart and renders the total at the bottom
    function refreshCartTotal() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        var total = 0;
        var subTotal = 0;
        var taxes = 0;
        var shipping = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                var subtotalId = ($(this).attr("id")).replace("cartItemProdId", "subtotalProdId");
                subtotalId = subtotalId.replaceAll(".", "\\.");
                if (subtotalId != "emptyCartMessage") {
                    total += parseFloat(($("[id='" + subtotalId + "']").text()).replace("$", ""));
                }
            }
            i++;
        });


        taxes = ((Math.round(total * 100) / 100) * 0.029).toFixed(2);
        subTotal = (Math.round(total * 100) / 100).toFixed(2);
        shipping = 9.00.toFixed(2);
        /*if (subTotal >= 100){
            shipping = 0.00.toFixed(2);
        }*/
        total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);
        $("#cartTotal").text("Total: $" + total);
        $("#tax").text("Tax: $" + taxes);
        $("#subTotal").text("Sub Total: $" + subTotal);
        $("#shippingCost").text("Shipping: $" + shipping);


    }

    // This function handles user clicks on the Trash icon next to items
    // in the cart
    function cartRemoveItem(id, _size, _type) {
        var concatIdSizeType = id + _size + _type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        $("[id='cartItemProdId" + concatIdSizeType + "']").slideUp(500);
        setTimeout(function () {
            $("[id='cartItemProdId" + concatIdSizeType + "']").remove();
        }, 500);

        // make a call to the server to remove the item(s) from the cart
        $.ajax({
            url: '/art/remove_from_cart/',
            type: "POST",
            data: {product_id: id, size: _size, type: _type, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                refreshCartBtn();

                //Need to ensure other one is removed at this point. So waiting half a second to assess
                setTimeout(function () {
                    // If there's no more items, we want to show Empty Cart Message
                    var itemCount = $("#cartMainProdRow").children().length - 1;
                    if (itemCount == 0) {
                        $("#cartMainProdRow").append('<div id="emptyCartMessage" style="display:none;text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                        $("#emptyCartMessage").slideDown("slow");
                        $("#cartTotalRow").slideUp(500);
                        setTimeout(function () {
                            $("#cartTotalRow").remove();
                        }, 500);
                    }
                    else {
                        setTimeout(function () {
                            redrawCartItemBorders();
                            refreshCartTotal();
                        }, 500);
                    }
                }, 500);

                // Updating hidden json
                $.ajax({
                    url: '/art/get_cart/',
                    type: "POST",
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (response) {
                        addHiddenInputElement("cart_info_json", response);
                    },
                    error: function () {
                        alert("Error...");
                    }
                });
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function drawNewItemInCart(id, size, type) {
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        // Start by checking if this particular item already exists in our cart
        // If so, then we just need to increment the quantity by 1
        var item_already_in_cart = false;
        $("#cartMainProdRow").children().each(function () {
            if ($(this).attr("id") == "cartItemProdId" + id + size + type) {
                item_already_in_cart = true;
            }
        });
        // Then all we need to do is increment the quantity for the given item and triger the quantity change event
        if (item_already_in_cart) {
            var new_quant_val = parseInt($("[id='quantityProdId" + concatIdSizeType + "']").val()) + 1;
            $("[id='quantityProdId" + concatIdSizeType + "']").val(new_quant_val);
            $("[id='quantityProdId" + concatIdSizeType + "']").trigger("change");
        }
        // Else, we've got an entire item row to add to the cart (without closing and reopening it)
        else {
            // Start by updating the cart information (that we store in a hidden json)
            $.ajax({
                url: '/art/get_cart/',
                type: "POST",
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (response) {
                    addHiddenInputElement("cart_info_json", response);
                    // Debugging Purposes Only
                    //console.log(response);
                    // Now locate the item we're adding to the cart in the JSON obj
                    var cart_json_obj = JSON.parse(response);
                    var da_key = "";
                    for (var key in cart_json_obj) {
                        if (cart_json_obj[key].hasOwnProperty("prod_id")) {
                            if (cart_json_obj[key]["prod_id"] == id) {
                                da_key = key;
                            }
                        }
                    }
                    // Now that we have da key to it (lol...) we can generate the html to add our item
                    // to our cart. We're going to start it out as display:none and then expand
                    // it once it's added fully.
                    var total_row = $("#cartMainProdRow").children().last();
                    total_row.before('' +
                        '<div id="cartItemProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="row table-hover" style="display:none;margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row">' +
                        '</div>' +
                        '<div class="row"  style="padding-bottom:10px;">' +
                        '<div class="col-xs-4"><img src="/' + cart_json_obj[da_key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                        '<div class="col-xs-8">' +
                        '<a><h3 class="title">' + cart_json_obj[da_key]["name"] + '</h3></a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row" style="padding-bottom:15px;">' +
                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Quality</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                        '</div>' +
                        '<div class="row">' +
                        '<div id="unitPriceProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + cart_json_obj[da_key]["price"] + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<input onchange="quantityChange(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="quantityProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_json_obj[da_key]["quantity"]) + '">' +
                        '</div>' +
                        '<div id="subtotalProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_json_obj[da_key]["price"] * cart_json_obj[da_key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<button onclick="cartRemoveItem(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="cartRemoveProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" data-id="' + cart_json_obj[da_key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                    );

                    if (!!document.getElementById("emptyCartMessage")) {
                        // Fade out the message
                        $("#emptyCartMessage").animate({
                            opacity: 0,
                            height: "0px"
                        }, 500);
                        setTimeout(function () {
                            $("#emptyCartMessage").remove();
                        }, 500);

                        var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                        var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                        var shipping = 9.00.toFixed(2);
                        if (subTotal >= 100) {
                            shipping = 0.00.toFixed(2);
                        }

                        var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);


                        $("#cartMainProdRow").append('' +
                            '<div style="display:none;" id="cartTotalRow" class="row" style="padding-top:15px;">' +
                            '<div class="col-sm-6 col-xs-12"></div>' +
                            '<div class="col-sm-6 col-xs-12">' +
                            //'<div class="col-xs-3"></div>' +
                            '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping[USPS Priority]: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                            //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                            '</div>' +
                            '</div>'
                        );

                        $("#cartTotalRow").slideDown("slow");
                    }

                    // Show it (via sliding it down)
                    // Special Note: Size may have instances of periods to represent decimal sizes. When
                    // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
                    // below, you'll see that I'm escaping the period using our replaceAll string function.
                    var cartItemId = "cartItemProdId" + id + size + type;
                    cartItemId = cartItemId.replaceAll(".", "\\.");
                    $("[id='" + cartItemId + "']").slideDown("slow");
                    // Re-draw border lines as needed
                    redrawCartItemBorders();
                    refreshCartTotal();
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
    }

    // Handles the "Add to Cart" clicks.
    $("#prodModalAddToCart").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Type.");

            // Pulse the type selector
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Size.");

            // pulse the size selector
            scaleAndShadowByDataId("prodSizeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodSizeSelector", 500);
            }, 1000);
        }
        else {
            var prod_modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
            var id = prod_modal_info_json["requested_prod"]["id"];
            var size_selected = $("#prodSizeSelector").find("option:selected").val();
            var type_selected = $("#prodTypeSelector").find("option:selected").val();
            $.ajax({
                url: '/art/add_to_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: 1,
                    price: $("#prodModalPrice").text(),
                    size: size_selected,
                    type: type_selected,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    // Close Modal
                    $("#modalCloseBtn").trigger("click");

                    // Display notification informing of success
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]("Added to Cart!");

                    scaleAndShadowById("cartBtn", 350);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 700);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 1400);
                    refreshCartBtn();

                    // If the cart is currently showing, then we want to add to it on the fly (as apposed to
                    // building the entire thing from scratch like the apply_cart_btn_listeners() function(s)
                    // do.
                    if ($("#cartSection").css("display") == "block") {
                        drawNewItemInCart(id, size_selected, type_selected);
                    }

                    // This flashes helps draw attention to the menu button (when user is on phone)
                    $("#menu-toggle").addClass("toggled");
                    setTimeout(function () {
                        $("#menu-toggle").removeClass("toggled");
                    }, 200);
                    setTimeout(function () {
                        $("#menu-toggle").addClass("toggled");
                        setTimeout(function () {
                            $("#menu-toggle").removeClass("toggled");
                        }, 100);
                    }, 500);
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // Handles the "Buy Now" clicks.
    $("#prodModalBuyNow").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Type!");

            $('*[data-id="prodTypeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodTypeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodTypeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodTypeSelector"]').removeClass("add-shadow-size");
            }, 500);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Size!");

            $('*[data-id="prodSizeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodSizeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodSizeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodSizeSelector"]').removeClass("add-shadow-size");
            }, 500);

        }
        else {
            $("#prodModalAddToCart").trigger("click");
            $("#cartBtn").trigger("click");
            setTimeout(function () {
                scaleAndShadowById("checkOut", 500);
                setTimeout(function () {
                    scaleAndShadowById("checkOut", 500);
                }, 1000);
            }, 2000);
            setTimeout(function () {
                if ($("#checkOut").visible() == false) {
                    $('html, body').animate({
                        scrollTop: $("#checkOut").offset().top - $(window).height() + $("#navBar1337").height() + 20
                    }, 1000);
                }
            }, 2000);
        }

        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // When the screen is scrolled down a certain amount, this function
    // changes the color of the menu bar at the top. This is done for
    // style/readability
    function checkScroll() {
        if ($(document).scrollTop() > 180) {
            if (transparent) {
                transparent = false;
                $('nav[role="navigation"]').removeClass('navbar-transparent').addClass('navbar-default');
            }
        } else {
            if (!transparent) {
                transparent = true;
                $('nav[role="navigation"]').addClass('navbar-transparent').removeClass('navbar-default');
            }
        }
    }

    // This beautiful function/filter will return boolean of whether a given element is or is not within the
    // view port.
    // Currently not working as intended. Using visible.js instead.
    // Example use: $('div').is(':offscreen');
    jQuery.expr.filters.offscreen = function (el) {
        var rect = el.getBoundingClientRect();
        return (
            (rect.x + rect.width) < 0
            || (rect.y + rect.height) < 0
            || (rect.x > window.innerWidth || rect.y > window.innerHeight)
        );
    };

    // When card-product is clicked, we need to reach out to server and fill modal with
    // appropriate information.
    $(document).on("click", ".card-product", function () {

        // Call out to server to get needed information (for product modal)
        // Response should be json formatted data. alert(response) to see it.
        $.ajax({
            url: '/art/get_product_modal_info/',
            type: "POST",
            data: {id: $(this).data('id'), csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                // Debugging purposes. Uncomment to see JSON data.
                //console.log(response);

                // Save the response in hidden form element
                if (!!document.getElementById("prod_modal_content_json_hidden")) {
                    $("#prod_modal_content_json_hidden").val(response);
                }
                else {
                    addHiddenInputElement("prod_modal_content_json_hidden", response);
                }

                // Parse the json into object/var
                var modal_info_json = JSON.parse(response);

                // Fill modal
                $("#prodModalImage").attr('src', '/' + modal_info_json["requested_prod"]["image_file"]);
                $("#prodModalTitle").text(modal_info_json["requested_prod"]["product_name"]);
                $("#prodModalProdDescription").text(modal_info_json["requested_prod"]["description"]);
                // Expand description header
                setTimeout(function () {
                    $("#collapsibleDescriptionHeader").collapse("show");
                }, 500);

                //alert(Object.keys(modal_info_json["purchase_options"])[0]);
                //alert(JSON.stringify(modal_info_json["purchase_options"]));

                // Loop through type options and fill selector
                for (var key in modal_info_json["purchase_options"]) {
                    $("#prodTypeSelector").append("<option value='" + key + "'>" + key + "</option>").selectpicker('refresh');
                }
                // Refresh selectors to update with new options and disable size
                $("#prodSizeSelector").attr('disabled', true);
                $("#prodSizeSelector").selectpicker('refresh');
                $("#prodTypeSelector").selectpicker('refresh');
                // If there's only one "Type" option, then select it for the user
                if (Object.keys(modal_info_json["purchase_options"]).length == 1) {
                    // Set Type selector to the one option that exists...
                    $("#prodTypeSelector").val(Object.keys(modal_info_json["purchase_options"])[0]);
                    $("#prodTypeSelector").selectpicker('refresh'); // Refresh selector so change shows in browser
                    // Trigger the change event so that the size type get's populated and activated
                }
                // Trigger the change in case we ended up setting it to something (so that other listener actions trigger)
                $("#prodTypeSelector").trigger("change");

                // Adding in related/similar products scroller content
                for (var key in modal_info_json["related_prods"]) {
                    $("#relatedProdsScroller").append('<li class="nbs-flexisel-item" style="width: 113.75px;">' +
                        '     <a href="#product-page2" role="tab" data-toggle="tab" aria-expanded="false">' +
                        '        <img src="/' + modal_info_json["related_prods"][key]["image_file"] + '" alt="...">' +
                        '    </a>' +
                        '</li>');
                }

            },
            error: function () {
                alert("Error...");
            }
        });

        // Build Modal using #prod_modal_content_json_hidden

        //var products = JSON.parse("{{products|escapejs}}");

        //alert(JSON.string(products));

        var prodID = $(this).data('id');

        //$(".modal-body #modal-body").text( prodID );
    });

    var parallax = function () {
        var current_scroll = $(this).scrollTop();

        oVal = ($(window).scrollTop() / 3);
        big_image.css('top', oVal);
    };

    // Handles little clickable filter button on each product box
    function filterBtnOnClick(prodType) {
        event.stopPropagation();
        alert("Filter button clicked. Still need to implement filter. Would have filtered to " + prodType);
    }

    // Function to hide all product rows past the 1th indicy (aka show only 2 prod rows)
    function initializeProductRows() {
        var rowNum = 2;
        var id = 'row' + rowNum;
        var hasNextRow = !!document.getElementById(id);
        // while there exists another row (past the 1th row or the last row we hid)
        while (hasNextRow) {
            // Setting selector for jquery hide function
            selector = '#' + id;
            // Hiding rows (past 0th and 1th)
            $(selector).slideUp("fast");
            // If the row's child elements have a height of 0, display of none, or opacity of 0,
            // Then we will undo that since their parent element/container is what we'll be
            // expanding. When we expand the parent element, we want the children to be visible.
            $(selector).children().each(function (i) {
                if ($(this).css("height") == "0px") {
                    $(this).css("height", "100%");
                }
                if ($(this).css("opacity") == "0") {
                    $(this).css("opacity", "1");
                }
                if ($(this).css("display") == "none") {
                    $(this).css("display", "block");
                }
            });
            // Increment row num (to check for)
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Loads/Shows/Un-hides/Displays 2 more product rows
    // if they exist. It does this with a fade and an expand.
    function loadMoreProductRows(option, time) {
        // Start by removing the noProdsInformDiv
        $("#noProdsInformDiv").remove();
        // start searching for hidden rows
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a next row
        var hasNextRow = !!document.getElementById(id);
        // Start a counter. We only want to show 2 new rows (per "Load More..." click)
        var count = 0;
        while (hasNextRow && count < 2) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);

            // if it's hidden, then display it (with some animation to it)
            if (option == "fadeAndExpand") {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.css("overflow", "visible");
                    //row.css("height","0px");
                    row.css("opacity", 0);
                    //row.css("display","block");
                    row.slideToggle('slow');
                    row.animate({
                        //height:"100%",
                        opacity: 1
                    }, time);

                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }
            else if (option == "expandThenFade") {
                if ($("#productsStatus").val() == "some") {
                    if (row.css("display") == "none" || row.css("opacity") == 0) {
                        row.animate({
                            height: "auto"
                        }, 1);
                        setTimeout(function () {
                            row.animate({
                                opacity: 1
                            }, 1);
                        }, 1);
                    }
                    row.children().each(function () {
                        if ($(this).css("display") == "none" || $(this).css("opacity") == 0) {

                            $(this).height("100%");
                            $(this).css({opacity: 1});
                            // No Animation needed here. If we're here, the parent class should have
                            // opacity of 0
                        }
                    });
                    if ($("#productColumn").css("display") == "none" || $("#productColumn").css("opacity") == 0) {

                        $("#productColumn").slideDown(time);
                        /*$("#productColumn").animate({
                                height: "toggle"
                            }, 1000);*/

                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }
                else {
                    // There aren't any products to show
                    // Due to the Filter settings.
                    // Inform the user.
                    if (!!document.getElementById("noProdsInformDiv") == false) {
                        $("#productColumn").append('<div id="wrapper" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items Met Your Chosen Filter Options</h3></div>');
                        $("#productColumn").slideDown(time);
                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }

                // Scroll the screen so that the newly displayed products are some % from the
                // top of the screen
                if (option == "fadeAndExpand") {
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                }
                // This was a hidden row and now it isn't. Increment counter.
                // Only want to do this to two (per "Load More..." click)
                count++;
            }
            else {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.animate({
                        opacity: 1
                    }, time);
                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }

            // Increment row num (to check for) and count
            rowNum++;

            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
            setTimeout(function () {
                addImgSpacers();
            }, time / 2)
        }
    }

    // This function returns true if there exist hidden product rows on the page
    // This function returns false if there exist no hidden product rows on the page
    function existsHiddenProdRows() {
        // We know we've got the 1th and 0th row showing, so start searching
        // for hidden rows at the 2nd indexed (aka 3rd) row.
        var rowNum = 2;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a 3rd row (aka 2nd indexed row)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);
            // If this row is hidden, then there exist some hidden row(s)
            if (row.css("display") == "none" && row.children().length > 0) {
                return true;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;                    // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
        return false;
    }

    // The "Load More..." button gets removed and re-added throughout its life.
    // Each time the button element is removed and added, this function needs
    // to be called in order to reapply the click listener (and function that
    // goes with it).
    function setLoadMoreClickFunc() {
        $('#loadMore').click(function () {
            loadMoreProductRows("fadeAndExpand", 1000);
            setTimeout(function () {
                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>Load more...</button>" +
                    "</div>";
                var options = {
                    action: "setState",
                    state: "info"
                };
                $('#loadMore').morphingButton(options);
                setTimeout(function () {
                    // Fade out existing button
                    if (existsHiddenProdRows()) {
                        $('#loadMoreCol').fadeOut(400); // Match this with id=LBFOD line
                    }
                    setTimeout(function () {
                        if (existsHiddenProdRows()) {
                            $('#loadMoreCol').replaceWith(loadMoreHtml);
                            // Fade in new instance of button
                            $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                            $('#loadMore').morphingButton();
                        } else {
                            $('#loadMoreCol').animate({
                                height: "toggle",
                                opacity: "toggle"
                            }, 1000);
                        }
                    }, 400); // Duration given for "Fade Out" of Light Blue (Success) Circle (id: LBFOD)
                }, 300); // Duration of Light Blue (Success) Circle (prior to Fade Out)
            }, 700); // Duration of Spinning Circle
        });
    }

    // If All is checked and user checks another filter box, then all should become
    // unchecked
    function initializeCheckBoxListeners() {
        {% for type in types %}
            $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllProductsCheckBox was checked, un-check it.
                if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
                    $("#AllProductsCheckBox").parent().removeClass("checked");
                }

                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // Color Filtering Removed For Now
        /*
            {% for color in colors %}
                $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                    // If AllColorsCheckBox was checked, un-check it.
                    if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
                        $("#AllColorsCheckBox").parent().removeClass("checked");
                    }

                    // Apply the filter change that just happened.
                    applyFilterOptions();
                });
            {% endfor %}
            */

        {% for image in images %}
            $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllImagesCheckBox was checked, un-check it.
                if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
                    $("#AllImagesCheckBox").parent().removeClass("checked");
                }
                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // When All is checked (in colors subsection) then other boxes should be unchecked
        // NOTE: Colors Filtering Disabled For Now
        /*$("#AllColorsCheckBox").change(function(){
                {% for color in colors %}
                    $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in Product subsection) then other boxes should be unchecked
        $("#AllProductsCheckBox").change(function () {
            {% for type in types %}
                $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            if ($("#resetFilterBtnStatus").val() != "clicked") {
                // Apply the filter change that just happened.
                applyFilterOptions();
            }
        });

        // When All is checked (in Clothing subsection) then other boxes should be unchecked
        // Merging Clothing and Products Check Box Filters Sections
        // Thus commenting out below section
        /*$("#AllClothingCheckBox").change(function(){
                {% for type in types %}
                    {% if type.is_clothing == True %}
                        $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                    {% endif %}
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in image subsection) then other boxes should be unchecked
        $("#AllImagesCheckBox").change(function () {
            {% for image in images %}
                $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            // Apply the filter change that just happened.
            applyFilterOptions();
        });

    }

    // This function returns the filter state as an object containing arrays.
    // Each array contains a list of valid types to be filtered to
    function getFilterState() {
        var filters = {
            images: [],
            clothing: [],
            products: [],
            colors: []
        };

        // Iterate over each check box and fill appropriate filter array
        if ($("#AllClothingCheckBox").parent().hasClass("checked")) {
            filters.clothing[0] = "All";
        }
        if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
            filters.products[0] = "All";
        }
        if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
            filters.colors[0] = "All";
        }
        if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
            filters.images[0] = "All";
        }
        // If the products filter don't have "all" checked
        if (!($("#AllProductsCheckBox").parent().hasClass("checked"))) {
            var productFilterCount = 0;
            {% for type in types %}
                if ($("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.products[productFilterCount] = "{{type.display_name}}";
                    productFilterCount++;
                }
            {% endfor %}
        }

        if (!($("#AllImagesCheckBox").parent().hasClass("checked"))) {
            var imageFilterCount = 0;
            {% for image in images %}
                if ($("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.images[imageFilterCount] = "{{image.name}}";
                    imageFilterCount++;
                }
            {% endfor %}
        }

        /*if(!($("#AllColorsCheckBox").parent().hasClass("checked"))) {
                var colorFilterCount = 0;
                {% for color in colors %}
                    if($("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")){
                        filters.colors[colorFilterCount] = "{{color.name}}";
                        colorFilterCount++;
                    }
                {% endfor %}
            }*/

        return filters;
    }

    // Replaces all instances of a given string in another string
    String.prototype.replaceAll = function (str1, str2, ignore) {
        return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof(str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
    };

    // This function adds "text" to the value() field of the element
    // with id of "elementId"
    function addHiddenInputElement(elementId, text) {
        text = text.replaceAll("'", "&#39;");
        //text = text.replace("\"","&#34;");
        if (!!document.getElementById(elementId)) {
            $("#" + elementId).val(text);
        }
        else {
            $('#hiddenForm').append("<input type='hidden' name='" + elementId + "' id='" + elementId + "' value='" + text + "'/>");
        }
    }

    // As the name suggests, this will animated an object fading away
    // and then remvoe the element
    function fadeOutRemoveElement(elementId, time) {
        $("#" + elementId).animate({
            opacity: "toggle"
        }, time);
        setTimeout(function () {
            $("[data-id=" + elementId + "]").remove();
        }, time);
    }

    // As the name suggests, this function collapses all product rows.
    // Not currently used. Used to be. Then implemented same effect
    // except utilized parent element/container.
    function collapseAllProductRows() {
        // Start by fading out the "Load More..." button as we don't want the user to click this while
        // we're refreshing the product tables/rows
        $("#loadMoreCol").animate({
            opacity: 0
        }, 1000);

        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results)
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            $(selector).animate({
                opacity: 0//,
                //height:"toggle"
            }, 1000);

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Removes products starting at a row/column and
    // continuing until there are no prods left to remove
    function removeRemainingProducts(startRow, startCol) {
        //alert(startRow + " , " + startCol);
        var rowNum = startRow;
        var colNum = startCol;
        // Set initial element id to begin at
        var id = 'row' + rowNum;

        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            var i = 0;
            $(selector).children().each(function () {
                if ((rowNum == startRow && i >= colNum) || (rowNum != startRow)) {
                    /*$(this).animate({
                            height:0
                        },2000);
                        var prod_element = $(this);
                        setTimeout(function(){
                            prod_element.remove();
                        }, 2000);*/
                    $(this).remove();
                }
                i++;
            });

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // This functions gets the 0th product described in the
    // hidden products_json_hidden form element (value() field)
    function getZerothJSONProductHTML() {
        var products_json = JSON.parse($("#products_json_hidden").val());
        var date = Date.now();

        var new_prod_element = "" +
            "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
            " data-image='" + products_json[0][4] + "' data-colors='' style='opacity:0; height:100%; dispay:none;'" +
            " data-product_type='" + products_json[0][3] + "'>" +
            "   <div data-toggle='modal' onmouseover='prodHover(" + products_json[0][0] + ")'  data-target='#prodModal' data-id='" + products_json[0][0] + "' class='fake-link card card-product card-plain my-card-light' id='prod" + products_json[0][0] + "'>" +
            "       <div style='overflow:visible;padding-top:10px;' class='image text-center'>" +
            "           <div id='topImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "           <a>" +
            "               <img id='imgProdId" + products_json[0][0] + "' class='my-img-dark' style='max-width:90%;max-height:300px;height:auto;width:auto;' src='/" + products_json[0][4] + "' alt='Couldnt Find Image'/>" +
            "           </a>" +
            "           <div id='bottomImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "       </div>" +
            "       <div class='content text-center'>" +
            "           <a>" +
            "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
            "           </a>" +
            //"           <p class='description'>" +
            //products_json[0][2] +
            //"           </p>" +
            "           <div class='footer'>" +
            "               <span class='price'>" + products_json[0][6] + "</span>" +
            "               <button onclick='filterBtnOnClick(\"" + products_json[0][3] + "\")' class='btn btn-danger btn-tooltip btn-simple pull-right' data-toggle='tooltip' title='Filter to " + products_json[0][3] + "' data-placement='left'>" +
            //"                   <i style='align-self:right;' class='fa fa-filter'></i>" +
            "               </button>" +
            "           </div>" +
            "       </div>" +
            "   </div> <!-- end card -->" +
            "</div>";

        jQuery.ready();

        return new_prod_element;
    }

    function addAndAnimateImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 added due to some padding at top of img
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300 && prodImgHeight > 0) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                            $("#bottomImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                        }
                        // Sometimes an image might still be loading due to slow network or something.
                        // In these cases, I believe height returned will be 0 or less than 0.
                        // When this is the case, we want to pause (to allow it to finish loading)
                        // and call the function again. Then return from the function (to end
                        // the initial instance of the function. This may happen multiple times.
                        else if (prodImgHeight <= 0) {
                            setTimeout(function () {
                                addAndAnimateImgSpacers();
                            }, 500);

                        }
                    });
                }
            });
        }
    }

    function addImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 is added due to some padding at the top
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).height(spaceDivHeight);
                            $("#bottomImgSpacerProdId" + prodId).height(spaceDivHeight);
                        }
                    });
                }
            });
        }
    }

    // This function builds the product rows
    // as they're described in the hidden products_json_hidden
    // form element (value() field).
    function buildAllProductRows() {
        // Parse the JSON (to add a new prod (which matches filter options))
        var products_json = JSON.parse($("#products_json_hidden").val());

        // Replace existing products and keep track of our position
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // This will be used for tracking position
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            $(selector).children().each(function (i) {
                var product_element = $(this);

                if ($("#products_json_hidden").val() != "[]") {
                    // Parse the JSON (to add a new prod (which matches filter options))
                    var products_json = JSON.parse($("#products_json_hidden").val());

                    // Generate/Save html to replace what we just faded/removed
                    var new_prod_element = getZerothJSONProductHTML();

                    // Replace the element we're on with
                    product_element.replaceWith(new_prod_element);

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);

                    rowCol[1]++;
                }
            });

            // Check if we need to adjust/increment column/row
            if (rowCol[1] > 2) {
                //reset rowCol (since there's only to be three products per row)
                rowCol[1] = 0;
                rowCol[0]++;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }

        // If the filter the user chose returns more than was previously there, then we need to continue adding
        if ($("#products_json_hidden").val() != "[]") {
            // Parse the JSON (to add a new prod (which matches filter options))
            var products_json = JSON.parse($("#products_json_hidden").val());

            while ($("#products_json_hidden").val() != "[]") {
                // First ensure a row exists for the item to be put into
                // And that we're not trying to add a 4th column
                if (!!$("#row" + rowCol[0]) && rowCol[1] <= 2) {
                    // Append the product
                    $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement below

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);
                }
                else if (rowCol[1] > 2) {
                    //reset rowCol (since there's only to be three products per row)
                    rowCol[1] = 0;
                    rowCol[0]++;
                }
                // Need to create the row to put the product into
                else {
                    //alert("getting here...");
                    //Check if there are any previous rows to append to
                    var rowOneBack = rowCol[0]--;
                    if (!!$("#row" + rowOneBack)) {
                        $("#row" + rowOneBack).append("</div> <div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());
                    }
                    // There are no rows. Need to create from scratch. None to append to
                    else {
                        // Need to create new row
                        // Appending </div><[new row stuffs]> to end of existing existing row
                        $("#productColumn").append("<div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'></div>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                        // Drop 0th element from json text
                        products_json.splice(0, 1);
                        var products_json_str = JSON.stringify(products_json);
                        // push the json string to the hidden element for latter use
                        addHiddenInputElement("products_json_hidden", products_json_str);
                    }
                    // Increment rowCol
                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement above
                }
            }
        }
        else {
            removeRemainingProducts(rowCol[0], rowCol[1]);
        }
    }

    /*$(window).on("resize",function(){
            waitForFinalEvent(function() {
                setProductSectionContainerSize();
                alert("here....");
            },1000);
        });*/

    var waitForFinalEvent = (function () {
        var timers = {};
        return function (callback, ms, uniqueId) {
            if (!uniqueId) {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId]) {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    function enableFilters() {
        $(window).trigger('resize');
        // This will enable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', 1);
        $('#disableFilterDiv').remove();
        scaleAndShadowById("filterDiv", 400);
        setTimeout(function () {
            $('#filterDiv').removeClass("remove-shadow-size");
        }, 800);
    }

    // This is the main function for applying filter options
    // after the user modifies them. This function calls
    // the other needed function with the correct timing
    // between each one.
    function applyFilterOptions() {
        // Start by stopping any existing animation on the product column
        $("#productColumn").stop(true);
        // Add spacer to bottom. This gives the circle space to exist on the phone view
        $("#footerSpacer").addClass("space-150");
        // Apply the "Loading" circle to the screen
        var pos = $("#productColumn").position();
        var w = $("#productColumn").width();
        //alert(pos.top + "," + pos.left);
        $('<div id="loadingCircle" class="loader" style="display:none;position:absolute;top:' + (pos.top.toString()) + 'px;left:' + ((pos.left) + (w / 2) - 60).toString() + 'px;z-index:2;"></div>').insertAfter("#productColumn");
        $("#loadingCircle").fadeIn(1000);

        var productColHtml = "";

        // Get filters as list of arrays
        var filters = getFilterState();
        // Convert to string (for server side python/django function)
        filters_str = "";
        filters_str += "" + filters.images.toString();
        //filters_str+= ":-!" + filters.clothing.toString();
        filters_str += ":-!" + filters.products.toString();
        //filters_str+= ":-!" + filters.colors.toString();

        //alert(filters_str);

        // Debug Purposes
        //alert(filters.images + " - " + filters.clothing + " - " + filters.products + " - " + filters.colors);

        // This will disable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', .6);
        $('#filterDiv').append('<div id="disableFilterDiv" style="position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>');

        $.ajax({
            url: '/art/filter_request/',
            type: "POST",
            data: {filters: filters_str, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                //alert(response);
                console.log(response);
                // Save the response
                addHiddenInputElement("products_json_hidden", response);

                // Method TWO START
                ////////////////////////////////////////////////////////////////////////////////////////////////
                // Goal here is to collaps all rows and then expand all rows with new products showing
                ////////////////////////////////////////////////////////////////////////////////////////////////
                //collapseAllProductRows();

                // Set hidden element that dictates whether or not we got products back to show
                if ($("#products_json_hidden").val() == "[]") {
                    addHiddenInputElement("productsStatus", "none");
                }
                else {
                    addHiddenInputElement("productsStatus", "some");
                }

                // Start by just fading away the entire product column/rows element
                // This way we can do whatever with the rows/product elements on the inside and then fade it back in
                $("#productColumn").animate({
                    opacity: 0
                }, 500);

                setTimeout(function () {
                    $("#productColumn").slideUp(500);
                    // Build product rows (while the column is opacity 0)
                    setTimeout(function () {
                        buildAllProductRows();
                        initializeProductRows();
                        // If after filtering we're not showing all rows,
                        // then get the "Load More" button there and ready.
                        if (existsHiddenProdRows()) {
                            if (existsHiddenProdRows()) {
                                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info" +
                                    " btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>" +
                                    "Load more...</button></div>";
                                $('#loadMoreCol').replaceWith(loadMoreHtml);
                                // Fade in new instance of button
                                $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                                $('#loadMore').morphingButton();
                            } else {
                                $('#loadMoreCol').animate({
                                    height: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                            }
                        }
                        else {
                            $("#loadMoreCol").slideUp("slow");
                        }
                        setTimeout(function () {
                            loadMoreProductRows("expandThenFade", 500);
                            $("#loadingCircle").fadeOut(500);
                            // Remove spacer to bottom. This gives the circle space to exist on the phone view
                            setTimeout(function () {
                                enableFilters();
                                $("#footerSpacer").removeClass("space-150");
                            }, 500)
                        }, 100);
                    }, 1000);
                }, 1000);

                // Set needed rows to be "display:none;"

                /* ---------- Method ONE START ----------
                    //////////////////////////////////////////////////////////////
                    //(this got complicated fast so I'm trying a different method
                    //////////////////////////////////////////////////////////////
                    // Loop through rows/products and remove if not found in
                    // the list that we just got from the server
                    var rowNum = 0;
                    // Set initial element id to begin at
                    var id     = 'row' + rowNum;
                    var rowCol = [0,0];
                    // Check if there even is a row (there should/will be unless the user
                    // previously filtered to something with zero results
                    // TODO: Handle this event... (see statement above)
                    var hasNextRow = !!document.getElementById(id);
                    while(hasNextRow){
                        rowCol[1] = 0;
                        // jquery selector
                        var selector = '#' + id;
                        // get row element
                        var row = $(selector);

                        var prodIdCounter = 0;
                        // Loop over each product element and check if it should be there
                        $(selector).children().each(function(i) {
                            //alert("On Row " + selector + " Child " + $(this).attr("data-id"));
                            var products_json = JSON.parse($("#products_json_hidden").val());
                            //Debug purposes
                            //alert($(this).attr("name") + $(this).attr("data-product_type"));

                            // Determine if this particular product should be shown
                            // (based on new filter settings)
                            var i = 0;
                            var existsInFilteredProdList = false;
                            for(i = 0; i < products_json.length; i++){
                                // Debug - Output ID we're checking against
                                //alert(products_json[i][0]);
                                if(products_json[i][0] == $(this).attr("data-id")){
                                    existsInFilteredProdList = true;
                                    break;
                                }
                            }
                            // DEBUG OUTPUT...
                            //alert(existsInFilteredProdList);

                            var product_element = $(this);
                            // If it's not in the filters product list, then fade it away and fade
                            // something else in
                            if(!existsInFilteredProdList){
                                product_element.animate({
                                    width: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                                setTimeout(function(){
                                    // If there exists some in the list to show
                                    if($("#products_json_hidden").val() != "[]") {
                                        // Parse the JSON (to add a new prod (which matches filter options))
                                        var products_json =  JSON.parse($("#products_json_hidden").val());
                                        // If this product isn't already listed
                                        if(!!$("[data-id=" + products_json[0][0] + "]")) {
                                            // Generate/Save html to replace what we just faded/removed
                                            var date = Date.now();
                                            var new_prod_element = "" +
                                                "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
                                                " data-image='" + products_json[0][4] + "' data-colors='' style='display:none'" +
                                                "data-product_type='" + products_json[0][3] + "'>" +
                                                "   <div class='card card-product card-plain'>" +
                                                "       <div class='image'>" +
                                                "           <a href='#'>" +
                                                "               <img src='/" + products_json[0][4] + "' alt='...'/>" +
                                                "           </a>" +
                                                "       </div>" +
                                                "       <div class='content'>" +
                                                "           <a href='#'>" +
                                                "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
                                                "           </a>" +
                                                "           <p class='description'>" +
                                                products_json[0][2] +
                                                "           </p>" +
                                                "           <div class='footer'>" +
                                                "               <span class='price'> TODO </span>" +
                                                "               <button class='btn btn-danger btn-simple pull-right' rel='tooltip' title='Remove from wishlist' data-placement='left'>" +
                                                "                   <i class='fa fa-heart'></i>" +
                                                "               </button>" +
                                                "           </div>" +
                                                "       </div>" +
                                                "   </div> <!-- end card -->" +
                                                "</div>";
                                            // Replace the element we're on with
                                            product_element.replaceWith(new_prod_element);

                                            // Fade/Expand it in.
                                            $("#prod" + products_json[0][0] + "-" + date).animate({
                                                width: "toggle",
                                                opacity: "toggle"
                                            }, 1000);
                                        }

                                        // We should have just taken the 0th item in the json list/array and
                                        // put it on the web page (if it wasn't already there)

                                        // Get json string (hidden element vlaue) as json object
                                        var products_json = JSON.parse($("#products_json_hidden").val());

                                        // Drop 0th element from json text
                                        products_json.splice(0,1);
                                        var products_json_str = JSON.stringify(products_json);
                                        // push the json string to the hidden element for latter use
                                        addHiddenInputElement("products_json_hidden", products_json_str);
                                    }
                                },1000);
                            }
                            else{
                                // There's nothing to do here because it should stay right where it is.
                            }

                            rowCol[1]++;
                        });

                        // Increment row num (to check for) and count
                        rowNum++;
                        // Set new id (to row after one we just hid)
                        id = 'row' + rowNum;
                        // Check if new/next row exists
                        hasNextRow = !!document.getElementById(id);

                        // Increment rowCol
                        rowCol[0]++;
                    }
                    -------- End Method ONE -------*/

                //alert(rowCol[0] + "," + rowCol[1]);
                // Anything remaining in the products_json (results of filter) needs to be added

            },
            error: function () {
                alert("Error...");
            }
        });
    }

    $('#checkoutEmailHref').on("click", function () {
        $('#checkoutModalBackBtn').hide();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutShippingHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutPaymentHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').hide();
        $('#checkoutModalPayBtn').show();
    });

    // When "Next" button is clicked on the checkout modal
    $("#checkoutModalNextBtn").on("click", function () {
        // For each child li of the nav pills (in the checkout modal)
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutPaymentHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
        });
    });

    $("#checkoutModalBackBtn").on("click", function () {
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutEmailHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
        });
    });

    $(document).ready(function () {
        {#$icon = $addon.find('span'),#}
        {#$addon = $group.find('.input-group-addon'),#}
        {#$addon.removeClass('success');#}
        {#$addon.addClass('danger');#}
        {#$icon.attr('class', 'fas fa-times-circle');#}

        var email = document.getElementById("email_input");

        $('.form-control').keyup(function () {
            if ($.trim($('.form-control').val()).length) {
                $(this).addClass('sq-input--focus');
                $(this).removeClass('sq-input--error');
                {#$(this).removeClass('sq-input--focus');#}
            } else {
                $(this).removeClass('active-text');
            }
        });

        /*
        $('.input-group input[required]').on('keyup change', function () {
            var $form = $(this).closest('form'),
                $group = $(this).closest('.input-group'),
                $addon = $group.find('.input-group-addon'),
                $icon = $addon.find('span'),
                state = false;

            if (!$group.data('validate')) {
                state = $(this).val() ? true : false;
            } else if ($group.data('validate') == "email") {
                state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
            }


            if (state) {
                document.getElementById("disabledButtonWrapper").title = "";
                $addon.removeClass('danger');
                $addon.addClass('success');
                $icon.attr('class', 'fas fa-check-circle');
            } else {
                document.getElementById("disabledButtonWrapper").title = "Email is Invalid";
                $addon.removeClass('success');
                $addon.addClass('danger');
                $icon.attr('class', 'fas fa-times-circle');
            }

            if ($form.find('.input-group-addon.danger').length == 0) {
                $form.find('[type="submit"]').prop('disabled', false);
            } else {
                $form.find('[type="submit"]').prop('disabled', true);
            }
        });

        $('.input-group input[required], .input-group textarea[required], .input-group select[required]').trigger('change');
        */

    });

    var sendEmailBtn = document.getElementById("sendEmail");
    var contactModal = document.getElementById('contactModal');

    sendEmailBtn.onclick = function () {
        var _name = document.getElementById("contactorName").value;
        var _email = document.getElementById("contactorEmail").value;
        var _phone = document.getElementById("contactorPhone").value;
        var _message = document.getElementById("contactorMessage").value;

        // Close and clear the contact modal
        $('#contactModal').modal('hide');
        $('#contactorName').val('');
        $('#contactorEmail').val('');
        $('#contactorPhone').val('');
        $('#contactorMessage').val('');

        $.ajax({
            url: '/art/contact_us_email/',
            type: "POST",
            data: {
                name: _name,
                email: _email,
                phone_number: _phone,
                message: _message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // TODO: It's possible that we get a successful response even though we didn't send the email.
                // TODO-cont: In view should put specific thing in there. If not found (here) then consider it
                // TODO-cont: failed. Otherwise if we find specific string, success.
                //console.log(response);
                // Configure Notification
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["success"]("Your message to the Ludega Team was sent successfully. Thanks!", "Success");
            },
            error: function () {
                // Configure Notification
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "0",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut",
                    "tapToDismiss": false
                };
                toastr["error"]("Woh, we're sorry but we seem to have hit a snag on our end. Please reach out to us directly at ludega.team@ludega.com or call us 24/7 at (720) 288-0674.", "Error");
            }
        });
    };

    function attemptCheckout(event) {
        // Email Field (checkout "form")validation
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!emailReg.test($('#email_input').val())) {
            $('#email_input').addClass('sq-input--error');
            $('#checkoutEmailHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]("Invalid Email");

            return;
        }

        // Shipping Info Validation
        var fname = document.getElementById("firstName_input");
        var lname = document.getElementById("lastName_input");
        var add1 = document.getElementById("address_input");
        var city = document.getElementById("city_input");
        var state = document.getElementById("state_input");
        var zip = document.getElementById("zip_input_shipping");
        var country = document.getElementById("country_input");

        var shipping_info_errors_found = false;
        var errorMsg = "";

        if (fname.value == "") {
            // fname.addClass("sq-input--error");
            fname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "First name required<br>";
        }
        if (lname.value == "") {
            // fname.addClass("sq-input--error");
            lname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Last name required<br>";
        }
        if (add1.value == "") {
            // fname.addClass("sq-input--error");
            add1.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Address required<br>";
        }
        if (city.value == "") {
            // fname.addClass("sq-input--error");
            city.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "City required<br>";
        }
        if (state.value == "") {
            // fname.addClass("sq-input--error");
            state.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "State required<br>";
        }
        if (zip.value == "") {
            // fname.addClass("sq-input--error");
            zip.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Zip Code required<br>";
        }
        if (country.value == "") {
            // fname.addClass("sq-input--error");
            country.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Country required<br>";
        }

        if (shipping_info_errors_found) {
            // Take user to shipping section of form
            $('#checkoutShippingHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"](errorMsg);
            return;
        }

        // If we're here, all our validation passed.
        // Note: Square takes care of validating card info, so it's still possible that errors come back (during card
        // nonce request / after.
        if (!requestCardNonce(event)) {
            // TODO: Error. What should we do here and when will/should false be returned?
        }
    }
</script>
<!-- If you are using TypeKit.com uncomment this code -->
<!--
        <script src="https://use.typekit.net/[your kit code here].js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        -->
<!-- If you have retina @2x images on your server which can be sent to iPhone/iPad/MacRetina, please uncomment the next line -->
<!-- <script src="assets/js/retina.min.js"></script> -->
<!-- This ensures that when the modal opens, it won't scroll the background of up -->
</html>
<!doctype html>
{% load staticfiles %}
{% load ludega_art_filters %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Ludega</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="96x96" href="{% static "ludega_art/img/favicon.png" %}">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="{% static "ludega_art/css/material-kit.css" %}" rel="stylesheet"/>-->
    <link href="{% static "ludega_art/css/bootstrap.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/gsdk.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/examples.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.css" %}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <!-- link to the SqPaymentForm library -->
    <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- link to the local SqPaymentForm initialization -->
    <script src="{% static 'ludega_art/js/sqpaymentform.js' %}" type="text/javascript"></script>

    <!-- link to the custom styles for SqPaymentForm -->
    <link href="{% static "ludega_art/css/sqpaymentform.css" %}" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="{% static "ludega_art/css/pe-icon-7-stroke.css" %}" rel="stylesheet" />-->
    <style>
        .input-group-addon.primary {
            color: rgb(255, 255, 255);
            background-color: rgb(50, 118, 177);
            border-color: rgb(40, 94, 142);
        }

        .input-group-addon.success {
            color: rgb(255, 255, 255);
            background-color: rgb(92, 184, 92);
            border-color: rgb(76, 174, 76);
        }

        .input-group-addon.info {
            color: rgb(255, 255, 255);
            background-color: rgb(57, 179, 215);
            border-color: rgb(38, 154, 188);
        }

        .input-group-addon.warning {
            color: rgb(255, 255, 255);
            background-color: rgb(240, 173, 78);
            border-color: rgb(238, 162, 54);
        }

        .input-group-addon.danger {
            color: rgb(255, 255, 255);
            background-color: rgb(217, 83, 79);
            border-color: rgb(212, 63, 58);
        }
    </style>
</head>
<body class="ecommerce">
<nav id="navBar1337" class="navbar navbar-transparent navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button id="menu-toggle" type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar bar1"></span>
                <span class="icon-bar bar2"></span>
                <span class="icon-bar bar3"></span>
            </button>
            <!--<a class="navbar-brand" href="http://ludega.com"><i class="fa fa-chevron-left"></i> Back to Kit</a>-->
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                {#                <li>#}
                {#                    <a href="#">#}
                {#                        About LudegaArt#}
                {#                        <!--<b class="caret"></b>-->#}
                {#                    </a>#}
                {#                </li>#}
                <li>
                    <a href="" data-toggle="modal" data-target="#contactModal">
                        Contact Us
                        <!--<b class="caret"></b>-->
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        More
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-with-icons">
                        <!--<li>
                                    <a href="contact-us.html">
                                    <i class="pe-7s-mail-open-file"></i> Contact Us
                                    </a>
                                </li>
                                <li>
                                    <a href="about-us.html">
                                    <i class="pe-7s-info"></i> Blog Page
                                    </a>
                                </li>
                                <li>
                                    <a href="pricing.html">
                                    <i class="pe-7s-cash"></i> Pricing Page
                                    </a>
                                </li>-->
                        <li>
                            <a href="http://ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega
                            </a>
                        </li>
                        <li>
                            <a href="http://brokerage.ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Brokerage
                            </a>
                        </li>
                        <li>
                            <a href="http://104.131.86.135/" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Window Cleaning
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a id="cartBtn" href="#" class="btn btn-round btn-default cartBtn">Cart ({{ cart_count }} Items)</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<div class="wrapper">
    <div class="img-wrapper">
        <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/banner2.png' %}">
    </div>

    <!--<div class="parallax filter-black">
        <div class="parallax-image">
            <div class="col-sm-12 col-md-12 col-lg-12" style="padding-left: 0px; padding-right: 0px;">
                <img id="titleImage" src="{% static 'ludega_art/img/header.jpg' %}" alt="..." style="height: 100%; width:100%;"/>
            </div>
        </div>
        <br><br><br><br>
        <div class="small-info">
            {#            <h1 style="font-family:longtime">Ludega</h1>#}
            {#            <h3 style="font-family:longtime">Ludega Merch</h3>#}
        </div>
    </div>-->
    <!--<div class="section">
                <div class="container">
                    <h2 class="section-title">Special Offers</h2>
                    {% if top_products_list %}
                    <div id="mainContentRow" class="row">
                        {% for product in top_products_list %}
                        <div class="col-md-4">
                            <div class="card card-product card-plain">
                                <div class="image">
                                    <a>
                                    <img src="/{{product.image_file}}"  alt="..."/>
                                    </a>
                                </div>
                                <div class="content">
                                    <a href="#">
                                        <h4 class="title">{{product.name}}</h4>
                                    </a>
                                    <div class="footer">
                                        <span class="price price-old"> &dollar;1,930</span>
                                        <span class="price price-new">&dollar;1,330</span>
                                        <button class="btn btn-danger btn-simple pull-right" rel="tooltip" title="Remove from wishlist" data-placement="left">
                                        <i class="fa fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>-->
    <!-- section -->
    <div id="cartSection" class="section" style="display:none;">
        <div id="cartContainer" class="container my-card-dark">
            <button type="button" style="margin-top:15px;" id="closeCartBtn" class="close" aria-hidden="true">×</button>
            <h2 id="shoppingCartTitle" class="section-title">Your Shopping Cart</h2>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <!-- nesting -->
                        <div id="cartMainProdRow" class="row">
                            <!-- Cart Items will go here...-->
                        </div>
                        <div class="row" style="height:15px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <button id="cartContinueShoppingBtn" class="btn btn btn-success btn-block"
                                            style="margin-bottom:10px;">Continue Shopping
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button id="checkOut1" class="btn btn-info btn-block" style="margin-bottom:10px;"
                                            data-toggle="modal"
                                            onclick="initialize_checkout_modal()">Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="height:15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mainProductSection" class="section">
        <div id="productSectionContainer" class="container" style="max-width:100%;">
            <h2 class="section-title">Find what you need</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="filterDiv" class="card card-refine">
                        <!-- card-plain for no border -->
                        <div class="header">
                            <h4 class="title">Refine
                                <!--<button class="btn btn-default btn-xs btn pull-right btn-simple" rel="tooltip" title="Reset Filter">
                                    <i id="refreshFilterBtn" class="fa fa-refresh"></i>
                                </button>-->
                            </h4>
                        </div>
                        <div class="content">
                            <div class="panel-group" id="accordion">
                                <!-- Commenting out this dollar range section for now -->
                                <!--
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                <h6 class="panel-title">
                                                  <a data-toggle="collapse" href="#refinePrice">
                                                    Price Range
                                                    <i class="fa fa-caret-up pull-right"></i>
                                                  </a>
                                                </h6>
                                              </div>
                                              <div id="refinePrice" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                   <span class="price price-left">&dollar; 100</span>
                                                   <span class="price price-right">&dollar; 850</span>
                                                   <div class="clearfix"></div>
                                                   <div id="refine-price-range" class="slider slider-info"></div>
                                                </div>
                                              </div>
                                            </div>
                                            -->
                                {#                                <div class="panel panel-default">#}
                                {#                                    <div class="panel-heading">#}
                                {#                                        <h6 class="panel-title">#}
                                {#                                            <a data-toggle="collapse" href="#refineImage" class="collapsed">#}
                                {#                                                Images#}
                                {#                                                <i class="fa fa-caret-up pull-right"></i>#}
                                {#                                            </a>#}
                                {#                                        </h6>#}
                                {#                                    </div>#}
                                {#                                    <div id="refineImage" class="panel-collapse collapse">#}
                                {#                                        <div class="panel-body">#}
                                {#                                            <label class="checkbox">#}
                                {#                                                <input type="checkbox" id="AllImagesCheckBox" value=""#}
                                {#                                                       data-toggle="checkbox" checked="">#}
                                {#                                                All#}
                                {#                                            </label>#}
                                {#                                            {% if images %}#}
                                {#                                                {% for image in images %}#}
                                {#                                                    <label class="checkbox">#}
                                {#                                                        <input type="checkbox"#}
                                {#                                                               id="{{ image.name|str_replace:' ,' }}CheckBox" value=""#}
                                {#                                                               data-toggle="checkbox">#}
                                {#                                                        {{ image.name }}#}
                                {#                                                    </label>#}
                                {#                                                {% endfor %}#}
                                {#                                            {% endif %}#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineClothing" class="collapsed">
                                                  Clothing
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineClothing" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                <label class="checkbox">
                                                  <input type="checkbox" id="AllClothingCheckBox" value="" data-toggle="checkbox" checked="">
                                                  All
                                                </label>
                                                {% if types %}
                                                    {% for type in types %}
                                                        {% if type.is_clothing %}
                                                          <label class="checkbox">
                                                            <input type="checkbox" id="
                                    {{type.display_name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                            {{type.display_name}}
                                                          </label>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                              </div>
                                            </div>
                                            </div> -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            <a data-toggle="collapse" href="#refineProduct" class="collapsed">
                                                Products
                                                <i class="fa fa-caret-up pull-right"></i>
                                            </a>
                                        </h6>
                                    </div>
                                    <div id="refineProduct" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label class="checkbox">
                                                <input type="checkbox" id="AllProductsCheckBox" value=""
                                                       data-toggle="checkbox" checked="">
                                                All
                                            </label>
                                            {% if types %}
                                                {% for type in types %}
                                                    {% if not type.sub_type_only %}
                                                        <label class="checkbox">
                                                            <input type="checkbox"
                                                                   id="{{ type.display_name|str_replace:' ,' }}CheckBox"
                                                                   value="" data-toggle="checkbox">
                                                            {{ type.display_name }}
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineColor" class="collapsed">
                                                  Colors
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineColor" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                 <label class="checkbox">
                                                    <input type="checkbox" id="AllColorsCheckBox" value="" data-toggle="checkbox" checked="">
                                                    All
                                                  </label>
                                                  {% if colors %}
                                                      {% for color in colors %}
                                                        <label class="checkbox">
                                                          <input type="checkbox" id="{{color.name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                          {{color.name}}
                                                        </label>
                                                      {% endfor %}
                                                  {% endif %}
                                              </div>
                                            </div>
                                            </div> <!-- end panel -->
                            </div>
                        </div>
                    </div>
                    <!-- end card -->
                </div>
                <div class="col-md-9" id="productColumn">
                    <div class="row" id="row0">
                        {% if products %}
                            {% for product in products %}
                                {% if product.display %}
                                    <div class="col-sm-4"
                                         data-id="{{ product.id }}"
                                         data-image="{{ product.image_file }}"
                                            {% with colors_=product.colors.all %}
                                         data-colors="
                                    {% for color in colors_ %}
                                    {{ color }},
                                    {% endfor %}"
                                         data-product_type="{{ product.product_type.display_name }}"
                                         data-is_clothing="{{ product.product_type.is_clothing }}"
                                                >
                                            {% endwith %}
                                    <div data-toggle="modal" onmouseover="prodHover({{ product.id }})"
                                         data-id="{{ product.id }}" data-target="#prodModal"
                                         class="fake-link card card-product card-plain my-card-light"
                                         id="prod{{ product.id }}">
                                        <div style="overflow:visible;padding-top:10px;" class="image text-center">
                                            <div id="topImgSpacerProdId{{ product.id }}"
                                                 style="overflow:visible;height:0px"
                                                 ;></div>
                                            <a>
                                                <img id="imgProdId{{ product.id }}" class="my-img-dark"
                                                     style="max-width:90%;max-height:300px;height:auto;width:auto;"
                                                     src="/{{ product.image_file }}" alt="..."/>
                                            </a>
                                            <div id="bottomImgSpacerProdId{{ product.id }}" style="height:0px" ;></div>
                                        </div>
                                        <div class="content text-center">
                                            <span>
                                                <a>
                                                    <h4 class="title">{{ product.name }}</h4>
                                                </a>
                                            </span>
                                            <!--<p class="description">
                                                {{product.description}}
                                                </p>-->
                                            <div class="footer">
                                                <span class="price"> {{ product.id|get_price_str }}</span>
                                                <button onclick="filterBtnOnClick('{{ product.product_type }}')"
                                                        class="btn btn-danger btn-tooltip btn-simple pull-right"
                                                        rel="tooltip" title="Filter to {{ product.product_type }}"
                                                        data-placement="top">
                                                    <!--<i style="align-self:right;" class="fa fa-filter"></i>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end card -->
                                    </div>
                                    <!-- Each row should only contain 3 products -->
                                    {% if forloop.counter|divisibleby:3 == True %}
                                        <!-- End the previous <div class="row">  -->
                                        </div>
                                        <!-- Determine the row id (which is "row" + rowNum)                -->
                                        {% with rowCount=forloop.counter|divnum:3 %}
                                            {% with rowid="row"|addstr:rowCount %}
                                                <div class="row" id="{{ rowid }}">
                                            {% endwith %} <!-- Ending "with rowCount=forloop.counter|divnum:3" -->
                                        {% endwith %} <!-- Ending "with rowid="row"|addstr:rowCount"       -->
                                    {% endif %}
                                {% endif %}
                            {% endfor %} <!-- Ending "for product in products" -->
                        {% endif %}  <!-- Ending "if products"             -->
                        </div>
                    <div class="space-50"></div>
                    <div class="col-md-3 col-md-offset-4" id="loadMoreCol">
                        <button rel="tooltip" title="" style="margin-bottom:1px;" class="btn btn-info btn-round"
                                id="loadMore" data-toggle="morphing" data-rotation-color="blue">Load more...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- section -->
<div id="footerSpacer" class="space-50"></div>
<div class="subscribe-line subscribe-line-transparent"
     style="background-image: url('{% static 'ludega_art/img/merch7.png' %}')">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <form class="">
                    <div class="form-group">
                        <input type="text" value="" class="form-control" placeholder="Enter your email here...">
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-info btn-fill btn-block">Subscribe Now!</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer footer-big footer-default">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="id">Bahasa Indonesia</option>
                        <option value="ms">Bahasa Melayu</option>
                        <option value="ca">Català</option>
                        <option value="da">Dansk</option>
                        <option value="de">Deutsch</option>
                        <option value="en" selected="">English</option>
                        <option value="es">Español</option>
                        <option value="el">Eλληνικά</option>
                        <option value="fr">Français</option>
                        <option value="it">Italiano</option>
                        <option value="hu">Magyar</option>
                        <option value="nl">Nederlands</option>
                        <option value="no">Norsk</option>
                        <option value="pl">Polski</option>
                        <option value="pt">Português</option>
                        <option value="fi">Suomi</option>
                        <option value="sv">Svenska</option>
                        <option value="tr">Türkçe</option>
                        <option value="is">Íslenska</option>
                        <option value="cs">Čeština</option>
                        <option value="ru">Русский</option>
                        <option value="th">ภาษาไทย</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="ARS">ARS</option>
                        <option value="AUD">AUD</option>
                        <option value="BRL">BRL</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="CZK">CZK</option>
                        <option value="DKK">DKK</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="HKD">HKD</option>
                        <option value="HUF">HUF</option>
                        <option value="IDR">IDR</option>
                        <option value="ILS">ILS</option>
                        <option value="INR">INR</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                        <option value="MYR">MYR</option>
                        <option value="MXN">MXN</option>
                        <option value="NOK">NOK</option>
                        <option value="NZD">NZD</option>
                        <option value="PHP">PHP</option>
                        <option value="PLN">PLN</option>
                        <option value="RUB">RUB</option>
                        <option value="SEK">SEK</option>
                        <option value="SGD">SGD</option>
                        <option value="TWD">TWD</option>
                        <option value="USD" selected="">USD</option>
                        <option value="VND">VND</option>
                        <option value="ZAR">ZAR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-1">
                <h5 class="title">Company</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Our Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                About Us
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3 col-md-offset-1">
                <h5 class="title"> Help and Support</h5>
                <nav>
                    <ul>
                        <li>
                            <a data-toggle="modal" data-target="#contactModal">
                                Contact Us
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Terms & Conditions
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Money Back
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3">
                <h5 class="title">Latest News</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i> <b>We're Live!</b>
                                Ludega Merch is now live, feel free to place an order.
                                <hr class="hr-small">
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i>
                                <b>New merchandise!</b> New merch has been added, check out some of the new inventory.
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr/>
        <div class="social-area text-center">
            <h5>Join us on</h5>
            <a href="https://www.facebook.com/ludega.merch.3" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-facebook"></i>
            </a>
            <a href="https://mobile.twitter.com/LudegaMerch" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-twitter"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-google-plus"></i>#}
{#            </a>#}
            <a href="https://www.instagram.com/ludegamerch/" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-instagram"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-linkedin"></i>#}
{#            </a>#}
        </div>
        <div class="copyright">
            &copy; 2017 <a href="http://www.ludega.com">Ludega</a> - It Will Be.
        </div>
    </div>
</footer>
</div> <!-- wrapper -->

<div id="largeImgModal" class="img-modal">
    <!-- The Close Button -->
    <span class="my-close" onclick="document.getElementById('largeImgModal').style.display='none'">&times;</span>
    <!-- Modal Content (The Image) -->
    <img class="img-modal-content" id="largeImg" src="">
    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<!--<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true" style="display: none;">-->
<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <div class="modal-body">
                <!--<div class="container">-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="tab-content">
                            <div class="tab-pane active" id="product-page6">
                                <img class="my-prod-modal-img" onclick="increaseImgWithModal('123')" id="prodModalImage"
                                     style="-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-width:100%;max-height:500px;margin:auto;display:block;"
                                     src="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <a>
                                <h3 id="prodModalTitle" class="title"></h3>
                            </a>
                            <!--<p class="description">
                                        </p>-->
                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="descriptionHeading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleDescriptionHeader" class="collapsed">
                                            Product Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleDescriptionHeader" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="descriptionHeading" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdDescription">
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="typeDescriptionHeading">
                                    <h4 class="panel-title">
                                        <a id="collapsibleTypeDescriptionClickable" class="collapsed"
                                           data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleTypeDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleTypeDescriptionHeader">
                                            Type Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleTypeDescriptionHeader" class="panel-collapse collapse"
                                     role="tabpanel" aria-labelledby="typeDescriptionHeading" aria-expanded="false"
                                     style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdTypeDescription">
                                        <p>You haven't selected a Product Type yet.</p>
                                        <!--<ul style="padding-left: 20px;">
                                                    <li style="list-style-position: outside;"> Fits small to size</li>
                                                    <li style="list-style-position: outside;"> Model wears a UK 40R</li>
                                                    <li style="list-style-position: outside;"> Model measures: chest 39"/ 99cm, height 6'1"/ 185cm</li>
                                                </ul>-->
                                    </div>
                                </div>
                            </div>
                            <!--<div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                          <h4 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                              Details
                                            </a>
                                          </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false" style="height: 0px;">
                                          <div class="panel-body">
                                            85% wool, 15% linen. Dry-clean only
                                          </div>
                                        </div>
                                        </div>-->
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="headingFour">
                                    <h4 class="panel-title">
                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Returns
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="headingFour" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body">
                                        Here at Ludega Merch, we pride ourselves in having a friendly return policy.
                                        It's simple; if you're not 100% satisfied with your product, simply return it to
                                        us in the condition it was received and we'll refund or replace your order
                                        (shipping not included) and give you a 5% discount on your next purchase
                                        regardless of purchase amount.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Acordeon  -->
                        <div class="row align-items-center">
                            <div class="prod-options pull-down">
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodTypeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Type</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodSizeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Size</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12" id="priceDivCol" style="height:0px;opacity:0;">
                                    <a align="right">
                                        <h3 id="prodModalPrice" class="title">Select a Product Type and Size for
                                            Pricing!</h3>
                                    </a>
                                </div>
                                <div class="col-md-12" style="height:60px;">
                                    <div class="pull-right" style="margin-top:10px;">
                                        <button type="button" id="prodModalAddToCart" class="btn btn-fill">Add to Cart
                                        </button>
                                        <button type="button" id="prodModalBuyNow" class="btn btn-fill">Buy Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                       <div class="col-md-4"></div>
                       <div class="col-md-4 text-center"><a><h3 class="title">Similar Products</h3></a></div>
                       <div class="col-md-4"></div>
                   </div>
                  <div class="row">
                  <div class="col-md-12">
                   <div class="nbs-flexisel-container">
                           <div class="nbs-flexisel-inner">
                              <ul class="nav nav-text nbs-flexisel-ul" role="tablist" id="relatedProdsScroller" style="left: -113.75px;">
                              </ul>
                           </div>
                           <div class="nbs-flexisel-nav-left" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-left"></i></div>
                           <div class="nbs-flexisel-nav-right" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-right"></i></div>
                        </div>
                      </div>
                    </div>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
        <!--</div>-->
    </div>
</div>
</div>
<form id="hiddenForm"></form>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <!--<button type="button" id="contactModalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            <div class="modal-body">
                <div id="contactContainer" class="col-md-offset-1">
                    <h2 class="section-title">Send us a message</h2>
                </div>
                <div class="row">
                    <!--<div class="separator line-separator">♦</div>-->
                    <div id="contactContainer" class="col-md-6 col-md-offset-1">
                        </p>
                        <form role="form" id="contact-form" method="post" data-color="blue">
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your name (optional)</label>
                                <input id="contactorName" placeholder="First & Last Name" type="text" name="name"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Email address (optional)</label>
                                <input id="contactorEmail" placeholder="Your personal email" type="email" name="email"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Phone (optional)</label>
                                <input id="contactorPhone" placeholder="Phone Nmber" type="text" name="phone"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your message</label>
                                <textarea name="message" class="form-control" id="contactorMessage" rows="6"
                                          required></textarea>
                                <span class="material-input"></span></div>
                            <div id="contactButtonContainer" class="submit">
                                <input id="sendEmail" type="submit" class="btn btn-info btn-fill" value="Send Message">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4 col-md-offset-1">
                        <div class="contact-info">
                            <!--<h5><i class="fa fa-map-marker text-muted"></i> Address</h5>
                            <p class="text-muted"> Bld Mihail Kogalniceanu, nr. 8,<br>
                                7652 Bucharest,<br>
                                Romania
                            </p><br>-->
                            <h5><i class="fa fa-phone text-muted"></i> 24/7 Live Support</h5>
                            <p class="text-muted"> Customer Support<br>
                                (720) 288-0674<br>
                                Mon - Sun, 12:00AM -11:59PM
                            </p><br>
                            <h5><i class="fa fa-envelope text-muted"></i> Email Us</h5>
                            <p class="text-muted"> Ludega Merch LLC<br>
                                customer.support@ludega.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ageVerifictaionModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" )>
            <div class="img-wrapper">
                <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/merch7.png' %}">
            </div>
            <div class="modal-header" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Age Verification</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <h5 class="text-center">Are you old enough to purchase these products?</h5>
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title text-center">
                                <i class="fa fa-info-circle"></i>
                                <a data-toggle="collapse" href="#collapse1">Why are we asking?</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse">
                            <div class="panel-body">THIS WEBSITE CONTAINS ADULT MATERIAL AND IS ONLY SUITABLE FOR THOSE 18
                OR OLDER. ALL CUSTOMERS FROM ARIZONA, CALIFORNIA, ILLINOIS, KANSAS, MASSACHUSETTS,
                MISSISSIPPI, MISSOURI, NEW JERSEY, NEW YORK, & OHIO MUST BE 21 YEARS OR OLDER. BY ENTERING
                THIS SITE, YOU CONFIRM THAT YOU ARE OF LEGAL AGE TO PURCHASE THESE PRODUCTS IN YOUR STATE.
                WARNING: TOBACCO PRODUCTS CONTAIN NICOTINE, AND NICOTINE IS AN ADDICTIVE CHEMICAL.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class=" btn btn-primary btn-block" onclick="$('#ageVerifictaionModal').modal('hide');">
                                Yes
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="btn btn-danger btn-block" onclick="ageVerificationNoClicked()">
                                No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="checkoutModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Checkout As Guest</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <div class="row">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <ul id="checkoutNavPills" class="nav nav-pills" role="tablist"
                            style="justify-content:center;display:flex;">
                            <li id="checkoutEmailli" class="active">
                                <a id="checkoutEmailHref" href="#email" role="tab" data-toggle="tab"
                                   aria-expanded="true">
                                    Email
                                </a>
                            </li>
                            <li id="checkoutShippingli" class="">
                                <a id="checkoutShippingHref" href="#shipping" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Shipping Info
                                </a>
                            </li>
                            <li id="checkoutPaymentli" class="">
                                <a id="checkoutPaymentHref" href="#payment" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="email">
                        <div class="row" style="padding-top: 15px;">
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                            <div class="col-sm-10 col-md-10 col-lg-10">
                                <div class="form-group">
                                    <label for="validate-email">Email</label>
                                    <input type="email" class="form-control" id="email_input" placeholder="Email"
                                           required=""><br>
                                    <label for="validate-email">Additional Notes [optional]</label>
                                    <textarea class="form-control" rows="5" id="notes" placeholder="Color, size, flavor, or any other additional comments."></textarea>
                                </div>
                            </div>
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="shipping">
                        <div id="" class="" style="padding:15px;">
                            <div class="form-group">
                                <select class="form-control" id="shippingOptions">
                                    <option value="0" selected="">USPS Priority - $9.00</option>
                                    {#                                    <option value="1">Free Shipping [All orders over $100, abuse of this will void your order.]</option>#}
                                </select>
                            </div>
                            <div class="">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left">
                                    <label for="exampleInputEmail1">First Name</label>
                                    <input type="text" class="form-control" id="firstName_input"
                                           aria-describedby="emailHelp" placeholder="First Name" required="">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right">
                                    <label for="exampleInputEmail1">Last Name</label>
                                    <input type="text" class="form-control" id="lastName_input"
                                           aria-describedby="emailHelp" placeholder="Last Name" required="">
                                </div>
                                <br>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Address</label>
                                <input type="text" class="form-control" id="address_input" aria-describedby="emailHelp"
                                       placeholder="Address Line 1">
                            </div>
                            <div class="form-group shove-bot">
                                <input type="text" class="form-control" id="address_input2" aria-describedby="emailHelp"
                                       placeholder="Address Line 2 [Optional]">
                            </div>
                            <div class="form-group shove-left">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="city_input" aria-describedby="emailHelp"
                                           placeholder="City">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="state_input"
                                           aria-describedby="emailHelp" placeholder="State/Province/Region">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-left">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="number" class="form-control" id="zip_input_shipping"
                                           aria-describedby="emailHelp" onchange="checkDenverZipCode()"
                                           placeholder="Zip/Postal Code">
                                </div>
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-right">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="country_input"
                                           aria-describedby="emailHelp" placeholder="Country">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div id="shippingAlert" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="payment">
                        <div id="sq-ccbox">
                            <!--
                                You should replace the action attribute of the form with the path of
                                the URL you want to POST the nonce to (for example, "/process-card")
                            -->
                            <div class="row">
                                <div id="cc-form" class="col-sm-12 col-md-12 col-lg-12 pad-cc-info">

                                    <table>
                                        <tbody>
                                        <tr>
                                            <th class="pad-left">Card Number</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-card-number"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">CVV</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-cvv"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Expiration Date</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-expiration-date"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Postal Code</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-postal-code"></div>
                                            </td>
                                        </tr>

                                        </tbody>
                                    </table>
                                    <!--After a nonce is generated it will be assigned to this hidden input field.-->
                                    <input type="hidden" id="card-nonce" name="nonce">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                            <div id="totalCreditCardForm"
                                 class="totalCC col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"></div>
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalBackBtn" type="button" class="btn btn-info"
                                    style="justify-content:left;display:flex;">
                                <i class="fa fa-arrow-left" style="padding-top: 2px;"></i>
                                Back
                            </button>
                        </div>
                        <div id="" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>

                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalNextBtn" type="button" class="btn btn-info">
                                Next
                                <i class="fa fa-arrow-right"></i>
                            </button>
                            <button id="checkoutModalPayBtn" type="button" onclick="attemptCheckout(event)"
                                    class="btn btn-info">Confirm & Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header"></div>
            <div class="">

                <div class="row marketing">

                    <div class="col-lg-12">

                        <h4><b>Product Name</b></h4>
                        <hr/>

                        <div>
                            <h4>Success - your order is confirmed!</h4>
                            <h5>Order number:
                                <div id="orderNumber"> orderNumber</div>
                            </h5>
                            <hr/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">Shipping Address
                                    <ul class="list-group">
                                        <li class="list-group-item" id="orderName">firstName lastName</li>
                                        <li class="list-group-item" id="orderEmail">email</li>
                                        <li class="list-group-item" id="orderAddress">address</li>
                                        <li class="list-group-item" id="orderZip">state city zip</li>
                                        <li class="list-group-item" id="orderCountry">country</li>
                                    </ul>

                                </div>
                                <div class="col-xs-6 text-right">
                                    <h1><span class="glyphicon glyphicon glyphicon-cloud-download"
                                              aria-hidden="true"></span></h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <p><span class="glyphicon glyphicon glyphicon-question-sign"
                                             aria-hidden="true"></span>
                                        All Monthly and Quarterly subscription plans renew automatically on the 15th of
                                        the month.</p>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed">
                                            <thead>
                                            <tr>
                                                <td><strong>Product Name</strong></td>
                                                <td class="text-right"><strong>Product Options</strong></td>
                                                <td class="text-right"><strong>Subscription Type</strong></td>
                                                <td class="text-right"><strong>Price</strong></td>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                            <tr>
                                                <td>Veganboxen</td>
                                                <td class="text-right">Variable #1</td>
                                                <td class="text-right">Monthly</td>
                                                <td class="text-right">189 SEK</td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-right"><strong>VAT - 12%</strong></td>
                                                <td class="thick-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Shipping</strong></td>
                                                <td class="no-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Total</strong></td>
                                                <td class="no-line text-right">189 SEK</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div> <!-- /container -->
        </div>
    </div>
</div>

</body>

<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>
<!--  jQuery and Bootstrap core files    -->
<script src="{% static 'ludega_art/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/jquery-ui.custom.min.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/bootstrap.min.js' %}" type="text/javascript"></script>
<!--  Plugins -->
<script src="{% static 'ludega_art/js/gsdk-checkbox.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-morphing.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-radio.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-bootstrapswitch.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-select.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'ludega_art/js/chartist.min.js' %}"></script>
<script src="{% static 'ludega_art/js/jquery.tagsinput.js' %}"></script>
<script src="{% static 'ludega_glass/js/toastr.min.js' %}"></script>
<script src="{% static 'ludega_art/js/visible.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
<!--  Get Shit Done Kit PRO Core javascript 	 -->
<script src="{% static 'ludega_art/js/get-shit-done.js' %}"></script>


<script type="text/javascript">

    var debug = true;
    var big_image;
    var transparent = true;
    var loadMoreColOrigHtml = "";


    // This function initializes listeners and calls initialization functions
    // TODO: Get all listeners to be called here.
    $().ready(function () {
        responsive = $(window).width();

        var show_age_verification_json_str = '{{ show_age_verification }}';
        var show_age_verification_json = JSON.parse(show_age_verification_json_str.replace(/&quot;/g,"\""));
        if(show_age_verification_json["show_age_verification"] == "true") {
            $("#ageVerifictaionModal").modal({backdrop: 'static', keyboard: false});
        }
        else{
            // No need to display the age verification
        }


        $(window).on('scroll', checkScroll);

        if (responsive >= 768) {
            big_image = $('.parallax-image').find('img');

            $(window).on('scroll', function () {
                parallax();
                checkScroll();
            });
        }

        //This ensures that if the user tries to scroll while we're doing some fancy scrolling of our own, it will get canceled
        $('html, body').on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
            $('html, body').stop();
        });


        initializeProductRows();
        loadMoreColOrigHtml = $("#loadMoreCol").html();
        setLoadMoreClickFunc();
        //applyFilterOptions();
        refreshCartBtn();
        initializeCheckBoxListeners();
        // There are two cart btns due to sizing of screen. We don't want to apply
        // the listener until document is ready. Otherwise we may not get the
        // listener to be applied to the "second" version of the btn.
        apply_cart_btn_listeners();
        // If the user refreshes the page while they're half way down,
        // then calling this will ensure we display the header bar correctly.
        checkScroll();
        setTimeout(function () {
            addAndAnimateImgSpacers();
        }, 500);
        setProductSectionContainerSize();

    });

    function ageVerificationNoClicked(){
        $.ajax({
            url: '/art/no_selected_on_age_verification/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                console.log("User indicated that they are not of age to purchases our products.")
            },
            error: function (response) {
                console.log("Error - Response was" + response);
            }
        });

        window.location.href='http://www.google.com';
    }

    function checkDenverZipCode() {

        var total = parseFloat((document.getElementById("cartTotal").innerHTML).replace('Total: $', ''))


        var shippingAlert = document.getElementById("shippingAlert");
        var myInput = parseInt(document.getElementById("zip_input_shipping").value);

        var denver_zip_codes = [80002, 80003, 80004, 80005, 80007, 80010, 80011, 80012, 80013, 80014, 80015, 80016, 80017,
            80018, 80019, 80020, 80021, 80022, 80023, 80024, 80030, 80031, 80033, 80045, 80101, 80102,
            80103, 80104, 80105, 80107, 80108, 80109, 80110, 80111, 80112, 80113, 80116, 80117, 80118,
            80120, 80121, 80122, 80123, 80124, 80125, 80126, 80127, 80128, 80129, 80130, 80131, 80134,
            80135, 80136, 80137, 80138, 80202, 80203, 80204, 80205, 80206, 80207, 80209, 80210, 80211,
            80212, 80214, 80215, 80216, 80218, 80219, 80220, 80221, 80222, 80223, 80224, 80226, 80227,
            80228, 80229, 80230, 80231, 80232, 80233, 80234, 80235, 80236, 80237, 80238, 80239, 80241,
            80246, 80247, 80249, 80260, 80264, 80290, 80293, 80294, 80401, 80403, 80419, 80420, 80421,
            80422, 80425, 80427, 80432, 80433, 80436, 80438, 80439, 80440, 80444, 80448, 80449, 80452,
            80453, 80454, 80456, 80457, 80465, 80470, 80475, 80476, 80601, 80602, 80640, 80820, 80827,
            80830, 80835];

        var check_for_denver_zip = denver_zip_codes.includes(myInput);

        if (check_for_denver_zip == true) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["success"]('You are eligible for free shipping!');
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + (total - 9.00).toFixed(2) + " [Free Shipping]";
        }
        else {
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + parseFloat(total).toFixed(2);
            document.getElementById("shippingAlert").innerHTML = "";
        }

    }

    function setProductSectionContainerSize() {
        //alert($(window).width());
        if ($(window).width() > 1400) {
            var pixels = $("#mainProductSection").width() * .75;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "80%");
            }, 500);
        }
        else {
            var pixels = $("#mainProductSection").width() * .9;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "90%");
            }, 500);
        }
    }

    function increaseImgWithModal(id) {
        // Get the modal
        var modal = document.getElementById('largeImgModal');

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("prodModalImage");
        var modalImg = document.getElementById("largeImg");
        var captionText = document.getElementById("caption");
        modal.style.display = "block";
        modalImg.src = img.src;
        captionText.innerHTML = img.alt;

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("my-close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };
    }

    function scaleAndShadowById(id, time) {
        $("#" + id).removeClass("remove-shadow-size");
        $("#" + id).addClass("add-shadow-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-shadow-size");
            $("#" + id).removeClass("add-shadow-size");
        }, time);
    }

    function scaleById(id, time) {
        $("#" + id).removeClass("remove-size");
        $("#" + id).addClass("add-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-size");
            $("#" + id).removeClass("add-size");
        }, time);
    }

    function refreshCartBtn() {
        $.ajax({
            url: '/art/get_cart_count/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                $(".cartBtn").each(function () {
                    $(this).text("Cart (" + response + " Items)");
                });
                //$("#cartBtn").text("Cart (" + response + " Items)");
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function clearCart() {
        $.ajax({
            url: '/art/clear_cart/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                if (!response === "{\"error\":\"\",\"message\":\"success\"}") {
                    console.log("ERROR - Failed to Clear Cart");
                    // TODO: Attempt to email support.ludega.com
                }
            },
            error: function () {
                console.log("ERROR - Failed to Clear Cart");
                // TODO: Attempt to email support.ludega.com
            }
        });
    }

    // This function is called via a "handler" in static/ludega_art/js/sqpaymentform.js
    function chargeCard(nonce) {

        // TODO: Send this json over the network and parse server side.
        var cart_json = $("#cart_info_json").val();
        var obj = JSON.parse(cart_json);

        number_of_keys = (Object.keys(obj).length) - 1;
        var i = 0;
        var prod_id_arr = [];
        var quantity_arr = [];
        var prod_type_arr = [];
        var prod_size_arr = [];

        for (i; i < number_of_keys; i++) {
            prod_id_arr[i] = obj[i]["prod_id"];
            quantity_arr[i] = obj[i]["quantity"];
            prod_type_arr[i] = obj[i]["type"];
            prod_size_arr[i] = obj[i]["size"];
        }

        console.log("DEBUG ON");
        console.log('Nonce: ' + nonce);
        console.log('prod_id_arr: ' + prod_id_arr);
        console.log('quantity_arr: ' + quantity_arr);
        console.log('prod_type_arr: ' + prod_type_arr);
        console.log('prod_size_arr: ' + prod_size_arr);
        console.log('Number of keys: ' + number_of_keys);
        console.log(document.getElementById("firstName_input").value);
        console.log(document.getElementById("lastName_input").value);
        console.log(document.getElementById("address_input").value);
        console.log(document.getElementById("city_input").value);
        console.log(document.getElementById("state_input").value);
        console.log(document.getElementById("zip_input_shipping").value);
        console.log(document.getElementById("notes").value);

        var e = document.getElementById("shippingOptions");
        var shipping_method = e.options[e.selectedIndex].value;
        console.log(shipping_method);

        $.ajax({
            url: '/art/submit_order_charge_card/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                nonce: nonce,
                prod_id_arr: prod_id_arr,
                quantity_arr: quantity_arr,
                prod_size_arr: prod_size_arr,
                prod_type_arr: prod_type_arr,
                number_of_keys: number_of_keys,
                email: document.getElementById("email_input").value,
                note: document.getElementById("notes").value,
                first_name: document.getElementById("firstName_input").value,
                last_name: document.getElementById("lastName_input").value,
                address1: document.getElementById("address_input").value,
                address2: document.getElementById("address_input2").value,
                city: document.getElementById("city_input").value,
                state: document.getElementById("state_input").value,
                zip: document.getElementById("zip_input_shipping").value,
                country: document.getElementById("country_input").value,
                shipping_method: shipping_method,
            },
            success: function (response) {

                var fName = document.getElementById("firstName_input").value
                var lName = document.getElementById("firstName_input").value


                if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date');
                    var element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV');
                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date / CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Expiration');

                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_CARD\', u\'detail\': u\'Invalid card number.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Credit Card Number');
                    var element = document.getElementById("sq-card-number");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'CARD_DECLINED\', u\'detail\': u\'Card declined.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Sorry, your card was declined.');
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'INVALID_REQUEST_ERROR\', u\'code\': u\'CARD_TOKEN_USED\', u\'detail\': u\'Card nonce already used; please request new nonce.\'}]}') {
                    // Somehow this nonce was already used. We need to re-request a nonce and try this whole process again.
                    console.log("Card nonce already used; please request new nonce and try to charge card again.")
                    //$("#checkoutModalPayBtn").trigger("click");
                }
                // THIS, hopefully, is where we get most of the time!
                else if (response.indexOf("order_confirmation_number") >= 0) {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]('Payment Recieved!');

                    // Clear cart since we just successfully bought everything in the cart
                    if (!clearCart()) {
                        console.log("CRITICAL ERROR - Failed to clear cart.");
                    }

                    console.log(response);
                    response_json = JSON.parse(response);
                    var confirmation_num = response_json["order_confirmation_number"];

                    // Now redirect page to confirmation page.
                    url = '/order_confirmation?order_id_hash=' + confirmation_num;
                    window.location.replace(url);

                }
                else {
                    console.log("CRITICAL ERROR - Got unexpected response from server.\nResponse was: " + response);
                    // TODO: Email software.support@ludega.com
                }
            },
            error: function (response) {
                alert("Failed: " + response.toString());
            }
        });
    }

    // This get's called upon "showing" of the checkout modal
    // Think of it as the "before showing, run this stuff" function
    function initialize_checkout_modal() {

        $('#checkoutEmailHref').trigger("click");

        $('#checkoutForm').trigger("reset");
        $("#email_input").removeClass("sq-input--focus");
        $("#email_valid_color").removeClass("success");
        $("#email_valid_color").addClass("danger");
        $("#email_valid_symbol").removeClass("fa-check-circle");
        $("#email_valid_symbol").addClass("fa-times-circle");

        $("#firstName_input").removeClass("sq-input--focus");
        $("#lastName_input").removeClass("sq-input--focus");
        $("#address_input").removeClass("sq-input--focus");
        $("#city_input").removeClass("sq-input--focus");
        $("#state_input").removeClass("sq-input--focus");
        $("#zip_input_shipping").removeClass("sq-input--focus");
        $("#country_input").removeClass("sq-input--focus");


        $('#cc-form').find('input:text').val('');
        $('#checkoutModal').modal('hide');
        $("#collapse2").removeClass("in");
        $("#collapse3").removeClass("in");
        try {
            var cart_empty = document.getElementById("noProdsInformDiv").innerHTML;

            if (cart_empty == "No Items In Cart") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-left",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "500",
                    "hideDuration": "1000",
                    "timeOut": "2000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["error"]('Your cart is empty. Please add an item to checkout.');
                return;
            }
            else {
                $("#checkoutModal").modal()
            }
        }
        catch (err) {
            $("#checkoutModal").modal()
        }


        {#document.getElementsByTagName('iframe')[0].src=document.getElementsByTagName('iframe')[0].src#}
        {#document.getElementsByTagName('iframe')[1].src=document.getElementsByTagName('iframe')[1].src#}
        {#document.getElementsByTagName('iframe')[2].src=document.getElementsByTagName('iframe')[2].src#}
        {#document.getElementsByTagName('iframe')[3].src=document.getElementsByTagName('iframe')[3].src#}


        {#document.getElementById('sq-card-number').src += '';#}


        {#var iframe = document.getElementById('sq-cvv');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#iframe.src = iframe.src;#}

        {#var iframe = document.getElementById('sq-card-number');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-cvv');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src#}
    }


    function scaleAndShadowByDataId(id, time) {
        //alert("here too...");
        $('*[data-id=' + id + ']').removeClass("remove-shadow-size");
        $('*[data-id=' + id + ']').addClass("add-shadow-size");
        setTimeout(function () {
            $('*[data-id=' + id + ']').addClass("remove-shadow-size");
            $('*[data-id=' + id + ']').removeClass("add-shadow-size");
        }, time);
    }

    // This function handles user clicks on "Continue Shopping" in the
    // cart section of the site
    $("#cartContinueShoppingBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        $("#cartContainer").hover(function (event) {
            event.preventDefault();
        });
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    $("#closeCartBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    // This function handles clicks on the "Checkout" button.
    // We build a link to the "Shopify Pay Page" and redirect the user there
    $("#checkOut").on("click", function () {
        console.log($("#cart_info_json").val());
        var cart_info = JSON.parse($("#cart_info_json").val());

        var checkout_page_url = "https://enspirus-arts.myshopify.com/cart/";
        var i = 0;
        var key_count = Object.keys(cart_info).length;
        if (key_count == 1) {
            scaleById("emptyCartMessage", 350);
            setTimeout(function () {
                scaleById("emptyCartMessage", 350);
            }, 650);
        }
        else {
            for (var key in cart_info) {
                if (key != "total_price") {
                    checkout_page_url += cart_info[key]["variant_id"] + ":" + cart_info[key]["quantity"];
                    if (i < key_count - 2) {
                        checkout_page_url += ",";
                    }
                }
                i++;
            }
            // Direct user to checkout page
            window.location.href = checkout_page_url;
        }
    });

    // This is a niche situation listener. Essentially, if the user
    // wants to see the "Type Description" and clicks/taps on it, but
    // they haven't selected a type in the drop down, then we want to
    // pulse the type selector and only temporarily display a message
    // stating that they haven't chooses a type yet.
    $("#collapsibleTypeDescriptionClickable").on("click", function () {
        if ($('#collapsibleTypeDescriptionHeader').attr('aria-expanded') == "false" && $("#prodTypeSelector").find("option:selected").val() == "default") {
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);

            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("hide");
            }, 2000);
        }
    });

    // This function resets the filters to default which, currently is just
    // "All". Meaning completely open, no filter subset criteria
    $("#refreshFilterBtn").on("click", function () {
        addHiddenInputElement("resetFilterBtnStatus", "clicked");
        $("#AllProductsCheckBox").parent().addClass("checked");
        $("#AllProductsCheckBox").trigger("click");
        //$("#AllImagesCheckBox").parent().addClass("checked");
        addHiddenInputElement("resetFilterBtnStatus", "notClicked");
        //$("#AllImagesCheckBox").trigger("change");
    });

    // Once a size is selected, we should be able to display a price.
    $('#prodSizeSelector').on('change', function () {
        // Get/save product size selection
        var sizeSelection = $(this).find("option:selected").val();
        if (sizeSelection != "default") {
            // Get/save the price for the given selection
            var prod_modal_json_info = JSON.parse($("#prod_modal_content_json_hidden").val());
            // Get/save product type selected
            var typeSelection = $("#prodTypeSelector").find("option:selected").val();
            // Get/save product price (for selected size/type)
            var price = prod_modal_json_info["purchase_options"][typeSelection]["size_price"][sizeSelection];

            // If the price is already showing, collapse it and then open it to show
            // new price
            if ($("#priceDivCol").height() != 0 && $("#priceDivCol").height() != 1) {
                // Collapse it so it can be changed and then re-opened.
                $("#priceDivCol").animate({
                    height: "0px",
                    opacity: 0
                }, 600);
                setTimeout(function () {
                    $("#prodModalPrice").text("$" + price);
                }, 600);
            }
            // It was already collapsed. Just fill price. Then we'll show it (below)
            else {
                $("#prodModalPrice").text("$" + price);
            }
            // Show price (with fade in and expand in)
            $("#priceDivCol").animate({
                height: "60px",
                opacity: 1
            }, 600);
            //$("#priceDivCol").slideDown("slow");
            //$("#priceDivCol").fadeIn("slow");
        }
        else {
            $("#priceDivCol").animate({
                height: "0px",
                opacity: 0
            }, 600);
            setTimeout(function () {
                $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
            }, 600);
        }
    });

    // This accomplishes a cascading drop down list.
    // When Type is selected, then the Size selector
    // can be populated. This function populates the
    // size selector with options based on what type
    // the user selected.
    $('#prodTypeSelector').on('change', function () {
        // Start by removing existing options from size selector
        $("#prodSizeSelector")
            .find('option')
            .remove()
            .end()
            .append('<option value="default">Select Size</option>')
            .val('default')
        ;
        $("#prodSizeSelector").selectpicker('refresh');

        var selected = $(this).find("option:selected").val();
        var modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
        var one_size = "";
        if (selected != "default") {
            // Fill the size dropdown with options
            for (var size in modal_info_json["purchase_options"][selected]["size_price"]) {
                $("#prodSizeSelector").append("<option value='" + size + "'>" + size + "</option>");
                $("#prodSizeSelector").attr('disabled', false);
                $("#prodSizeSelector").selectpicker('refresh');
                one_size = size;
            }

            // Fill the Type Description Header and expand it
            $("#prodModalProdTypeDescription").html(selected + "<br>" + modal_info_json["purchase_options"][selected]["description"]);
            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("show");
            }, 500);
        }
        else {
            // Then they selected the "Default" value which isn't a valid type
            // Disable size as there is no size for "Default"
            $("#prodSizeSelector").attr('disabled', true);
            $("#prodSizeSelector").selectpicker('refresh');
            // Collapse and change the Type Description
            $("#collapsibleTypeDescriptionHeader").collapse("hide");
            setTimeout(function () {
                $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
            }, 500);
        }

        // If there's only one Prod Size for the Prod Type selected,
        // then auto-select that size for the user.
        if ($("#prodSizeSelector option").size() == 2) {
            $("#prodSizeSelector").val(one_size);
            $("#prodSizeSelector").selectpicker('refresh')
        }
        // Size selector may have changed. As a check, trigger the on change function/listener
        $("#prodSizeSelector").trigger("change");
    });

    // This function/listener removes options from type and size selector
    // whenever the modal is closed (modal close). It also collapses the description and
    // type headers/info boxes.
    $("#prodModal").on('hidden.bs.modal', function () {
        // Remove options from type selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodTypeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Remove optiosn from size selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodSizeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Collaps price section and reset pricing text
        $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
        $("#priceDivCol").animate({
            height: "0px",
            opacity: 0
        }, 600);

        // Refresh the selectors since we changed them.
        // Bootstrap requires this step.
        $("#prodTypeSelector").selectpicker('refresh');
        $("#prodSizeSelector").selectpicker('refresh');

        // Reset Type Description and Product Description
        $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
        $("#collapsibleTypeDescriptionHeader").collapse("hide");
        $("#collapsibleDescriptionHeader").collapse("hide");

        // Remove Product Image
        $("#prodModalImage").attr("src", "");
    });

    // When the user clicks the "Cart" button at the top, this is what happens.
    function apply_cart_btn_listeners() {
        $(".cartBtn").each(function () {
            $(this).on("click", function () {
                if ($("#cartSection").css("display") == "none") {
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            // Save the JSON returned in a hidden form
                            addHiddenInputElement("cart_info_json", response);

                            // Parse response (json formatted string) into a json object for iterating through it
                            var cart_info_json = JSON.parse(response);

                            // for each item in the cart
                            var i = 0;
                            for (var key in cart_info_json) {
                                var item_row = "";
                                if (i == 0 && Object.keys(cart_info_json).length != 3 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;">';
                                }
                                else if (i == Object.keys(cart_info_json).length - 2 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">';
                                }
                                else {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;border-bottom:0.5px solid lightgray;">';
                                }
                                if (key != "total_price") {
                                    $("#cartMainProdRow").append('' +
                                        item_row +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row">' +
                                        '</div>' +
                                        '<div class="row"  style="padding-bottom:10px;">' +
                                        '<div class="col-xs-4"><img src="/' + cart_info_json[key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                                        '<div class="col-xs-8">' +
                                        '<a><h3 class="title">' + cart_info_json[key]["name"] + '</h3></a>' +
                                        '<p>' + ' ' + cart_info_json[key]["type"] + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row" style="padding-bottom:15px;">' +
                                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Quantity</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                                        '</div>' +
                                        '<div class="row">' +
                                        '<div id="unitPriceProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + cart_info_json[key]["price"] + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<input onchange="quantityChange(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="quantityProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_info_json[key]["quantity"]) + '">' +
                                        '</div>' +
                                        '<div id="subtotalProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_info_json[key]["price"] * cart_info_json[key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<button onclick="cartRemoveItem(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="cartRemoveProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-id="' + cart_info_json[key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                    );

                                }
                                i++;
                            }

                            // If we added at least 1 item
                            // There will always be one key (total_amount). So if there are 2, then we had
                            // at least one item. Thus if i > 1, not i > 0


                            if (i > 1) {
                                var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                                var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                                var shipping = 9.00.toFixed(2);

                                /*if (subTotal >= 100){
                                    shipping = 0.00.toFixed(2);
                                }*/

                                var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);

                                $("#cartMainProdRow").append('' +
                                    '<div id="cartTotalRow" class="row" style="padding-top:15px;">' +
                                    '<div class="col-sm-6 col-xs-12"></div>' +
                                    '<div class="col-sm-6 col-xs-12">' +
                                    //'<div class="col-xs-3"></div>' +
                                    '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                                    //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                            // Else no items were added. So display something saying so.
                            else {
                                $("#cartMainProdRow").append('<div id="emptyCartMessage" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                            }

                            $("#cartContainer").removeClass("remove-shadow-size-quick");
                            if ($("#closeCartBtn").css("display") == "none") {
                                $("#closeCartBtn").css("display", "block");
                            }
                            $("#cartSection").slideToggle();
                            $('html, body').animate({
                                scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                            }, 1000);
                            if ($("html").hasClass("nav-open")) {
                                $("#menu-toggle").trigger("click");
                            }
                            //console.log(response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                }
                else {
                    $('html, body').animate({
                        scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                    }, 1000);
                    if ($("html").hasClass("nav-open")) {
                        $("#menu-toggle").trigger("click");
                    }
                }

                // Seems we get weird flickering effects (involved in the animate scrollTop action) if this isn't here
                return false;
            });
        });
    }

    function quantityChange(id, size, type) {
        // Special Note: Size may have instances of periods to represent decimal sizes. When
        // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
        // below, you'll see that I'm escaping the period using our replaceAll string function.
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        if ($("[id='quantityProdId" + concatIdSizeType + "']").val() <= 0) {
            // Display notification informing of success
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]('Select the red trash can to remove an item from your cart.');

            $("[id='quantityProdId" + concatIdSizeType + "']").val(1);
            scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 650);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 1300);
        }
        else {
            // Firstly, inform the server that the user would like to add to their cart. And attempt to do so...
            var _size = size;
            var _type = type;
            $.ajax({
                url: '/art/update_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: $("[id='quantityProdId" + concatIdSizeType + "']").val(),
                    price: $("[id='unitPriceProdId" + concatIdSizeType + "']").text(),
                    size: _size,
                    type: _type,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    scaleAndShadowById("cartBtn", 500);
                    refreshCartBtn();
                    // Updating hidden json
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            addHiddenInputElement("cart_info_json", response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                },
                error: function () {
                    alert("Error...");
                }
            });

            // This behemoth of a statement simply sets the text of the subtotal for a give item in the cart
            // The length of the statement is due to rounding, multiplication, and ridiculous id naming convention I've
            // used for naming/id'ing items in the cart
            $("[id='subtotalProdId" + concatIdSizeType + "']").text("$" + (Math.round((parseFloat($("[id='unitPriceProdId" + concatIdSizeType + "']").text().replace("$", "")) * $("[id='quantityProdId" + concatIdSizeType + "']").val()) * 100) / 100).toFixed(2));

            //We also want to refresh the cart total.
            refreshCartTotal();
        }
    }

    function prodHover(id) {
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
        if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
            $("#imgProdId" + id).css("transform", "scale(.90, .90)");
        }
        $("#prod" + id).hover(function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(.90, .90)");
            }
        }, function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(1,1)");
            }
        });
    }

    // This function loops through each item in the cart and applies a border on top or bottom as needed
    function redrawCartItemBorders() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                if (i == 0) {
                    $(this).css("border-top", "0.5px solid lightgray");
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
                else {
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
            }
            i++;
        });
    }

    // This function adds up all items in the cart and renders the total at the bottom
    function refreshCartTotal() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        var total = 0;
        var subTotal = 0;
        var taxes = 0;
        var shipping = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                var subtotalId = ($(this).attr("id")).replace("cartItemProdId", "subtotalProdId");
                subtotalId = subtotalId.replaceAll(".", "\\.");
                if (subtotalId != "emptyCartMessage") {
                    total += parseFloat(($("[id='" + subtotalId + "']").text()).replace("$", ""));
                }
            }
            i++;
        });


        taxes = ((Math.round(total * 100) / 100) * 0.029).toFixed(2);
        subTotal = (Math.round(total * 100) / 100).toFixed(2);
        shipping = 9.00.toFixed(2);
        /*if (subTotal >= 100){
            shipping = 0.00.toFixed(2);
        }*/
        total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);
        $("#cartTotal").text("Total: $" + total);
        $("#tax").text("Tax: $" + taxes);
        $("#subTotal").text("Sub Total: $" + subTotal);
        $("#shippingCost").text("Shipping: $" + shipping);


    }

    // This function handles user clicks on the Trash icon next to items
    // in the cart
    function cartRemoveItem(id, _size, _type) {
        var concatIdSizeType = id + _size + _type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        $("[id='cartItemProdId" + concatIdSizeType + "']").slideUp(500);
        setTimeout(function () {
            $("[id='cartItemProdId" + concatIdSizeType + "']").remove();
        }, 500);

        // make a call to the server to remove the item(s) from the cart
        $.ajax({
            url: '/art/remove_from_cart/',
            type: "POST",
            data: {product_id: id, size: _size, type: _type, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                refreshCartBtn();

                //Need to ensure other one is removed at this point. So waiting half a second to assess
                setTimeout(function () {
                    // If there's no more items, we want to show Empty Cart Message
                    var itemCount = $("#cartMainProdRow").children().length - 1;
                    if (itemCount == 0) {
                        $("#cartMainProdRow").append('<div id="emptyCartMessage" style="display:none;text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                        $("#emptyCartMessage").slideDown("slow");
                        $("#cartTotalRow").slideUp(500);
                        setTimeout(function () {
                            $("#cartTotalRow").remove();
                        }, 500);
                    }
                    else {
                        setTimeout(function () {
                            redrawCartItemBorders();
                            refreshCartTotal();
                        }, 500);
                    }
                }, 500);

                // Updating hidden json
                $.ajax({
                    url: '/art/get_cart/',
                    type: "POST",
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (response) {
                        addHiddenInputElement("cart_info_json", response);
                    },
                    error: function () {
                        alert("Error...");
                    }
                });
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function drawNewItemInCart(id, size, type) {
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        // Start by checking if this particular item already exists in our cart
        // If so, then we just need to increment the quantity by 1
        var item_already_in_cart = false;
        $("#cartMainProdRow").children().each(function () {
            if ($(this).attr("id") == "cartItemProdId" + id + size + type) {
                item_already_in_cart = true;
            }
        });
        // Then all we need to do is increment the quantity for the given item and triger the quantity change event
        if (item_already_in_cart) {
            var new_quant_val = parseInt($("[id='quantityProdId" + concatIdSizeType + "']").val()) + 1;
            $("[id='quantityProdId" + concatIdSizeType + "']").val(new_quant_val);
            $("[id='quantityProdId" + concatIdSizeType + "']").trigger("change");
        }
        // Else, we've got an entire item row to add to the cart (without closing and reopening it)
        else {
            // Start by updating the cart information (that we store in a hidden json)
            $.ajax({
                url: '/art/get_cart/',
                type: "POST",
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (response) {
                    addHiddenInputElement("cart_info_json", response);
                    // Debugging Purposes Only
                    //console.log(response);
                    // Now locate the item we're adding to the cart in the JSON obj
                    var cart_json_obj = JSON.parse(response);
                    var da_key = "";
                    for (var key in cart_json_obj) {
                        if (cart_json_obj[key].hasOwnProperty("prod_id")) {
                            if (cart_json_obj[key]["prod_id"] == id) {
                                da_key = key;
                            }
                        }
                    }
                    // Now that we have da key to it (lol...) we can generate the html to add our item
                    // to our cart. We're going to start it out as display:none and then expand
                    // it once it's added fully.
                    var total_row = $("#cartMainProdRow").children().last();
                    total_row.before('' +
                        '<div id="cartItemProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="row table-hover" style="display:none;margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row">' +
                        '</div>' +
                        '<div class="row"  style="padding-bottom:10px;">' +
                        '<div class="col-xs-4"><img src="/' + cart_json_obj[da_key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                        '<div class="col-xs-8">' +
                        '<a><h3 class="title">' + cart_json_obj[da_key]["name"] + '</h3></a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row" style="padding-bottom:15px;">' +
                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Quality</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                        '</div>' +
                        '<div class="row">' +
                        '<div id="unitPriceProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + cart_json_obj[da_key]["price"] + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<input onchange="quantityChange(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="quantityProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_json_obj[da_key]["quantity"]) + '">' +
                        '</div>' +
                        '<div id="subtotalProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_json_obj[da_key]["price"] * cart_json_obj[da_key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<button onclick="cartRemoveItem(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="cartRemoveProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" data-id="' + cart_json_obj[da_key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                    );

                    if (!!document.getElementById("emptyCartMessage")) {
                        // Fade out the message
                        $("#emptyCartMessage").animate({
                            opacity: 0,
                            height: "0px"
                        }, 500);
                        setTimeout(function () {
                            $("#emptyCartMessage").remove();
                        }, 500);

                        var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                        var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                        var shipping = 9.00.toFixed(2);
                        if (subTotal >= 100) {
                            shipping = 0.00.toFixed(2);
                        }

                        var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);


                        $("#cartMainProdRow").append('' +
                            '<div style="display:none;" id="cartTotalRow" class="row" style="padding-top:15px;">' +
                            '<div class="col-sm-6 col-xs-12"></div>' +
                            '<div class="col-sm-6 col-xs-12">' +
                            //'<div class="col-xs-3"></div>' +
                            '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping[USPS Priority]: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                            //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                            '</div>' +
                            '</div>'
                        );

                        $("#cartTotalRow").slideDown("slow");
                    }

                    // Show it (via sliding it down)
                    // Special Note: Size may have instances of periods to represent decimal sizes. When
                    // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
                    // below, you'll see that I'm escaping the period using our replaceAll string function.
                    var cartItemId = "cartItemProdId" + id + size + type;
                    cartItemId = cartItemId.replaceAll(".", "\\.");
                    $("[id='" + cartItemId + "']").slideDown("slow");
                    // Re-draw border lines as needed
                    redrawCartItemBorders();
                    refreshCartTotal();
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
    }

    // Handles the "Add to Cart" clicks.
    $("#prodModalAddToCart").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Type.");

            // Pulse the type selector
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Size.");

            // pulse the size selector
            scaleAndShadowByDataId("prodSizeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodSizeSelector", 500);
            }, 1000);
        }
        else {
            var prod_modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
            var id = prod_modal_info_json["requested_prod"]["id"];
            var size_selected = $("#prodSizeSelector").find("option:selected").val();
            var type_selected = $("#prodTypeSelector").find("option:selected").val();
            $.ajax({
                url: '/art/add_to_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: 1,
                    price: $("#prodModalPrice").text(),
                    size: size_selected,
                    type: type_selected,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    // Close Modal
                    $("#modalCloseBtn").trigger("click");

                    // Display notification informing of success
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]("Added to Cart!");

                    scaleAndShadowById("cartBtn", 350);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 700);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 1400);
                    refreshCartBtn();

                    // If the cart is currently showing, then we want to add to it on the fly (as apposed to
                    // building the entire thing from scratch like the apply_cart_btn_listeners() function(s)
                    // do.
                    if ($("#cartSection").css("display") == "block") {
                        drawNewItemInCart(id, size_selected, type_selected);
                    }

                    // This flashes helps draw attention to the menu button (when user is on phone)
                    $("#menu-toggle").addClass("toggled");
                    setTimeout(function () {
                        $("#menu-toggle").removeClass("toggled");
                    }, 200);
                    setTimeout(function () {
                        $("#menu-toggle").addClass("toggled");
                        setTimeout(function () {
                            $("#menu-toggle").removeClass("toggled");
                        }, 100);
                    }, 500);
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // Handles the "Buy Now" clicks.
    $("#prodModalBuyNow").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Type!");

            $('*[data-id="prodTypeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodTypeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodTypeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodTypeSelector"]').removeClass("add-shadow-size");
            }, 500);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Size!");

            $('*[data-id="prodSizeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodSizeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodSizeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodSizeSelector"]').removeClass("add-shadow-size");
            }, 500);

        }
        else {
            $("#prodModalAddToCart").trigger("click");
            $("#cartBtn").trigger("click");
            setTimeout(function () {
                scaleAndShadowById("checkOut", 500);
                setTimeout(function () {
                    scaleAndShadowById("checkOut", 500);
                }, 1000);
            }, 2000);
            setTimeout(function () {
                if ($("#checkOut").visible() == false) {
                    $('html, body').animate({
                        scrollTop: $("#checkOut").offset().top - $(window).height() + $("#navBar1337").height() + 20
                    }, 1000);
                }
            }, 2000);
        }

        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // When the screen is scrolled down a certain amount, this function
    // changes the color of the menu bar at the top. This is done for
    // style/readability
    function checkScroll() {
        if ($(document).scrollTop() > 180) {
            if (transparent) {
                transparent = false;
                $('nav[role="navigation"]').removeClass('navbar-transparent').addClass('navbar-default');
            }
        } else {
            if (!transparent) {
                transparent = true;
                $('nav[role="navigation"]').addClass('navbar-transparent').removeClass('navbar-default');
            }
        }
    }

    // This beautiful function/filter will return boolean of whether a given element is or is not within the
    // view port.
    // Currently not working as intended. Using visible.js instead.
    // Example use: $('div').is(':offscreen');
    jQuery.expr.filters.offscreen = function (el) {
        var rect = el.getBoundingClientRect();
        return (
            (rect.x + rect.width) < 0
            || (rect.y + rect.height) < 0
            || (rect.x > window.innerWidth || rect.y > window.innerHeight)
        );
    };

    // When card-product is clicked, we need to reach out to server and fill modal with
    // appropriate information.
    $(document).on("click", ".card-product", function () {

        // Call out to server to get needed information (for product modal)
        // Response should be json formatted data. alert(response) to see it.
        $.ajax({
            url: '/art/get_product_modal_info/',
            type: "POST",
            data: {id: $(this).data('id'), csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                // Debugging purposes. Uncomment to see JSON data.
                //console.log(response);

                // Save the response in hidden form element
                if (!!document.getElementById("prod_modal_content_json_hidden")) {
                    $("#prod_modal_content_json_hidden").val(response);
                }
                else {
                    addHiddenInputElement("prod_modal_content_json_hidden", response);
                }

                // Parse the json into object/var
                var modal_info_json = JSON.parse(response);

                // Fill modal
                $("#prodModalImage").attr('src', '/' + modal_info_json["requested_prod"]["image_file"]);
                $("#prodModalTitle").text(modal_info_json["requested_prod"]["product_name"]);
                $("#prodModalProdDescription").text(modal_info_json["requested_prod"]["description"]);
                // Expand description header
                setTimeout(function () {
                    $("#collapsibleDescriptionHeader").collapse("show");
                }, 500);

                //alert(Object.keys(modal_info_json["purchase_options"])[0]);
                //alert(JSON.stringify(modal_info_json["purchase_options"]));

                // Loop through type options and fill selector
                for (var key in modal_info_json["purchase_options"]) {
                    $("#prodTypeSelector").append("<option value='" + key + "'>" + key + "</option>").selectpicker('refresh');
                }
                // Refresh selectors to update with new options and disable size
                $("#prodSizeSelector").attr('disabled', true);
                $("#prodSizeSelector").selectpicker('refresh');
                $("#prodTypeSelector").selectpicker('refresh');
                // If there's only one "Type" option, then select it for the user
                if (Object.keys(modal_info_json["purchase_options"]).length == 1) {
                    // Set Type selector to the one option that exists...
                    $("#prodTypeSelector").val(Object.keys(modal_info_json["purchase_options"])[0]);
                    $("#prodTypeSelector").selectpicker('refresh'); // Refresh selector so change shows in browser
                    // Trigger the change event so that the size type get's populated and activated
                }
                // Trigger the change in case we ended up setting it to something (so that other listener actions trigger)
                $("#prodTypeSelector").trigger("change");

                // Adding in related/similar products scroller content
                for (var key in modal_info_json["related_prods"]) {
                    $("#relatedProdsScroller").append('<li class="nbs-flexisel-item" style="width: 113.75px;">' +
                        '     <a href="#product-page2" role="tab" data-toggle="tab" aria-expanded="false">' +
                        '        <img src="/' + modal_info_json["related_prods"][key]["image_file"] + '" alt="...">' +
                        '    </a>' +
                        '</li>');
                }

            },
            error: function () {
                alert("Error...");
            }
        });

        // Build Modal using #prod_modal_content_json_hidden

        //var products = JSON.parse("{{products|escapejs}}");

        //alert(JSON.string(products));

        var prodID = $(this).data('id');

        //$(".modal-body #modal-body").text( prodID );
    });

    var parallax = function () {
        var current_scroll = $(this).scrollTop();

        oVal = ($(window).scrollTop() / 3);
        big_image.css('top', oVal);
    };

    // Handles little clickable filter button on each product box
    function filterBtnOnClick(prodType) {
        event.stopPropagation();
        alert("Filter button clicked. Still need to implement filter. Would have filtered to " + prodType);
    }

    // Function to hide all product rows past the 1th indicy (aka show only 2 prod rows)
    function initializeProductRows() {
        var rowNum = 2;
        var id = 'row' + rowNum;
        var hasNextRow = !!document.getElementById(id);
        // while there exists another row (past the 1th row or the last row we hid)
        while (hasNextRow) {
            // Setting selector for jquery hide function
            selector = '#' + id;
            // Hiding rows (past 0th and 1th)
            $(selector).slideUp("fast");
            // If the row's child elements have a height of 0, display of none, or opacity of 0,
            // Then we will undo that since their parent element/container is what we'll be
            // expanding. When we expand the parent element, we want the children to be visible.
            $(selector).children().each(function (i) {
                if ($(this).css("height") == "0px") {
                    $(this).css("height", "100%");
                }
                if ($(this).css("opacity") == "0") {
                    $(this).css("opacity", "1");
                }
                if ($(this).css("display") == "none") {
                    $(this).css("display", "block");
                }
            });
            // Increment row num (to check for)
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Loads/Shows/Un-hides/Displays 2 more product rows
    // if they exist. It does this with a fade and an expand.
    function loadMoreProductRows(option, time) {
        // Start by removing the noProdsInformDiv
        $("#noProdsInformDiv").remove();
        // start searching for hidden rows
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a next row
        var hasNextRow = !!document.getElementById(id);
        // Start a counter. We only want to show 2 new rows (per "Load More..." click)
        var count = 0;
        while (hasNextRow && count < 2) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);

            // if it's hidden, then display it (with some animation to it)
            if (option == "fadeAndExpand") {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.css("overflow", "visible");
                    //row.css("height","0px");
                    row.css("opacity", 0);
                    //row.css("display","block");
                    row.slideToggle('slow');
                    row.animate({
                        //height:"100%",
                        opacity: 1
                    }, time);

                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }
            else if (option == "expandThenFade") {
                if ($("#productsStatus").val() == "some") {
                    if (row.css("display") == "none" || row.css("opacity") == 0) {
                        row.animate({
                            height: "auto"
                        }, 1);
                        setTimeout(function () {
                            row.animate({
                                opacity: 1
                            }, 1);
                        }, 1);
                    }
                    row.children().each(function () {
                        if ($(this).css("display") == "none" || $(this).css("opacity") == 0) {

                            $(this).height("100%");
                            $(this).css({opacity: 1});
                            // No Animation needed here. If we're here, the parent class should have
                            // opacity of 0
                        }
                    });
                    if ($("#productColumn").css("display") == "none" || $("#productColumn").css("opacity") == 0) {

                        $("#productColumn").slideDown(time);
                        /*$("#productColumn").animate({
                                height: "toggle"
                            }, 1000);*/

                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }
                else {
                    // There aren't any products to show
                    // Due to the Filter settings.
                    // Inform the user.
                    if (!!document.getElementById("noProdsInformDiv") == false) {
                        $("#productColumn").append('<div id="wrapper" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items Met Your Chosen Filter Options</h3></div>');
                        $("#productColumn").slideDown(time);
                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }

                // Scroll the screen so that the newly displayed products are some % from the
                // top of the screen
                if (option == "fadeAndExpand") {
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                }
                // This was a hidden row and now it isn't. Increment counter.
                // Only want to do this to two (per "Load More..." click)
                count++;
            }
            else {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.animate({
                        opacity: 1
                    }, time);
                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }

            // Increment row num (to check for) and count
            rowNum++;

            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
            setTimeout(function () {
                addImgSpacers();
            }, time / 2)
        }
    }

    // This function returns true if there exist hidden product rows on the page
    // This function returns false if there exist no hidden product rows on the page
    function existsHiddenProdRows() {
        // We know we've got the 1th and 0th row showing, so start searching
        // for hidden rows at the 2nd indexed (aka 3rd) row.
        var rowNum = 2;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a 3rd row (aka 2nd indexed row)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);
            // If this row is hidden, then there exist some hidden row(s)
            if (row.css("display") == "none" && row.children().length > 0) {
                return true;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;                    // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
        return false;
    }

    // The "Load More..." button gets removed and re-added throughout its life.
    // Each time the button element is removed and added, this function needs
    // to be called in order to reapply the click listener (and function that
    // goes with it).
    function setLoadMoreClickFunc() {
        $('#loadMore').click(function () {
            loadMoreProductRows("fadeAndExpand", 1000);
            setTimeout(function () {
                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>Load more...</button>" +
                    "</div>";
                var options = {
                    action: "setState",
                    state: "info"
                };
                $('#loadMore').morphingButton(options);
                setTimeout(function () {
                    // Fade out existing button
                    if (existsHiddenProdRows()) {
                        $('#loadMoreCol').fadeOut(400); // Match this with id=LBFOD line
                    }
                    setTimeout(function () {
                        if (existsHiddenProdRows()) {
                            $('#loadMoreCol').replaceWith(loadMoreHtml);
                            // Fade in new instance of button
                            $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                            $('#loadMore').morphingButton();
                        } else {
                            $('#loadMoreCol').animate({
                                height: "toggle",
                                opacity: "toggle"
                            }, 1000);
                        }
                    }, 400); // Duration given for "Fade Out" of Light Blue (Success) Circle (id: LBFOD)
                }, 300); // Duration of Light Blue (Success) Circle (prior to Fade Out)
            }, 700); // Duration of Spinning Circle
        });
    }

    // If All is checked and user checks another filter box, then all should become
    // unchecked
    function initializeCheckBoxListeners() {
        {% for type in types %}
            $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllProductsCheckBox was checked, un-check it.
                if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
                    $("#AllProductsCheckBox").parent().removeClass("checked");
                }

                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // Color Filtering Removed For Now
        /*
            {% for color in colors %}
                $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                    // If AllColorsCheckBox was checked, un-check it.
                    if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
                        $("#AllColorsCheckBox").parent().removeClass("checked");
                    }

                    // Apply the filter change that just happened.
                    applyFilterOptions();
                });
            {% endfor %}
            */

        {% for image in images %}
            $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllImagesCheckBox was checked, un-check it.
                if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
                    $("#AllImagesCheckBox").parent().removeClass("checked");
                }
                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // When All is checked (in colors subsection) then other boxes should be unchecked
        // NOTE: Colors Filtering Disabled For Now
        /*$("#AllColorsCheckBox").change(function(){
                {% for color in colors %}
                    $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in Product subsection) then other boxes should be unchecked
        $("#AllProductsCheckBox").change(function () {
            {% for type in types %}
                $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            if ($("#resetFilterBtnStatus").val() != "clicked") {
                // Apply the filter change that just happened.
                applyFilterOptions();
            }
        });

        // When All is checked (in Clothing subsection) then other boxes should be unchecked
        // Merging Clothing and Products Check Box Filters Sections
        // Thus commenting out below section
        /*$("#AllClothingCheckBox").change(function(){
                {% for type in types %}
                    {% if type.is_clothing == True %}
                        $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                    {% endif %}
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in image subsection) then other boxes should be unchecked
        $("#AllImagesCheckBox").change(function () {
            {% for image in images %}
                $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            // Apply the filter change that just happened.
            applyFilterOptions();
        });

    }

    // This function returns the filter state as an object containing arrays.
    // Each array contains a list of valid types to be filtered to
    function getFilterState() {
        var filters = {
            images: [],
            clothing: [],
            products: [],
            colors: []
        };

        // Iterate over each check box and fill appropriate filter array
        if ($("#AllClothingCheckBox").parent().hasClass("checked")) {
            filters.clothing[0] = "All";
        }
        if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
            filters.products[0] = "All";
        }
        if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
            filters.colors[0] = "All";
        }
        if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
            filters.images[0] = "All";
        }
        // If the products filter don't have "all" checked
        if (!($("#AllProductsCheckBox").parent().hasClass("checked"))) {
            var productFilterCount = 0;
            {% for type in types %}
                if ($("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.products[productFilterCount] = "{{type.display_name}}";
                    productFilterCount++;
                }
            {% endfor %}
        }

        if (!($("#AllImagesCheckBox").parent().hasClass("checked"))) {
            var imageFilterCount = 0;
            {% for image in images %}
                if ($("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.images[imageFilterCount] = "{{image.name}}";
                    imageFilterCount++;
                }
            {% endfor %}
        }

        /*if(!($("#AllColorsCheckBox").parent().hasClass("checked"))) {
                var colorFilterCount = 0;
                {% for color in colors %}
                    if($("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")){
                        filters.colors[colorFilterCount] = "{{color.name}}";
                        colorFilterCount++;
                    }
                {% endfor %}
            }*/

        return filters;
    }

    // Replaces all instances of a given string in another string
    String.prototype.replaceAll = function (str1, str2, ignore) {
        return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof(str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
    };

    // This function adds "text" to the value() field of the element
    // with id of "elementId"
    function addHiddenInputElement(elementId, text) {
        text = text.replaceAll("'", "&#39;");
        //text = text.replace("\"","&#34;");
        if (!!document.getElementById(elementId)) {
            $("#" + elementId).val(text);
        }
        else {
            $('#hiddenForm').append("<input type='hidden' name='" + elementId + "' id='" + elementId + "' value='" + text + "'/>");
        }
    }

    // As the name suggests, this will animated an object fading away
    // and then remvoe the element
    function fadeOutRemoveElement(elementId, time) {
        $("#" + elementId).animate({
            opacity: "toggle"
        }, time);
        setTimeout(function () {
            $("[data-id=" + elementId + "]").remove();
        }, time);
    }

    // As the name suggests, this function collapses all product rows.
    // Not currently used. Used to be. Then implemented same effect
    // except utilized parent element/container.
    function collapseAllProductRows() {
        // Start by fading out the "Load More..." button as we don't want the user to click this while
        // we're refreshing the product tables/rows
        $("#loadMoreCol").animate({
            opacity: 0
        }, 1000);

        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results)
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            $(selector).animate({
                opacity: 0//,
                //height:"toggle"
            }, 1000);

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Removes products starting at a row/column and
    // continuing until there are no prods left to remove
    function removeRemainingProducts(startRow, startCol) {
        //alert(startRow + " , " + startCol);
        var rowNum = startRow;
        var colNum = startCol;
        // Set initial element id to begin at
        var id = 'row' + rowNum;

        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            var i = 0;
            $(selector).children().each(function () {
                if ((rowNum == startRow && i >= colNum) || (rowNum != startRow)) {
                    /*$(this).animate({
                            height:0
                        },2000);
                        var prod_element = $(this);
                        setTimeout(function(){
                            prod_element.remove();
                        }, 2000);*/
                    $(this).remove();
                }
                i++;
            });

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // This functions gets the 0th product described in the
    // hidden products_json_hidden form element (value() field)
    function getZerothJSONProductHTML() {
        var products_json = JSON.parse($("#products_json_hidden").val());
        var date = Date.now();

        var new_prod_element = "" +
            "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
            " data-image='" + products_json[0][4] + "' data-colors='' style='opacity:0; height:100%; dispay:none;'" +
            " data-product_type='" + products_json[0][3] + "'>" +
            "   <div data-toggle='modal' onmouseover='prodHover(" + products_json[0][0] + ")'  data-target='#prodModal' data-id='" + products_json[0][0] + "' class='fake-link card card-product card-plain my-card-light' id='prod" + products_json[0][0] + "'>" +
            "       <div style='overflow:visible;padding-top:10px;' class='image text-center'>" +
            "           <div id='topImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "           <a>" +
            "               <img id='imgProdId" + products_json[0][0] + "' class='my-img-dark' style='max-width:90%;max-height:300px;height:auto;width:auto;' src='/" + products_json[0][4] + "' alt='Couldnt Find Image'/>" +
            "           </a>" +
            "           <div id='bottomImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "       </div>" +
            "       <div class='content text-center'>" +
            "           <a>" +
            "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
            "           </a>" +
            //"           <p class='description'>" +
            //products_json[0][2] +
            //"           </p>" +
            "           <div class='footer'>" +
            "               <span class='price'>" + products_json[0][6] + "</span>" +
            "               <button onclick='filterBtnOnClick(\"" + products_json[0][3] + "\")' class='btn btn-danger btn-tooltip btn-simple pull-right' data-toggle='tooltip' title='Filter to " + products_json[0][3] + "' data-placement='left'>" +
            //"                   <i style='align-self:right;' class='fa fa-filter'></i>" +
            "               </button>" +
            "           </div>" +
            "       </div>" +
            "   </div> <!-- end card -->" +
            "</div>";

        jQuery.ready();

        return new_prod_element;
    }

    function addAndAnimateImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 added due to some padding at top of img
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300 && prodImgHeight > 0) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                            $("#bottomImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                        }
                        // Sometimes an image might still be loading due to slow network or something.
                        // In these cases, I believe height returned will be 0 or less than 0.
                        // When this is the case, we want to pause (to allow it to finish loading)
                        // and call the function again. Then return from the function (to end
                        // the initial instance of the function. This may happen multiple times.
                        else if (prodImgHeight <= 0) {
                            setTimeout(function () {
                                addAndAnimateImgSpacers();
                            }, 500);

                        }
                    });
                }
            });
        }
    }

    function addImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 is added due to some padding at the top
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).height(spaceDivHeight);
                            $("#bottomImgSpacerProdId" + prodId).height(spaceDivHeight);
                        }
                    });
                }
            });
        }
    }

    // This function builds the product rows
    // as they're described in the hidden products_json_hidden
    // form element (value() field).
    function buildAllProductRows() {
        // Parse the JSON (to add a new prod (which matches filter options))
        var products_json = JSON.parse($("#products_json_hidden").val());

        // Replace existing products and keep track of our position
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // This will be used for tracking position
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            $(selector).children().each(function (i) {
                var product_element = $(this);

                if ($("#products_json_hidden").val() != "[]") {
                    // Parse the JSON (to add a new prod (which matches filter options))
                    var products_json = JSON.parse($("#products_json_hidden").val());

                    // Generate/Save html to replace what we just faded/removed
                    var new_prod_element = getZerothJSONProductHTML();

                    // Replace the element we're on with
                    product_element.replaceWith(new_prod_element);

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);

                    rowCol[1]++;
                }
            });

            // Check if we need to adjust/increment column/row
            if (rowCol[1] > 2) {
                //reset rowCol (since there's only to be three products per row)
                rowCol[1] = 0;
                rowCol[0]++;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }

        // If the filter the user chose returns more than was previously there, then we need to continue adding
        if ($("#products_json_hidden").val() != "[]") {
            // Parse the JSON (to add a new prod (which matches filter options))
            var products_json = JSON.parse($("#products_json_hidden").val());

            while ($("#products_json_hidden").val() != "[]") {
                // First ensure a row exists for the item to be put into
                // And that we're not trying to add a 4th column
                if (!!$("#row" + rowCol[0]) && rowCol[1] <= 2) {
                    // Append the product
                    $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement below

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);
                }
                else if (rowCol[1] > 2) {
                    //reset rowCol (since there's only to be three products per row)
                    rowCol[1] = 0;
                    rowCol[0]++;
                }
                // Need to create the row to put the product into
                else {
                    //alert("getting here...");
                    //Check if there are any previous rows to append to
                    var rowOneBack = rowCol[0]--;
                    if (!!$("#row" + rowOneBack)) {
                        $("#row" + rowOneBack).append("</div> <div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());
                    }
                    // There are no rows. Need to create from scratch. None to append to
                    else {
                        // Need to create new row
                        // Appending </div><[new row stuffs]> to end of existing existing row
                        $("#productColumn").append("<div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'></div>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                        // Drop 0th element from json text
                        products_json.splice(0, 1);
                        var products_json_str = JSON.stringify(products_json);
                        // push the json string to the hidden element for latter use
                        addHiddenInputElement("products_json_hidden", products_json_str);
                    }
                    // Increment rowCol
                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement above
                }
            }
        }
        else {
            removeRemainingProducts(rowCol[0], rowCol[1]);
        }
    }

    /*$(window).on("resize",function(){
            waitForFinalEvent(function() {
                setProductSectionContainerSize();
                alert("here....");
            },1000);
        });*/

    var waitForFinalEvent = (function () {
        var timers = {};
        return function (callback, ms, uniqueId) {
            if (!uniqueId) {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId]) {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    function enableFilters() {
        $(window).trigger('resize');
        // This will enable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', 1);
        $('#disableFilterDiv').remove();
        scaleAndShadowById("filterDiv", 400);
        setTimeout(function () {
            $('#filterDiv').removeClass("remove-shadow-size");
        }, 800);
    }

    // This is the main function for applying filter options
    // after the user modifies them. This function calls
    // the other needed function with the correct timing
    // between each one.
    function applyFilterOptions() {
        // Start by stopping any existing animation on the product column
        $("#productColumn").stop(true);
        // Add spacer to bottom. This gives the circle space to exist on the phone view
        $("#footerSpacer").addClass("space-150");
        // Apply the "Loading" circle to the screen
        var pos = $("#productColumn").position();
        var w = $("#productColumn").width();
        //alert(pos.top + "," + pos.left);
        $('<div id="loadingCircle" class="loader" style="display:none;position:absolute;top:' + (pos.top.toString()) + 'px;left:' + ((pos.left) + (w / 2) - 60).toString() + 'px;z-index:2;"></div>').insertAfter("#productColumn");
        $("#loadingCircle").fadeIn(1000);

        var productColHtml = "";

        // Get filters as list of arrays
        var filters = getFilterState();
        // Convert to string (for server side python/django function)
        filters_str = "";
        filters_str += "" + filters.images.toString();
        //filters_str+= ":-!" + filters.clothing.toString();
        filters_str += ":-!" + filters.products.toString();
        //filters_str+= ":-!" + filters.colors.toString();

        //alert(filters_str);

        // Debug Purposes
        //alert(filters.images + " - " + filters.clothing + " - " + filters.products + " - " + filters.colors);

        // This will disable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', .6);
        $('#filterDiv').append('<div id="disableFilterDiv" style="position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>');

        $.ajax({
            url: '/art/filter_request/',
            type: "POST",
            data: {filters: filters_str, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                //alert(response);
                console.log(response);
                // Save the response
                addHiddenInputElement("products_json_hidden", response);

                // Method TWO START
                ////////////////////////////////////////////////////////////////////////////////////////////////
                // Goal here is to collaps all rows and then expand all rows with new products showing
                ////////////////////////////////////////////////////////////////////////////////////////////////
                //collapseAllProductRows();

                // Set hidden element that dictates whether or not we got products back to show
                if ($("#products_json_hidden").val() == "[]") {
                    addHiddenInputElement("productsStatus", "none");
                }
                else {
                    addHiddenInputElement("productsStatus", "some");
                }

                // Start by just fading away the entire product column/rows element
                // This way we can do whatever with the rows/product elements on the inside and then fade it back in
                $("#productColumn").animate({
                    opacity: 0
                }, 500);

                setTimeout(function () {
                    $("#productColumn").slideUp(500);
                    // Build product rows (while the column is opacity 0)
                    setTimeout(function () {
                        buildAllProductRows();
                        initializeProductRows();
                        // If after filtering we're not showing all rows,
                        // then get the "Load More" button there and ready.
                        if (existsHiddenProdRows()) {
                            if (existsHiddenProdRows()) {
                                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info" +
                                    " btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>" +
                                    "Load more...</button></div>";
                                $('#loadMoreCol').replaceWith(loadMoreHtml);
                                // Fade in new instance of button
                                $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                                $('#loadMore').morphingButton();
                            } else {
                                $('#loadMoreCol').animate({
                                    height: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                            }
                        }
                        else {
                            $("#loadMoreCol").slideUp("slow");
                        }
                        setTimeout(function () {
                            loadMoreProductRows("expandThenFade", 500);
                            $("#loadingCircle").fadeOut(500);
                            // Remove spacer to bottom. This gives the circle space to exist on the phone view
                            setTimeout(function () {
                                enableFilters();
                                $("#footerSpacer").removeClass("space-150");
                            }, 500)
                        }, 100);
                    }, 1000);
                }, 1000);

                // Set needed rows to be "display:none;"

                /* ---------- Method ONE START ----------
                    //////////////////////////////////////////////////////////////
                    //(this got complicated fast so I'm trying a different method
                    //////////////////////////////////////////////////////////////
                    // Loop through rows/products and remove if not found in
                    // the list that we just got from the server
                    var rowNum = 0;
                    // Set initial element id to begin at
                    var id     = 'row' + rowNum;
                    var rowCol = [0,0];
                    // Check if there even is a row (there should/will be unless the user
                    // previously filtered to something with zero results
                    // TODO: Handle this event... (see statement above)
                    var hasNextRow = !!document.getElementById(id);
                    while(hasNextRow){
                        rowCol[1] = 0;
                        // jquery selector
                        var selector = '#' + id;
                        // get row element
                        var row = $(selector);

                        var prodIdCounter = 0;
                        // Loop over each product element and check if it should be there
                        $(selector).children().each(function(i) {
                            //alert("On Row " + selector + " Child " + $(this).attr("data-id"));
                            var products_json = JSON.parse($("#products_json_hidden").val());
                            //Debug purposes
                            //alert($(this).attr("name") + $(this).attr("data-product_type"));

                            // Determine if this particular product should be shown
                            // (based on new filter settings)
                            var i = 0;
                            var existsInFilteredProdList = false;
                            for(i = 0; i < products_json.length; i++){
                                // Debug - Output ID we're checking against
                                //alert(products_json[i][0]);
                                if(products_json[i][0] == $(this).attr("data-id")){
                                    existsInFilteredProdList = true;
                                    break;
                                }
                            }
                            // DEBUG OUTPUT...
                            //alert(existsInFilteredProdList);

                            var product_element = $(this);
                            // If it's not in the filters product list, then fade it away and fade
                            // something else in
                            if(!existsInFilteredProdList){
                                product_element.animate({
                                    width: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                                setTimeout(function(){
                                    // If there exists some in the list to show
                                    if($("#products_json_hidden").val() != "[]") {
                                        // Parse the JSON (to add a new prod (which matches filter options))
                                        var products_json =  JSON.parse($("#products_json_hidden").val());
                                        // If this product isn't already listed
                                        if(!!$("[data-id=" + products_json[0][0] + "]")) {
                                            // Generate/Save html to replace what we just faded/removed
                                            var date = Date.now();
                                            var new_prod_element = "" +
                                                "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
                                                " data-image='" + products_json[0][4] + "' data-colors='' style='display:none'" +
                                                "data-product_type='" + products_json[0][3] + "'>" +
                                                "   <div class='card card-product card-plain'>" +
                                                "       <div class='image'>" +
                                                "           <a href='#'>" +
                                                "               <img src='/" + products_json[0][4] + "' alt='...'/>" +
                                                "           </a>" +
                                                "       </div>" +
                                                "       <div class='content'>" +
                                                "           <a href='#'>" +
                                                "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
                                                "           </a>" +
                                                "           <p class='description'>" +
                                                products_json[0][2] +
                                                "           </p>" +
                                                "           <div class='footer'>" +
                                                "               <span class='price'> TODO </span>" +
                                                "               <button class='btn btn-danger btn-simple pull-right' rel='tooltip' title='Remove from wishlist' data-placement='left'>" +
                                                "                   <i class='fa fa-heart'></i>" +
                                                "               </button>" +
                                                "           </div>" +
                                                "       </div>" +
                                                "   </div> <!-- end card -->" +
                                                "</div>";
                                            // Replace the element we're on with
                                            product_element.replaceWith(new_prod_element);

                                            // Fade/Expand it in.
                                            $("#prod" + products_json[0][0] + "-" + date).animate({
                                                width: "toggle",
                                                opacity: "toggle"
                                            }, 1000);
                                        }

                                        // We should have just taken the 0th item in the json list/array and
                                        // put it on the web page (if it wasn't already there)

                                        // Get json string (hidden element vlaue) as json object
                                        var products_json = JSON.parse($("#products_json_hidden").val());

                                        // Drop 0th element from json text
                                        products_json.splice(0,1);
                                        var products_json_str = JSON.stringify(products_json);
                                        // push the json string to the hidden element for latter use
                                        addHiddenInputElement("products_json_hidden", products_json_str);
                                    }
                                },1000);
                            }
                            else{
                                // There's nothing to do here because it should stay right where it is.
                            }

                            rowCol[1]++;
                        });

                        // Increment row num (to check for) and count
                        rowNum++;
                        // Set new id (to row after one we just hid)
                        id = 'row' + rowNum;
                        // Check if new/next row exists
                        hasNextRow = !!document.getElementById(id);

                        // Increment rowCol
                        rowCol[0]++;
                    }
                    -------- End Method ONE -------*/

                //alert(rowCol[0] + "," + rowCol[1]);
                // Anything remaining in the products_json (results of filter) needs to be added

            },
            error: function () {
                alert("Error...");
            }
        });
    }

    $('#checkoutEmailHref').on("click", function () {
        $('#checkoutModalBackBtn').hide();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutShippingHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutPaymentHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').hide();
        $('#checkoutModalPayBtn').show();
    });

    // When "Next" button is clicked on the checkout modal
    $("#checkoutModalNextBtn").on("click", function () {
        // For each child li of the nav pills (in the checkout modal)
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutPaymentHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
        });
    });

    $("#checkoutModalBackBtn").on("click", function () {
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutEmailHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
        });
    });

    $(document).ready(function () {
        {#$icon = $addon.find('span'),#}
        {#$addon = $group.find('.input-group-addon'),#}
        {#$addon.removeClass('success');#}
        {#$addon.addClass('danger');#}
        {#$icon.attr('class', 'fas fa-times-circle');#}

        var email = document.getElementById("email_input");

        $('.form-control').keyup(function () {
            if ($.trim($('.form-control').val()).length) {
                $(this).addClass('sq-input--focus');
                $(this).removeClass('sq-input--error');
                {#$(this).removeClass('sq-input--focus');#}
            } else {
                $(this).removeClass('active-text');
            }
        });

        /*
        $('.input-group input[required]').on('keyup change', function () {
            var $form = $(this).closest('form'),
                $group = $(this).closest('.input-group'),
                $addon = $group.find('.input-group-addon'),
                $icon = $addon.find('span'),
                state = false;

            if (!$group.data('validate')) {
                state = $(this).val() ? true : false;
            } else if ($group.data('validate') == "email") {
                state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
            }


            if (state) {
                document.getElementById("disabledButtonWrapper").title = "";
                $addon.removeClass('danger');
                $addon.addClass('success');
                $icon.attr('class', 'fas fa-check-circle');
            } else {
                document.getElementById("disabledButtonWrapper").title = "Email is Invalid";
                $addon.removeClass('success');
                $addon.addClass('danger');
                $icon.attr('class', 'fas fa-times-circle');
            }

            if ($form.find('.input-group-addon.danger').length == 0) {
                $form.find('[type="submit"]').prop('disabled', false);
            } else {
                $form.find('[type="submit"]').prop('disabled', true);
            }
        });

        $('.input-group input[required], .input-group textarea[required], .input-group select[required]').trigger('change');
        */

    });

    var sendEmailBtn = document.getElementById("sendEmail");
    var contactModal = document.getElementById('contactModal');

    sendEmailBtn.onclick = function () {
        var _name = document.getElementById("contactorName").value;
        var _email = document.getElementById("contactorEmail").value;
        var _phone = document.getElementById("contactorPhone").value;
        var _message = document.getElementById("contactorMessage").value;

        // Close and clear the contact modal
        $('#contactModal').modal('hide');
        $('#contactorName').val('');
        $('#contactorEmail').val('');
        $('#contactorPhone').val('');
        $('#contactorMessage').val('');

        $.ajax({
            url: '/art/contact_us_email/',
            type: "POST",
            data: {
                name: _name,
                email: _email,
                phone_number: _phone,
                message: _message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // TODO: It's possible that we get a successful response even though we didn't send the email.
                // TODO-cont: In view should put specific thing in there. If not found (here) then consider it
                // TODO-cont: failed. Otherwise if we find specific string, success.
                //console.log(response);
                // Configure Notification
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["success"]("Your message to the Ludega Team was sent successfully. Thanks!", "Success");
            },
            error: function () {
                // Configure Notification
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "0",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut",
                    "tapToDismiss": false
                };
                toastr["error"]("Woh, we're sorry but we seem to have hit a snag on our end. Please reach out to us directly at ludega.team@ludega.com or call us 24/7 at (720) 288-0674.", "Error");
            }
        });
    };

    function attemptCheckout(event) {
        // Email Field (checkout "form")validation
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!emailReg.test($('#email_input').val())) {
            $('#email_input').addClass('sq-input--error');
            $('#checkoutEmailHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]("Invalid Email");

            return;
        }

        // Shipping Info Validation
        var fname = document.getElementById("firstName_input");
        var lname = document.getElementById("lastName_input");
        var add1 = document.getElementById("address_input");
        var city = document.getElementById("city_input");
        var state = document.getElementById("state_input");
        var zip = document.getElementById("zip_input_shipping");
        var country = document.getElementById("country_input");

        var shipping_info_errors_found = false;
        var errorMsg = "";

        if (fname.value == "") {
            // fname.addClass("sq-input--error");
            fname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "First name required<br>";
        }
        if (lname.value == "") {
            // fname.addClass("sq-input--error");
            lname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Last name required<br>";
        }
        if (add1.value == "") {
            // fname.addClass("sq-input--error");
            add1.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Address required<br>";
        }
        if (city.value == "") {
            // fname.addClass("sq-input--error");
            city.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "City required<br>";
        }
        if (state.value == "") {
            // fname.addClass("sq-input--error");
            state.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "State required<br>";
        }
        if (zip.value == "") {
            // fname.addClass("sq-input--error");
            zip.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Zip Code required<br>";
        }
        if (country.value == "") {
            // fname.addClass("sq-input--error");
            country.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Country required<br>";
        }

        if (shipping_info_errors_found) {
            // Take user to shipping section of form
            $('#checkoutShippingHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"](errorMsg);
            return;
        }

        // If we're here, all our validation passed.
        // Note: Square takes care of validating card info, so it's still possible that errors come back (during card
        // nonce request / after.
        if (!requestCardNonce(event)) {
            // TODO: Error. What should we do here and when will/should false be returned?
        }
    }
</script>
<!-- If you are using TypeKit.com uncomment this code -->
<!--
        <script src="https://use.typekit.net/[your kit code here].js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        -->
<!-- If you have retina @2x images on your server which can be sent to iPhone/iPad/MacRetina, please uncomment the next line -->
<!-- <script src="assets/js/retina.min.js"></script> -->
<!-- This ensures that when the modal opens, it won't scroll the background of up -->
</html>
<!doctype html>
{% load staticfiles %}
{% load ludega_art_filters %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Ludega</title>
    <link rel="shortcut icon" type="image/x-icon" sizes="96x96" href="{% static "ludega_art/img/favicon.png" %}">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link href="{% static "ludega_art/css/material-kit.css" %}" rel="stylesheet"/>-->
    <link href="{% static "ludega_art/css/bootstrap.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/gsdk.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_art/css/examples.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.min.css" %}" rel="stylesheet"/>
    <link href="{% static "ludega_glass/css/toastr.css" %}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


    <!-- link to the SqPaymentForm library -->
    <script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- link to the local SqPaymentForm initialization -->
    <script src="{% static 'ludega_art/js/sqpaymentform.js' %}" type="text/javascript"></script>

    <!-- link to the custom styles for SqPaymentForm -->
    <link href="{% static "ludega_art/css/sqpaymentform.css" %}" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link href="{% static "ludega_art/css/pe-icon-7-stroke.css" %}" rel="stylesheet" />-->
    <style>
        .input-group-addon.primary {
            color: rgb(255, 255, 255);
            background-color: rgb(50, 118, 177);
            border-color: rgb(40, 94, 142);
        }

        .input-group-addon.success {
            color: rgb(255, 255, 255);
            background-color: rgb(92, 184, 92);
            border-color: rgb(76, 174, 76);
        }

        .input-group-addon.info {
            color: rgb(255, 255, 255);
            background-color: rgb(57, 179, 215);
            border-color: rgb(38, 154, 188);
        }

        .input-group-addon.warning {
            color: rgb(255, 255, 255);
            background-color: rgb(240, 173, 78);
            border-color: rgb(238, 162, 54);
        }

        .input-group-addon.danger {
            color: rgb(255, 255, 255);
            background-color: rgb(217, 83, 79);
            border-color: rgb(212, 63, 58);
        }
    </style>
</head>
<body class="ecommerce">
<nav id="navBar1337" class="navbar navbar-transparent navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button id="menu-toggle" type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar bar1"></span>
                <span class="icon-bar bar2"></span>
                <span class="icon-bar bar3"></span>
            </button>
            <!--<a class="navbar-brand" href="http://ludega.com"><i class="fa fa-chevron-left"></i> Back to Kit</a>-->
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#">
                        Home
                    </a>
                </li>
                {#                <li>#}
                {#                    <a href="#">#}
                {#                        About LudegaArt#}
                {#                        <!--<b class="caret"></b>-->#}
                {#                    </a>#}
                {#                </li>#}
                <li>
                    <a href="" data-toggle="modal" data-target="#contactModal">
                        Contact Us
                        <!--<b class="caret"></b>-->
                    </a>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        More
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-with-icons">
                        <!--<li>
                                    <a href="contact-us.html">
                                    <i class="pe-7s-mail-open-file"></i> Contact Us
                                    </a>
                                </li>
                                <li>
                                    <a href="about-us.html">
                                    <i class="pe-7s-info"></i> Blog Page
                                    </a>
                                </li>
                                <li>
                                    <a href="pricing.html">
                                    <i class="pe-7s-cash"></i> Pricing Page
                                    </a>
                                </li>-->
                        <li>
                            <a href="http://ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega
                            </a>
                        </li>
                        <li>
                            <a href="http://brokerage.ludega.com" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Brokerage
                            </a>
                        </li>
                        <li>
                            <a href="http://104.131.86.135/" target="_blank">
                                <i class="pe-7s-gift"></i> Ludega Window Cleaning
                            </a>
                        </li>
                    </ul>
                </li>
                <li><a id="cartBtn" href="#" class="btn btn-round btn-default cartBtn">Cart ({{ cart_count }} Items)</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<div class="wrapper">
    <div class="img-wrapper">
        <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/banner2.png' %}">
    </div>

    <!--<div class="parallax filter-black">
        <div class="parallax-image">
            <div class="col-sm-12 col-md-12 col-lg-12" style="padding-left: 0px; padding-right: 0px;">
                <img id="titleImage" src="{% static 'ludega_art/img/header.jpg' %}" alt="..." style="height: 100%; width:100%;"/>
            </div>
        </div>
        <br><br><br><br>
        <div class="small-info">
            {#            <h1 style="font-family:longtime">Ludega</h1>#}
            {#            <h3 style="font-family:longtime">Ludega Merch</h3>#}
        </div>
    </div>-->
    <!--<div class="section">
                <div class="container">
                    <h2 class="section-title">Special Offers</h2>
                    {% if top_products_list %}
                    <div id="mainContentRow" class="row">
                        {% for product in top_products_list %}
                        <div class="col-md-4">
                            <div class="card card-product card-plain">
                                <div class="image">
                                    <a>
                                    <img src="/{{product.image_file}}"  alt="..."/>
                                    </a>
                                </div>
                                <div class="content">
                                    <a href="#">
                                        <h4 class="title">{{product.name}}</h4>
                                    </a>
                                    <div class="footer">
                                        <span class="price price-old"> &dollar;1,930</span>
                                        <span class="price price-new">&dollar;1,330</span>
                                        <button class="btn btn-danger btn-simple pull-right" rel="tooltip" title="Remove from wishlist" data-placement="left">
                                        <i class="fa fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>-->
    <!-- section -->
    <div id="cartSection" class="section" style="display:none;">
        <div id="cartContainer" class="container my-card-dark">
            <button type="button" style="margin-top:15px;" id="closeCartBtn" class="close" aria-hidden="true">×</button>
            <h2 id="shoppingCartTitle" class="section-title">Your Shopping Cart</h2>
            <div class="col-md-12">
                <div class="row">
                    <div class="col-sm-12">
                        <!-- nesting -->
                        <div id="cartMainProdRow" class="row">
                            <!-- Cart Items will go here...-->
                        </div>
                        <div class="row" style="height:15px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <button id="cartContinueShoppingBtn" class="btn btn btn-success btn-block"
                                            style="margin-bottom:10px;">Continue Shopping
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button id="checkOut1" class="btn btn-info btn-block" style="margin-bottom:10px;"
                                            data-toggle="modal"
                                            onclick="initialize_checkout_modal()">Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="height:15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="mainProductSection" class="section">
        <div id="productSectionContainer" class="container" style="max-width:100%;">
            <h2 class="section-title">Find what you need</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="filterDiv" class="card card-refine">
                        <!-- card-plain for no border -->
                        <div class="header">
                            <h4 class="title">Refine
                                <!--<button class="btn btn-default btn-xs btn pull-right btn-simple" rel="tooltip" title="Reset Filter">
                                    <i id="refreshFilterBtn" class="fa fa-refresh"></i>
                                </button>-->
                            </h4>
                        </div>
                        <div class="content">
                            <div class="panel-group" id="accordion">
                                <!-- Commenting out this dollar range section for now -->
                                <!--
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                <h6 class="panel-title">
                                                  <a data-toggle="collapse" href="#refinePrice">
                                                    Price Range
                                                    <i class="fa fa-caret-up pull-right"></i>
                                                  </a>
                                                </h6>
                                              </div>
                                              <div id="refinePrice" class="panel-collapse collapse in">
                                                <div class="panel-body">
                                                   <span class="price price-left">&dollar; 100</span>
                                                   <span class="price price-right">&dollar; 850</span>
                                                   <div class="clearfix"></div>
                                                   <div id="refine-price-range" class="slider slider-info"></div>
                                                </div>
                                              </div>
                                            </div>
                                            -->
                                {#                                <div class="panel panel-default">#}
                                {#                                    <div class="panel-heading">#}
                                {#                                        <h6 class="panel-title">#}
                                {#                                            <a data-toggle="collapse" href="#refineImage" class="collapsed">#}
                                {#                                                Images#}
                                {#                                                <i class="fa fa-caret-up pull-right"></i>#}
                                {#                                            </a>#}
                                {#                                        </h6>#}
                                {#                                    </div>#}
                                {#                                    <div id="refineImage" class="panel-collapse collapse">#}
                                {#                                        <div class="panel-body">#}
                                {#                                            <label class="checkbox">#}
                                {#                                                <input type="checkbox" id="AllImagesCheckBox" value=""#}
                                {#                                                       data-toggle="checkbox" checked="">#}
                                {#                                                All#}
                                {#                                            </label>#}
                                {#                                            {% if images %}#}
                                {#                                                {% for image in images %}#}
                                {#                                                    <label class="checkbox">#}
                                {#                                                        <input type="checkbox"#}
                                {#                                                               id="{{ image.name|str_replace:' ,' }}CheckBox" value=""#}
                                {#                                                               data-toggle="checkbox">#}
                                {#                                                        {{ image.name }}#}
                                {#                                                    </label>#}
                                {#                                                {% endfor %}#}
                                {#                                            {% endif %}#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineClothing" class="collapsed">
                                                  Clothing
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineClothing" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                <label class="checkbox">
                                                  <input type="checkbox" id="AllClothingCheckBox" value="" data-toggle="checkbox" checked="">
                                                  All
                                                </label>
                                                {% if types %}
                                                    {% for type in types %}
                                                        {% if type.is_clothing %}
                                                          <label class="checkbox">
                                                            <input type="checkbox" id="
                                    {{type.display_name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                            {{type.display_name}}
                                                          </label>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                              </div>
                                            </div>
                                            </div> -->
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h6 class="panel-title">
                                            <a data-toggle="collapse" href="#refineProduct" class="collapsed">
                                                Products
                                                <i class="fa fa-caret-up pull-right"></i>
                                            </a>
                                        </h6>
                                    </div>
                                    <div id="refineProduct" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label class="checkbox">
                                                <input type="checkbox" id="AllProductsCheckBox" value=""
                                                       data-toggle="checkbox" checked="">
                                                All
                                            </label>
                                            {% if types %}
                                                {% for type in types %}
                                                    {% if not type.sub_type_only %}
                                                        <label class="checkbox">
                                                            <input type="checkbox"
                                                                   id="{{ type.display_name|str_replace:' ,' }}CheckBox"
                                                                   value="" data-toggle="checkbox">
                                                            {{ type.display_name }}
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <!-- end panel -->
                                <!--<div class="panel panel-default">
                                            <div class="panel-heading">
                                              <h6 class="panel-title">
                                                <a data-toggle="collapse" href="#refineColor" class="collapsed">
                                                  Colors
                                                  <i class="fa fa-caret-up pull-right"></i>
                                                </a>
                                              </h6>
                                            </div>
                                            <div id="refineColor" class="panel-collapse collapse">
                                              <div class="panel-body">
                                                 <label class="checkbox">
                                                    <input type="checkbox" id="AllColorsCheckBox" value="" data-toggle="checkbox" checked="">
                                                    All
                                                  </label>
                                                  {% if colors %}
                                                      {% for color in colors %}
                                                        <label class="checkbox">
                                                          <input type="checkbox" id="{{color.name|str_replace:' ,'}}CheckBox" value="" data-toggle="checkbox">
                                                          {{color.name}}
                                                        </label>
                                                      {% endfor %}
                                                  {% endif %}
                                              </div>
                                            </div>
                                            </div> <!-- end panel -->
                            </div>
                        </div>
                    </div>
                    <!-- end card -->
                </div>
                <div class="col-md-9" id="productColumn">
                    <div class="row" id="row0">
                        {% if products %}
                            {% for product in products %}
                                {% if product.display %}
                                    <div class="col-sm-4"
                                         data-id="{{ product.id }}"
                                         data-image="{{ product.image_file }}"
                                            {% with colors_=product.colors.all %}
                                         data-colors="
                                    {% for color in colors_ %}
                                    {{ color }},
                                    {% endfor %}"
                                         data-product_type="{{ product.product_type.display_name }}"
                                         data-is_clothing="{{ product.product_type.is_clothing }}"
                                                >
                                            {% endwith %}
                                    <div data-toggle="modal" onmouseover="prodHover({{ product.id }})"
                                         data-id="{{ product.id }}" data-target="#prodModal"
                                         class="fake-link card card-product card-plain my-card-light"
                                         id="prod{{ product.id }}">
                                        <div style="overflow:visible;padding-top:10px;" class="image text-center">
                                            <div id="topImgSpacerProdId{{ product.id }}"
                                                 style="overflow:visible;height:0px"
                                                 ;></div>
                                            <a>
                                                <img id="imgProdId{{ product.id }}" class="my-img-dark"
                                                     style="max-width:90%;max-height:300px;height:auto;width:auto;"
                                                     src="/{{ product.image_file }}" alt="..."/>
                                            </a>
                                            <div id="bottomImgSpacerProdId{{ product.id }}" style="height:0px" ;></div>
                                        </div>
                                        <div class="content text-center">
                                            <span>
                                                <a>
                                                    <h4 class="title">{{ product.name }}</h4>
                                                </a>
                                            </span>
                                            <!--<p class="description">
                                                {{product.description}}
                                                </p>-->
                                            <div class="footer">
                                                <span class="price"> {{ product.id|get_price_str }}</span>
                                                <button onclick="filterBtnOnClick('{{ product.product_type }}')"
                                                        class="btn btn-danger btn-tooltip btn-simple pull-right"
                                                        rel="tooltip" title="Filter to {{ product.product_type }}"
                                                        data-placement="top">
                                                    <!--<i style="align-self:right;" class="fa fa-filter"></i>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end card -->
                                    </div>
                                    <!-- Each row should only contain 3 products -->
                                    {% if forloop.counter|divisibleby:3 == True %}
                                        <!-- End the previous <div class="row">  -->
                                        </div>
                                        <!-- Determine the row id (which is "row" + rowNum)                -->
                                        {% with rowCount=forloop.counter|divnum:3 %}
                                            {% with rowid="row"|addstr:rowCount %}
                                                <div class="row" id="{{ rowid }}">
                                            {% endwith %} <!-- Ending "with rowCount=forloop.counter|divnum:3" -->
                                        {% endwith %} <!-- Ending "with rowid="row"|addstr:rowCount"       -->
                                    {% endif %}
                                {% endif %}
                            {% endfor %} <!-- Ending "for product in products" -->
                        {% endif %}  <!-- Ending "if products"             -->
                        </div>
                    <div class="space-50"></div>
                    <div class="col-md-3 col-md-offset-4" id="loadMoreCol">
                        <button rel="tooltip" title="" style="margin-bottom:1px;" class="btn btn-info btn-round"
                                id="loadMore" data-toggle="morphing" data-rotation-color="blue">Load more...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- section -->
<div id="footerSpacer" class="space-50"></div>
<div class="subscribe-line subscribe-line-transparent"
     style="background-image: url('{% static 'ludega_art/img/merch7.png' %}')">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <form class="">
                    <div class="form-group">
                        <input type="text" value="" class="form-control" placeholder="Enter your email here...">
                    </div>
                </form>
            </div>
            <div class="col-md-3">
                <button type="button" class="btn btn-info btn-fill btn-block">Subscribe Now!</button>
            </div>
        </div>
    </div>
</div>
<footer class="footer footer-big footer-default">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="id">Bahasa Indonesia</option>
                        <option value="ms">Bahasa Melayu</option>
                        <option value="ca">Català</option>
                        <option value="da">Dansk</option>
                        <option value="de">Deutsch</option>
                        <option value="en" selected="">English</option>
                        <option value="es">Español</option>
                        <option value="el">Eλληνικά</option>
                        <option value="fr">Français</option>
                        <option value="it">Italiano</option>
                        <option value="hu">Magyar</option>
                        <option value="nl">Nederlands</option>
                        <option value="no">Norsk</option>
                        <option value="pl">Polski</option>
                        <option value="pt">Português</option>
                        <option value="fi">Suomi</option>
                        <option value="sv">Svenska</option>
                        <option value="tr">Türkçe</option>
                        <option value="is">Íslenska</option>
                        <option value="cs">Čeština</option>
                        <option value="ru">Русский</option>
                        <option value="th">ภาษาไทย</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="huge" class="selectpicker hidden" data-style="btn-default btn-block"
                            data-menu-style="dropdown-blue">
                        <option value="ARS">ARS</option>
                        <option value="AUD">AUD</option>
                        <option value="BRL">BRL</option>
                        <option value="CAD">CAD</option>
                        <option value="CHF">CHF</option>
                        <option value="CNY">CNY</option>
                        <option value="CZK">CZK</option>
                        <option value="DKK">DKK</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="HKD">HKD</option>
                        <option value="HUF">HUF</option>
                        <option value="IDR">IDR</option>
                        <option value="ILS">ILS</option>
                        <option value="INR">INR</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                        <option value="MYR">MYR</option>
                        <option value="MXN">MXN</option>
                        <option value="NOK">NOK</option>
                        <option value="NZD">NZD</option>
                        <option value="PHP">PHP</option>
                        <option value="PLN">PLN</option>
                        <option value="RUB">RUB</option>
                        <option value="SEK">SEK</option>
                        <option value="SGD">SGD</option>
                        <option value="TWD">TWD</option>
                        <option value="USD" selected="">USD</option>
                        <option value="VND">VND</option>
                        <option value="ZAR">ZAR</option>
                    </select>
                </div>
            </div>
            <div class="col-md-2 col-md-offset-1">
                <h5 class="title">Company</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Our Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                About Us
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3 col-md-offset-1">
                <h5 class="title"> Help and Support</h5>
                <nav>
                    <ul>
                        <li>
                            <a data-toggle="modal" data-target="#contactModal">
                                Contact Us
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Terms & Conditions
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Money Back
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-3">
                <h5 class="title">Latest News</h5>
                <nav>
                    <ul>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i> <b>We're Live!</b>
                                Ludega Merch is now live, feel free to place an order.
                                <hr class="hr-small">
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa fa-twitter"></i>
                                <b>New merchandise!</b> New merch has been added, check out some of the new inventory.
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr/>
        <div class="social-area text-center">
            <h5>Join us on</h5>
            <a href="https://www.facebook.com/ludega.merch.3" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-facebook"></i>
            </a>
            <a href="https://mobile.twitter.com/LudegaMerch" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-twitter"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-google-plus"></i>#}
{#            </a>#}
            <a href="https://www.instagram.com/ludegamerch/" target="_blank" class="btn btn-social btn-round">
                <i class="fa fa-instagram"></i>
            </a>
{#            <a href="#" class="btn btn-social btn-round">#}
{#                <i class="fa fa-linkedin"></i>#}
{#            </a>#}
        </div>
        <div class="copyright">
            &copy; 2017 <a href="http://www.ludega.com">Ludega</a> - It Will Be.
        </div>
    </div>
</footer>
</div> <!-- wrapper -->

<div id="largeImgModal" class="img-modal">
    <!-- The Close Button -->
    <span class="my-close" onclick="document.getElementById('largeImgModal').style.display='none'">&times;</span>
    <!-- Modal Content (The Image) -->
    <img class="img-modal-content" id="largeImg" src="">
    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
</div>
<!--<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="Label" aria-hidden="true" style="display: none;">-->
<div class="modal fade" id="prodModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <div class="modal-body">
                <!--<div class="container">-->
                <div class="row">
                    <div class="col-md-6">
                        <div class="tab-content">
                            <div class="tab-pane active" id="product-page6">
                                <img class="my-prod-modal-img" onclick="increaseImgWithModal('123')" id="prodModalImage"
                                     style="-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-width:100%;max-height:500px;margin:auto;display:block;"
                                     src="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <a>
                                <h3 id="prodModalTitle" class="title"></h3>
                            </a>
                            <!--<p class="description">
                                        </p>-->
                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="descriptionHeading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleDescriptionHeader" class="collapsed">
                                            Product Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleDescriptionHeader" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="descriptionHeading" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdDescription">
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="typeDescriptionHeading">
                                    <h4 class="panel-title">
                                        <a id="collapsibleTypeDescriptionClickable" class="collapsed"
                                           data-toggle="collapse" data-parent="#accordion"
                                           href="#collapsibleTypeDescriptionHeader" aria-expanded="false"
                                           aria-controls="collapsibleTypeDescriptionHeader">
                                            Type Description
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapsibleTypeDescriptionHeader" class="panel-collapse collapse"
                                     role="tabpanel" aria-labelledby="typeDescriptionHeading" aria-expanded="false"
                                     style="height: 0px;">
                                    <div class="panel-body" id="prodModalProdTypeDescription">
                                        <p>You haven't selected a Product Type yet.</p>
                                        <!--<ul style="padding-left: 20px;">
                                                    <li style="list-style-position: outside;"> Fits small to size</li>
                                                    <li style="list-style-position: outside;"> Model wears a UK 40R</li>
                                                    <li style="list-style-position: outside;"> Model measures: chest 39"/ 99cm, height 6'1"/ 185cm</li>
                                                </ul>-->
                                    </div>
                                </div>
                            </div>
                            <!--<div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                          <h4 class="panel-title">
                                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                              Details
                                            </a>
                                          </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false" style="height: 0px;">
                                          <div class="panel-body">
                                            85% wool, 15% linen. Dry-clean only
                                          </div>
                                        </div>
                                        </div>-->
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="headingFour">
                                    <h4 class="panel-title">
                                        <a class="collapsed" data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                            Returns
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                                     aria-labelledby="headingFour" aria-expanded="false" style="height: 0px;">
                                    <div class="panel-body">
                                        Here at Ludega Merch, we pride ourselves in having a friendly return policy.
                                        It's simple; if you're not 100% satisfied with your product, simply return it to
                                        us in the condition it was received and we'll refund or replace your order
                                        (shipping not included) and give you a 5% discount on your next purchase
                                        regardless of purchase amount.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Acordeon  -->
                        <div class="row align-items-center">
                            <div class="prod-options pull-down">
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodTypeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Type</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6" style="display: none;">
                                    <div class="form-group">
                                        <select name="huge" id="prodSizeSelector" class="selectpicker" data-style="btn"
                                                data-menu-style="dropdown-blue">
                                            <option value="default" selected="">Select Size</option>
                                            <!--<option value="id">XS</option>
                                                        <option value="ms">S</option>
                                                        <option value="ca">M</option>
                                                        <option value="ca">L</option>
                                                        <option value="ca">XL</option>
                                                        <option value="ca">XXL</option>-->
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12" id="priceDivCol" style="height:0px;opacity:0;">
                                    <a align="right">
                                        <h3 id="prodModalPrice" class="title">Select a Product Type and Size for
                                            Pricing!</h3>
                                    </a>
                                </div>
                                <div class="col-md-12" style="height:60px;">
                                    <div class="pull-right" style="margin-top:10px;">
                                        <button type="button" id="prodModalAddToCart" class="btn btn-fill">Add to Cart
                                        </button>
                                        <button type="button" id="prodModalBuyNow" class="btn btn-fill">Buy Now</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                       <div class="col-md-4"></div>
                       <div class="col-md-4 text-center"><a><h3 class="title">Similar Products</h3></a></div>
                       <div class="col-md-4"></div>
                   </div>
                  <div class="row">
                  <div class="col-md-12">
                   <div class="nbs-flexisel-container">
                           <div class="nbs-flexisel-inner">
                              <ul class="nav nav-text nbs-flexisel-ul" role="tablist" id="relatedProdsScroller" style="left: -113.75px;">
                              </ul>
                           </div>
                           <div class="nbs-flexisel-nav-left" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-left"></i></div>
                           <div class="nbs-flexisel-nav-right" style="visibility: visible; font-size: 22px; top: 37px;"><i class="fa fa-angle-right"></i></div>
                        </div>
                      </div>
                    </div>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
        <!--</div>-->
    </div>
</div>
</div>
<form id="hiddenForm"></form>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" id="modalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
            </div>
            <!--<button type="button" id="contactModalCloseBtn" class="close" data-dismiss="modal" aria-hidden="true">×</button>-->
            <div class="modal-body">
                <div id="contactContainer" class="col-md-offset-1">
                    <h2 class="section-title">Send us a message</h2>
                </div>
                <div class="row">
                    <!--<div class="separator line-separator">♦</div>-->
                    <div id="contactContainer" class="col-md-6 col-md-offset-1">
                        </p>
                        <form role="form" id="contact-form" method="post" data-color="blue">
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your name (optional)</label>
                                <input id="contactorName" placeholder="First & Last Name" type="text" name="name"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Email address (optional)</label>
                                <input id="contactorEmail" placeholder="Your personal email" type="email" name="email"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Phone (optional)</label>
                                <input id="contactorPhone" placeholder="Phone Nmber" type="text" name="phone"
                                       class="form-control">
                                <span class="material-input"></span></div>
                            <div class="form-group label-floating is-empty">
                                <label class="control-label">Your message</label>
                                <textarea name="message" class="form-control" id="contactorMessage" rows="6"
                                          required></textarea>
                                <span class="material-input"></span></div>
                            <div id="contactButtonContainer" class="submit">
                                <input id="sendEmail" type="submit" class="btn btn-info btn-fill" value="Send Message">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4 col-md-offset-1">
                        <div class="contact-info">
                            <!--<h5><i class="fa fa-map-marker text-muted"></i> Address</h5>
                            <p class="text-muted"> Bld Mihail Kogalniceanu, nr. 8,<br>
                                7652 Bucharest,<br>
                                Romania
                            </p><br>-->
                            <h5><i class="fa fa-phone text-muted"></i> 24/7 Live Support</h5>
                            <p class="text-muted"> Customer Support<br>
                                (720) 288-0674<br>
                                Mon - Sun, 12:00AM -11:59PM
                            </p><br>
                            <h5><i class="fa fa-envelope text-muted"></i> Email Us</h5>
                            <p class="text-muted"> Ludega Merch LLC<br>
                                customer.support@ludega.com
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-simple" data-dismiss="modal">Close</button>
                <!--<button type="button" class="btn btn-info btn-simple">Save</button>-->
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="ageVerifictaionModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" )>
            <div class="img-wrapper">
                <img class="img-responsive" width="100%" height="100%" src="{% static 'ludega_art/img/merch7.png' %}">
            </div>
            <div class="modal-header" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Age Verification</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <h5 class="text-center">Are you old enough to purchase these products?</h5>
                <div class="panel-group">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title text-center">
                                <i class="fa fa-info-circle"></i>
                                <a data-toggle="collapse" href="#collapse1">Why are we asking?</a>
                            </h4>
                        </div>
                        <div id="collapse1" class="panel-collapse collapse">
                            <div class="panel-body">THIS WEBSITE CONTAINS ADULT MATERIAL AND IS ONLY SUITABLE FOR THOSE 18
                OR OLDER. ALL CUSTOMERS FROM ARIZONA, CALIFORNIA, ILLINOIS, KANSAS, MASSACHUSETTS,
                MISSISSIPPI, MISSOURI, NEW JERSEY, NEW YORK, & OHIO MUST BE 21 YEARS OR OLDER. BY ENTERING
                THIS SITE, YOU CONFIRM THAT YOU ARE OF LEGAL AGE TO PURCHASE THESE PRODUCTS IN YOUR STATE.
                WARNING: TOBACCO PRODUCTS CONTAIN NICOTINE, AND NICOTINE IS AN ADDICTIVE CHEMICAL.
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="row">
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class=" btn btn-primary btn-block" onclick="$('#ageVerifictaionModal').modal('hide');">
                                Yes
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                            <div class="btn btn-danger btn-block" onclick="ageVerificationNoClicked()">
                                No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="checkoutModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="row" about="">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <h2 class="section-title" style="justify-content:center;display:flex;">Checkout As Guest</h2>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
            </div>
            <div class="modal-body" style="padding-top: 0px;">
                <div class="row">
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                        <ul id="checkoutNavPills" class="nav nav-pills" role="tablist"
                            style="justify-content:center;display:flex;">
                            <li id="checkoutEmailli" class="active">
                                <a id="checkoutEmailHref" href="#email" role="tab" data-toggle="tab"
                                   aria-expanded="true">
                                    Email
                                </a>
                            </li>
                            <li id="checkoutShippingli" class="">
                                <a id="checkoutShippingHref" href="#shipping" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Shipping Info
                                </a>
                            </li>
                            <li id="checkoutPaymentli" class="">
                                <a id="checkoutPaymentHref" href="#payment" role="tab" data-toggle="tab"
                                   aria-expanded="false">
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-2 col-md-2 col-lg-2"></div>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="email">
                        <div class="row" style="padding-top: 15px;">
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                            <div class="col-sm-10 col-md-10 col-lg-10">
                                <div class="form-group">
                                    <label for="validate-email">Email</label>
                                    <input type="email" class="form-control" id="email_input" placeholder="Email"
                                           required=""><br>
                                    <label for="validate-email">Additional Notes [optional]</label>
                                    <textarea class="form-control" rows="5" id="notes" placeholder="Color, size, flavor, or any other additional comments."></textarea>
                                </div>
                            </div>
                            <div class="col-sm-1 col-md-1 col-lg-1"></div>
                        </div>
                    </div>
                    <div class="tab-pane" id="shipping">
                        <div id="" class="" style="padding:15px;">
                            <div class="form-group">
                                <select class="form-control" id="shippingOptions">
                                    <option value="0" selected="">USPS Priority - $9.00</option>
                                    {#                                    <option value="1">Free Shipping [All orders over $100, abuse of this will void your order.]</option>#}
                                </select>
                            </div>
                            <div class="">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left">
                                    <label for="exampleInputEmail1">First Name</label>
                                    <input type="text" class="form-control" id="firstName_input"
                                           aria-describedby="emailHelp" placeholder="First Name" required="">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right">
                                    <label for="exampleInputEmail1">Last Name</label>
                                    <input type="text" class="form-control" id="lastName_input"
                                           aria-describedby="emailHelp" placeholder="Last Name" required="">
                                </div>
                                <br>
                            </div>
                            <div class="form-group">
                                <label for="exampleInputEmail1">Address</label>
                                <input type="text" class="form-control" id="address_input" aria-describedby="emailHelp"
                                       placeholder="Address Line 1">
                            </div>
                            <div class="form-group shove-bot">
                                <input type="text" class="form-control" id="address_input2" aria-describedby="emailHelp"
                                       placeholder="Address Line 2 [Optional]">
                            </div>
                            <div class="form-group shove-left">
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-left shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="city_input" aria-describedby="emailHelp"
                                           placeholder="City">
                                </div>
                                <div class="col-sm-6 col-md-6 col-lg-6 form-group shove-right shove-bot">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="state_input"
                                           aria-describedby="emailHelp" placeholder="State/Province/Region">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-left">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="number" class="form-control" id="zip_input_shipping"
                                           aria-describedby="emailHelp" onchange="checkDenverZipCode()"
                                           placeholder="Zip/Postal Code">
                                </div>
                                <div class="form-group col-sm-6 col-md-6 col-lg-6 shove-right">
                                    <label for="exampleInputEmail1"></label>
                                    <input type="text" class="form-control" id="country_input"
                                           aria-describedby="emailHelp" placeholder="Country">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div id="shippingAlert" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="payment">
                        <div id="sq-ccbox">
                            <!--
                                You should replace the action attribute of the form with the path of
                                the URL you want to POST the nonce to (for example, "/process-card")
                            -->
                            <div class="row">
                                <div id="cc-form" class="col-sm-12 col-md-12 col-lg-12 pad-cc-info">

                                    <table>
                                        <tbody>
                                        <tr>
                                            <th class="pad-left">Card Number</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-card-number"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">CVV</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-cvv"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Expiration Date</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-expiration-date"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th class="pad-left">Postal Code</th>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div id="sq-postal-code"></div>
                                            </td>
                                        </tr>

                                        </tbody>
                                    </table>
                                    <!--After a nonce is generated it will be assigned to this hidden input field.-->
                                    <input type="hidden" id="card-nonce" name="nonce">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                            <div id="totalCreditCardForm"
                                 class="totalCC col-xs-8 col-sm-8 col-md-8 col-lg-8 text-center"></div>
                            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalBackBtn" type="button" class="btn btn-info"
                                    style="justify-content:left;display:flex;">
                                <i class="fa fa-arrow-left" style="padding-top: 2px;"></i>
                                Back
                            </button>
                        </div>
                        <div id="" class="col-xs-4 col-sm-4 col-md-4 col-lg-4 text-center"></div>

                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                            <button id="checkoutModalNextBtn" type="button" class="btn btn-info">
                                Next
                                <i class="fa fa-arrow-right"></i>
                            </button>
                            <button id="checkoutModalPayBtn" type="button" onclick="attemptCheckout(event)"
                                    class="btn btn-info">Confirm & Pay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header"></div>
            <div class="">

                <div class="row marketing">

                    <div class="col-lg-12">

                        <h4><b>Product Name</b></h4>
                        <hr/>

                        <div>
                            <h4>Success - your order is confirmed!</h4>
                            <h5>Order number:
                                <div id="orderNumber"> orderNumber</div>
                            </h5>
                            <hr/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-xs-6">Shipping Address
                                    <ul class="list-group">
                                        <li class="list-group-item" id="orderName">firstName lastName</li>
                                        <li class="list-group-item" id="orderEmail">email</li>
                                        <li class="list-group-item" id="orderAddress">address</li>
                                        <li class="list-group-item" id="orderZip">state city zip</li>
                                        <li class="list-group-item" id="orderCountry">country</li>
                                    </ul>

                                </div>
                                <div class="col-xs-6 text-right">
                                    <h1><span class="glyphicon glyphicon glyphicon-cloud-download"
                                              aria-hidden="true"></span></h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <p><span class="glyphicon glyphicon glyphicon-question-sign"
                                             aria-hidden="true"></span>
                                        All Monthly and Quarterly subscription plans renew automatically on the 15th of
                                        the month.</p>
                                </div>
                                <div class="panel-body">
                                    <div class="table-responsive">
                                        <table class="table table-condensed">
                                            <thead>
                                            <tr>
                                                <td><strong>Product Name</strong></td>
                                                <td class="text-right"><strong>Product Options</strong></td>
                                                <td class="text-right"><strong>Subscription Type</strong></td>
                                                <td class="text-right"><strong>Price</strong></td>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- foreach ($order->lineItems as $line) or some such thing here -->
                                            <tr>
                                                <td>Veganboxen</td>
                                                <td class="text-right">Variable #1</td>
                                                <td class="text-right">Monthly</td>
                                                <td class="text-right">189 SEK</td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-right"><strong>VAT - 12%</strong></td>
                                                <td class="thick-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Shipping</strong></td>
                                                <td class="no-line text-right">incl.</td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-right"><strong>Total</strong></td>
                                                <td class="no-line text-right">189 SEK</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div> <!-- /container -->
        </div>
    </div>
</div>

</body>

<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }

    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
</style>
<!--  jQuery and Bootstrap core files    -->
<script src="{% static 'ludega_art/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/jquery-ui.custom.min.js' %}" type="text/javascript"></script>
<script src="{% static 'ludega_art/js/bootstrap.min.js' %}" type="text/javascript"></script>
<!--  Plugins -->
<script src="{% static 'ludega_art/js/gsdk-checkbox.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-morphing.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-radio.js' %}"></script>
<script src="{% static 'ludega_art/js/gsdk-bootstrapswitch.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-select.js' %}"></script>
<script src="{% static 'ludega_art/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'ludega_art/js/chartist.min.js' %}"></script>
<script src="{% static 'ludega_art/js/jquery.tagsinput.js' %}"></script>
<script src="{% static 'ludega_glass/js/toastr.min.js' %}"></script>
<script src="{% static 'ludega_art/js/visible.js' %}"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
<!--  Get Shit Done Kit PRO Core javascript 	 -->
<script src="{% static 'ludega_art/js/get-shit-done.js' %}"></script>


<script type="text/javascript">

    var debug = true;
    var big_image;
    var transparent = true;
    var loadMoreColOrigHtml = "";


    // This function initializes listeners and calls initialization functions
    // TODO: Get all listeners to be called here.
    $().ready(function () {
        responsive = $(window).width();

        var show_age_verification_json_str = '{{ show_age_verification }}';
        var show_age_verification_json = JSON.parse(show_age_verification_json_str.replace(/&quot;/g,"\""));
        if(show_age_verification_json["show_age_verification"] == "true") {
            $("#ageVerifictaionModal").modal({backdrop: 'static', keyboard: false});
        }
        else{
            // No need to display the age verification
        }


        $(window).on('scroll', checkScroll);

        if (responsive >= 768) {
            big_image = $('.parallax-image').find('img');

            $(window).on('scroll', function () {
                parallax();
                checkScroll();
            });
        }

        //This ensures that if the user tries to scroll while we're doing some fancy scrolling of our own, it will get canceled
        $('html, body').on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
            $('html, body').stop();
        });


        initializeProductRows();
        loadMoreColOrigHtml = $("#loadMoreCol").html();
        setLoadMoreClickFunc();
        //applyFilterOptions();
        refreshCartBtn();
        initializeCheckBoxListeners();
        // There are two cart btns due to sizing of screen. We don't want to apply
        // the listener until document is ready. Otherwise we may not get the
        // listener to be applied to the "second" version of the btn.
        apply_cart_btn_listeners();
        // If the user refreshes the page while they're half way down,
        // then calling this will ensure we display the header bar correctly.
        checkScroll();
        setTimeout(function () {
            addAndAnimateImgSpacers();
        }, 500);
        setProductSectionContainerSize();

    });

    function ageVerificationNoClicked(){
        $.ajax({
            url: '/art/no_selected_on_age_verification/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                console.log("User indicated that they are not of age to purchases our products.")
            },
            error: function (response) {
                console.log("Error - Response was" + response);
            }
        });

        window.location.href='http://www.google.com';
    }

    function checkDenverZipCode() {

        var total = parseFloat((document.getElementById("cartTotal").innerHTML).replace('Total: $', ''))


        var shippingAlert = document.getElementById("shippingAlert");
        var myInput = parseInt(document.getElementById("zip_input_shipping").value);

        var denver_zip_codes = [80002, 80003, 80004, 80005, 80007, 80010, 80011, 80012, 80013, 80014, 80015, 80016, 80017,
            80018, 80019, 80020, 80021, 80022, 80023, 80024, 80030, 80031, 80033, 80045, 80101, 80102,
            80103, 80104, 80105, 80107, 80108, 80109, 80110, 80111, 80112, 80113, 80116, 80117, 80118,
            80120, 80121, 80122, 80123, 80124, 80125, 80126, 80127, 80128, 80129, 80130, 80131, 80134,
            80135, 80136, 80137, 80138, 80202, 80203, 80204, 80205, 80206, 80207, 80209, 80210, 80211,
            80212, 80214, 80215, 80216, 80218, 80219, 80220, 80221, 80222, 80223, 80224, 80226, 80227,
            80228, 80229, 80230, 80231, 80232, 80233, 80234, 80235, 80236, 80237, 80238, 80239, 80241,
            80246, 80247, 80249, 80260, 80264, 80290, 80293, 80294, 80401, 80403, 80419, 80420, 80421,
            80422, 80425, 80427, 80432, 80433, 80436, 80438, 80439, 80440, 80444, 80448, 80449, 80452,
            80453, 80454, 80456, 80457, 80465, 80470, 80475, 80476, 80601, 80602, 80640, 80820, 80827,
            80830, 80835];

        var check_for_denver_zip = denver_zip_codes.includes(myInput);

        if (check_for_denver_zip == true) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["success"]('You are eligible for free shipping!');
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + (total - 9.00).toFixed(2) + " [Free Shipping]";
        }
        else {
            document.getElementById("totalCreditCardForm").innerHTML = "Total: $" + parseFloat(total).toFixed(2);
            document.getElementById("shippingAlert").innerHTML = "";
        }

    }

    function setProductSectionContainerSize() {
        //alert($(window).width());
        if ($(window).width() > 1400) {
            var pixels = $("#mainProductSection").width() * .75;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "80%");
            }, 500);
        }
        else {
            var pixels = $("#mainProductSection").width() * .9;
            $("#productSectionContainer").animate({
                width: pixels
            }, 500);
            setTimeout(function () {
                $("#productSectionContainer").css("width", "90%");
            }, 500);
        }
    }

    function increaseImgWithModal(id) {
        // Get the modal
        var modal = document.getElementById('largeImgModal');

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("prodModalImage");
        var modalImg = document.getElementById("largeImg");
        var captionText = document.getElementById("caption");
        modal.style.display = "block";
        modalImg.src = img.src;
        captionText.innerHTML = img.alt;

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("my-close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };
    }

    function scaleAndShadowById(id, time) {
        $("#" + id).removeClass("remove-shadow-size");
        $("#" + id).addClass("add-shadow-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-shadow-size");
            $("#" + id).removeClass("add-shadow-size");
        }, time);
    }

    function scaleById(id, time) {
        $("#" + id).removeClass("remove-size");
        $("#" + id).addClass("add-size");
        setTimeout(function () {
            $("#" + id).addClass("remove-size");
            $("#" + id).removeClass("add-size");
        }, time);
    }

    function refreshCartBtn() {
        $.ajax({
            url: '/art/get_cart_count/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                $(".cartBtn").each(function () {
                    $(this).text("Cart (" + response + " Items)");
                });
                //$("#cartBtn").text("Cart (" + response + " Items)");
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function clearCart() {
        $.ajax({
            url: '/art/clear_cart/',
            type: "POST",
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                if (!response === "{\"error\":\"\",\"message\":\"success\"}") {
                    console.log("ERROR - Failed to Clear Cart");
                    // TODO: Attempt to email support.ludega.com
                }
            },
            error: function () {
                console.log("ERROR - Failed to Clear Cart");
                // TODO: Attempt to email support.ludega.com
            }
        });
    }

    // This function is called via a "handler" in static/ludega_art/js/sqpaymentform.js
    function chargeCard(nonce) {

        // TODO: Send this json over the network and parse server side.
        var cart_json = $("#cart_info_json").val();
        var obj = JSON.parse(cart_json);

        number_of_keys = (Object.keys(obj).length) - 1;
        var i = 0;
        var prod_id_arr = [];
        var quantity_arr = [];
        var prod_type_arr = [];
        var prod_size_arr = [];

        for (i; i < number_of_keys; i++) {
            prod_id_arr[i] = obj[i]["prod_id"];
            quantity_arr[i] = obj[i]["quantity"];
            prod_type_arr[i] = obj[i]["type"];
            prod_size_arr[i] = obj[i]["size"];
        }

        console.log("DEBUG ON");
        console.log('Nonce: ' + nonce);
        console.log('prod_id_arr: ' + prod_id_arr);
        console.log('quantity_arr: ' + quantity_arr);
        console.log('prod_type_arr: ' + prod_type_arr);
        console.log('prod_size_arr: ' + prod_size_arr);
        console.log('Number of keys: ' + number_of_keys);
        console.log(document.getElementById("firstName_input").value);
        console.log(document.getElementById("lastName_input").value);
        console.log(document.getElementById("address_input").value);
        console.log(document.getElementById("city_input").value);
        console.log(document.getElementById("state_input").value);
        console.log(document.getElementById("zip_input_shipping").value);
        console.log(document.getElementById("notes").value);

        var e = document.getElementById("shippingOptions");
        var shipping_method = e.options[e.selectedIndex].value;
        console.log(shipping_method);

        $.ajax({
            url: '/art/submit_order_charge_card/',
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                nonce: nonce,
                prod_id_arr: prod_id_arr,
                quantity_arr: quantity_arr,
                prod_size_arr: prod_size_arr,
                prod_type_arr: prod_type_arr,
                number_of_keys: number_of_keys,
                email: document.getElementById("email_input").value,
                note: document.getElementById("notes").value,
                first_name: document.getElementById("firstName_input").value,
                last_name: document.getElementById("lastName_input").value,
                address1: document.getElementById("address_input").value,
                address2: document.getElementById("address_input2").value,
                city: document.getElementById("city_input").value,
                state: document.getElementById("state_input").value,
                zip: document.getElementById("zip_input_shipping").value,
                country: document.getElementById("country_input").value,
                shipping_method: shipping_method,
            },
            success: function (response) {

                var fName = document.getElementById("firstName_input").value
                var lName = document.getElementById("firstName_input").value


                if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date');
                    var element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV');
                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration Date / CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Expiration');

                    var element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_EXPIRATION\', u\'detail\': u\'Invalid card expiration date.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}]}') {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Expiration / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-expiration-date");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_AVS_FAILURE\', u\'detail\': u\'Postal code check failed.\'}, {u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'VERIFY_CVV_FAILURE\', u\'detail\': u\'Card verification code check failed.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid CVV / Postal Code');
                    var element = document.getElementById("sq-postal-code");
                    element.className += " sq-input--error";
                    element = document.getElementById("sq-cvv");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'INVALID_CARD\', u\'detail\': u\'Invalid card number.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Invalid Credit Card Number');
                    var element = document.getElementById("sq-card-number");
                    element.className += " sq-input--error";
                    // TODO: Show toast message...
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'PAYMENT_METHOD_ERROR\', u\'code\': u\'CARD_DECLINED\', u\'detail\': u\'Card declined.\'}]}') {

                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["error"]('Sorry, your card was declined.');
                }
                else if (response == '{u\'errors\': [{u\'category\': u\'INVALID_REQUEST_ERROR\', u\'code\': u\'CARD_TOKEN_USED\', u\'detail\': u\'Card nonce already used; please request new nonce.\'}]}') {
                    // Somehow this nonce was already used. We need to re-request a nonce and try this whole process again.
                    console.log("Card nonce already used; please request new nonce and try to charge card again.")
                    //$("#checkoutModalPayBtn").trigger("click");
                }
                // THIS, hopefully, is where we get most of the time!
                else if (response.indexOf("order_confirmation_number") >= 0) {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]('Payment Recieved!');

                    // Clear cart since we just successfully bought everything in the cart
                    if (!clearCart()) {
                        console.log("CRITICAL ERROR - Failed to clear cart.");
                    }

                    console.log(response);
                    response_json = JSON.parse(response);
                    var confirmation_num = response_json["order_confirmation_number"];

                    // Now redirect page to confirmation page.
                    url = '/order_confirmation?order_id_hash=' + confirmation_num;
                    window.location.replace(url);

                }
                else {
                    console.log("CRITICAL ERROR - Got unexpected response from server.\nResponse was: " + response);
                    // TODO: Email software.support@ludega.com
                }
            },
            error: function (response) {
                alert("Failed: " + response.toString());
            }
        });
    }

    // This get's called upon "showing" of the checkout modal
    // Think of it as the "before showing, run this stuff" function
    function initialize_checkout_modal() {

        $('#checkoutEmailHref').trigger("click");

        $('#checkoutForm').trigger("reset");
        $("#email_input").removeClass("sq-input--focus");
        $("#email_valid_color").removeClass("success");
        $("#email_valid_color").addClass("danger");
        $("#email_valid_symbol").removeClass("fa-check-circle");
        $("#email_valid_symbol").addClass("fa-times-circle");

        $("#firstName_input").removeClass("sq-input--focus");
        $("#lastName_input").removeClass("sq-input--focus");
        $("#address_input").removeClass("sq-input--focus");
        $("#city_input").removeClass("sq-input--focus");
        $("#state_input").removeClass("sq-input--focus");
        $("#zip_input_shipping").removeClass("sq-input--focus");
        $("#country_input").removeClass("sq-input--focus");


        $('#cc-form').find('input:text').val('');
        $('#checkoutModal').modal('hide');
        $("#collapse2").removeClass("in");
        $("#collapse3").removeClass("in");
        try {
            var cart_empty = document.getElementById("noProdsInformDiv").innerHTML;

            if (cart_empty == "No Items In Cart") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-left",
                    "preventDuplicates": true,
                    "onclick": null,
                    "showDuration": "500",
                    "hideDuration": "1000",
                    "timeOut": "2000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["error"]('Your cart is empty. Please add an item to checkout.');
                return;
            }
            else {
                $("#checkoutModal").modal()
            }
        }
        catch (err) {
            $("#checkoutModal").modal()
        }


        {#document.getElementsByTagName('iframe')[0].src=document.getElementsByTagName('iframe')[0].src#}
        {#document.getElementsByTagName('iframe')[1].src=document.getElementsByTagName('iframe')[1].src#}
        {#document.getElementsByTagName('iframe')[2].src=document.getElementsByTagName('iframe')[2].src#}
        {#document.getElementsByTagName('iframe')[3].src=document.getElementsByTagName('iframe')[3].src#}


        {#document.getElementById('sq-card-number').src += '';#}


        {#var iframe = document.getElementById('sq-cvv');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#iframe.src = iframe.src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#iframe.src = iframe.src;#}

        {#var iframe = document.getElementById('sq-card-number');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-cvv');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-expiration-date');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src;#}
        {#var iframe = document.getElementById('sq-postal-code');#}
        {#var tmp_src = iframe.src; iframe.src = ''; iframe.src = tmp_src#}
    }


    function scaleAndShadowByDataId(id, time) {
        //alert("here too...");
        $('*[data-id=' + id + ']').removeClass("remove-shadow-size");
        $('*[data-id=' + id + ']').addClass("add-shadow-size");
        setTimeout(function () {
            $('*[data-id=' + id + ']').addClass("remove-shadow-size");
            $('*[data-id=' + id + ']').removeClass("add-shadow-size");
        }, time);
    }

    // This function handles user clicks on "Continue Shopping" in the
    // cart section of the site
    $("#cartContinueShoppingBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        $("#cartContainer").hover(function (event) {
            event.preventDefault();
        });
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    $("#closeCartBtn").on("click", function () {
        $("#cartContainer").addClass("remove-shadow-size-quick");
        fadeOutRemoveElement("closeCartBtn", 250);
        $('html, body').animate({
            scrollTop: $("#mainProductSection").offset().top - $("#navBar1337").height() - $("#cartSection").height() - 40
        }, 1000);
        $("#cartSection").slideUp(500);
        setTimeout(function () {
            $("#cartMainProdRow").html("");
        }, 500);
    });

    // This function handles clicks on the "Checkout" button.
    // We build a link to the "Shopify Pay Page" and redirect the user there
    $("#checkOut").on("click", function () {
        console.log($("#cart_info_json").val());
        var cart_info = JSON.parse($("#cart_info_json").val());

        var checkout_page_url = "https://enspirus-arts.myshopify.com/cart/";
        var i = 0;
        var key_count = Object.keys(cart_info).length;
        if (key_count == 1) {
            scaleById("emptyCartMessage", 350);
            setTimeout(function () {
                scaleById("emptyCartMessage", 350);
            }, 650);
        }
        else {
            for (var key in cart_info) {
                if (key != "total_price") {
                    checkout_page_url += cart_info[key]["variant_id"] + ":" + cart_info[key]["quantity"];
                    if (i < key_count - 2) {
                        checkout_page_url += ",";
                    }
                }
                i++;
            }
            // Direct user to checkout page
            window.location.href = checkout_page_url;
        }
    });

    // This is a niche situation listener. Essentially, if the user
    // wants to see the "Type Description" and clicks/taps on it, but
    // they haven't selected a type in the drop down, then we want to
    // pulse the type selector and only temporarily display a message
    // stating that they haven't chooses a type yet.
    $("#collapsibleTypeDescriptionClickable").on("click", function () {
        if ($('#collapsibleTypeDescriptionHeader').attr('aria-expanded') == "false" && $("#prodTypeSelector").find("option:selected").val() == "default") {
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);

            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("hide");
            }, 2000);
        }
    });

    // This function resets the filters to default which, currently is just
    // "All". Meaning completely open, no filter subset criteria
    $("#refreshFilterBtn").on("click", function () {
        addHiddenInputElement("resetFilterBtnStatus", "clicked");
        $("#AllProductsCheckBox").parent().addClass("checked");
        $("#AllProductsCheckBox").trigger("click");
        //$("#AllImagesCheckBox").parent().addClass("checked");
        addHiddenInputElement("resetFilterBtnStatus", "notClicked");
        //$("#AllImagesCheckBox").trigger("change");
    });

    // Once a size is selected, we should be able to display a price.
    $('#prodSizeSelector').on('change', function () {
        // Get/save product size selection
        var sizeSelection = $(this).find("option:selected").val();
        if (sizeSelection != "default") {
            // Get/save the price for the given selection
            var prod_modal_json_info = JSON.parse($("#prod_modal_content_json_hidden").val());
            // Get/save product type selected
            var typeSelection = $("#prodTypeSelector").find("option:selected").val();
            // Get/save product price (for selected size/type)
            var price = prod_modal_json_info["purchase_options"][typeSelection]["size_price"][sizeSelection];

            // If the price is already showing, collapse it and then open it to show
            // new price
            if ($("#priceDivCol").height() != 0 && $("#priceDivCol").height() != 1) {
                // Collapse it so it can be changed and then re-opened.
                $("#priceDivCol").animate({
                    height: "0px",
                    opacity: 0
                }, 600);
                setTimeout(function () {
                    $("#prodModalPrice").text("$" + price);
                }, 600);
            }
            // It was already collapsed. Just fill price. Then we'll show it (below)
            else {
                $("#prodModalPrice").text("$" + price);
            }
            // Show price (with fade in and expand in)
            $("#priceDivCol").animate({
                height: "60px",
                opacity: 1
            }, 600);
            //$("#priceDivCol").slideDown("slow");
            //$("#priceDivCol").fadeIn("slow");
        }
        else {
            $("#priceDivCol").animate({
                height: "0px",
                opacity: 0
            }, 600);
            setTimeout(function () {
                $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
            }, 600);
        }
    });

    // This accomplishes a cascading drop down list.
    // When Type is selected, then the Size selector
    // can be populated. This function populates the
    // size selector with options based on what type
    // the user selected.
    $('#prodTypeSelector').on('change', function () {
        // Start by removing existing options from size selector
        $("#prodSizeSelector")
            .find('option')
            .remove()
            .end()
            .append('<option value="default">Select Size</option>')
            .val('default')
        ;
        $("#prodSizeSelector").selectpicker('refresh');

        var selected = $(this).find("option:selected").val();
        var modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
        var one_size = "";
        if (selected != "default") {
            // Fill the size dropdown with options
            for (var size in modal_info_json["purchase_options"][selected]["size_price"]) {
                $("#prodSizeSelector").append("<option value='" + size + "'>" + size + "</option>");
                $("#prodSizeSelector").attr('disabled', false);
                $("#prodSizeSelector").selectpicker('refresh');
                one_size = size;
            }

            // Fill the Type Description Header and expand it
            $("#prodModalProdTypeDescription").html(selected + "<br>" + modal_info_json["purchase_options"][selected]["description"]);
            setTimeout(function () {
                $("#collapsibleTypeDescriptionHeader").collapse("show");
            }, 500);
        }
        else {
            // Then they selected the "Default" value which isn't a valid type
            // Disable size as there is no size for "Default"
            $("#prodSizeSelector").attr('disabled', true);
            $("#prodSizeSelector").selectpicker('refresh');
            // Collapse and change the Type Description
            $("#collapsibleTypeDescriptionHeader").collapse("hide");
            setTimeout(function () {
                $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
            }, 500);
        }

        // If there's only one Prod Size for the Prod Type selected,
        // then auto-select that size for the user.
        if ($("#prodSizeSelector option").size() == 2) {
            $("#prodSizeSelector").val(one_size);
            $("#prodSizeSelector").selectpicker('refresh')
        }
        // Size selector may have changed. As a check, trigger the on change function/listener
        $("#prodSizeSelector").trigger("change");
    });

    // This function/listener removes options from type and size selector
    // whenever the modal is closed (modal close). It also collapses the description and
    // type headers/info boxes.
    $("#prodModal").on('hidden.bs.modal', function () {
        // Remove options from type selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodTypeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Remove optiosn from size selector
        // They'll be rebuilt on modal open/unhide action
        $("#prodSizeSelector").children().each(function (i) {
            if (i > 0) {
                $(this).remove();
            }
        });

        // Collaps price section and reset pricing text
        $("#prodModalPrice").text("Select a Product Type and Size for Pricing!");
        $("#priceDivCol").animate({
            height: "0px",
            opacity: 0
        }, 600);

        // Refresh the selectors since we changed them.
        // Bootstrap requires this step.
        $("#prodTypeSelector").selectpicker('refresh');
        $("#prodSizeSelector").selectpicker('refresh');

        // Reset Type Description and Product Description
        $("#prodModalProdTypeDescription").text("You haven't selected a Product Type.");
        $("#collapsibleTypeDescriptionHeader").collapse("hide");
        $("#collapsibleDescriptionHeader").collapse("hide");

        // Remove Product Image
        $("#prodModalImage").attr("src", "");
    });

    // When the user clicks the "Cart" button at the top, this is what happens.
    function apply_cart_btn_listeners() {
        $(".cartBtn").each(function () {
            $(this).on("click", function () {
                if ($("#cartSection").css("display") == "none") {
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            // Save the JSON returned in a hidden form
                            addHiddenInputElement("cart_info_json", response);

                            // Parse response (json formatted string) into a json object for iterating through it
                            var cart_info_json = JSON.parse(response);

                            // for each item in the cart
                            var i = 0;
                            for (var key in cart_info_json) {
                                var item_row = "";
                                if (i == 0 && Object.keys(cart_info_json).length != 3 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;">';
                                }
                                else if (i == Object.keys(cart_info_json).length - 2 && Object.keys(cart_info_json).length != 2) {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">';
                                }
                                else {
                                    item_row = '<div id="cartItemProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-itemCount="' + i + '" class="row table-hover" style="margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-top:0.5px solid lightgray;border-bottom:0.5px solid lightgray;">';
                                }
                                if (key != "total_price") {
                                    $("#cartMainProdRow").append('' +
                                        item_row +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row">' +
                                        '</div>' +
                                        '<div class="row"  style="padding-bottom:10px;">' +
                                        '<div class="col-xs-4"><img src="/' + cart_info_json[key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                                        '<div class="col-xs-8">' +
                                        '<a><h3 class="title">' + cart_info_json[key]["name"] + '</h3></a>' +
                                        '<p>' + ' ' + cart_info_json[key]["type"] + '</p>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                                        '<div class="col-sm-6 col-xs-12">' +
                                        '<div class="row" style="padding-bottom:15px;">' +
                                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Quantity</a></div>' +
                                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                                        '</div>' +
                                        '<div class="row">' +
                                        '<div id="unitPriceProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + cart_info_json[key]["price"] + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<input onchange="quantityChange(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="quantityProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_info_json[key]["quantity"]) + '">' +
                                        '</div>' +
                                        '<div id="subtotalProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_info_json[key]["price"] * cart_info_json[key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                                        '<div class="col-xs-3 text-center">' +
                                        '<button onclick="cartRemoveItem(' + cart_info_json[key]["prod_id"] + ',\'' + cart_info_json[key]["size"] + '\',\'' + cart_info_json[key]["type"] + '\')" id="cartRemoveProdId' + cart_info_json[key]["prod_id"] + cart_info_json[key]["size"] + cart_info_json[key]["type"] + '" data-id="' + cart_info_json[key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                    );

                                }
                                i++;
                            }

                            // If we added at least 1 item
                            // There will always be one key (total_amount). So if there are 2, then we had
                            // at least one item. Thus if i > 1, not i > 0


                            if (i > 1) {
                                var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                                var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                                var shipping = 9.00.toFixed(2);

                                /*if (subTotal >= 100){
                                    shipping = 0.00.toFixed(2);
                                }*/

                                var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);

                                $("#cartMainProdRow").append('' +
                                    '<div id="cartTotalRow" class="row" style="padding-top:15px;">' +
                                    '<div class="col-sm-6 col-xs-12"></div>' +
                                    '<div class="col-sm-6 col-xs-12">' +
                                    //'<div class="col-xs-3"></div>' +
                                    '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                                    //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                                    '</div>' +
                                    '</div>'
                                );
                            }
                            // Else no items were added. So display something saying so.
                            else {
                                $("#cartMainProdRow").append('<div id="emptyCartMessage" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                            }

                            $("#cartContainer").removeClass("remove-shadow-size-quick");
                            if ($("#closeCartBtn").css("display") == "none") {
                                $("#closeCartBtn").css("display", "block");
                            }
                            $("#cartSection").slideToggle();
                            $('html, body').animate({
                                scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                            }, 1000);
                            if ($("html").hasClass("nav-open")) {
                                $("#menu-toggle").trigger("click");
                            }
                            //console.log(response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                }
                else {
                    $('html, body').animate({
                        scrollTop: $("#cartSection").offset().top - $("#navBar1337").height()
                    }, 1000);
                    if ($("html").hasClass("nav-open")) {
                        $("#menu-toggle").trigger("click");
                    }
                }

                // Seems we get weird flickering effects (involved in the animate scrollTop action) if this isn't here
                return false;
            });
        });
    }

    function quantityChange(id, size, type) {
        // Special Note: Size may have instances of periods to represent decimal sizes. When
        // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
        // below, you'll see that I'm escaping the period using our replaceAll string function.
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        if ($("[id='quantityProdId" + concatIdSizeType + "']").val() <= 0) {
            // Display notification informing of success
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]('Select the red trash can to remove an item from your cart.');

            $("[id='quantityProdId" + concatIdSizeType + "']").val(1);
            scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 650);
            setTimeout(function () {
                scaleById("cartRemoveProdId" + concatIdSizeType, 350);
            }, 1300);
        }
        else {
            // Firstly, inform the server that the user would like to add to their cart. And attempt to do so...
            var _size = size;
            var _type = type;
            $.ajax({
                url: '/art/update_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: $("[id='quantityProdId" + concatIdSizeType + "']").val(),
                    price: $("[id='unitPriceProdId" + concatIdSizeType + "']").text(),
                    size: _size,
                    type: _type,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    scaleAndShadowById("cartBtn", 500);
                    refreshCartBtn();
                    // Updating hidden json
                    $.ajax({
                        url: '/art/get_cart/',
                        type: "POST",
                        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                        success: function (response) {
                            addHiddenInputElement("cart_info_json", response);
                        },
                        error: function () {
                            alert("Error...");
                        }
                    });
                },
                error: function () {
                    alert("Error...");
                }
            });

            // This behemoth of a statement simply sets the text of the subtotal for a give item in the cart
            // The length of the statement is due to rounding, multiplication, and ridiculous id naming convention I've
            // used for naming/id'ing items in the cart
            $("[id='subtotalProdId" + concatIdSizeType + "']").text("$" + (Math.round((parseFloat($("[id='unitPriceProdId" + concatIdSizeType + "']").text().replace("$", "")) * $("[id='quantityProdId" + concatIdSizeType + "']").val()) * 100) / 100).toFixed(2));

            //We also want to refresh the cart total.
            refreshCartTotal();
        }
    }

    function prodHover(id) {
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
        $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
        if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
            $("#imgProdId" + id).css("transform", "scale(.90, .90)");
        }
        $("#prod" + id).hover(function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "4px 4px 10px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-backface-visibility", "hidden");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(.90, .90)");
            }
        }, function () {
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            $("#imgProdId" + id).css("-webkit-box-shadow", "7px 7px 15px 0px rgba(0,0,0,0.75)");
            if ($("#imgProdId" + id).width() >= $("#prod" + id).width() * 0.91) {
                $("#imgProdId" + id).css("transform", "scale(1,1)");
            }
        });
    }

    // This function loops through each item in the cart and applies a border on top or bottom as needed
    function redrawCartItemBorders() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                if (i == 0) {
                    $(this).css("border-top", "0.5px solid lightgray");
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
                else {
                    $(this).css("border-bottom", "0.5px solid lightgray");
                }
            }
            i++;
        });
    }

    // This function adds up all items in the cart and renders the total at the bottom
    function refreshCartTotal() {
        var itemCount = $("#cartMainProdRow").children().size();
        var i = 0;
        var total = 0;
        var subTotal = 0;
        var taxes = 0;
        var shipping = 0;
        $("#cartMainProdRow").children().each(function () {
            if (i < itemCount - 1) {
                var subtotalId = ($(this).attr("id")).replace("cartItemProdId", "subtotalProdId");
                subtotalId = subtotalId.replaceAll(".", "\\.");
                if (subtotalId != "emptyCartMessage") {
                    total += parseFloat(($("[id='" + subtotalId + "']").text()).replace("$", ""));
                }
            }
            i++;
        });


        taxes = ((Math.round(total * 100) / 100) * 0.029).toFixed(2);
        subTotal = (Math.round(total * 100) / 100).toFixed(2);
        shipping = 9.00.toFixed(2);
        /*if (subTotal >= 100){
            shipping = 0.00.toFixed(2);
        }*/
        total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);
        $("#cartTotal").text("Total: $" + total);
        $("#tax").text("Tax: $" + taxes);
        $("#subTotal").text("Sub Total: $" + subTotal);
        $("#shippingCost").text("Shipping: $" + shipping);


    }

    // This function handles user clicks on the Trash icon next to items
    // in the cart
    function cartRemoveItem(id, _size, _type) {
        var concatIdSizeType = id + _size + _type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        $("[id='cartItemProdId" + concatIdSizeType + "']").slideUp(500);
        setTimeout(function () {
            $("[id='cartItemProdId" + concatIdSizeType + "']").remove();
        }, 500);

        // make a call to the server to remove the item(s) from the cart
        $.ajax({
            url: '/art/remove_from_cart/',
            type: "POST",
            data: {product_id: id, size: _size, type: _type, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                refreshCartBtn();

                //Need to ensure other one is removed at this point. So waiting half a second to assess
                setTimeout(function () {
                    // If there's no more items, we want to show Empty Cart Message
                    var itemCount = $("#cartMainProdRow").children().length - 1;
                    if (itemCount == 0) {
                        $("#cartMainProdRow").append('<div id="emptyCartMessage" style="display:none;text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items In Cart</h3></div>');
                        $("#emptyCartMessage").slideDown("slow");
                        $("#cartTotalRow").slideUp(500);
                        setTimeout(function () {
                            $("#cartTotalRow").remove();
                        }, 500);
                    }
                    else {
                        setTimeout(function () {
                            redrawCartItemBorders();
                            refreshCartTotal();
                        }, 500);
                    }
                }, 500);

                // Updating hidden json
                $.ajax({
                    url: '/art/get_cart/',
                    type: "POST",
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function (response) {
                        addHiddenInputElement("cart_info_json", response);
                    },
                    error: function () {
                        alert("Error...");
                    }
                });
            },
            error: function () {
                alert("Error...");
            }
        });
    }

    function drawNewItemInCart(id, size, type) {
        var concatIdSizeType = id + size + type;
        concatIdSizeType = concatIdSizeType.replaceAll(".", "\\.");
        // Start by checking if this particular item already exists in our cart
        // If so, then we just need to increment the quantity by 1
        var item_already_in_cart = false;
        $("#cartMainProdRow").children().each(function () {
            if ($(this).attr("id") == "cartItemProdId" + id + size + type) {
                item_already_in_cart = true;
            }
        });
        // Then all we need to do is increment the quantity for the given item and triger the quantity change event
        if (item_already_in_cart) {
            var new_quant_val = parseInt($("[id='quantityProdId" + concatIdSizeType + "']").val()) + 1;
            $("[id='quantityProdId" + concatIdSizeType + "']").val(new_quant_val);
            $("[id='quantityProdId" + concatIdSizeType + "']").trigger("change");
        }
        // Else, we've got an entire item row to add to the cart (without closing and reopening it)
        else {
            // Start by updating the cart information (that we store in a hidden json)
            $.ajax({
                url: '/art/get_cart/',
                type: "POST",
                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (response) {
                    addHiddenInputElement("cart_info_json", response);
                    // Debugging Purposes Only
                    //console.log(response);
                    // Now locate the item we're adding to the cart in the JSON obj
                    var cart_json_obj = JSON.parse(response);
                    var da_key = "";
                    for (var key in cart_json_obj) {
                        if (cart_json_obj[key].hasOwnProperty("prod_id")) {
                            if (cart_json_obj[key]["prod_id"] == id) {
                                da_key = key;
                            }
                        }
                    }
                    // Now that we have da key to it (lol...) we can generate the html to add our item
                    // to our cart. We're going to start it out as display:none and then expand
                    // it once it's added fully.
                    var total_row = $("#cartMainProdRow").children().last();
                    total_row.before('' +
                        '<div id="cartItemProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="row table-hover" style="display:none;margin-left:10px;margin-right:10px;padding-top:10px;padding-bottom:10px;border-bottom:0.5px solid lightgray;">' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row">' +
                        '</div>' +
                        '<div class="row"  style="padding-bottom:10px;">' +
                        '<div class="col-xs-4"><img src="/' + cart_json_obj[da_key]["img_loc"] + '" class="img-responsive" style="margin:auto;-webkit-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);-moz-box-shadow:7px 7px 15px 0px rgba(0,0,0,0.75);box-shadow: 7px 7px 15px 0px rgba(0,0,0,0.75);max-height:150px;"></div>' +
                        '<div class="col-xs-8">' +
                        '<a><h3 class="title">' + cart_json_obj[da_key]["name"] + '</h3></a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        //'<div class="col-sm-6 col-xs-12" style="height:40px"></div>' +
                        '<div class="col-sm-6 col-xs-12">' +
                        '<div class="row" style="padding-bottom:15px;">' +
                        '<div class="col-xs-3 text-center"><a>Price</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Quality</a></div>' +
                        '<div class="col-xs-3 text-center"><a>Subtotal</a></div>' +
                        '</div>' +
                        '<div class="row">' +
                        '<div id="unitPriceProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + cart_json_obj[da_key]["price"] + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<input onchange="quantityChange(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="quantityProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" type="number" class="form-control text-center" value="' + (cart_json_obj[da_key]["quantity"]) + '">' +
                        '</div>' +
                        '<div id="subtotalProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" class="col-xs-3 text-center">$' + (Math.round((cart_json_obj[da_key]["price"] * cart_json_obj[da_key]["quantity"]) * 100) / 100).toFixed(2) + '</div>' +
                        '<div class="col-xs-3 text-center">' +
                        '<button onclick="cartRemoveItem(' + cart_json_obj[da_key]["prod_id"] + ',\'' + cart_json_obj[da_key]["size"] + '\',\'' + cart_json_obj[da_key]["type"] + '\')" id="cartRemoveProdId' + cart_json_obj[da_key]["prod_id"] + cart_json_obj[da_key]["size"] + cart_json_obj[da_key]["type"] + '" data-id="' + cart_json_obj[da_key]["prod_id"] + '" class="btn btn-danger btn-sm deleteItemBtn"><i class="fa fa-trash-o"></i></button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                    );

                    if (!!document.getElementById("emptyCartMessage")) {
                        // Fade out the message
                        $("#emptyCartMessage").animate({
                            opacity: 0,
                            height: "0px"
                        }, 500);
                        setTimeout(function () {
                            $("#emptyCartMessage").remove();
                        }, 500);

                        var subTotal = (Math.round(cart_info_json["total_price"] * 100) / 100).toFixed(2);
                        var taxes = ((Math.round(cart_info_json["total_price"] * 100) / 100) * 0.029).toFixed(2)

                        var shipping = 9.00.toFixed(2);
                        if (subTotal >= 100) {
                            shipping = 0.00.toFixed(2);
                        }

                        var total = (parseFloat(subTotal) + parseFloat(taxes) + parseFloat(shipping)).toFixed(2);


                        $("#cartMainProdRow").append('' +
                            '<div style="display:none;" id="cartTotalRow" class="row" style="padding-top:15px;">' +
                            '<div class="col-sm-6 col-xs-12"></div>' +
                            '<div class="col-sm-6 col-xs-12">' +
                            //'<div class="col-xs-3"></div>' +
                            '<div id="cartTotalRow" class="col-xs-9 pull-right text-right" style="padding-right:40px;"><a><p id="subTotal" style="font-size:10px;">Sub Total: $' + subTotal + '</p><p id="tax" style="font-size:10px;">Tax: $' + taxes + '</p> <p id="shippingCost" style="font-size:10px;">Shipping[USPS Priority]: $' + shipping + '</p><h3 id="cartTotal" class="title">Total: $' + total + '</h3></a></div>' +
                            //'<div class="col-xs-3"><a><h3  id="cartTotal" class="title">$' + cart_info_json["total_price"] + '</h3></a></div>' +
                            '</div>' +
                            '</div>'
                        );

                        $("#cartTotalRow").slideDown("slow");
                    }

                    // Show it (via sliding it down)
                    // Special Note: Size may have instances of periods to represent decimal sizes. When
                    // accessing elements using JQUERY, the period is reserved (has special meaning). Thus,
                    // below, you'll see that I'm escaping the period using our replaceAll string function.
                    var cartItemId = "cartItemProdId" + id + size + type;
                    cartItemId = cartItemId.replaceAll(".", "\\.");
                    $("[id='" + cartItemId + "']").slideDown("slow");
                    // Re-draw border lines as needed
                    redrawCartItemBorders();
                    refreshCartTotal();
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
    }

    // Handles the "Add to Cart" clicks.
    $("#prodModalAddToCart").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Type.");

            // Pulse the type selector
            scaleAndShadowByDataId("prodTypeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodTypeSelector", 500);
            }, 1000);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-right",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("You haven't selected a Product Size.");

            // pulse the size selector
            scaleAndShadowByDataId("prodSizeSelector", 500);
            setTimeout(function () {
                scaleAndShadowByDataId("prodSizeSelector", 500);
            }, 1000);
        }
        else {
            var prod_modal_info_json = JSON.parse($("#prod_modal_content_json_hidden").val());
            var id = prod_modal_info_json["requested_prod"]["id"];
            var size_selected = $("#prodSizeSelector").find("option:selected").val();
            var type_selected = $("#prodTypeSelector").find("option:selected").val();
            $.ajax({
                url: '/art/add_to_cart/',
                type: "POST",
                data: {
                    product_id: id,
                    quantity: 1,
                    price: $("#prodModalPrice").text(),
                    size: size_selected,
                    type: type_selected,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    // Close Modal
                    $("#modalCloseBtn").trigger("click");

                    // Display notification informing of success
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-left",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "2000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    };
                    toastr["info"]("Added to Cart!");

                    scaleAndShadowById("cartBtn", 350);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 700);
                    setTimeout(function () {
                        scaleAndShadowById("cartBtn", 350);
                    }, 1400);
                    refreshCartBtn();

                    // If the cart is currently showing, then we want to add to it on the fly (as apposed to
                    // building the entire thing from scratch like the apply_cart_btn_listeners() function(s)
                    // do.
                    if ($("#cartSection").css("display") == "block") {
                        drawNewItemInCart(id, size_selected, type_selected);
                    }

                    // This flashes helps draw attention to the menu button (when user is on phone)
                    $("#menu-toggle").addClass("toggled");
                    setTimeout(function () {
                        $("#menu-toggle").removeClass("toggled");
                    }, 200);
                    setTimeout(function () {
                        $("#menu-toggle").addClass("toggled");
                        setTimeout(function () {
                            $("#menu-toggle").removeClass("toggled");
                        }, 100);
                    }, 500);
                },
                error: function () {
                    alert("Error...");
                }
            });
        }
        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // Handles the "Buy Now" clicks.
    $("#prodModalBuyNow").click(function () {
        if ($("#prodTypeSelector").find("option:selected").text() == "Select Type") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Type!");

            $('*[data-id="prodTypeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodTypeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodTypeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodTypeSelector"]').removeClass("add-shadow-size");
            }, 500);
        }
        else if ($("#prodSizeSelector").find("option:selected").text() == "Select Size") {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-left",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["info"]("Select a Size!");

            $('*[data-id="prodSizeSelector"]').removeClass("remove-shadow-size");
            $('*[data-id="prodSizeSelector"]').addClass("add-shadow-size");
            setTimeout(function () {
                $('*[data-id="prodSizeSelector"]').addClass("remove-shadow-size");
                $('*[data-id="prodSizeSelector"]').removeClass("add-shadow-size");
            }, 500);

        }
        else {
            $("#prodModalAddToCart").trigger("click");
            $("#cartBtn").trigger("click");
            setTimeout(function () {
                scaleAndShadowById("checkOut", 500);
                setTimeout(function () {
                    scaleAndShadowById("checkOut", 500);
                }, 1000);
            }, 2000);
            setTimeout(function () {
                if ($("#checkOut").visible() == false) {
                    $('html, body').animate({
                        scrollTop: $("#checkOut").offset().top - $(window).height() + $("#navBar1337").height() + 20
                    }, 1000);
                }
            }, 2000);
        }

        //alert("Size selector: " + $("#prodSizeSelector").find("option:selected").text());
        //alert("Type selector: " + $("#prodTypeSelector").find("option:selected").text());
    });

    // When the screen is scrolled down a certain amount, this function
    // changes the color of the menu bar at the top. This is done for
    // style/readability
    function checkScroll() {
        if ($(document).scrollTop() > 180) {
            if (transparent) {
                transparent = false;
                $('nav[role="navigation"]').removeClass('navbar-transparent').addClass('navbar-default');
            }
        } else {
            if (!transparent) {
                transparent = true;
                $('nav[role="navigation"]').addClass('navbar-transparent').removeClass('navbar-default');
            }
        }
    }

    // This beautiful function/filter will return boolean of whether a given element is or is not within the
    // view port.
    // Currently not working as intended. Using visible.js instead.
    // Example use: $('div').is(':offscreen');
    jQuery.expr.filters.offscreen = function (el) {
        var rect = el.getBoundingClientRect();
        return (
            (rect.x + rect.width) < 0
            || (rect.y + rect.height) < 0
            || (rect.x > window.innerWidth || rect.y > window.innerHeight)
        );
    };

    // When card-product is clicked, we need to reach out to server and fill modal with
    // appropriate information.
    $(document).on("click", ".card-product", function () {

        // Call out to server to get needed information (for product modal)
        // Response should be json formatted data. alert(response) to see it.
        $.ajax({
            url: '/art/get_product_modal_info/',
            type: "POST",
            data: {id: $(this).data('id'), csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                // Debugging purposes. Uncomment to see JSON data.
                //console.log(response);

                // Save the response in hidden form element
                if (!!document.getElementById("prod_modal_content_json_hidden")) {
                    $("#prod_modal_content_json_hidden").val(response);
                }
                else {
                    addHiddenInputElement("prod_modal_content_json_hidden", response);
                }

                // Parse the json into object/var
                var modal_info_json = JSON.parse(response);

                // Fill modal
                $("#prodModalImage").attr('src', '/' + modal_info_json["requested_prod"]["image_file"]);
                $("#prodModalTitle").text(modal_info_json["requested_prod"]["product_name"]);
                $("#prodModalProdDescription").text(modal_info_json["requested_prod"]["description"]);
                // Expand description header
                setTimeout(function () {
                    $("#collapsibleDescriptionHeader").collapse("show");
                }, 500);

                //alert(Object.keys(modal_info_json["purchase_options"])[0]);
                //alert(JSON.stringify(modal_info_json["purchase_options"]));

                // Loop through type options and fill selector
                for (var key in modal_info_json["purchase_options"]) {
                    $("#prodTypeSelector").append("<option value='" + key + "'>" + key + "</option>").selectpicker('refresh');
                }
                // Refresh selectors to update with new options and disable size
                $("#prodSizeSelector").attr('disabled', true);
                $("#prodSizeSelector").selectpicker('refresh');
                $("#prodTypeSelector").selectpicker('refresh');
                // If there's only one "Type" option, then select it for the user
                if (Object.keys(modal_info_json["purchase_options"]).length == 1) {
                    // Set Type selector to the one option that exists...
                    $("#prodTypeSelector").val(Object.keys(modal_info_json["purchase_options"])[0]);
                    $("#prodTypeSelector").selectpicker('refresh'); // Refresh selector so change shows in browser
                    // Trigger the change event so that the size type get's populated and activated
                }
                // Trigger the change in case we ended up setting it to something (so that other listener actions trigger)
                $("#prodTypeSelector").trigger("change");

                // Adding in related/similar products scroller content
                for (var key in modal_info_json["related_prods"]) {
                    $("#relatedProdsScroller").append('<li class="nbs-flexisel-item" style="width: 113.75px;">' +
                        '     <a href="#product-page2" role="tab" data-toggle="tab" aria-expanded="false">' +
                        '        <img src="/' + modal_info_json["related_prods"][key]["image_file"] + '" alt="...">' +
                        '    </a>' +
                        '</li>');
                }

            },
            error: function () {
                alert("Error...");
            }
        });

        // Build Modal using #prod_modal_content_json_hidden

        //var products = JSON.parse("{{products|escapejs}}");

        //alert(JSON.string(products));

        var prodID = $(this).data('id');

        //$(".modal-body #modal-body").text( prodID );
    });

    var parallax = function () {
        var current_scroll = $(this).scrollTop();

        oVal = ($(window).scrollTop() / 3);
        big_image.css('top', oVal);
    };

    // Handles little clickable filter button on each product box
    function filterBtnOnClick(prodType) {
        event.stopPropagation();
        alert("Filter button clicked. Still need to implement filter. Would have filtered to " + prodType);
    }

    // Function to hide all product rows past the 1th indicy (aka show only 2 prod rows)
    function initializeProductRows() {
        var rowNum = 2;
        var id = 'row' + rowNum;
        var hasNextRow = !!document.getElementById(id);
        // while there exists another row (past the 1th row or the last row we hid)
        while (hasNextRow) {
            // Setting selector for jquery hide function
            selector = '#' + id;
            // Hiding rows (past 0th and 1th)
            $(selector).slideUp("fast");
            // If the row's child elements have a height of 0, display of none, or opacity of 0,
            // Then we will undo that since their parent element/container is what we'll be
            // expanding. When we expand the parent element, we want the children to be visible.
            $(selector).children().each(function (i) {
                if ($(this).css("height") == "0px") {
                    $(this).css("height", "100%");
                }
                if ($(this).css("opacity") == "0") {
                    $(this).css("opacity", "1");
                }
                if ($(this).css("display") == "none") {
                    $(this).css("display", "block");
                }
            });
            // Increment row num (to check for)
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Loads/Shows/Un-hides/Displays 2 more product rows
    // if they exist. It does this with a fade and an expand.
    function loadMoreProductRows(option, time) {
        // Start by removing the noProdsInformDiv
        $("#noProdsInformDiv").remove();
        // start searching for hidden rows
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a next row
        var hasNextRow = !!document.getElementById(id);
        // Start a counter. We only want to show 2 new rows (per "Load More..." click)
        var count = 0;
        while (hasNextRow && count < 2) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);

            // if it's hidden, then display it (with some animation to it)
            if (option == "fadeAndExpand") {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.css("overflow", "visible");
                    //row.css("height","0px");
                    row.css("opacity", 0);
                    //row.css("display","block");
                    row.slideToggle('slow');
                    row.animate({
                        //height:"100%",
                        opacity: 1
                    }, time);

                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }
            else if (option == "expandThenFade") {
                if ($("#productsStatus").val() == "some") {
                    if (row.css("display") == "none" || row.css("opacity") == 0) {
                        row.animate({
                            height: "auto"
                        }, 1);
                        setTimeout(function () {
                            row.animate({
                                opacity: 1
                            }, 1);
                        }, 1);
                    }
                    row.children().each(function () {
                        if ($(this).css("display") == "none" || $(this).css("opacity") == 0) {

                            $(this).height("100%");
                            $(this).css({opacity: 1});
                            // No Animation needed here. If we're here, the parent class should have
                            // opacity of 0
                        }
                    });
                    if ($("#productColumn").css("display") == "none" || $("#productColumn").css("opacity") == 0) {

                        $("#productColumn").slideDown(time);
                        /*$("#productColumn").animate({
                                height: "toggle"
                            }, 1000);*/

                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }
                else {
                    // There aren't any products to show
                    // Due to the Filter settings.
                    // Inform the user.
                    if (!!document.getElementById("noProdsInformDiv") == false) {
                        $("#productColumn").append('<div id="wrapper" style="text-align:center"><h3 class="title" id="noProdsInformDiv" style="display: inline-block;">No Items Met Your Chosen Filter Options</h3></div>');
                        $("#productColumn").slideDown(time);
                        $("#productColumn").animate({
                            opacity: 1
                        }, time);
                    }
                }

                // Scroll the screen so that the newly displayed products are some % from the
                // top of the screen
                if (option == "fadeAndExpand") {
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                }
                // This was a hidden row and now it isn't. Increment counter.
                // Only want to do this to two (per "Load More..." click)
                count++;
            }
            else {
                if (row.css("display") == "none" || row.css("opacity") == 0) {
                    row.animate({
                        opacity: 1
                    }, time);
                    // Scroll the screen so that the newly displayed products are some % from the
                    // top of the screen
                    $('html, body').animate({scrollTop: ((row.offset().top) - ($(window).height() * 0.11))}, time);
                    // This was a hidden row and now it isn't. Increment counter.
                    // Only want to do this to two (per "Load More..." click)
                    count++;
                }
            }

            // Increment row num (to check for) and count
            rowNum++;

            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
            setTimeout(function () {
                addImgSpacers();
            }, time / 2)
        }
    }

    // This function returns true if there exist hidden product rows on the page
    // This function returns false if there exist no hidden product rows on the page
    function existsHiddenProdRows() {
        // We know we've got the 1th and 0th row showing, so start searching
        // for hidden rows at the 2nd indexed (aka 3rd) row.
        var rowNum = 2;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // Check if there even is a 3rd row (aka 2nd indexed row)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            var row = $(selector);
            // If this row is hidden, then there exist some hidden row(s)
            if (row.css("display") == "none" && row.children().length > 0) {
                return true;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;                    // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
        return false;
    }

    // The "Load More..." button gets removed and re-added throughout its life.
    // Each time the button element is removed and added, this function needs
    // to be called in order to reapply the click listener (and function that
    // goes with it).
    function setLoadMoreClickFunc() {
        $('#loadMore').click(function () {
            loadMoreProductRows("fadeAndExpand", 1000);
            setTimeout(function () {
                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>Load more...</button>" +
                    "</div>";
                var options = {
                    action: "setState",
                    state: "info"
                };
                $('#loadMore').morphingButton(options);
                setTimeout(function () {
                    // Fade out existing button
                    if (existsHiddenProdRows()) {
                        $('#loadMoreCol').fadeOut(400); // Match this with id=LBFOD line
                    }
                    setTimeout(function () {
                        if (existsHiddenProdRows()) {
                            $('#loadMoreCol').replaceWith(loadMoreHtml);
                            // Fade in new instance of button
                            $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                            $('#loadMore').morphingButton();
                        } else {
                            $('#loadMoreCol').animate({
                                height: "toggle",
                                opacity: "toggle"
                            }, 1000);
                        }
                    }, 400); // Duration given for "Fade Out" of Light Blue (Success) Circle (id: LBFOD)
                }, 300); // Duration of Light Blue (Success) Circle (prior to Fade Out)
            }, 700); // Duration of Spinning Circle
        });
    }

    // If All is checked and user checks another filter box, then all should become
    // unchecked
    function initializeCheckBoxListeners() {
        {% for type in types %}
            $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllProductsCheckBox was checked, un-check it.
                if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
                    $("#AllProductsCheckBox").parent().removeClass("checked");
                }

                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // Color Filtering Removed For Now
        /*
            {% for color in colors %}
                $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                    // If AllColorsCheckBox was checked, un-check it.
                    if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
                        $("#AllColorsCheckBox").parent().removeClass("checked");
                    }

                    // Apply the filter change that just happened.
                    applyFilterOptions();
                });
            {% endfor %}
            */

        {% for image in images %}
            $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").change(function () {
                // If AllImagesCheckBox was checked, un-check it.
                if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
                    $("#AllImagesCheckBox").parent().removeClass("checked");
                }
                if ($("#resetFilterBtnStatus").val() != "clicked") {
                    // Apply the filter change that just happened.
                    applyFilterOptions();
                }
            });
        {% endfor %}

        // When All is checked (in colors subsection) then other boxes should be unchecked
        // NOTE: Colors Filtering Disabled For Now
        /*$("#AllColorsCheckBox").change(function(){
                {% for color in colors %}
                    $("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in Product subsection) then other boxes should be unchecked
        $("#AllProductsCheckBox").change(function () {
            {% for type in types %}
                $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            if ($("#resetFilterBtnStatus").val() != "clicked") {
                // Apply the filter change that just happened.
                applyFilterOptions();
            }
        });

        // When All is checked (in Clothing subsection) then other boxes should be unchecked
        // Merging Clothing and Products Check Box Filters Sections
        // Thus commenting out below section
        /*$("#AllClothingCheckBox").change(function(){
                {% for type in types %}
                    {% if type.is_clothing == True %}
                        $("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
                    {% endif %}
                {% endfor %}

                // Apply the filter change that just happened.
                applyFilterOptions();
            });*/

        // When All is checked (in image subsection) then other boxes should be unchecked
        $("#AllImagesCheckBox").change(function () {
            {% for image in images %}
                $("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().removeClass("checked");
            {% endfor %}

            // Apply the filter change that just happened.
            applyFilterOptions();
        });

    }

    // This function returns the filter state as an object containing arrays.
    // Each array contains a list of valid types to be filtered to
    function getFilterState() {
        var filters = {
            images: [],
            clothing: [],
            products: [],
            colors: []
        };

        // Iterate over each check box and fill appropriate filter array
        if ($("#AllClothingCheckBox").parent().hasClass("checked")) {
            filters.clothing[0] = "All";
        }
        if ($("#AllProductsCheckBox").parent().hasClass("checked")) {
            filters.products[0] = "All";
        }
        if ($("#AllColorsCheckBox").parent().hasClass("checked")) {
            filters.colors[0] = "All";
        }
        if ($("#AllImagesCheckBox").parent().hasClass("checked")) {
            filters.images[0] = "All";
        }
        // If the products filter don't have "all" checked
        if (!($("#AllProductsCheckBox").parent().hasClass("checked"))) {
            var productFilterCount = 0;
            {% for type in types %}
                if ($("#" + "{{type.display_name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.products[productFilterCount] = "{{type.display_name}}";
                    productFilterCount++;
                }
            {% endfor %}
        }

        if (!($("#AllImagesCheckBox").parent().hasClass("checked"))) {
            var imageFilterCount = 0;
            {% for image in images %}
                if ($("#" + "{{image.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")) {
                    filters.images[imageFilterCount] = "{{image.name}}";
                    imageFilterCount++;
                }
            {% endfor %}
        }

        /*if(!($("#AllColorsCheckBox").parent().hasClass("checked"))) {
                var colorFilterCount = 0;
                {% for color in colors %}
                    if($("#" + "{{color.name|str_replace:' ,'}}" + "CheckBox").parent().hasClass("checked")){
                        filters.colors[colorFilterCount] = "{{color.name}}";
                        colorFilterCount++;
                    }
                {% endfor %}
            }*/

        return filters;
    }

    // Replaces all instances of a given string in another string
    String.prototype.replaceAll = function (str1, str2, ignore) {
        return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof(str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
    };

    // This function adds "text" to the value() field of the element
    // with id of "elementId"
    function addHiddenInputElement(elementId, text) {
        text = text.replaceAll("'", "&#39;");
        //text = text.replace("\"","&#34;");
        if (!!document.getElementById(elementId)) {
            $("#" + elementId).val(text);
        }
        else {
            $('#hiddenForm').append("<input type='hidden' name='" + elementId + "' id='" + elementId + "' value='" + text + "'/>");
        }
    }

    // As the name suggests, this will animated an object fading away
    // and then remvoe the element
    function fadeOutRemoveElement(elementId, time) {
        $("#" + elementId).animate({
            opacity: "toggle"
        }, time);
        setTimeout(function () {
            $("[data-id=" + elementId + "]").remove();
        }, time);
    }

    // As the name suggests, this function collapses all product rows.
    // Not currently used. Used to be. Then implemented same effect
    // except utilized parent element/container.
    function collapseAllProductRows() {
        // Start by fading out the "Load More..." button as we don't want the user to click this while
        // we're refreshing the product tables/rows
        $("#loadMoreCol").animate({
            opacity: 0
        }, 1000);

        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results)
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;
            // get row element
            $(selector).animate({
                opacity: 0//,
                //height:"toggle"
            }, 1000);

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // Removes products starting at a row/column and
    // continuing until there are no prods left to remove
    function removeRemainingProducts(startRow, startCol) {
        //alert(startRow + " , " + startCol);
        var rowNum = startRow;
        var colNum = startCol;
        // Set initial element id to begin at
        var id = 'row' + rowNum;

        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            var i = 0;
            $(selector).children().each(function () {
                if ((rowNum == startRow && i >= colNum) || (rowNum != startRow)) {
                    /*$(this).animate({
                            height:0
                        },2000);
                        var prod_element = $(this);
                        setTimeout(function(){
                            prod_element.remove();
                        }, 2000);*/
                    $(this).remove();
                }
                i++;
            });

            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }
    }

    // This functions gets the 0th product described in the
    // hidden products_json_hidden form element (value() field)
    function getZerothJSONProductHTML() {
        var products_json = JSON.parse($("#products_json_hidden").val());
        var date = Date.now();

        var new_prod_element = "" +
            "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
            " data-image='" + products_json[0][4] + "' data-colors='' style='opacity:0; height:100%; dispay:none;'" +
            " data-product_type='" + products_json[0][3] + "'>" +
            "   <div data-toggle='modal' onmouseover='prodHover(" + products_json[0][0] + ")'  data-target='#prodModal' data-id='" + products_json[0][0] + "' class='fake-link card card-product card-plain my-card-light' id='prod" + products_json[0][0] + "'>" +
            "       <div style='overflow:visible;padding-top:10px;' class='image text-center'>" +
            "           <div id='topImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "           <a>" +
            "               <img id='imgProdId" + products_json[0][0] + "' class='my-img-dark' style='max-width:90%;max-height:300px;height:auto;width:auto;' src='/" + products_json[0][4] + "' alt='Couldnt Find Image'/>" +
            "           </a>" +
            "           <div id='bottomImgSpacerProdId" + products_json[0][0] + "' style='height:0px';></div>" +
            "       </div>" +
            "       <div class='content text-center'>" +
            "           <a>" +
            "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
            "           </a>" +
            //"           <p class='description'>" +
            //products_json[0][2] +
            //"           </p>" +
            "           <div class='footer'>" +
            "               <span class='price'>" + products_json[0][6] + "</span>" +
            "               <button onclick='filterBtnOnClick(\"" + products_json[0][3] + "\")' class='btn btn-danger btn-tooltip btn-simple pull-right' data-toggle='tooltip' title='Filter to " + products_json[0][3] + "' data-placement='left'>" +
            //"                   <i style='align-self:right;' class='fa fa-filter'></i>" +
            "               </button>" +
            "           </div>" +
            "       </div>" +
            "   </div> <!-- end card -->" +
            "</div>";

        jQuery.ready();

        return new_prod_element;
    }

    function addAndAnimateImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 added due to some padding at top of img
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300 && prodImgHeight > 0) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                            $("#bottomImgSpacerProdId" + prodId).animate({
                                height: spaceDivHeight
                            }, 300);
                        }
                        // Sometimes an image might still be loading due to slow network or something.
                        // In these cases, I believe height returned will be 0 or less than 0.
                        // When this is the case, we want to pause (to allow it to finish loading)
                        // and call the function again. Then return from the function (to end
                        // the initial instance of the function. This may happen multiple times.
                        else if (prodImgHeight <= 0) {
                            setTimeout(function () {
                                addAndAnimateImgSpacers();
                            }, 500);

                        }
                    });
                }
            });
        }
    }

    function addImgSpacers() {
        if ($(window).width() > 890) {
            $("#productColumn").children().each(function () {
                if (($(this).attr("id")).indexOf("row") >= 0 && $(this).css("display") != "none") {
                    $(this).children().each(function () {
                        var prodId = $(this).attr("data-id");
                        // 10 is added due to some padding at the top
                        var prodImgHeight = $("#imgProdId" + prodId).height() + 10;
                        if (prodImgHeight < 300) {
                            var spaceDivHeight = (300 + 10 - prodImgHeight) / 2;
                            $("#topImgSpacerProdId" + prodId).height(spaceDivHeight);
                            $("#bottomImgSpacerProdId" + prodId).height(spaceDivHeight);
                        }
                    });
                }
            });
        }
    }

    // This function builds the product rows
    // as they're described in the hidden products_json_hidden
    // form element (value() field).
    function buildAllProductRows() {
        // Parse the JSON (to add a new prod (which matches filter options))
        var products_json = JSON.parse($("#products_json_hidden").val());

        // Replace existing products and keep track of our position
        var rowNum = 0;
        // Set initial element id to begin at
        var id = 'row' + rowNum;
        // This will be used for tracking position
        var rowCol = [0, 0];
        // Check if there even is a row (there should/will be unless the user
        // previously filtered to something with zero results
        // TODO: Handle this event... (see statement above)
        var hasNextRow = !!document.getElementById(id);
        while (hasNextRow) {
            // jquery selector
            var selector = '#' + id;

            // Iterate over each existing product
            $(selector).children().each(function (i) {
                var product_element = $(this);

                if ($("#products_json_hidden").val() != "[]") {
                    // Parse the JSON (to add a new prod (which matches filter options))
                    var products_json = JSON.parse($("#products_json_hidden").val());

                    // Generate/Save html to replace what we just faded/removed
                    var new_prod_element = getZerothJSONProductHTML();

                    // Replace the element we're on with
                    product_element.replaceWith(new_prod_element);

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);

                    rowCol[1]++;
                }
            });

            // Check if we need to adjust/increment column/row
            if (rowCol[1] > 2) {
                //reset rowCol (since there's only to be three products per row)
                rowCol[1] = 0;
                rowCol[0]++;
            }
            // Increment row num (to check for) and count
            rowNum++;
            // Set new id (to row after one we just hid)
            id = 'row' + rowNum;
            // Check if new/next row exists
            hasNextRow = !!document.getElementById(id);
        }

        // If the filter the user chose returns more than was previously there, then we need to continue adding
        if ($("#products_json_hidden").val() != "[]") {
            // Parse the JSON (to add a new prod (which matches filter options))
            var products_json = JSON.parse($("#products_json_hidden").val());

            while ($("#products_json_hidden").val() != "[]") {
                // First ensure a row exists for the item to be put into
                // And that we're not trying to add a 4th column
                if (!!$("#row" + rowCol[0]) && rowCol[1] <= 2) {
                    // Append the product
                    $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement below

                    // Drop 0th element from json text
                    products_json.splice(0, 1);
                    var products_json_str = JSON.stringify(products_json);
                    // push the json string to the hidden element for latter use
                    addHiddenInputElement("products_json_hidden", products_json_str);
                }
                else if (rowCol[1] > 2) {
                    //reset rowCol (since there's only to be three products per row)
                    rowCol[1] = 0;
                    rowCol[0]++;
                }
                // Need to create the row to put the product into
                else {
                    //alert("getting here...");
                    //Check if there are any previous rows to append to
                    var rowOneBack = rowCol[0]--;
                    if (!!$("#row" + rowOneBack)) {
                        $("#row" + rowOneBack).append("</div> <div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());
                    }
                    // There are no rows. Need to create from scratch. None to append to
                    else {
                        // Need to create new row
                        // Appending </div><[new row stuffs]> to end of existing existing row
                        $("#productColumn").append("<div class='row' id='row" + rowCol[0] + "' style='overflow:hidden;'></div>");
                        $("#row" + rowCol[0]).append(getZerothJSONProductHTML());

                        // Drop 0th element from json text
                        products_json.splice(0, 1);
                        var products_json_str = JSON.stringify(products_json);
                        // push the json string to the hidden element for latter use
                        addHiddenInputElement("products_json_hidden", products_json_str);
                    }
                    // Increment rowCol
                    // Increment rowCol
                    if (rowCol[1] > 2) {
                        rowCol[0]++;
                    }
                    rowCol[1]++;
                    // rowCol[1] == 3 will be handled next while iteration by else if statement above
                }
            }
        }
        else {
            removeRemainingProducts(rowCol[0], rowCol[1]);
        }
    }

    /*$(window).on("resize",function(){
            waitForFinalEvent(function() {
                setProductSectionContainerSize();
                alert("here....");
            },1000);
        });*/

    var waitForFinalEvent = (function () {
        var timers = {};
        return function (callback, ms, uniqueId) {
            if (!uniqueId) {
                uniqueId = "Don't call this twice without a uniqueId";
            }
            if (timers[uniqueId]) {
                clearTimeout(timers[uniqueId]);
            }
            timers[uniqueId] = setTimeout(callback, ms);
        };
    })();

    function enableFilters() {
        $(window).trigger('resize');
        // This will enable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', 1);
        $('#disableFilterDiv').remove();
        scaleAndShadowById("filterDiv", 400);
        setTimeout(function () {
            $('#filterDiv').removeClass("remove-shadow-size");
        }, 800);
    }

    // This is the main function for applying filter options
    // after the user modifies them. This function calls
    // the other needed function with the correct timing
    // between each one.
    function applyFilterOptions() {
        // Start by stopping any existing animation on the product column
        $("#productColumn").stop(true);
        // Add spacer to bottom. This gives the circle space to exist on the phone view
        $("#footerSpacer").addClass("space-150");
        // Apply the "Loading" circle to the screen
        var pos = $("#productColumn").position();
        var w = $("#productColumn").width();
        //alert(pos.top + "," + pos.left);
        $('<div id="loadingCircle" class="loader" style="display:none;position:absolute;top:' + (pos.top.toString()) + 'px;left:' + ((pos.left) + (w / 2) - 60).toString() + 'px;z-index:2;"></div>').insertAfter("#productColumn");
        $("#loadingCircle").fadeIn(1000);

        var productColHtml = "";

        // Get filters as list of arrays
        var filters = getFilterState();
        // Convert to string (for server side python/django function)
        filters_str = "";
        filters_str += "" + filters.images.toString();
        //filters_str+= ":-!" + filters.clothing.toString();
        filters_str += ":-!" + filters.products.toString();
        //filters_str+= ":-!" + filters.colors.toString();

        //alert(filters_str);

        // Debug Purposes
        //alert(filters.images + " - " + filters.clothing + " - " + filters.products + " - " + filters.colors);

        // This will disable the filter div
        // We'll re-enable it after processing the filter request
        $('#filterDiv').fadeTo('fast', .6);
        $('#filterDiv').append('<div id="disableFilterDiv" style="position: absolute;top:0;left:0;width: 100%;height:100%;z-index:2;opacity:0.4;filter: alpha(opacity = 50)"></div>');

        $.ajax({
            url: '/art/filter_request/',
            type: "POST",
            data: {filters: filters_str, csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (response) {
                //alert(response);
                console.log(response);
                // Save the response
                addHiddenInputElement("products_json_hidden", response);

                // Method TWO START
                ////////////////////////////////////////////////////////////////////////////////////////////////
                // Goal here is to collaps all rows and then expand all rows with new products showing
                ////////////////////////////////////////////////////////////////////////////////////////////////
                //collapseAllProductRows();

                // Set hidden element that dictates whether or not we got products back to show
                if ($("#products_json_hidden").val() == "[]") {
                    addHiddenInputElement("productsStatus", "none");
                }
                else {
                    addHiddenInputElement("productsStatus", "some");
                }

                // Start by just fading away the entire product column/rows element
                // This way we can do whatever with the rows/product elements on the inside and then fade it back in
                $("#productColumn").animate({
                    opacity: 0
                }, 500);

                setTimeout(function () {
                    $("#productColumn").slideUp(500);
                    // Build product rows (while the column is opacity 0)
                    setTimeout(function () {
                        buildAllProductRows();
                        initializeProductRows();
                        // If after filtering we're not showing all rows,
                        // then get the "Load More" button there and ready.
                        if (existsHiddenProdRows()) {
                            if (existsHiddenProdRows()) {
                                var loadMoreHtml = "<div class ='col-md-3 col-md-offset-4' id ='loadMoreCol'>" +
                                    "<button style='display:none;' rel='tooltip' title='' class='btn btn-info" +
                                    " btn-round' id='loadMore' data-toggle='morphing' data-rotation-color='blue'>" +
                                    "Load more...</button></div>";
                                $('#loadMoreCol').replaceWith(loadMoreHtml);
                                // Fade in new instance of button
                                $('#loadMore').fadeIn(400, "", setLoadMoreClickFunc());
                                $('#loadMore').morphingButton();
                            } else {
                                $('#loadMoreCol').animate({
                                    height: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                            }
                        }
                        else {
                            $("#loadMoreCol").slideUp("slow");
                        }
                        setTimeout(function () {
                            loadMoreProductRows("expandThenFade", 500);
                            $("#loadingCircle").fadeOut(500);
                            // Remove spacer to bottom. This gives the circle space to exist on the phone view
                            setTimeout(function () {
                                enableFilters();
                                $("#footerSpacer").removeClass("space-150");
                            }, 500)
                        }, 100);
                    }, 1000);
                }, 1000);

                // Set needed rows to be "display:none;"

                /* ---------- Method ONE START ----------
                    //////////////////////////////////////////////////////////////
                    //(this got complicated fast so I'm trying a different method
                    //////////////////////////////////////////////////////////////
                    // Loop through rows/products and remove if not found in
                    // the list that we just got from the server
                    var rowNum = 0;
                    // Set initial element id to begin at
                    var id     = 'row' + rowNum;
                    var rowCol = [0,0];
                    // Check if there even is a row (there should/will be unless the user
                    // previously filtered to something with zero results
                    // TODO: Handle this event... (see statement above)
                    var hasNextRow = !!document.getElementById(id);
                    while(hasNextRow){
                        rowCol[1] = 0;
                        // jquery selector
                        var selector = '#' + id;
                        // get row element
                        var row = $(selector);

                        var prodIdCounter = 0;
                        // Loop over each product element and check if it should be there
                        $(selector).children().each(function(i) {
                            //alert("On Row " + selector + " Child " + $(this).attr("data-id"));
                            var products_json = JSON.parse($("#products_json_hidden").val());
                            //Debug purposes
                            //alert($(this).attr("name") + $(this).attr("data-product_type"));

                            // Determine if this particular product should be shown
                            // (based on new filter settings)
                            var i = 0;
                            var existsInFilteredProdList = false;
                            for(i = 0; i < products_json.length; i++){
                                // Debug - Output ID we're checking against
                                //alert(products_json[i][0]);
                                if(products_json[i][0] == $(this).attr("data-id")){
                                    existsInFilteredProdList = true;
                                    break;
                                }
                            }
                            // DEBUG OUTPUT...
                            //alert(existsInFilteredProdList);

                            var product_element = $(this);
                            // If it's not in the filters product list, then fade it away and fade
                            // something else in
                            if(!existsInFilteredProdList){
                                product_element.animate({
                                    width: "toggle",
                                    opacity: "toggle"
                                }, 1000);
                                setTimeout(function(){
                                    // If there exists some in the list to show
                                    if($("#products_json_hidden").val() != "[]") {
                                        // Parse the JSON (to add a new prod (which matches filter options))
                                        var products_json =  JSON.parse($("#products_json_hidden").val());
                                        // If this product isn't already listed
                                        if(!!$("[data-id=" + products_json[0][0] + "]")) {
                                            // Generate/Save html to replace what we just faded/removed
                                            var date = Date.now();
                                            var new_prod_element = "" +
                                                "<div id='" + "prod" + products_json[0][0] + "-" + date + "'" + " class='col-md-4' data-id='" + products_json[0][0] + "'" +
                                                " data-image='" + products_json[0][4] + "' data-colors='' style='display:none'" +
                                                "data-product_type='" + products_json[0][3] + "'>" +
                                                "   <div class='card card-product card-plain'>" +
                                                "       <div class='image'>" +
                                                "           <a href='#'>" +
                                                "               <img src='/" + products_json[0][4] + "' alt='...'/>" +
                                                "           </a>" +
                                                "       </div>" +
                                                "       <div class='content'>" +
                                                "           <a href='#'>" +
                                                "               <h4 class='title'>" + products_json[0][1] + "</h4>" +
                                                "           </a>" +
                                                "           <p class='description'>" +
                                                products_json[0][2] +
                                                "           </p>" +
                                                "           <div class='footer'>" +
                                                "               <span class='price'> TODO </span>" +
                                                "               <button class='btn btn-danger btn-simple pull-right' rel='tooltip' title='Remove from wishlist' data-placement='left'>" +
                                                "                   <i class='fa fa-heart'></i>" +
                                                "               </button>" +
                                                "           </div>" +
                                                "       </div>" +
                                                "   </div> <!-- end card -->" +
                                                "</div>";
                                            // Replace the element we're on with
                                            product_element.replaceWith(new_prod_element);

                                            // Fade/Expand it in.
                                            $("#prod" + products_json[0][0] + "-" + date).animate({
                                                width: "toggle",
                                                opacity: "toggle"
                                            }, 1000);
                                        }

                                        // We should have just taken the 0th item in the json list/array and
                                        // put it on the web page (if it wasn't already there)

                                        // Get json string (hidden element vlaue) as json object
                                        var products_json = JSON.parse($("#products_json_hidden").val());

                                        // Drop 0th element from json text
                                        products_json.splice(0,1);
                                        var products_json_str = JSON.stringify(products_json);
                                        // push the json string to the hidden element for latter use
                                        addHiddenInputElement("products_json_hidden", products_json_str);
                                    }
                                },1000);
                            }
                            else{
                                // There's nothing to do here because it should stay right where it is.
                            }

                            rowCol[1]++;
                        });

                        // Increment row num (to check for) and count
                        rowNum++;
                        // Set new id (to row after one we just hid)
                        id = 'row' + rowNum;
                        // Check if new/next row exists
                        hasNextRow = !!document.getElementById(id);

                        // Increment rowCol
                        rowCol[0]++;
                    }
                    -------- End Method ONE -------*/

                //alert(rowCol[0] + "," + rowCol[1]);
                // Anything remaining in the products_json (results of filter) needs to be added

            },
            error: function () {
                alert("Error...");
            }
        });
    }

    $('#checkoutEmailHref').on("click", function () {
        $('#checkoutModalBackBtn').hide();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutShippingHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').show();
        $('#checkoutModalPayBtn').hide();
    });

    $('#checkoutPaymentHref').on("click", function () {
        $('#checkoutModalBackBtn').show();
        $('#checkoutModalNextBtn').hide();
        $('#checkoutModalPayBtn').show();
    });

    // When "Next" button is clicked on the checkout modal
    $("#checkoutModalNextBtn").on("click", function () {
        // For each child li of the nav pills (in the checkout modal)
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutPaymentHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
        });
    });

    $("#checkoutModalBackBtn").on("click", function () {
        $('#checkoutNavPills').children('li').each(function () {
            // If email pill is active
            if (this.id == "checkoutEmailli" && $('#checkoutEmailli').hasClass("active")) {
                // Button shouldn't be clicable when form is in this state
                return false;
            }
            // If shipping pill is active
            else if (this.id == "checkoutShippingli" && $('#checkoutShippingli').hasClass("active")) {
                $('#checkoutEmailHref').trigger("click");
                return false;
            }
            // If payment pill is active
            else if (this.id == "checkoutPaymentli" && $('#checkoutPaymentli').hasClass("active")) {
                $('#checkoutShippingHref').trigger("click");
                return false;
            }
        });
    });

    $(document).ready(function () {
        {#$icon = $addon.find('span'),#}
        {#$addon = $group.find('.input-group-addon'),#}
        {#$addon.removeClass('success');#}
        {#$addon.addClass('danger');#}
        {#$icon.attr('class', 'fas fa-times-circle');#}

        var email = document.getElementById("email_input");

        $('.form-control').keyup(function () {
            if ($.trim($('.form-control').val()).length) {
                $(this).addClass('sq-input--focus');
                $(this).removeClass('sq-input--error');
                {#$(this).removeClass('sq-input--focus');#}
            } else {
                $(this).removeClass('active-text');
            }
        });

        /*
        $('.input-group input[required]').on('keyup change', function () {
            var $form = $(this).closest('form'),
                $group = $(this).closest('.input-group'),
                $addon = $group.find('.input-group-addon'),
                $icon = $addon.find('span'),
                state = false;

            if (!$group.data('validate')) {
                state = $(this).val() ? true : false;
            } else if ($group.data('validate') == "email") {
                state = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test($(this).val())
            }


            if (state) {
                document.getElementById("disabledButtonWrapper").title = "";
                $addon.removeClass('danger');
                $addon.addClass('success');
                $icon.attr('class', 'fas fa-check-circle');
            } else {
                document.getElementById("disabledButtonWrapper").title = "Email is Invalid";
                $addon.removeClass('success');
                $addon.addClass('danger');
                $icon.attr('class', 'fas fa-times-circle');
            }

            if ($form.find('.input-group-addon.danger').length == 0) {
                $form.find('[type="submit"]').prop('disabled', false);
            } else {
                $form.find('[type="submit"]').prop('disabled', true);
            }
        });

        $('.input-group input[required], .input-group textarea[required], .input-group select[required]').trigger('change');
        */

    });

    var sendEmailBtn = document.getElementById("sendEmail");
    var contactModal = document.getElementById('contactModal');

    sendEmailBtn.onclick = function () {
        var _name = document.getElementById("contactorName").value;
        var _email = document.getElementById("contactorEmail").value;
        var _phone = document.getElementById("contactorPhone").value;
        var _message = document.getElementById("contactorMessage").value;

        // Close and clear the contact modal
        $('#contactModal').modal('hide');
        $('#contactorName').val('');
        $('#contactorEmail').val('');
        $('#contactorPhone').val('');
        $('#contactorMessage').val('');

        $.ajax({
            url: '/art/contact_us_email/',
            type: "POST",
            data: {
                name: _name,
                email: _email,
                phone_number: _phone,
                message: _message,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // TODO: It's possible that we get a successful response even though we didn't send the email.
                // TODO-cont: In view should put specific thing in there. If not found (here) then consider it
                // TODO-cont: failed. Otherwise if we find specific string, success.
                //console.log(response);
                // Configure Notification
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                };
                toastr["success"]("Your message to the Ludega Team was sent successfully. Thanks!", "Success");
            },
            error: function () {
                // Configure Notification
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-center",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "0",
                    "extendedTimeOut": "0",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut",
                    "tapToDismiss": false
                };
                toastr["error"]("Woh, we're sorry but we seem to have hit a snag on our end. Please reach out to us directly at ludega.team@ludega.com or call us 24/7 at (720) 288-0674.", "Error");
            }
        });
    };

    function attemptCheckout(event) {
        // Email Field (checkout "form")validation
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (!emailReg.test($('#email_input').val())) {
            $('#email_input').addClass('sq-input--error');
            $('#checkoutEmailHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"]("Invalid Email");

            return;
        }

        // Shipping Info Validation
        var fname = document.getElementById("firstName_input");
        var lname = document.getElementById("lastName_input");
        var add1 = document.getElementById("address_input");
        var city = document.getElementById("city_input");
        var state = document.getElementById("state_input");
        var zip = document.getElementById("zip_input_shipping");
        var country = document.getElementById("country_input");

        var shipping_info_errors_found = false;
        var errorMsg = "";

        if (fname.value == "") {
            // fname.addClass("sq-input--error");
            fname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "First name required<br>";
        }
        if (lname.value == "") {
            // fname.addClass("sq-input--error");
            lname.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Last name required<br>";
        }
        if (add1.value == "") {
            // fname.addClass("sq-input--error");
            add1.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Address required<br>";
        }
        if (city.value == "") {
            // fname.addClass("sq-input--error");
            city.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "City required<br>";
        }
        if (state.value == "") {
            // fname.addClass("sq-input--error");
            state.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "State required<br>";
        }
        if (zip.value == "") {
            // fname.addClass("sq-input--error");
            zip.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Zip Code required<br>";
        }
        if (country.value == "") {
            // fname.addClass("sq-input--error");
            country.className += " sq-input--error";
            shipping_info_errors_found = true;
            errorMsg += "Country required<br>";
        }

        if (shipping_info_errors_found) {
            // Take user to shipping section of form
            $('#checkoutShippingHref').trigger("click");

            // Display notification informing of success
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": true,
                "onclick": null,
                "showDuration": "500",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
            toastr["error"](errorMsg);
            return;
        }

        // If we're here, all our validation passed.
        // Note: Square takes care of validating card info, so it's still possible that errors come back (during card
        // nonce request / after.
        if (!requestCardNonce(event)) {
            // TODO: Error. What should we do here and when will/should false be returned?
        }
    }
</script>
<!-- If you are using TypeKit.com uncomment this code -->
<!--
        <script src="https://use.typekit.net/[your kit code here].js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        -->
<!-- If you have retina @2x images on your server which can be sent to iPhone/iPad/MacRetina, please uncomment the next line -->
<!-- <script src="assets/js/retina.min.js"></script> -->
<!-- This ensures that when the modal opens, it won't scroll the background of up -->
</html>
